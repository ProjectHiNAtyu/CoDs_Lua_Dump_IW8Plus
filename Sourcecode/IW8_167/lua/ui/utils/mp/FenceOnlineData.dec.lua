-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
FenceOnlineData = LUI.Class( LUI.Fence )
FenceOnlineData.CODE_STATE = {
	downloading = 2,
	inactive = 0,
	success = 3,
	requested = 1,
	failure = 4
}
FenceOnlineData.CONTROLLER_FENCE_STATE = {
	pass = 2,
	block = 3,
	fail = 4,
	inactive = 1
}
FenceOnlineData.GAMEMODE_TYPE = {
	sp = 1,
	mp = 2,
	cp = 3,
	none = 0
}
FenceOnlineData.init = function ( f19_arg0, f19_arg1 )
	LUI.Fence.init( f19_arg0 )
	f19_arg0._perController = {}
	f19_arg0._gameMode = f19_arg1
	for f19_local0 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		Fences.CFIIIAEBDD( f19_local0, f19_arg0._gameMode )
		f19_arg0._perController[f19_local0] = {
			isCancelling = false,
			fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.inactive
		}
	end
end

FenceOnlineData.Start = function ( f18_arg0 )
	DebugPrint( "FenceOnlineData.Start" )
end

FenceOnlineData.Stop = function ( f17_arg0 )
	DebugPrint( "FenceOnlineData.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "popup_getting_data", true )
	f17_arg0._openedWaitPopup = false
end

FenceOnlineData.OpenPopup = function ( f15_arg0 )
	local f15_local0 = f15_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data", false, nil, false, {
		onCancel = function ( f16_arg0, f16_arg1 )
			DebugPrint( "Cancelling FenceOnlineData" )
			f15_arg0._perController[f16_arg1].isCancelling = true
		end
	}, nil, true, true )
	f15_arg0._openedWaitPopup = true
end

FenceOnlineData.OnBackOut = function ( f14_arg0 )
	for f14_local0 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		Fences.CFIIIAEBDD( f14_local0, f14_arg0._gameMode )
	end
	Engine.DHHHJGGFJG()
end

FenceOnlineData.PostFail = function ( f13_arg0 )
	if f13_arg0._state == LUI.Fence.STATE.fail then
		local f13_local0 = Engine.IJEBHJIJF()
		if not Engine.CGABICJHAI() and not CONDITIONS.ForceOnlineMenus() then
			LUI.FlowManager.RequestAddMenu( "MainMenuOffline", true, f13_local0 )
		end
		if f13_arg0._errorCode then
			Fences.IABFCACDD( f13_local0 )
			if Dvar.IBEGCHEFE( "NNLMOPLQQO" ) then
				LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data_error_with_fence_status", false, f13_local0, false, {
					errorCode = f13_arg0._errorCode,
					gameMode = f13_arg0._gameMode
				}, nil, false, false )
			else
				LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data_error", false, f13_local0, false, {
					errorCode = f13_arg0._errorCode
				}, nil, false, false )
			end
		else
			LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data_cancelled", false, f13_local0, false, {}, nil, false, false )
		end
	end
end

FenceOnlineData.UpdateState = function ( f12_arg0 )
	assert( f12_arg0._state ~= LUI.Fence.STATE.fail )
	for f12_local0 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		local f12_local3 = Engine.BBHAECABBD( f12_local0 )
		local f12_local4
		if f12_local3 then
			f12_local4 = f12_local3
		else
			f12_local4 = Engine.DBAEJAHFGJ( f12_local0 )
		end
		if f12_local3 and not f12_local4 then
			local f12_local5, f12_local6 = Fences.CIHFIEHIDE( f12_local0, f12_arg0._gameMode )
			if f12_local5 == FenceOnlineData.CODE_STATE.inactive then
				Fences.CFFIJIBGA( f12_local0, f12_arg0._gameMode, true )
				f12_local5, f12_local6 = Fences.CIHFIEHIDE( f12_local0, f12_arg0._gameMode )
			end
			if f12_local5 == FenceOnlineData.CODE_STATE.failure then
				f12_arg0._perController[f12_local0].errorCode = f12_local6
				f12_arg0._perController[f12_local0].fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.fail
			elseif f12_local5 ~= FenceOnlineData.CODE_STATE.success then
				f12_arg0._perController[f12_local0].fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.block
			else
				f12_arg0._perController[f12_local0].fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.pass
			end
			if f12_arg0._perController[f12_local0].isCancelling then
				f12_arg0._perController[f12_local0].fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.fail
				f12_arg0._perController[f12_local0].errorCode = nil
			end
		end
		f12_arg0._perController[f12_local0].fenceState = FenceOnlineData.CONTROLLER_FENCE_STATE.inactive
		f12_arg0._perController[f12_local0].isCancelling = false
		f12_arg0._perController[f12_local0].errorCode = nil
	end
	local f12_local0 = 0
	local f12_local1 = 0
	local f12_local2 = 0
	for f12_local7 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		if f12_arg0._perController[f12_local7].fenceState == FenceOnlineData.CONTROLLER_FENCE_STATE.pass then
			f12_local0 = f12_local0 + 1
		end
		if f12_arg0._perController[f12_local7].fenceState == FenceOnlineData.CONTROLLER_FENCE_STATE.block then
			f12_local1 = f12_local1 + 1
		end
		if f12_arg0._perController[f12_local7].fenceState == FenceOnlineData.CONTROLLER_FENCE_STATE.fail then
			f12_local2 = f12_local2 + 1
		end
	end
	assert( 0 < f12_local2 + f12_local1 + f12_local0, "No active local clients" )
	if 0 < f12_local2 then
		for f12_local7 = 0, Engine.DCJGJDDEHE() - 1, 1 do
			if f12_arg0._perController[f12_local7].fenceState == FenceOnlineData.CONTROLLER_FENCE_STATE.fail then
				local f12_local6 = f12_arg0._perController[f12_local7].errorCode
				if 0 < f12_local0 and not Lobby.BJBBDIDHDA( f12_local7 ) then
					DebugPrint( "Controller #" .. tostring( f12_local7 ) .. " does not have online data. Making client inactive." )
					f12_arg0._state = LUI.Fence.STATE.block
					Engine.CIHFHAIIHC( f12_local7 )
					if f12_local6 then
						assert( type( f12_local6 ) == "number" )
						Fences.IABFCACDD( f12_local7 )
						if Dvar.IBEGCHEFE( "NNLMOPLQQO" ) then
							LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data_error_with_fence_status", false, f12_local7, false, {
								errorCode = f12_arg0._errorCode,
								gameMode = f12_arg0._gameMode
							}, nil, false, false )
						end
						LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_data_error", false, f12_local7, false, {
							errorCode = f12_local6
						}, nil, false, true )
					end
				end
				f12_arg0._errorCode = f12_local6
				f12_arg0._state = LUI.Fence.STATE.fail
			end
		end
	elseif 0 < f12_local1 then
		f12_arg0._state = LUI.Fence.STATE.block
	elseif 0 < f12_local0 then
		f12_arg0._state = LUI.Fence.STATE.pass
	else
		assert( false, "Unexpected state" )
		f12_arg0._state = LUI.Fence.STATE.block
	end
	if f12_arg0._state == LUI.Fence.STATE.pass and Engine.EAIICIFIFA() then
		InitCPRankedDataSources()
	end
	if f12_arg0._state == LUI.Fence.STATE.block and not f12_arg0._openedWaitPopup then
		f12_arg0:OpenPopup()
	end
end

function PopupGettingData( f11_arg0, f11_arg1 )
	local f11_local0 = assert
	local f11_local1
	if f11_arg1 then
		f11_local1 = f11_arg1
	else
		f11_local1 = f11_arg1.onCancel
	end
	f11_local0( f11_local1 )
	f11_local0 = {
		displayWZWipSetup = true,
		message = Engine.CBBHFCGDIC( "MENU/POPUP_ONLINEDATA" ),
		cancel_func = f11_arg1.onCancel
	}
	local f11_local2 = nil
	if Engine.CGABICJHAI() then
		f11_local2 = MenuBuilder.BuildRegisteredType( "live_dialog_text_box", f11_local0 )
	else
		f11_local2 = MenuBuilder.BuildRegisteredType( "live_dialog_text_box_with_cancel", f11_local0 )
	end
	f11_local2.id = "popup_getting_data"
	return f11_local2
end

function PopupGettingDataError( f9_arg0, f9_arg1 )
	local f9_local0 = assert
	local f9_local1
	if f9_arg1 then
		f9_local1 = f9_arg1
	else
		f9_local1 = f9_arg1.errorCode
	end
	f9_local0( f9_local1 )
	f9_local0 = {
		popup_title = Engine.CBBHFCGDIC( "MENU/ERROR" ),
		message_text = Engine.CBBHFCGDIC( "EXE/ERR_ONLINE_DATA", f9_arg1.errorCode )
	}
	if Engine.CGABICJHAI() then
		f9_local0.button_text = Engine.CBBHFCGDIC( "LUA_MENU/QUIT_DESKTOP" )
		f9_local0.confirmation_action = function ( f10_arg0, f10_arg1 )
			Engine.DJEDDFJEIG()
		end
		
	end
	local f9_local2 = MenuBuilder.BuildRegisteredType( "generic_confirmation_popup", f9_local0 )
	f9_local2.id = "popup_getting_data_error"
	return f9_local2
end

function PopupGettingDataCancelled( f8_arg0, f8_arg1 )
	local f8_local0 = MenuBuilder.BuildRegisteredType( "generic_confirmation_popup", {
		popup_title = Engine.CBBHFCGDIC( "MENU/NOTICE" ),
		message_text = Engine.CBBHFCGDIC( "MENU/POPUP_ONLINEDATA_CANCELLED" ),
		label = Engine.CBBHFCGDIC( "MENU/OK" )
	} )
	f8_local0.id = "popup_getting_data_cancelled"
	return f8_local0
end

function PopupGettingDataErrorWithFenceStatusString( f5_arg0, f5_arg1 )
	local f5_local0 = assert
	local f5_local1
	if f5_arg1 then
		f5_local1 = f5_arg1
	else
		f5_local1 = f5_arg1.errorCode and f5_arg1.gameMode
	end
	f5_local0( f5_local1 )
	f5_local0 = ""
	if Dvar.IBEGCHEFE( "NSPMLKQLOS" ) then
		f5_local0 = Fences.GADAACFC( f5_arg1.controllerIndex, f5_arg1.gameMode )
	end
	local f5_local2 = Engine.CBBHFCGDIC( "MENU/OK" )
	f5_local1 = nil
	if Engine.CGABICJHAI() then
		f5_local2 = Engine.CBBHFCGDIC( "LUA_MENU/QUIT_DESKTOP" )
		f5_local1 = function ( f7_arg0, f7_arg1 )
			Engine.DJEDDFJEIG()
		end
		
	end
	local f5_local3 = f5_arg1.controllerIndex
	if not f5_local3 then
		DebugPrint( "Warning: opening popup for unspecified controllerIndex" )
		f5_local3 = 0
	end
	local f5_local4 = {
		controllerIndex = f5_local3,
		title = Engine.CBBHFCGDIC( "MENU/ERROR" ),
		noBackButton = true,
		cancelClosesPopup = false,
		listContent = {}
	}
	local f5_local5 = Engine.CBBHFCGDIC( "EXE/ERR_ONLINE_DATA", f5_arg1.errorCode ) .. " " .. f5_local0
	local f5_local6 = 24
	if IsLanguageArabic() then
		f5_local6 = 36
	end
	local self = LUI.UIText.new()
	self:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 0, f5_local6 * _1080p )
	self:SetAlignment( LUI.Alignment.Center )
	self:SetRGBFromTable( SWATCHES.genericButton.description, 0 )
	if Engine.CGABICJHAI() then
		self:SetFont( FONTS.GetFont( FONTS.BattleNetRegular.File ) )
	else
		self:SetFont( FONTS.GetFont( FONTS.BodyRegular.File ) )
	end
	self.id = "message"
	self:setText( f5_local5 )
	table.insert( f5_local4.listContent, self )
	local f5_local8 = MenuBuilder.BuildRegisteredType( "PopupButton", {
		controllerIndex = f5_local3
	} )
	f5_local8:SetLeftAnchor( 0.5 )
	f5_local8:SetRightAnchor( 0.5 )
	f5_local8:SetLeft( -200 )
	f5_local8:SetRight( 200 )
	f5_local8.id = "ok_button"
	f5_local8.action = f5_local1
	f5_local8:SetText( f5_local2 )
	f5_local8:addEventHandler( "button_action", function ( f6_arg0, f6_arg1 )
		assert( f6_arg1.controller )
		if f5_arg0.action then
			f5_arg0.action( f6_arg0, f6_arg1.controller )
		end
		LUI.FlowManager.RequestLeaveMenu( f6_arg0, true, false )
	end )
	table.insert( f5_local4.listContent, f5_local8 )
	local f5_local9 = "\n" .. Fences.CHBEJGEFFG( f5_arg1.controllerIndex ) .. "\n"
	local f5_local10 = nil
	f5_local10 = LUI.UIStyledText.new()
	f5_local10.id = "FenceErrorStatus"
	f5_local10:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 25, 40 )
	f5_local10:SetAlignment( LUI.Alignment.Center )
	f5_local10:SetRGBFromTable( SWATCHES.Popups.highlight, 0 )
	f5_local10:setText( f5_local9, 0 )
	f5_local10:SetFont( FONTS.GetFont( FONTS.MainRegular.File ) )
	f5_local10:SetWordWrap( true )
	table.insert( f5_local4.listContent, f5_local10 )
	local f5_local11 = MenuBuilder.BuildRegisteredType( "PopupList", f5_local4 )
	f5_local11.id = "popup_getting_data_error_with_fence_status"
	Engine.BJDBIAGIDA( SOUND_SETS.default.popup )
	return f5_local11
end

MenuBuilder.registerType( "popup_getting_data", PopupGettingData )
MenuBuilder.registerType( "popup_getting_data_error", PopupGettingDataError )
MenuBuilder.registerType( "popup_getting_data_error_with_fence_status", PopupGettingDataErrorWithFenceStatusString )
MenuBuilder.registerType( "popup_getting_data_cancelled", PopupGettingDataCancelled )
LUI.Fence.Register( "onlineData", FenceOnlineData )
FenceMainOnlineData = LUI.Class( FenceOnlineData )
FenceMainOnlineData.init = function ( f4_arg0 )
	FenceMainOnlineData.super.init( f4_arg0, FenceOnlineData.GAMEMODE_TYPE.none )
end

LUI.Fence.Register( "mainOnlineData", FenceMainOnlineData )
FenceSPOnlineData = LUI.Class( FenceOnlineData )
FenceSPOnlineData.init = function ( f3_arg0 )
	FenceSPOnlineData.super.init( f3_arg0, FenceOnlineData.GAMEMODE_TYPE.sp )
end

LUI.Fence.Register( "spOnlineData", FenceSPOnlineData )
FenceMPOnlineData = LUI.Class( FenceOnlineData )
FenceMPOnlineData.init = function ( f2_arg0 )
	FenceMPOnlineData.super.init( f2_arg0, FenceOnlineData.GAMEMODE_TYPE.mp )
end

LUI.Fence.Register( "mpOnlineData", FenceMPOnlineData )
FenceCPOnlineData = LUI.Class( FenceOnlineData )
FenceCPOnlineData.init = function ( f1_arg0 )
	FenceCPOnlineData.super.init( f1_arg0, FenceOnlineData.GAMEMODE_TYPE.cp )
end

LUI.Fence.Register( "cpOnlineData", FenceCPOnlineData )
LockTable( _M )
