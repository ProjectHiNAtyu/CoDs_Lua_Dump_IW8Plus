-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 02-09-2025 10:42
module( ..., package.seeall )
local f0_local0 = "GunsmithButton"
local f0_local1 = function ( f24_arg0 )
	for f24_local0 = 1, GUNSMITH.maxCategories, 1 do
		if not f24_arg0._usedButtons[f24_local0] then
			local f24_local3 = f24_arg0[f0_local0 .. f24_local0]
			assert( f24_local3 )
			f24_local3:closeTree()
			f24_arg0[f0_local0 .. f24_local0] = nil
		end
	end
	f24_arg0._buttonsRemoved = true
end

local f0_local2 = function ( f23_arg0 )
	if f23_arg0._shouldDebugDynIcons == true and f23_arg0._weaponTable then
		local f23_local0 = DYN_ATTACHMENT.GetDynamicAttachmentsTable( WEAPON.GetWeaponModelName( f23_arg0._weaponTable.weapon, f23_arg0._weaponTable, {
			includeStickers = true,
			includeAttachments = true,
			keepAkimbo = true,
			includeCamos = true,
			controllerIndex = controllerIndex
		} ) )
		f23_arg0.WeaponAttributes:SetAlpha( 0 )
		f23_arg0.DynamicWeaponIcon:SetAlpha( 1 )
		f23_arg0.DynamicWeaponIcon:PerformUpdate( controllerIndex, {
			isInteractive = false,
			attachmentsData = f23_local0,
			weaponRef = f23_arg0._weaponTable.weapon
		} )
	end
end

local f0_local3 = function ( f22_arg0, f22_arg1, f22_arg2 )
	local f22_local0 = GUNSMITH.maxCategories / 2
	local f22_local1
	if f22_arg2 then
		f22_local1 = 1
	else
		f22_local1 = math.ceil( f22_local0 )
	end
	local f22_local2
	if f22_arg2 then
		f22_local2 = math.ceil( f22_local0 )
		if not f22_local2 then
		
		else
			local f22_local3
			if f22_arg2 then
				f22_local3 = math.ceil( f22_local0 )
				if not f22_local3 then
				
				else
					for f22_local4 = 0, f22_local3, 1 do
						local f22_local7 = f22_arg1 - f22_local4
						if f22_local7 < f22_local1 then
							f22_local7 = f22_local2
						end
						if f22_arg0._usedButtons[f22_local7] then
							return f22_local7
						end
					end
				end
			end
			f22_local3 = math.floor( f22_local0 )
		end
	end
	f22_local2 = GUNSMITH.maxCategories
end

local f0_local4 = function ( f21_arg0 )
	local f21_local0 = 0
	for f21_local4, f21_local5 in ipairs( f21_arg0._weaponTable.attachments ) do
		if f21_local5.ref ~= ATTACHMENT.none then
			f21_local0 = f21_local0 + 1
		end
	end
	f21_arg0.EquippedCount.EquippedTxt:setText( Engine.CBBHFCGDIC( "CAS/EQUIPPED_COUNT", f21_local0, ATTACHMENT.count ) )
	f21_arg0.EquippedCount:SetupCount( f21_local0 )
end

local f0_local5 = function ( f20_arg0 )
	local f20_local0 = math.ceil( GUNSMITH.maxCategories / 2 )
	for f20_local1 = 1, GUNSMITH.maxCategories, 1 do
		if f20_arg0._usedButtons[f20_local1] then
			local f20_local4 = f20_arg0[f0_local0 .. f20_local1]
			f20_local4.navigation = f20_local4.navigation or {}
			if f20_local0 < f20_local1 then
				local f20_local5 = f0_local0( f20_arg0, f20_local1 - f20_local0 + 1, true )
				if f20_local5 then
					f20_local4.navigation.up = f20_arg0[f0_local0 .. f20_local5]
				end
			end
			local f20_local5 = f20_local1 + f20_local0
			if f20_local1 ~= 1 then
				f20_local5 = f20_local5 - 1
			end
			f20_local5 = f0_local0( f20_arg0, f20_local5, false )
			if f20_local5 then
				f20_local4.navigation.down = f20_arg0[f0_local0 .. f20_local5]
			end
		end
	end
	f20_arg0._navigationSetup = true
end

local f0_local6 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = GUNSMITH.GetBlockedCategories( f19_arg0._weaponTable )
	for f19_local5, f19_local6 in pairs( f19_arg0._usedButtons ) do
		if f19_local6 then
			local f19_local4 = f19_arg0[f0_local0 .. f19_local5]
			assert( f19_local4 )
			f19_local4:Setup( f19_arg1, f19_local6, f19_arg0._attachments[f19_local6], f19_arg0._weaponTable, f19_local0[f19_local6] )
		end
	end
	if not f19_arg0._buttonsRemoved then
		f0_local0( f19_arg0 )
	end
	if not f19_arg0._navigationSetup then
		f0_local0( f19_arg0 )
	end
end

local f0_local7 = function ( f18_arg0 )
	local self = LUI.UIHorizontalNavigator.new()
	self.id = "topNavigator"
	f18_arg0:addElement( self )
	local f18_local1 = LUI.UIHorizontalNavigator.new()
	f18_local1.id = "bottomNavigator"
	f18_arg0:addElement( f18_local1 )
	local f18_local2 = math.ceil( GUNSMITH.maxCategories / 2 )
	for f18_local3 = 1, GUNSMITH.maxCategories, 1 do
		local f18_local6
		if f18_local2 < f18_local3 and not f18_local1 then
			f18_local6 = f18_local1
		else
			f18_local6 = self
		end
		local f18_local7 = f18_arg0[f0_local0 .. f18_local3]
		assert( f18_local7 )
		f18_arg0:RemoveElement( f18_local7 )
		f18_local6:addElement( f18_local7 )
	end
end

local f0_local8 = function ( f17_arg0, f17_arg1, f17_arg2 )
	f17_arg0._weaponTable = WEAPON.GenerateWeaponTable( f17_arg2 )
	f0_local0( f17_arg0, f17_arg1 )
	local f17_local0 = f17_arg0:getParent()
	if f17_local0 and f17_local0._weaponModel then
		WEAPON.LoadAndSetModel( f17_arg1, f17_local0._weaponModel, f17_arg0._weaponTable )
	end
	f17_arg0.WeaponAttributes:Setup( f17_arg0._weaponTable )
	f0_local0( f17_arg0 )
	f0_local0( f17_arg0 )
end

local f0_local9 = function ( f16_arg0, f16_arg1 )
	local f16_local0 = LUI.FlowManager.GetScopedData( f16_arg0 )
	if f16_local0.appearanceOptions then
		LUI.FlowManager.RequestAddMenu( "AttachmentAppearanceSelect", true, f16_arg1.controller, false, f16_local0.appearanceOptions )
	end
end

local f0_local10 = function ( f8_arg0, f8_arg1, f8_arg2 )
	local selfBindButton = LUI.UIBindButton.new()
	selfBindButton.id = "selfBindButton"
	f8_arg0:addElement( selfBindButton )
	f8_arg0.selfBindButton = selfBindButton
	
	local f8_local1 = function ( f15_arg0 )
		local f15_local0 = LUI.FlowManager.GetScopedData( f15_arg0 )
		if f15_local0.selectedIndex then
			GUNSMITH.EquipAttachment( nil, f8_arg0, ATTACHMENT.none, f8_arg0, {
				attachSlot = f15_local0.selectedIndex
			} )
			f8_arg0( f8_arg0, f8_arg0, f8_arg0 )
		end
	end
	
	f8_arg0.selfBindButton:registerEventHandler( "button_alt1", function ( element, event )
		f8_arg0( element )
	end )
	f8_arg0:addEventHandler( "contextual_menu_deselect_attachment", f8_local1 )
	f8_arg0.selfBindButton:registerEventHandler( "button_alt2", function ( element, event )
		ATTACHMENT.ClearAllAttachments( f8_arg0 )
		f8_arg0( f8_arg0, f8_arg0, f8_arg0 )
	end )
	local f8_local2 = function ()
		if PROGRESSION.IsWeaponMaxLevel( f8_arg0, f8_arg0._weaponTable.weapon ) or PROGRESSION.ShouldUnlockAll() then
			return false
		else
			LUI.FlowManager.RequestPopupMenu( nil, "NextUnlocksPopup", true, f8_arg0, false, {
				weaponRef = f8_arg0._weaponTable.weapon,
				bucketItems = f8_arg0._bucketItems
			} )
			return true
		end
	end
	
	f8_arg0.selfBindButton:registerEventHandler( "button_right_trigger", function ( element, event )
		if f8_arg0() and event.qualifier then
			Engine.BJDBIAGIDA( CoD.SFX.MouseClick )
		end
	end )
	f8_arg0.GunsmithProgress.kbmButton:addEventHandler( "button_action", function ( f10_arg0, f10_arg1 )
		f8_arg0()
	end )
	f8_arg0.selfBindButton:registerEventHandler( "button_left_stick", function ( element, event )
		f8_arg0( element, event )
	end )
end

local f0_local11 = function ( f7_arg0, f7_arg1, f7_arg2 )
	assert( f7_arg0.WeaponAttributes )
	if Engine.BHICADFIHA() then
		if not f7_arg2.loadoutIndex then
			DebugPrint( "WARNING: Missing \"loadoutIndex\" option for Gunsmith menu. Only OK after a MyChanges." )
			f7_arg2.loadoutIndex = 0
		end
		if not f7_arg2.weaponSlot then
			DebugPrint( "WARNING: Missing \"weaponSlot\" option for Gunsmith menu. Only OK after a MyChanges." )
			f7_arg2.weaponSlot = 0
		end
	end
	f7_arg0._shouldDebugDynIcons = CONDITIONS.DynamicIconDebugEnabled()
	assert( f7_arg2.loadoutPlayerData )
	assert( f7_arg2.weaponPlayerData )
	assert( f7_arg2.loadoutIndex )
	assert( f7_arg2.weaponSlot )
	local f7_local0 = f7_arg2.loadoutPlayerData
	local f7_local1 = f7_arg2.weaponPlayerData
	f7_arg0._weaponTable = WEAPON.GenerateWeaponTable( f7_local1 )
	f7_arg0._attachments, f7_arg0._bucketItems = GUNSMITH.GetAttachmentsAndBucketItems( f7_arg1, f7_arg0._weaponTable.weapon, f7_arg0._weaponTable.lootID )
	f7_arg0._usedButtons = GUNSMITH.GetUsedAttachmentIndices( f7_arg0._weaponTable.weapon, f7_arg0._attachments )
	f0_local0( f7_arg0 )
	f0_local0( f7_arg0, f7_arg1 )
	f7_arg0.WeaponAttributes:Setup( f7_arg0._weaponTable )
	f0_local0( f7_arg0 )
	if PROGRESSION.ShouldUnlockAll() then
		f7_arg0.GunsmithProgress:SetAlpha( 0 )
		f7_arg0.GunsmithWeaponLevel:SetAlpha( 0 )
	else
		f7_arg0.GunsmithProgress:Setup( f7_arg1, f7_arg0._bucketItems, f7_arg0._weaponTable.weapon )
		f7_arg0.GunsmithWeaponLevel:Setup( f7_arg1, f7_arg0._weaponTable.weapon )
	end
	f0_local0( f7_arg0, f7_arg1, f7_local1 )
	if IsLanguageChinese() then
		ACTIONS.AnimateSequence( f7_arg0, "CH" )
	end
	if f7_arg0._shouldDebugDynIcons == true then
		local DynamicWeaponIcon = nil
		
		DynamicWeaponIcon = MenuBuilder.BuildRegisteredType( "WeaponWithAttachments", {
			controllerIndex = f7_arg1
		} )
		DynamicWeaponIcon.id = "DynamicWeaponIcon"
		DynamicWeaponIcon:SetRGBFromInt( 12566463, 0 )
		DynamicWeaponIcon:SetScale( 0.5, 0 )
		DynamicWeaponIcon:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 71, _1080p * 531, _1080p * -297, _1080p * -69 )
		f7_arg0:addElement( DynamicWeaponIcon )
		f7_arg0.DynamicWeaponIcon = DynamicWeaponIcon
		
		f0_local0( f7_arg0 )
	end
	if CONDITIONS.IsWZWipFlowEnabled() and Engine.DDJFBBJAIG() then
		f7_arg0.WZWipSnipeBackgroundSceneOverlay:UpdateSnipeOverlay( {
			useGunsmithSetup = true,
			weaponRef = f7_arg0._weaponTable.weapon
		} )
	end
end

function GunsmithAttachments( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "GunsmithAttachments"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	local f1_local3 = nil
	if CONDITIONS.InGame( self ) then
		f1_local3 = MenuBuilder.BuildRegisteredType( "InGameMenuBackground", {
			controllerIndex = f1_local1
		} )
		f1_local3.id = "InGameMenuBackground"
		f1_local3:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, 0, 0 )
		self:addElement( f1_local3 )
		self.InGameMenuBackground = f1_local3
	end
	local f1_local4 = nil
	if CONDITIONS.IsWZWipFlowEnabled() then
		f1_local4 = MenuBuilder.BuildRegisteredType( "WZSnipeBackgroundSceneOverlay", {
			controllerIndex = f1_local1
		} )
		f1_local4.id = "WZWipSnipeBackgroundSceneOverlay"
		f1_local4:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, 0, 0 )
		self:addElement( f1_local4 )
		self.WZWipSnipeBackgroundSceneOverlay = f1_local4
	end
	local f1_local5 = nil
	if not Engine.DDJFBBJAIG() then
		f1_local5 = MenuBuilder.BuildRegisteredType( "InGameMenuTimerStatus", {
			controllerIndex = f1_local1
		} )
		f1_local5.id = "InGameMenuTimerStatus"
		f1_local5:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 1473, _1080p * 1873, _1080p * 66, _1080p * 116 )
		self:addElement( f1_local5 )
		self.InGameMenuTimerStatus = f1_local5
	end
	local WeaponAttributes = nil
	
	WeaponAttributes = MenuBuilder.BuildRegisteredType( "WeaponAttributes", {
		controllerIndex = f1_local1
	} )
	WeaponAttributes.id = "WeaponAttributes"
	WeaponAttributes:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 95, _1080p * 507, _1080p * -263, _1080p * -103 )
	self:addElement( WeaponAttributes )
	self.WeaponAttributes = WeaponAttributes
	
	local GunsmithButton1 = nil
	
	GunsmithButton1 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton1.id = "GunsmithButton1"
	GunsmithButton1:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -955, _1080p * -515, _1080p * 251, _1080p * 315 )
	self:addElement( GunsmithButton1 )
	self.GunsmithButton1 = GunsmithButton1
	
	local GunsmithButton2 = nil
	
	GunsmithButton2 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton2.id = "GunsmithButton2"
	GunsmithButton2:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -579, _1080p * -139, _1080p * 227, _1080p * 291 )
	self:addElement( GunsmithButton2 )
	self.GunsmithButton2 = GunsmithButton2
	
	local GunsmithButton3 = nil
	
	GunsmithButton3 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton3.id = "GunsmithButton3"
	GunsmithButton3:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -220, _1080p * 220, _1080p * 199, _1080p * 263 )
	self:addElement( GunsmithButton3 )
	self.GunsmithButton3 = GunsmithButton3
	
	local GunsmithButton4 = nil
	
	GunsmithButton4 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton4.id = "GunsmithButton4"
	GunsmithButton4:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * 139, _1080p * 579, _1080p * 227, _1080p * 291 )
	self:addElement( GunsmithButton4 )
	self.GunsmithButton4 = GunsmithButton4
	
	local GunsmithButton5 = nil
	
	GunsmithButton5 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton5.id = "GunsmithButton5"
	GunsmithButton5:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * 498, _1080p * 938, _1080p * 251, _1080p * 315 )
	self:addElement( GunsmithButton5 )
	self.GunsmithButton5 = GunsmithButton5
	
	local GunsmithButton6 = nil
	
	GunsmithButton6 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton6.id = "GunsmithButton6"
	GunsmithButton6:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -448, _1080p * -8, _1080p * 817, _1080p * 881 )
	self:addElement( GunsmithButton6 )
	self.GunsmithButton6 = GunsmithButton6
	
	local GunsmithButton7 = nil
	
	GunsmithButton7 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton7.id = "GunsmithButton7"
	GunsmithButton7:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -122, _1080p * 318, _1080p * 846, _1080p * 910 )
	self:addElement( GunsmithButton7 )
	self.GunsmithButton7 = GunsmithButton7
	
	local GunsmithButton8 = nil
	
	GunsmithButton8 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton8.id = "GunsmithButton8"
	GunsmithButton8:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * 188, _1080p * 628, _1080p * 847, _1080p * 911 )
	self:addElement( GunsmithButton8 )
	self.GunsmithButton8 = GunsmithButton8
	
	local GunsmithButton9 = nil
	
	GunsmithButton9 = MenuBuilder.BuildRegisteredType( "GunsmithButton", {
		controllerIndex = f1_local1
	} )
	GunsmithButton9.id = "GunsmithButton9"
	GunsmithButton9:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * 498, _1080p * 938, _1080p * 817, _1080p * 881 )
	self:addElement( GunsmithButton9 )
	self.GunsmithButton9 = GunsmithButton9
	
	local EquippedCount = nil
	
	EquippedCount = MenuBuilder.BuildRegisteredType( "GunsmithEquippedSlots", {
		controllerIndex = f1_local1
	} )
	EquippedCount.id = "EquippedCount"
	EquippedCount:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 130, _1080p * 462, _1080p * -299, _1080p * -267 )
	self:addElement( EquippedCount )
	self.EquippedCount = EquippedCount
	
	local f1_local17 = nil
	if CONDITIONS.InFrontend( self ) then
		f1_local17 = MenuBuilder.BuildRegisteredType( "LobbyMembersFooter", {
			controllerIndex = f1_local1
		} )
		f1_local17.id = "LobbyMembersFooter"
		f1_local17:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 0, _1080p * 150 )
		self:addElement( f1_local17 )
		self.LobbyMembersFooter = f1_local17
	end
	local GunsmithProgress = nil
	
	GunsmithProgress = MenuBuilder.BuildRegisteredType( "GunsmithProgress", {
		controllerIndex = f1_local1
	} )
	GunsmithProgress.id = "GunsmithProgress"
	GunsmithProgress:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -627, _1080p * -97, _1080p * 97, _1080p * 150 )
	self:addElement( GunsmithProgress )
	self.GunsmithProgress = GunsmithProgress
	
	local GunsmithWeaponLevel = nil
	
	GunsmithWeaponLevel = MenuBuilder.BuildRegisteredType( "GunsmithWeaponLevel", {
		controllerIndex = f1_local1
	} )
	GunsmithWeaponLevel.id = "GunsmithWeaponLevel"
	GunsmithWeaponLevel:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -643, _1080p * -447, _1080p * 61, _1080p * 85 )
	self:addElement( GunsmithWeaponLevel )
	self.GunsmithWeaponLevel = GunsmithWeaponLevel
	
	local CDLRestrictionTag = nil
	
	CDLRestrictionTag = MenuBuilder.BuildRegisteredType( "CDLRestrictionTag", {
		controllerIndex = f1_local1
	} )
	CDLRestrictionTag.id = "CDLRestrictionTag"
	CDLRestrictionTag:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 1508, _1080p * 1824, _1080p * 170, _1080p * 200 )
	self:addElement( CDLRestrictionTag )
	self.CDLRestrictionTag = CDLRestrictionTag
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequences.Modification = function ()
		
	end
	
	self._sequences.HasModification = function ()
		
	end
	
	self._sequences.ModifyWithModification = function ()
		
	end
	
	local f1_local21 = nil
	EquippedCount:RegisterAnimationSequence( "CH", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Top,
			value = _1080p * -320
		},
		{
			duration = 0,
			property = TWEEN_PROPERTY.Bottom,
			value = _1080p * -287
		}
	} )
	self._sequences.CH = function ()
		menu:AnimateSequence( "CH" )
	end
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "GunsmithAttachments", GunsmithAttachments )
LockTable( _M )
