-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
local f0_local0 = 10
local f0_local1 = 1
local f0_local2 = 2
local f0_local3 = "ReticleCrosshairDot"
local f0_local4 = function ( f21_arg0, f21_arg1, f21_arg2, f21_arg3, f21_arg4, f21_arg5, f21_arg6, f21_arg7, f21_arg8, f21_arg9, f21_arg10, f21_arg11, f21_arg12 )
	if not MenuBuilder.IsTypeRegistered( f21_arg1 ) then
		DebugPrint( "ERROR: Attempting to use unknown widget " .. f21_arg1 .. ". Ensure this widget is properly included for your game mode!" )
		return nil
	end
	local f21_local0 = MenuBuilder.BuildRegisteredType( f21_arg1, {
		controllerIndex = f21_arg3
	} )
	local f21_local1 = {
		entityTag = f21_arg2,
		isLockedToTag = f21_arg6,
		tagOffsetX = f21_arg7,
		naturalDistance = f21_arg8,
		naturalFOV = f21_arg9,
		defaultScale = f21_arg10,
		minScale = f21_arg11,
		maxScale = f21_arg12
	}
	f21_local0.id = "weaponWidget" .. f21_arg1
	f21_local0:SetupAnchoredElement( f21_local1 )
	if f21_arg4 then
		f21_local0:AttachToReticleViewModel()
	else
		f21_local0:AttachToViewModel( f21_arg5 )
	end
	f21_arg0:addElement( f21_local0 )
	return f21_local0
end

local f0_local5 = function ( f20_arg0, f20_arg1, f20_arg2 )
	if not MenuBuilder.IsTypeRegistered( f20_arg2 ) then
		DebugPrint( "ERROR: Attempting to use unknown widget " .. f20_arg2 .. ". Ensure this widget is properly included for your game mode!" )
		return nil
	end
	local f20_local0 = MenuBuilder.BuildRegisteredType( f20_arg2, {
		isBlockedCrosshair = false,
		controllerIndex = f20_arg1
	} )
	f20_local0.id = "crosshairWidget" .. f20_arg2
	f20_local0:SetAnchors( 0, 0, 0, 0, 0 )
	if f20_local0.ReticleCrosshairBase then
		f20_local0.ReticleCrosshairBase.ReticleCrosshairBaseOuter:SetupDynamicCrosshairPips()
		f20_local0.ReticleCrosshairBase.Dot:SetupDynamicCrosshairCenterDot()
	elseif f20_arg2 == f0_local0 then
		f20_local0:SetupDynamicCrosshairCenterDot()
	else
		f20_local0:SetupDynamicCrosshairPips()
	end
	if Engine[0x84287BE93239E99]() then
		f20_local0:dispatchEventToChildren( {
			dispatchChildren = true,
			name = "mobile_crosshair_style",
			scale = Dvar[0xEDCFC612B39E0C0]( 0x35998EFB7A1DB92 )
		} )
	end
	f20_arg0:addElement( f20_local0 )
	return f20_local0
end

local f0_local6 = function ( f19_arg0, f19_arg1, f19_arg2 )
	if not MenuBuilder.IsTypeRegistered( f19_arg2 ) then
		DebugPrint( "ERROR: Attempting to use unknown widget " .. f19_arg2 .. ". Ensure this widget is properly included for your game mode!" )
		return nil
	end
	local f19_local0 = MenuBuilder.BuildRegisteredType( f19_arg2, {
		isBlockedCrosshair = true,
		controllerIndex = f19_arg1
	} )
	f19_local0.id = "blockedCrosshairWidget" .. f19_arg2
	f19_local0:SetAnchors( 0, 0, 0, 0, 0 )
	if f19_local0.ReticleCrosshairBase then
		f19_local0.ReticleCrosshairBase.ReticleCrosshairBaseOuter:SetupDynamicCrosshairPips()
		f19_local0.ReticleCrosshairBase.Dot:SetupDynamicCrosshairCenterDot()
	elseif f19_arg2 == f0_local0 then
		f19_local0:SetupDynamicCrosshairCenterDot()
	else
		f19_local0:SetupDynamicCrosshairPips()
	end
	f19_local0:SetRGBFromTable( SWATCHES.HUD.enemyTeam )
	f19_arg0:addElement( f19_local0 )
	return f19_local0
end

local f0_local7 = function ( f18_arg0, f18_arg1, f18_arg2 )
	assert( f18_arg2.isPrimary ~= nil )
	assert( f18_arg2.isAlternate ~= nil )
	assert( f18_arg2.reticleIndex )
	local f18_local0 = "tag_reticle_attach"
	if f18_arg2.isAlternate then
		f18_local0 = "tag_reticle_attach2"
	end
	local f18_local1 = f18_arg0.reticleNames
	local f18_local2
	if f18_arg2.isAlternate then
		f18_local2 = 2
	else
		f18_local2 = 1
	end
	f18_local1 = f18_local1[f18_local2] ~= f18_arg2.reticleName
	if f18_arg0.reticles[f18_arg2.reticleIndex] and f18_local1 then
		f18_arg0.reticles[f18_arg2.reticleIndex]:closeTree()
		f18_arg0.reticles[f18_arg2.reticleIndex] = nil
	end
	if f18_arg2.reticleType ~= nil and 0 < #f18_arg2.reticleType and f18_local1 then
		f18_local2, f18_local3, f18_local4, f18_local5 = nil
		if f18_arg2.isPrimary then
			f18_local2 = Reticle[0x23742A69D7F5825]( f18_arg1, f18_arg2.isAlternate )
			f18_local5 = Reticle[0x13F7AE89DFC6E16]( f18_arg1, f18_arg2.isAlternate )
			if Reticle[0xCD0510EC63A89E4]( f18_arg1, f18_arg2.isAlternate ) then
				f18_local3 = Reticle[0x15A6B7714FD0AD9]( f18_arg1, f18_arg2.isAlternate )
			end
			f18_local4 = Reticle[0xFE4A5D4DCA4A4A8]( f18_arg1, f18_arg2.isAlternate )
		else
			f18_local2 = Reticle[0xC73A641E79EA3B9]( f18_arg1, f18_arg2.isAlternate )
			f18_local5 = Reticle[0x363F203268F2372]( f18_arg1, f18_arg2.isAlternate )
			f18_local4 = Reticle[0x2525D75712F8AC0]( f18_arg1, f18_arg2.isAlternate )
		end
		f18_arg0.reticles[f18_arg2.reticleIndex] = f0_local0( f18_arg0, f18_arg2.reticleType, f18_local0, f18_arg1, true, true, f18_local2, f18_local5, Reticle[0xC64ABFE83750AD5]( f18_arg1, f18_arg2.isAlternate ), f18_local3, f18_local4, Reticle[0xE9F5513A2E6BE7F]( f18_arg1, f18_arg2.isAlternate ), Reticle[0x35F2FC1A4A30C05]( f18_arg1, f18_arg2.isAlternate ) )
	end
end

local f0_local8 = function ( f17_arg0, f17_arg1, f17_arg2 )
	local f17_local0 = nil
	local f17_local1 = false
	if f17_arg2 ~= nil and 0 < #f17_arg2 then
		f17_local0 = Game[0x452777EC5FA7DD5]( f17_arg1 )
		f17_local1 = Game[0xD1C271BEBA20F99]( f17_arg1, f17_local0 )
	end
	local f17_local2 = f17_arg0.weaponWidgetType ~= f17_arg2
	if f17_arg0.weaponWidget and (f17_local2 or (f17_arg0.weaponWidgetBone ~= f17_local0) or not f17_local1) then
		f17_arg0.weaponWidget:closeTree()
		f17_arg0.weaponWidget = nil
	end
	if f17_arg2 ~= nil and 0 < #f17_arg2 and f17_local2 and f17_local1 then
		f17_arg0.weaponWidget = f0_local0( f17_arg0, f17_arg2, f17_local0, f17_arg1, false, Game[0xCBB6EBCF8D8D4AB]( f17_arg1 ), true, nil, f0_local0, nil, f0_local0, f0_local0, nil )
		f17_arg0.weaponWidgetType = f17_arg2
		f17_arg0.weaponWidgetBone = f17_local0
	else
		f17_arg0.weaponWidgetType = nil
		f17_arg0.weaponWidgetBone = nil
	end
end

local f0_local9 = function ( f16_arg0, f16_arg1, f16_arg2 )
	if f16_arg0.maxNumAttachments ~= f16_arg2 then
		return true
	elseif not f16_arg0.attachmentsInfo then
		return true
	end
	local f16_local0 = 0
	for f16_local1 = 0, f16_arg2 - 1, 1 do
		local f16_local4 = Game[0x1CE94E268E8474D]( f16_arg1, f16_local1 )
		local f16_local5 = Game[0xCE362F53EEDC7AE]( f16_arg1, f16_local1 )
		local f16_local6 = Game[0xE9123A0DB7B03D6]( f16_arg1, f16_local1 )
		if f16_local4 ~= nil and 0 < #f16_local4 then
			f16_local0 = f16_local0 + 1
			if not f16_arg0.attachmentsInfo[f16_local0] then
				return true
			end
			if (f16_local4 ~= f16_arg0.attachmentsInfo[f16_local0].widgetType) or (f16_local5 ~= f16_arg0.attachmentsInfo[f16_local0].widgetAttachPoint) or f16_local6 ~= f16_arg0.attachmentsInfo[f16_local0].widgetUsesScopeStencil then
				return true
			end
		end
	end
	if f16_local0 ~= #f16_arg0.attachmentsList then
		return true
	end
	return false
end

local f0_local10 = function ( f15_arg0, f15_arg1, f15_arg2 )
	if f15_arg0.attachmentsList then
		for f15_local3, f15_local4 in ipairs( f15_arg0.attachmentsList ) do
			f15_arg0.attachmentsList[f15_local3]:closeTree()
			f15_arg0.attachmentsList[f15_local3] = nil
		end
	end
	f15_arg0.attachmentsList = nil
	f15_arg0.attachmentsInfo = nil
	f15_arg0.attachmentsList = {}
	f15_arg0.attachmentsInfo = {}
	f15_arg0.maxNumAttachments = f15_arg2
	for f15_local0 = 0, f15_arg2 - 1, 1 do
		local f15_local4 = Game[0x1CE94E268E8474D]( f15_arg1, f15_local0 )
		local f15_local5 = Game[0xCE362F53EEDC7AE]( f15_arg1, f15_local0 )
		local f15_local6 = Game[0xE9123A0DB7B03D6]( f15_arg1, f15_local0 )
		if f15_local4 ~= nil and 0 < #f15_local4 then
			f15_arg0.attachmentsList[#f15_arg0.attachmentsList + 1] = f0_local0( f15_arg0, f15_local4, f15_local5, f15_arg1, false, f15_local6, true, nil, f0_local0, nil, f0_local0, f0_local0, nil )
			f15_arg0.attachmentsInfo[#f15_arg0.attachmentsInfo + 1] = {
				widgetType = f15_local4,
				widgetAttachPoint = f15_local5,
				widgetUsesScopeStencil = f15_local6
			}
		end
	end
end

local f0_local11 = function ( f14_arg0, f14_arg1, f14_arg2 )
	if f14_arg0.crosshairWidget then
		f14_arg0.crosshairWidget:closeTree()
		f14_arg0.crosshairWidget = nil
	end
	if f14_arg0.blockedCrosshairWidget then
		f14_arg0.blockedCrosshairWidget:closeTree()
		f14_arg0.blockedCrosshairWidget = nil
	end
	if f14_arg2 ~= nil and 0 < #f14_arg2 then
		f14_arg0.crosshairWidget = f0_local0( f14_arg0, f14_arg1, f14_arg2 )
		f14_arg0.blockedCrosshairWidget = f0_local0( f14_arg0, f14_arg1, f14_arg2 )
	end
	f14_arg0.crosshairWidgetType = f14_arg2
end

local f0_local12 = function ( f13_arg0, f13_arg1 )
	local f13_local0 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.primaryReticleVisible" )
	f13_local0 = f13_local0:GetValue( f13_arg1 )
	local f13_local1 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.altReticleVisible" )
	f13_local1 = f13_local1:GetValue( f13_arg1 )
	local f13_local2 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.weaponInfoLUIWidgetsVisible" )
	f13_local2 = f13_local2:GetValue( f13_arg1 )
	local f13_local3 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.hipfireCrosshairVisible" )
	f13_local3 = f13_local3:GetValue( f13_arg1 )
	local f13_local4 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.blockedCrosshairVisible" )
	f13_local4 = f13_local4:GetValue( f13_arg1 )
	if f13_local1 and not f13_local0 and not f13_arg0.reticles[3] then
		f13_local0 = true
		f13_local1 = false
	end
	if f13_arg0.reticles[1] then
		local f13_local5 = f13_arg0.reticles[1]
		local f13_local6 = f13_local5
		f13_local5 = f13_local5.SetAlpha
		local f13_local7
		if f13_local0 then
			f13_local7 = 1
		else
			f13_local7 = 0
		end
		f13_local5( f13_local6, f13_local7, 0 )
	end
	if f13_arg0.reticles[3] then
		local f13_local5 = f13_arg0.reticles[3]
		local f13_local6 = f13_local5
		f13_local5 = f13_local5.SetAlpha
		local f13_local7
		if f13_local1 then
			f13_local7 = 1
		else
			f13_local7 = 0
		end
		f13_local5( f13_local6, f13_local7, 0 )
	end
	if f13_arg0.weaponWidget then
		local f13_local5 = f13_arg0.weaponWidget
		local f13_local6 = f13_local5
		f13_local5 = f13_local5.SetAlpha
		local f13_local7
		if f13_local2 then
			f13_local7 = 1
		else
			f13_local7 = 0
		end
		f13_local5( f13_local6, f13_local7, 0 )
	end
	if f13_arg0.attachmentsList then
		for f13_local7, f13_local10 in ipairs( f13_arg0.attachmentsList ) do
			local f13_local11 = f13_arg0.attachmentsList[f13_local7]
			local f13_local12 = f13_local11
			f13_local11 = f13_local11.SetAlpha
			local f13_local9
			if f13_local2 then
				f13_local9 = 1
			else
				f13_local9 = 0
			end
			f13_local11( f13_local12, f13_local9, 0 )
		end
	end
	if f13_arg0.crosshairWidget then
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x2B7DA075887F96F ) then
			f13_local3 = false
		end
		local f13_local5 = f13_arg0.crosshairWidget
		local f13_local6 = f13_local5
		f13_local5 = f13_local5.SetAlpha
		local f13_local7
		if f13_local3 then
			f13_local7 = 1
		else
			f13_local7 = 0
		end
		f13_local5( f13_local6, f13_local7, 0 )
	end
	if f13_arg0.blockedCrosshairWidget then
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x2B7DA075887F96F ) then
			f13_local4 = false
		end
		local f13_local5 = f13_arg0.blockedCrosshairWidget
		local f13_local6 = f13_local5
		f13_local5 = f13_local5.SetAlpha
		local f13_local7
		if f13_local4 then
			f13_local7 = 1
		else
			f13_local7 = 0
		end
		f13_local5( f13_local6, f13_local7, 0 )
	end
end

local f0_local13 = function ( f12_arg0 )
	f12_arg0.reticleShakeProperties = {}
	f12_arg0.defaultReticleShakeProperties = {
		numRapidFireBullets = 1,
		multiplier = 1,
		magnitude = 0,
		settleDuration = 0,
		duration = 0
	}
	f12_arg0.reticleShake = {
		timer = 0,
		minMagnitude = 0,
		epsilon = 1.9991592787261236E+37,
		currentNumBullets = 0,
		maxMagnitude = 60,
		burstFireResetTime = 600
	}
end

local f0_local14 = function ( f11_arg0 )
	local f11_local0 = f11_arg0.reticleShakeProperties.magnitude
	if f11_arg0.reticleShakeProperties.numRapidFireBullets < f11_arg0.reticleShake.currentNumBullets then
		f11_local0 = f11_local0 * f11_arg0.reticleShakeProperties.multiplier
	end
	local f11_local1 = LUI.Lerp( f11_arg0.reticleShake.minMagnitude, f11_arg0.reticleShake.maxMagnitude, f11_local0 ) * math.random()
	local f11_local2 = math.random() * 2 * math.pi
	f11_arg0.reticles[1]:SetScreenOffsets( f11_local1 * math.cos( f11_local2 ), f11_local1 * math.sin( f11_local2 ) )
end

local f0_local15 = function ( f10_arg0 )
	if not f10_arg0.reticles[1] then
		return 
	end
	local f10_local0 = 0
	f10_local0 = Engine[0xF16311E3FCA3DCF]()
	local f10_local1 = f10_local0 - f10_arg0.previousTime
	if f10_arg0.reticleShake.burstFireResetTime < f10_local0 - f10_arg0.lastShotFiredTime then
		f10_arg0.reticleShake.currentNumBullets = 0
	end
	if 0 < f10_arg0.reticleShake.timer then
		f10_arg0.reticleShake.timer = f10_arg0.reticleShake.timer - f10_local1
		f0_local0( f10_arg0 )
	else
		f10_arg0.reticleShake.timer = 0
		local f10_local2 = f10_arg0.reticles[1]:GetScreenOffsets()
		if math.abs( f10_local2.x ) <= f10_arg0.reticleShake.epsilon and math.abs( f10_local2.y ) <= f10_arg0.reticleShake.epsilon then
			f10_arg0.reticles[1]:SetScreenOffsets( 0, 0 )
			return 
		end
		local f10_local3 = 1
		if 0 < f10_arg0.reticleShakeProperties.settleDuration then
			f10_local3 = (f10_local0 - f10_arg0.lastShotFiredTime) / f10_arg0.reticleShakeProperties.settleDuration
		end
		f10_local3 = LUI.clamp( f10_local3, 0, 1 )
		f10_local2.x = LUI.Lerp( f10_local2.x, 0, f10_local3 )
		f10_local2.y = LUI.Lerp( f10_local2.y, 0, f10_local3 )
		f10_arg0.reticles[1]:SetScreenOffsets( f10_local2.x, f10_local2.y )
	end
	f10_arg0.previousTime = f10_local0
end

local f0_local16 = function ( f9_arg0 )
	if not f9_arg0.reticles[1] then
		return 
	end
	f9_arg0.reticleShake.currentNumBullets = f9_arg0.reticleShake.currentNumBullets + 1
	if f9_arg0.reticleShake.timer <= 0 then
		f9_arg0.reticleShake.timer = f9_arg0.reticleShakeProperties.duration
	end
end

local f0_local17 = function ( f8_arg0 )
	f0_local0( f8_arg0 )
end

local f0_local18 = nil
f0_local18 = function ( f6_arg0, f6_arg1 )
	local f6_local0 = f6_arg0:Wait( 50 )
	f0_local0( f6_arg0 )
	f6_local0.onComplete = function ()
		return f6_arg0( f6_arg0, f6_arg0 )
	end
	
end

local f0_local19 = function ( f5_arg0, f5_arg1 )
	f5_arg0.lastShotFiredTime = Engine[0xF16311E3FCA3DCF]()
	f0_local0( f5_arg0 )
end

function FrontendScopeReticleManager( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "FrontendScopeReticleManager"
	self.reticles = {}
	self.reticleNames = {}
	local f1_local1 = controller.controllerIndex or 0
	local f1_local2 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.crosshairWidget" )
	f0_local0( self )
	self.previousTime = 0
	self.lastShotFiredTime = 0
	self:addEventHandler( "post_restart", function ( f4_arg0, f4_arg1 )
		f4_arg0.previousTime = 0
		f4_arg0.lastShotFiredTime = 0
		menu.reticleShake.timer = 0
	end )
	local f1_local3 = function ()
		if Dvar[0x9E5BE3B4BBA4E0E]( 0xA0375D33FC78DBA ) then
			local f3_local0 = Reticle[0x65D4365B16E06F]( menu, false )
			local f3_local1 = Reticle[0x6893E8D5F9CA3BB]( menu, false )
			local f3_local2 = Reticle[0x565048F9E3C3A64]( menu, false )
			local f3_local3, f3_local4, f3_local5 = nil
			f3_local3 = Reticle[0x65D4365B16E06F]( menu, true )
			f3_local4 = Reticle[0x6893E8D5F9CA3BB]( menu, true )
			f3_local5 = Reticle[0x565048F9E3C3A64]( menu, true )
			local f3_local6 = DataModel[0x614D394F6F9A18D]( menu:GetModel( menu ) )
			menu( menu, menu, {
				isAlternate = false,
				reticleIndex = 1,
				isPrimary = true,
				reticleType = f3_local0,
				reticleName = f3_local2
			} )
			menu( menu, menu, {
				isAlternate = false,
				reticleIndex = 2,
				isPrimary = false,
				reticleType = f3_local1,
				reticleName = f3_local2
			} )
			menu.reticleNames[1] = f3_local2
			menu( menu, menu, {
				isAlternate = true,
				reticleIndex = 3,
				isPrimary = true,
				reticleType = f3_local3,
				reticleName = f3_local5
			} )
			menu( menu, menu, {
				isAlternate = true,
				reticleIndex = 4,
				isPrimary = false,
				reticleType = f3_local4,
				reticleName = f3_local5
			} )
			menu.reticleNames[2] = f3_local5
			menu.reticleShakeProperties = menu.defaultReticleShakeProperties
			if menu.crosshairWidgetType ~= f3_local6 then
				menu( menu, menu, f3_local6 )
			end
			menu( menu, menu )
		end
	end
	
	local f1_local4 = DataSources.alwaysLoaded.player.currentWeapon.scopeVariation
	local f1_local5 = DataSources.alwaysLoaded.player.currentWeapon.scopeIndex
	local f1_local6 = DataSources.alwaysLoaded.player.currentWeapon.displayName
	local f1_local7 = DataSources.alwaysLoaded.player.currentWeapon.isDefaultWeapon
	local f1_local8 = DataSources.alwaysLoaded.player.currentWeapon.isNull
	self:SubscribeToModel( f1_local4:GetModel( f1_local1 ), f1_local3, true )
	self:SubscribeToModel( f1_local5:GetModel( f1_local1 ), f1_local3, true )
	self:SubscribeToModel( f1_local6:GetModel( f1_local1 ), f1_local3, true )
	self:SubscribeToModel( f1_local7:GetModel( f1_local1 ), f1_local3, true )
	self:SubscribeToModel( f1_local2:GetModel( f1_local1 ), f1_local3, true )
	self:SubscribeToModel( f1_local8:GetModel( f1_local1 ), f1_local3, true )
	local f1_local9 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.inWorldAttachmentsAlpha" )
	self:BindAlphaToModel( f1_local9:GetModel( f1_local1 ) )
	f1_local3()
	local f1_local10 = self:Wait( 50 )
	f1_local10.onComplete = function ()
		return menu( menu, menu )
	end
	
	return self
end

MenuBuilder.registerType( "FrontendScopeReticleManager", FrontendScopeReticleManager )
LockTable( _M )
