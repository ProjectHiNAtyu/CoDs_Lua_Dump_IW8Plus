-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 02-09-2025 10:42
module( ..., package.seeall )
local f0_local0 = function ( f7_arg0, f7_arg1, f7_arg2 )
	f7_arg0._availableItems = {}
	f7_arg0._allItems = {}
	f7_arg0._wzItems = {}
	f7_arg0._cwItems = {}
	f7_arg0._itemIdMaps = {}
	f7_arg0._currentFilterType = nil
	local f7_local0 = LOOT.GetPlayerBundleLockerFilterPreference( f7_arg1 )
	if f7_local0 then
		f7_arg0._currentFilterType = f7_local0:get()
	end
	local f7_local1 = STORE.GetCategoryData( f7_arg1 )
	for f7_local2 = 1, #f7_local1, 1 do
		local f7_local5 = f7_local1[f7_local2]
		local f7_local6 = f7_local5.items and f7_local5.items[1] or nil
		if f7_local5 and f7_local5.idPubVar and f7_local6 and f7_local6.layoutOnlyItem then
			local f7_local7 = split( Dvar.DHEEJCCJBH( f7_local5.idPubVar ) or "", "," )
			for f7_local8 = 1, #f7_local7, 1 do
				local f7_local11 = tonumber( f7_local7[f7_local8] )
				if 0 < Loot.DEBEIFJEEG( f7_arg1, f7_local11 ) and not f7_arg0._itemIdMaps[tostring( f7_local11 )] then
					local f7_local12 = LUI.DeepCopy( f7_local6 )
					f7_local12.emptyCategory = false
					f7_local12.id = f7_local11
					local f7_local13 = CSV.ReadRow( {
						file = CSV.bundleIDs.file,
						cols = CSV.bundleIDs.cols
					}, StringTable.BJJBBCJGEJ( CSV.bundleIDs.file, CSV.bundleIDs.cols.id, f7_local7[f7_local8] ) )
					f7_local12.name = f7_local13.name
					f7_local12.asset = f7_local13.image
					f7_local12.rarity = f7_local13.rarity
					f7_local12.bundleType = f7_local13.bundleType
					f7_local12.titleImage = f7_local13.titleImage
					f7_local12.currencyID = tonumber( f7_local13.currencyID )
					f7_local12.currencyAmount = tonumber( f7_local13.currencyAmount )
					local f7_local14
					if 0 < #f7_local13.firstPartyProductID then
						f7_local14 = f7_local13.firstPartyProductID
						if not f7_local14 then
						
						else
							f7_local12.firstPartyProductID = f7_local14
							f7_local12.gameSourceID = f7_local13.game
							table.insert( f7_arg0._allItems, f7_local12 )
							if f7_local12.gameSourceID == LUI.GAME_SOURCE_ID.MODERN_WARFARE then
								table.insert( f7_arg0._wzItems, f7_local12 )
							elseif f7_local12.gameSourceID == LUI.GAME_SOURCE_ID.COLD_WAR then
								table.insert( f7_arg0._cwItems, f7_local12 )
							end
							f7_arg0._itemIdMaps[tostring( f7_local12.id )] = f7_local12.id
						end
					end
					f7_local14 = nil
				end
			end
		end
	end
	local f7_local2 = function ( f14_arg0, f14_arg1, f14_arg2 )
		local f14_local0 = f7_arg0._availableItems[f14_arg1 + f14_arg2 * f7_arg0.BundleGrid:GetNumColumns() + 1]
		f14_arg0:UpdateButton( f14_local0 )
		f14_arg0:UpdateWZSnipeBar( f14_local0.gameSourceID )
		f14_arg0:registerEventHandler( "button_action", function ( element, event )
			if 0 < STORE.GetNumItemsInBundle( f14_arg0.id ) then
				LUI.FlowManager.RequestAddMenu( "StoreBundlePreview", true, f14_arg0, false, {
					bundleID = f14_arg0.id,
					rarity = f14_arg0.rarity,
					bundleType = f14_arg0.bundleType,
					titleImage = f14_arg0.titleImage,
					currencyID = f14_arg0.currencyID,
					currencyAmount = f14_arg0.currencyAmount,
					timerValue = f14_arg0.purchaseEnd,
					bundleIndex = f14_arg0
				} )
			end
		end )
	end
	
	local f7_local3 = function ()
		f7_arg0.ItemCount:setText( Engine.CBBHFCGDIC( "LUA_MENU/X_OF_Y", f7_arg0.BundleGrid:GetFocusPositionIndex() + 1, #f7_arg0._availableItems ) )
	end
	
	local f7_local15 = function ()
		if f7_arg0._currentFilterType == LOOT.bundleLockerFilterOptions.MODERN_WARFARE_ONLY then
			f7_arg0._availableItems = f7_arg0._wzItems
		elseif f7_arg0._currentFilterType == LOOT.bundleLockerFilterOptions.COLD_WAR_ONLY then
			f7_arg0._availableItems = f7_arg0._cwItems
		else
			f7_arg0._availableItems = f7_arg0._allItems
		end
		local f12_local0 = "HidePurchaseMessage"
		if 0 < #f7_arg0._availableItems then
			f7_arg0.ItemCount:SetAlpha( 1 )
		else
			f7_arg0.ItemCount:SetAlpha( 0 )
			f12_local0 = "ShowPurchaseMessage"
		end
		ACTIONS.AnimateSequence( f7_arg0, f12_local0 )
	end
	
	f7_local15()
	f7_arg0.BundleGrid:SetNewTargetOnFocusHandler( f7_arg0, f7_local3 )
	f7_arg0.BundleGrid:SetRefreshChild( f7_local2 )
	f7_arg0.BundleGrid:SetNumChildren( #f7_arg0._availableItems )
	f7_arg0.BundleGrid:GainFocus( {
		controllerIndex = f7_arg1
	} )
	f7_local15 = function ( f11_arg0, f11_arg1 )
		if f11_arg1.down and f11_arg1.qualifier == "mousewheel" then
			return f7_arg0.BundleGrid:processEvent( f11_arg1 )
		else
			
		end
	end
	
	f7_arg0.MouseScrollCatcher:SetHandleMouse( true )
	f7_arg0.MouseScrollCatcher:OverrideMouseCursorType( MouseCursorType.CURSOR_TYPE_ARROW_NORMAL )
	f7_arg0.MouseScrollCatcher:addEventHandler( "gamepad_button", f7_local15 )
	f7_arg0.bindButton:addEventHandler( "button_secondary", function ( f10_arg0, f10_arg1 )
		LUI.FlowManager.RequestLeaveMenu( f10_arg0 )
	end )
	f7_arg0.HelperBar:AddButtonHelperTextToElement( f7_arg0, {
		kbm_only = true,
		priority = 4,
		side = "left",
		button_ref = "button_left_trigger",
		helper_text = Engine.CBBHFCGDIC( "LUA_MENU/SORT_FILTER" )
	} )
	f7_arg0.bindButton:addEventHandler( "button_left_trigger", function ( f8_arg0, f8_arg1 )
		local f8_local0 = MenuBuilder.BuildRegisteredType( "BundleLockerFilteringSortingPopup", {
			controllerIndex = f7_arg0
		} )
		LUI.FlowManager.RequestPopupMenu( nil, "FlyInPopup", true, f7_arg0, false, {
			flyInLeftNarrow = true,
			disableQuickAccessShortcuts = false,
			widget = f8_local0
		} )
		f8_local0:addEventHandler( "menu_close", function ( f9_arg0, f9_arg1 )
			local f9_local0 = LOOT.GetPlayerBundleLockerFilterPreference( f9_arg1.controller )
			if f9_local0 then
				f8_arg0._currentFilterType = f9_local0:get()
				f8_arg0()
				f8_arg0.BundleGrid:SetNumChildren( #f8_arg0._availableItems )
			end
		end )
	end )
end

function BundleLockerMenu( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "BundleLockerMenu"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	self.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	self.HelperBar.id = "HelperBar"
	self.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	self.HelperBar:setPriority( 10 )
	self:addElement( self.HelperBar )
	local f1_local2 = self
	local WorldBlur = nil
	
	WorldBlur = MenuBuilder.BuildRegisteredType( "WorldBlur", {
		worldBlur = 1,
		controllerIndex = f1_local1
	} )
	WorldBlur.id = "WorldBlur"
	self:addElement( WorldBlur )
	self.WorldBlur = WorldBlur
	
	local Darken = nil
	
	Darken = LUI.UIImage.new()
	Darken.id = "Darken"
	Darken:SetRGBFromTable( SWATCHES.genericMenu.blackBackground, 0 )
	Darken:SetAlpha( 0.5, 0 )
	self:addElement( Darken )
	self.Darken = Darken
	
	local TabBacker = nil
	
	TabBacker = MenuBuilder.BuildRegisteredType( "TabBacker", {
		controllerIndex = f1_local1
	} )
	TabBacker.id = "TabBacker"
	TabBacker:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 1920, 0, _1080p * 160 )
	self:addElement( TabBacker )
	self.TabBacker = TabBacker
	
	local MenuTitle = nil
	
	MenuTitle = MenuBuilder.BuildRegisteredType( "MenuTitle", {
		controllerIndex = f1_local1
	} )
	MenuTitle.id = "MenuTitle"
	MenuTitle.MenuTitle:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU_MP/BUNDLE_LOCKER" ) ), 0 )
	MenuTitle.Line:SetLeft( 0, 0 )
	MenuTitle:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 562, 0, _1080p * 100 )
	self:addElement( MenuTitle )
	self.MenuTitle = MenuTitle
	
	local MouseScrollCatcher = nil
	
	MouseScrollCatcher = LUI.UIImage.new()
	MouseScrollCatcher.id = "MouseScrollCatcher"
	MouseScrollCatcher:SetRGBFromInt( 0, 0 )
	MouseScrollCatcher:SetAlpha( 0, 0 )
	MouseScrollCatcher:setImage( RegisterMaterial( "widg_gradient_bottom_to_top" ), 0 )
	MouseScrollCatcher:SetVMin( 0.5, 0 )
	MouseScrollCatcher:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, _1080p * 154, _1080p * -85 )
	self:addElement( MouseScrollCatcher )
	self.MouseScrollCatcher = MouseScrollCatcher
	
	local BundleGrid = nil
	
	BundleGrid = LUI.UIPeekingGrid.new( {
		scrollingThresholdX = 1,
		buildArrowsLabel = false,
		maxVelocity = 5000,
		adjustSizeToContent = true,
		scrollingThresholdY = 1,
		wrapX = true,
		maxVisibleColumns = 5,
		maxVisibleRows = 5,
		wrapY = true,
		arrowsVerticalOffset = 0,
		springCoefficient = 400,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "MPStoreBillboardButton", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f5_arg0, f5_arg1, f5_arg2 )
			
		end,
		spacingX = _1080p * 27,
		spacingY = _1080p * 27,
		columnWidth = _1080p * 320,
		rowHeight = _1080p * 120,
		horizontalAlignment = LUI.Alignment.Left,
		verticalAlignment = LUI.Alignment.Top
	} )
	BundleGrid.id = "BundleGrid"
	BundleGrid:setUseStencil( true )
	BundleGrid:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 95, _1080p * 1803, _1080p * 244, _1080p * 812 )
	self:addElement( BundleGrid )
	self.BundleGrid = BundleGrid
	
	local VerticalScrollbar = nil
	
	VerticalScrollbar = MenuBuilder.BuildRegisteredType( "VerticalScrollbar", {
		controllerIndex = f1_local1
	} )
	VerticalScrollbar.id = "VerticalScrollbar"
	VerticalScrollbar:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -119, _1080p * -96, _1080p * 244, _1080p * 952 )
	self:addElement( VerticalScrollbar )
	self.VerticalScrollbar = VerticalScrollbar
	
	local ArrowDown = nil
	
	ArrowDown = MenuBuilder.BuildRegisteredType( "StoreScrollArrow", {
		controllerIndex = f1_local1
	} )
	ArrowDown.id = "ArrowDown"
	ArrowDown:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -250, _1080p * 250, _1080p * -135, _1080p * -85 )
	self:addElement( ArrowDown )
	self.ArrowDown = ArrowDown
	
	local ArrowUp = nil
	
	ArrowUp = MenuBuilder.BuildRegisteredType( "StoreScrollArrow", {
		controllerIndex = f1_local1
	} )
	ArrowUp.id = "ArrowUp"
	ArrowUp:SetZRotation( 180, 0 )
	ArrowUp.FreeBundleText:SetZRotation( 180, 0 )
	ArrowUp:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -250, _1080p * 250, _1080p * -930, _1080p * -880 )
	self:addElement( ArrowUp )
	self.ArrowUp = ArrowUp
	
	local f1_local12 = nil
	if CONDITIONS.InFrontendPublicMP() then
		f1_local12 = MenuBuilder.BuildRegisteredType( "MPPlayerDetails", {
			controllerIndex = f1_local1
		} )
		f1_local12.id = "MPPlayerDetails"
		f1_local12:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -596, _1080p * -96, _1080p * 54, _1080p * 114 )
		self:addElement( f1_local12 )
		self.MPPlayerDetails = f1_local12
	end
	local ItemCount = nil
	
	ItemCount = LUI.UIStyledText.new()
	ItemCount.id = "ItemCount"
	ItemCount:SetRGBFromTable( SWATCHES.CH2.WZGenericButtonLine, 0 )
	ItemCount:setText( "", 0 )
	ItemCount:SetFont( FONTS.GetFont( FONTS.BodyRegular.File ) )
	ItemCount:SetAlignment( LUI.Alignment.Left )
	ItemCount:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 596, _1080p * 201, _1080p * 223 )
	self:addElement( ItemCount )
	self.ItemCount = ItemCount
	
	local PurchaseMessage = nil
	
	PurchaseMessage = LUI.UIStyledText.new()
	PurchaseMessage.id = "PurchaseMessage"
	PurchaseMessage:SetRGBFromTable( SWATCHES.CH2.WZGenericTabText, 0 )
	PurchaseMessage:SetAlpha( 0, 0 )
	PurchaseMessage:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU_MP/PURCHASE_BUNDLES_IN_STORE" ) ), 0 )
	PurchaseMessage:SetFont( FONTS.GetFont( FONTS.MainRegular.File ) )
	PurchaseMessage:SetAlignment( LUI.Alignment.Center )
	PurchaseMessage:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -628, _1080p * 628, _1080p * 430, _1080p * 478 )
	self:addElement( PurchaseMessage )
	self.PurchaseMessage = PurchaseMessage
	
	local GridDivider = nil
	
	GridDivider = LUI.UIImage.new()
	GridDivider.id = "GridDivider"
	GridDivider:SetRGBFromTable( SWATCHES.text.primaryText, 0 )
	GridDivider:SetAlpha( 0.6, 0 )
	GridDivider:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 1803, _1080p * 230, _1080p * 231 )
	self:addElement( GridDivider )
	self.GridDivider = GridDivider
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	local f1_local16 = nil
	PurchaseMessage:RegisterAnimationSequence( "ShowPurchaseMessage", {
		{
			value = 1,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	GridDivider:RegisterAnimationSequence( "ShowPurchaseMessage", {
		{
			value = 0,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	self._sequences.ShowPurchaseMessage = function ()
		menu:AnimateSequence( "ShowPurchaseMessage" )
		menu:AnimateSequence( "ShowPurchaseMessage" )
	end
	
	local f1_local17 = nil
	PurchaseMessage:RegisterAnimationSequence( "HidePurchaseMessage", {
		{
			value = 0,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	GridDivider:RegisterAnimationSequence( "HidePurchaseMessage", {
		{
			value = 4.667261642226141E-62,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	self._sequences.HidePurchaseMessage = function ()
		menu:AnimateSequence( "HidePurchaseMessage" )
		menu:AnimateSequence( "HidePurchaseMessage" )
	end
	
	local f1_local18 = LUI.UIScrollbar.new
	local f1_local19 = {
		direction = LUI.DIRECTION.vertical,
		eventListener = VerticalScrollbar,
		startCap = VerticalScrollbar.startCap,
		endCap = VerticalScrollbar.endCap,
		sliderArea = VerticalScrollbar.sliderArea
	}
	local f1_local20 = VerticalScrollbar.sliderArea
	if f1_local20 then
		f1_local20 = VerticalScrollbar.sliderArea.slider
	end
	f1_local19.slider = f1_local20
	f1_local20 = VerticalScrollbar.sliderArea
	if f1_local20 then
		f1_local20 = VerticalScrollbar.sliderArea.fixedSizeSlider
	end
	f1_local19.fixedSizeSlider = f1_local20
	BundleGrid:AddScrollbar( f1_local18( f1_local19 ) )
	BundleGrid:AddArrow( ArrowUp )
	BundleGrid:AddArrow( ArrowDown )
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		button_ref = "button_secondary",
		priority = 1,
		helper_text = Engine.CBBHFCGDIC( "MENU/BACK" )
	} )
	
	local bindButton = LUI.UIBindButton.new()
	bindButton.id = "selfBindButton"
	self:addElement( bindButton )
	self.bindButton = bindButton
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "BundleLockerMenu", BundleLockerMenu )
LockTable( _M )
