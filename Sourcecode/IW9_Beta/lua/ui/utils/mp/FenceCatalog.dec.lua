-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
FenceCatalog = LUI.Class( LUI.Fence )
FenceCatalog.init = function ( f5_arg0, f5_arg1, f5_arg2 )
	f5_arg0.super:init( f5_arg1, f5_arg2 )
	f5_arg0._controllerIndex = f5_arg2
	assert( f5_arg0._controllerIndex )
end

FenceCatalog.Start = function ( f4_arg0 )
	DebugPrint( "FenceCatalog.Start" )
	local f4_local0 = Dvar[0x9E5BE3B4BBA4E0E]( 0x3B86A8B1D90B34B )
	if f4_local0 then
		f4_local0 = not Dvar[0x9E5BE3B4BBA4E0E]( 0xA170C849D940B2C )
	end
	local f4_local1 = Dvar[0x22EAAB59AA27E9B]( 0xCC943BEC6415CFE )
	if f4_local0 and f4_local1 and 0 < f4_local1 then
		f4_arg0._timeoutSeconds = f4_local1 / 1000
		f4_arg0._startTime = tostring( Engine[0xF16311E3FCA3DCF]() )
		InGameStore.FetchCatalog( f4_arg0._controllerIndex, false, true )
	else
		f4_arg0._state = LUI.Fence.STATE.pass
	end
end

FenceCatalog.Stop = function ( f3_arg0 )
	DebugPrint( "FenceCatalog.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "store_inprogress_popup", true )
	f3_arg0._openedPopup = false
end

FenceCatalog.UpdateState = function ( f2_arg0 )
	if f2_arg0._state == LUI.Fence.STATE.pass then
		return 
	end
	if f2_arg0._startTime and f2_arg0._timeoutSeconds <= math.abs( Engine[0x81B9C166599CE22]( f2_arg0._startTime ) ) then
		DebugPrint( "FenceCatalog: timed out" )
		f2_arg0._state = LUI.Fence.STATE.pass
		return 
	end
	local f2_local0 = InGameStore.GetCatalogStatus( f2_arg0._controllerIndex )
	if f2_local0 == InGameStoreCatalogStatus.FETCHING then
		f2_arg0._state = LUI.Fence.STATE.block
	elseif f2_local0 == InGameStoreCatalogStatus.READY then
		f2_arg0._state = LUI.Fence.STATE.pass
	else
		DebugPrint( "FenceCatalog: an error occured" )
		f2_arg0._state = LUI.Fence.STATE.pass
	end
	if f2_arg0._state == LUI.Fence.STATE.block and not f2_arg0._openedPopup then
		f2_arg0:ShowInProgressPopup()
	end
end

FenceCatalog.ShowInProgressPopup = function ( f1_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "store_inprogress_popup", false, f1_arg0._controllerIndex, false, {
		message = Engine[0xED84C33EC5F01EA]( 0x62946C2D7154819 )
	}, nil, true, true )
	f1_arg0._openedPopup = true
end

LUI.Fence.Register( "catalog", FenceCatalog )
LockTable( _M )
