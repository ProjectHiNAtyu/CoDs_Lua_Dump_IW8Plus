-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:01
module( ..., package.seeall )
local f0_local0 = function ( f26_arg0, f26_arg1, f26_arg2 )
	local f26_local0 = PERK.GetPerkPackageData( f26_arg1, f26_arg2 )
	local f26_local1 = f26_local0.perks
	f26_arg0.highlightedPerk = f26_arg2
	f26_arg0.PerkPackageDetails:UpdatePerkDetails( f26_local1 )
	f26_arg0.ItemDetailPanel:UpdateDetails( f26_arg1, {
		unlockCriteria = nil,
		title = Engine[0xED84C33EC5F01EA]( 0x915D60B323E0670, f26_local0.name ),
		desc = f26_local0.description
	} )
	ACTIONS.AnimateSequence( f26_arg0, "FocusPackage" )
end

local f0_local1 = function ( f21_arg0, f21_arg1 )
	f21_arg0.AddPerkPackageButton:addEventHandler( "button_action", function ( f25_arg0, f25_arg1 )
		local f25_local0 = PERK.GetAvailablePerkPackageSlot( f25_arg1.controller )
		if f25_local0 ~= nil then
			local f25_local1 = PERK.SavePerkPackageToPlayerData
			local f25_local2 = f21_arg0
			local f25_local3 = f25_local0
			local f25_local4 = Engine[0xED84C33EC5F01EA]( PERK.DEFAULT_PACKAGE_NAMES[f25_local0 + 1] )
			local f25_local5 = PERK.GetDefaultPerkPackageForIndex( 0 )
			f25_local1( f25_local2, f25_local3, f25_local4, f25_local5.perks )
			LUI.FlowManager.RequestAddMenu( "CreatePerkPackageMenu", true, f25_arg1.controller, false, {
				isEditingPerks = true,
				selectedPerkIndex = f25_local0 + PERK.defaultPerkPackageCount
			} )
		else
			LUI.FlowManager.RequestAddMenu( "SelectBasePerkPopup", true, f25_arg1.controller, nil, {
				replacingPerks = true
			} )
		end
	end )
	f21_arg0.AddPerkPackageButton:addEventHandler( "button_over", function ( f24_arg0, f24_arg1 )
		f21_arg0.ItemDetailPanel:UpdateDetails( f21_arg0, {
			title = Engine[0xED84C33EC5F01EA]( 0x70468F0B9053BEB ),
			desc = Engine[0xED84C33EC5F01EA]( 0xA7EB6D49DB0E33D ),
			count = #PERK.GetValidPerkPackageSlots( f21_arg0 )
		} )
		ACTIONS.AnimateSequence( f21_arg0, "FocusCreate" )
	end )
	f21_arg0.PerkPackageGrid:registerEventHandler( "gamepad_button", function ( element, event )
		if not event.down then
			return 
		elseif CONDITIONS.IsMouseWheelEvent( event ) and f21_arg0.SideArrows then
			return f21_arg0.SideArrows:ExternalScroll( event )
		elseif event.button == "left" then
			if f21_arg0.PerkPackageGrid:GetFocusPosition( LUI.DIRECTION.horizontal ) == 0 then
				f21_arg0.PerkPackageGrid:RemoveFocusFromChild( true )
				f21_arg0.PerkPackageGrid:LoseFocus( event )
				f21_arg0.AddPerkPackageButton:GainFocus( event )
				return true
			else
				return f21_arg0.PerkPackageGrid:GamepadButton( event )
			end
		else
			return f21_arg0.PerkPackageGrid:GamepadButton( event )
		end
	end )
	f21_arg0.AddPerkPackageButton:addEventHandler( "gamepad_button", function ( f22_arg0, f22_arg1 )
		if not f22_arg1.down or not f22_arg0:GetHandleMouseButton() or not f22_arg0:isInFocus() then
			return 
		elseif f22_arg1.button == "right" then
			f21_arg0.AddPerkPackageButton:LoseFocus( f22_arg1 )
			f21_arg0.PerkPackageGrid:GainFocus( f22_arg1 )
			f21_arg0.PerkPackageGrid:SetFocusedPosition( {
				x = 0,
				y = 0
			}, true )
		end
	end )
end

MenuBuilder.registerType( "PerkPackageOptions", function ( f20_arg0, f20_arg1 )
	f20_arg1.widget = MenuBuilder.BuildRegisteredType( "PerkPackageOptionsPopup", f20_arg1 )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f20_arg1.flyInLeftNarrow = LAYOUT.GetTextWidth( f20_arg1.widget.PerkTitle.MenuTitle, f20_arg1.controllerIndex ) < 480 * _1080p
	end
	local f20_local0 = MenuBuilder.BuildRegisteredType( "FlyInPopup", f20_arg1 )
	f20_local0.id = "PerkPackageOptions"
	return f20_local0
end )
local f0_local2 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = PERK.GetValidPerkPackageSlots( f19_arg1 )
	local f19_local1 = f19_arg0.PerkPackageGrid
	local f19_local2 = PERK.defaultPerkPackageCount + #f19_local0
	f19_local1:SetNumColumns( f19_local2 )
	f19_local1.customPerkIndices = f19_local0
	f19_local1:RefreshContent()
	local f19_local3 = f19_arg0.SideArrows
	if f19_local3 then
		f19_local3:SetupSideButtons( f19_local1, f19_local2 )
		f19_local3:UpdateSideButtons()
	end
end

local f0_local3 = function ( f18_arg0, f18_arg1, f18_arg2 )
	local f18_local0 = PERK.DoesPerkPackageContainOverkill( PERK.GetPerkPackageData( f18_arg1, f18_arg2 ) )
	local f18_local1 = LOADOUT.GetLoadoutSquadMember( f18_arg1 )
	local f18_local2 = f18_local1.loadouts[f18_arg0.loadoutIndex]
	local f18_local3 = f18_local2.weaponSetups[0]
	local f18_local4 = f18_local2.weaponSetups[1]
	if f18_arg0._wasOverkill and not f18_local0 then
		f18_local4.weapon:set( WEAPON.DefaultSecondary )
		WEAPON.WipeWeaponSetup( f18_local4 )
	elseif not f18_arg0._wasOverkill and f18_local0 then
		local f18_local5
		if f18_local3.weapon:get() == WEAPON.OverkillDefaultPrimary then
			f18_local5 = WEAPON.DefaultPrimary
			if not f18_local5 then
			
			else
				f18_local4.weapon:set( f18_local5 )
				WEAPON.WipeWeaponSetup( f18_local4 )
			end
		end
		f18_local5 = WEAPON.OverkillDefaultPrimary
	end
end

local f0_local4 = function ( f17_arg0, f17_arg1 )
	local f17_local0 = 0
	local f17_local1 = PERK.GetValidPerkPackageSlots( f17_arg0 )
	if f17_arg1 >= PERK.defaultPerkPackageCount then
		local f17_local2 = f17_arg1 - PERK.defaultPerkPackageCount
		for f17_local6, f17_local7 in ipairs( f17_local1 ) do
			if f17_local7 == f17_local2 then
				f17_local0 = f17_local6 - 1
			end
		end
	else
		f17_local0 = f17_arg1 + #f17_local1
	end
	return f17_local0
end

local f0_local5 = function ( f5_arg0, f5_arg1, f5_arg2 )
	f5_arg0.RefreshGrids = f0_local0
	f5_arg0.UpdatePerkDetails = f0_local0
	f5_arg0.loadoutIndex = f5_arg2.loadoutIndex
	f5_arg0._currentPerkPackageIndex = LOADOUT.GetSelectedLoadoutPerkPackage( f5_arg1, f5_arg0.loadoutIndex )
	f5_arg0._wasOverkill = f5_arg2.wasOverkill
	if f5_arg0._wasOverkill == nil then
		f5_arg0._wasOverkill = PERK.DoesPerkPackageContainOverkill( PERK.GetPerkPackageData( f5_arg1, f5_arg0._currentPerkPackageIndex ) )
	end
	if f5_arg0.MenuTitle then
		f5_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( 0xC71805C88D5C1A4 ) )
	end
	f5_arg0.PerkPackageGrid:SetMask( f5_arg0.GridMask )
	f5_arg0:addEventHandler( "gain_focus", function ()
		return true
	end )
	local f5_local0 = PERK.GetValidPerkPackageSlots( f5_arg1 )
	local f5_local1 = function ()
		return {
			y = 0,
			x = f5_arg0( f5_arg0, f5_arg0._currentPerkPackageIndex )
		}
	end
	
	local f5_local2 = function ( f14_arg0 )
		if f5_arg0.highlightedPerk >= PERK.defaultPerkPackageCount and CONDITIONS.InFrontend() then
			local f14_local0 = LUI.FlowManager.GetScopedData( f5_arg0 )
			f14_local0.wasOverkill = f5_arg0._wasOverkill
			local f14_local1 = {
				controllerIndex = f5_arg0,
				perkPackageIndex = f5_arg0.highlightedPerk
			}
			local f14_local2 = PERK.GetPerkPackageData( f5_arg0, f5_arg0.highlightedPerk )
			f14_local1.name = f14_local2.name
			LUI.FlowManager.RequestPopupMenu( nil, "PerkPackageOptions", true, f14_arg0.controller, false, f14_local1 )
		end
	end
	
	f5_arg0.PerkPackageGrid.customPerkIndices = f5_local0
	f5_arg0.PerkPackageGrid:SetActiveOnMouseOverBehavior( f5_arg1 )
	local f5_local3 = PERK.defaultPerkPackageCount + #f5_local0
	f5_arg0.PerkPackageGrid:SetNumColumns( f5_local3 )
	f5_arg0.PerkPackageGrid:SetNumRows( 1 )
	f5_arg0.PerkPackageGrid:SetDefaultFocus( f5_local1 )
	f5_arg0.PerkPackageGrid:MouseSetActiveToDefaultFocusMenuCreate( f5_arg1 )
	f5_arg0.PerkPackageGrid:SetRefreshChild( function ( f10_arg0, f10_arg1, f10_arg2 )
		local f10_local0 = f10_arg0:getParent()
		local f10_local1 = #f10_local0.customPerkIndices
		local f10_local2 = f10_arg1 < f10_local1
		local f10_local3
		if f10_local2 then
			f10_local3 = f10_local0.customPerkIndices[f10_arg1 + 1] + PERK.defaultPerkPackageCount
			if not f10_local3 then
			
			else
				local f10_local4 = PERK.GetPerkPackageData( f5_arg0, f10_local3 )
				f10_arg0.perkIndex = f10_local3
				local f10_local5 = {
					localizeHeader = false,
					imageSize = "Empty",
					removeEquipBanner = true,
					buttonData = {}
				}
				if f10_local2 then
					f10_local5.doubleAction = {
						text = 0x371D314917B7829,
						prompt = 0x21E44BE45534168,
						callback = f5_arg0
					}
				end
				f10_arg0:SetupButton( f10_local5 )
				local f10_local6 = f10_arg0
				local f10_local7 = f10_arg0.SetHeaderText
				local f10_local8
				if f10_local2 then
					f10_local8 = f10_local4.name
					if not f10_local8 then
					
					else
						f10_local7( f10_local6, f10_local8 )
						f10_local7 = LOADOUT.GetSelectedLoadoutPerkPackage
						f10_local6 = f5_arg0
						f10_local8 = f10_local0:getParent()
						f10_arg0:SetEquipped( f10_local7( f10_local6, f10_local8.loadoutIndex ) == f10_local3 )
						f10_arg0:SetPrimaryPromptText( 0x8FDA56E32BAE81A )
						if not f10_arg0.eventHandlerAdded then
							f10_arg0:addEventHandler( "button_over", function ()
								f10_arg0:UpdatePerkDetails( f10_arg0, f10_arg0.perkIndex )
							end )
							f10_arg0:addEventHandler( "gain_focus", function ()
								f10_arg0:UpdatePerkDetails( f10_arg0, f10_arg0.perkIndex )
							end )
							f10_arg0:addEventHandler( "button_action", function ( f11_arg0, f11_arg1 )
								local f11_local0 = f10_arg0:getParent()
								f10_arg0( f11_local0, f10_arg0, f11_arg0.perkIndex )
								local f11_local1 = PERK.GetPerkPackageData( f10_arg0, f11_arg0.perkIndex )
								LOADOUT.EquipPerkPackage( f11_arg1.controller, f11_local0.loadoutIndex, f11_arg0.perkIndex, f11_local1.perks )
								ACTIONS.LeaveMenu( f11_local0 )
							end )
							f10_arg0.eventHandlerAdded = true
						end
					end
				end
				f10_local8 = Engine[0xED84C33EC5F01EA]( f10_local4.name )
			end
		end
		f10_local3 = f10_arg1 - f10_local1
	end )
	f5_arg0.bindButton:addEventHandler( "button_alt1", function ( f9_arg0, f9_arg1 )
		f5_arg0( f9_arg1 )
	end )
	f5_arg0:addEventHandler( "refresh_perkpackages", function ( f8_arg0, f8_arg1 )
		f5_arg0( f8_arg0, f5_arg0 )
	end )
	if f5_arg0.AddPerkPackageButton then
		f0_local0( f5_arg0, f5_arg1 )
	else
		ACTIONS.AnimateSequence( f5_arg0, "HideCreatePackage" )
		f5_arg0.PerkPackageGrid:registerEventHandler( "gamepad_button", function ( element, event )
			if event.down and CONDITIONS.IsMouseWheelEvent( event ) and f5_arg0.SideArrows then
				return f5_arg0.SideArrows:ExternalScroll( event )
			else
				
			end
		end )
	end
	if LUI.IsLastInputGamepad( f5_arg1 ) or LUI.IsLastInputKeyboardNavigation( f5_arg1 ) then
		f5_arg0.PerkPackageGrid:SetFocusedPosition( {
			y = 0,
			x = f0_local0( f5_arg1, f5_arg0._currentPerkPackageIndex )
		}, true )
	end
	if f5_arg0.Blur then
		ACTIONS.ScaleFullscreen( f5_arg0.Blur )
	end
	if f5_arg0.Gradient then
		ACTIONS.ScaleFullscreen( f5_arg0.Gradient )
	end
	local f5_local4 = f5_arg0.PerkPackageGrid
	local f5_local5 = f5_arg0.SideArrows
	if f5_local4 and f5_local5 then
		f5_local4:SetSnapOnScrollBarMouseDrag( true )
		f5_local4._onNewTargetFocusPosition = function ( f6_arg0, f6_arg1 )
			if f5_arg0 then
				f5_arg0:AddScrollWatch()
			end
		end
		
		f5_local5:SetupSideButtons( f5_local4, f5_local3 )
		f5_local5:UpdateSideButtons()
	end
end

local f0_local6 = function ( f4_arg0, f4_arg1, f4_arg2 )
	f4_arg0.PostLoadShared = f0_local0
end

function PerkPackageSelectMenuBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "PerkPackageSelectMenuBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	self.addButtonHelperFunction = function ( f3_arg0, f3_arg1 )
		f3_arg0:AddButtonHelperText( {
			side = "left",
			button_ref = "button_secondary",
			helper_text = Engine[0xED84C33EC5F01EA]( 0xC6D515BE207B9A5 )
		} )
	end
	
	self:addEventHandler( "menu_create", self.addButtonHelperFunction )
	if not self.bindButton then
		local f1_local3 = LUI.UIBindButton.new()
		f1_local3.id = "selfBindButton"
		self:addElement( f1_local3 )
		self.bindButton = f1_local3
	end
	self.bindButton:addEventHandler( "button_secondary", function ( f2_arg0, f2_arg1 )
		menu( menu, f2_arg1.controller or menu, menu._currentPerkPackageIndex )
		ACTIONS.LeaveMenu( menu )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "PerkPackageSelectMenuBase", PerkPackageSelectMenuBase )
LockTable( _M )
