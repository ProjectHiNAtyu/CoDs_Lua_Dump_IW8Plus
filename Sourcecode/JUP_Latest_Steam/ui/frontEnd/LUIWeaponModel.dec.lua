-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
LUI.UIWeaponModel = LUI.Class( LUI.UIElement )
LUI.UIWeaponModel.WEAPON_REFRESH_TIME = 100
LUI.UIWeaponModel.MAX_WEAPON_REFRESH_TIME = 5000
LUI.UIWeaponModel.WEAPON_POSE_FINISH_TIME = 400
LUI.UIWeaponModel.init = function ( f18_arg0, f18_arg1 )
	LUI.UIWeaponModel.super.init( f18_arg0 )
	f18_arg0._clientWeaponIndex = f18_arg1.clientWeaponIndex
	local f18_local0 = f18_arg1.weaponOffsetFilePath
	if not f18_local0 then
		f18_local0 = WEAPON.OffsetFiles.WeaponModelData
	end
	f18_arg0._weaponOffsetFilePath = f18_local0
	f18_arg0._inputRotationActive = true
	f18_arg0._nextPoseTagName = GUNSMITH.defaultTag
	f18_local0 = {
		base2DPosition = f18_arg1.basePosition
	}
	f18_arg0._baseOffsets = f18_arg1.baseOffsets
	f18_arg0:SetupWeaponModel( f18_local0 )
	f18_arg0:SetWeaponIndex( f18_arg0._clientWeaponIndex )
end

LUI.UIWeaponModel.GetDebugOffsets = function ( f17_arg0, f17_arg1, f17_arg2, f17_arg3 )
	local f17_local0 = Dvar[0xEDCFC612B39E0C0]( 0x71F1567332DCCA8 )
	local f17_local1 = Dvar[0xEDCFC612B39E0C0]( 0x774613F8B3B55AB )
	local f17_local2 = Dvar[0xEDCFC612B39E0C0]( 0x4DCCE6EE05480CE )
	local f17_local3 = Dvar[0xEDCFC612B39E0C0]( 0xC836E6DD0FFD64D )
	local f17_local4 = Dvar[0xEDCFC612B39E0C0]( 0xF447F54B5E3C7E2 )
	local f17_local5 = Dvar[0xEDCFC612B39E0C0]( 0x5A83214D3BDC00F )
	if f17_local0 ~= f17_arg1 then
		f17_arg1 = f17_local0
	end
	if f17_local1 ~= f17_arg2 then
		f17_arg2 = f17_local1
	end
	if f17_local2 ~= f17_arg3 then
		f17_arg3 = f17_local2
	end
	return f17_arg1 + f17_local3, f17_arg2 + f17_local4, f17_arg3 + f17_local5
end

LUI.UIWeaponModel.GetDebugRotations = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3 )
	local f16_local0 = Dvar[0xEDCFC612B39E0C0]( 0xB3467C1D298866D )
	local f16_local1 = Dvar[0xEDCFC612B39E0C0]( 0xCC3BF6F84F16064 )
	local f16_local2 = Dvar[0xEDCFC612B39E0C0]( 0xE97BBCC3E9A7592 )
	if f16_local0 ~= f16_arg1 then
		f16_arg1 = f16_local0
	end
	if f16_local1 ~= f16_arg2 then
		f16_arg2 = f16_local1
	end
	if f16_local2 ~= f16_arg3 then
		f16_arg3 = f16_local2
	end
	return f16_arg1, f16_arg2, f16_arg3
end

LUI.UIWeaponModel.ApplyBaseOffsets = function ( f15_arg0, f15_arg1 )
	if f15_arg0._baseOffsets then
		local f15_local0 = f15_arg0._baseOffsets
		if f15_local0.xOffset then
			f15_arg1.xOffset = f15_arg1.xOffset + f15_local0.xOffset
		end
		if f15_local0.yOffset then
			f15_arg1.yOffset = f15_arg1.yOffset + f15_local0.yOffset
		end
		if f15_local0.zOffset then
			f15_arg1.zOffset = f15_arg1.zOffset + f15_local0.zOffset
		end
	end
end

LUI.UIWeaponModel.GetInputRotatable = function ( f14_arg0 )
	return f14_arg0._inputRotationActive
end

LUI.UIWeaponModel.SetInputRotatable = function ( f13_arg0, f13_arg1 )
	f13_arg0._inputRotationActive = f13_arg1
end

LUI.UIWeaponModel.CancelWeaponPoseSubscription = function ( f12_arg0 )
	f12_arg0._nextPoseTagName = GUNSMITH.defaultTag
	f12_arg0:SetInputRotatable( true )
	if f12_arg0._dataSourceSubscription then
		f12_arg0:UnsubscribeFromModel( f12_arg0._dataSourceSubscription )
		f12_arg0._dataSourceSubscription = nil
	end
end

LUI.UIWeaponModel.ClearWeaponPoseRequest = function ( f10_arg0 )
	ClientWeapon[0x59B77D6F41ED417]( f10_arg0._clientWeaponIndex, true )
	f10_arg0:CancelWeaponPoseSubscription()
	local f10_local0 = f10_arg0:Wait( 5 )
	f10_local0.onComplete = function ()
		if LUI.FlowManager.IsUsingWeaponOriginOffset() then
			f10_arg0._currentOffsetData = CLIENT_MODEL.GetWeaponGunCaseOffsets( f10_arg0, f10_arg0._currentOffsetData )
			f10_arg0:SetWeaponOffset( f10_arg0._currentOffsetData.xOffset, f10_arg0._currentOffsetData.yOffset, f10_arg0._currentOffsetData.zOffset )
			if not CONDITIONS.IsInEXGMMenus() and not CONDITIONS.IsOutbreakGametype() and f10_arg0._selectedLoadoutData then
				CLIENT_MODEL.UpdateGunCase( f10_arg0._controllerIndex, f10_arg0._selectedLoadoutData, f10_arg0._weaponModelName, f10_arg0._clientWeaponIndex )
			end
		end
	end
	
end

LUI.UIWeaponModel.PoseWeapon = function ( f8_arg0, f8_arg1 )
	local f8_local0 = Engine[0x45B054C920178E9]()
	f8_arg0._poseWeaponRequestTimeStart = Engine[0x6991337AE950F99]()
	f8_arg0._poseWeaponOffsetData = f8_arg1
	f8_arg0._setPoseOffsetData = false
	f8_arg0._setPoseOffsetDataTimestamp = nil
	local f8_local1 = LUI.FlowManager.IsMenuOnTop( GUNSMITH.GetWeaponPreviewMenuRef() )
	if not f8_local1 then
		f8_local1 = LUI.FlowManager.IsMenuOnTop( STORE.GetStorePreviewMenuRef() )
	end
	f8_arg0._isWeaponPreviewScene = f8_local1
	f8_arg0._weaponTable = CONDITIONS.IsDMZGametype() and DMZ.GetEquippedInstanceWeaponTable( f8_arg0._clientWeaponIndex ) or WEAPON.GenerateWeaponTableFromWeaponString( f8_arg0._weaponBaseRef, f8_arg0._weaponModelName )
	f8_arg0._lootID = f8_arg0._weaponTable.lootID
	if f8_arg0._dataSourceSubscription then
		
	else
		
	end
	ClientWeapon[0x59B77D6F41ED417]( f8_arg0._clientWeaponIndex, false )
	ClientWeapon[0x2F28F9BE6EE7D2D]( f8_arg0._clientWeaponIndex, 0, 0, 0 )
	f8_arg0:SetInputRotatable( false )
	f8_local1 = FrontEndScene.GetClientWeaponDataSource( f8_arg0._clientWeaponIndex )
	f8_arg0._dataSourceSubscription = f8_arg0:SubscribeToModel( f8_local1.lastPoseTimestamp:GetModel( f8_local0 ), function ( f9_arg0 )
		local f9_local0 = DataModel[0x614D394F6F9A18D]( f9_arg0 )
		if f8_arg0._setPoseOffsetData and f8_arg0._setPoseOffsetDataTimestamp and f8_arg0._setPoseOffsetDataTimestamp < f9_local0 then
			f8_arg0._currentOffsetData = f8_arg0._poseWeaponOffsetData
			f8_arg0:ClearWeaponPoseRequest()
			return 
		elseif f8_arg0._setPoseOffsetData or f9_local0 < f8_arg0._poseWeaponRequestTimeStart then
			return 
		elseif ClientModel[0xA988866C889EAAD]() and ClientWeapon[0xB4CB16EAC8B8DCE]( f8_arg0._clientWeaponIndex ) and ClientModel[0xF26FBD80467CAC7]( f8_arg0._weaponModelName ) then
			if f8_arg0._isWeaponPreviewScene then
				GUNSMITH.SetWeaponPreviewCameraPosition( f8_arg0, f8_arg0._nextPoseTagName, {
					weaponTable = f8_arg0._weaponTable
				} )
				f8_arg0._poseWeaponOffsetData.xRotationCenter = f8_arg0._poseWeaponOffsetData.xRotationCenter + WEAPON.GetCenterOfRotationOffset( f8_arg0, f8_arg0._clientWeaponIndex, f8_arg0._weaponBaseRef )
			end
			ClientWeapon[0xD45C6A2FD89FDDC]( f8_arg0._clientWeaponIndex, f8_arg0._poseWeaponOffsetData.xRotationCenter, f8_arg0._poseWeaponOffsetData.yRotationCenter, f8_arg0._poseWeaponOffsetData.zRotationCenter )
			ClientWeapon[0x2F28F9BE6EE7D2D]( f8_arg0._clientWeaponIndex, f8_arg0._poseWeaponOffsetData.pitch, f8_arg0._poseWeaponOffsetData.yaw, f8_arg0._poseWeaponOffsetData.roll )
			f8_arg0._setPoseOffsetData = true
			f8_arg0._setPoseOffsetDataTimestamp = Engine[0x6991337AE950F99]()
		end
	end )
end

LUI.UIWeaponModel.SetOffsetsAndRotations = function ( f7_arg0, f7_arg1 )
	if f7_arg1 ~= ClientWeapon[0x9E23B76B1859FB4]( f7_arg0._clientWeaponIndex ) then
		return 
	end
	f7_arg0._weaponModelName = f7_arg1
	f7_arg0._weaponBaseRef = WEAPON.GetBaseRefFromWeaponString( f7_arg0._weaponModelName )
	local f7_local0 = FrontEndScene.GetWeaponModelOffset( f7_arg1, f7_arg0._weaponOffsetFilePath )
	if Engine[0x2DA54CF5D6B7F02]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x207212EF5C79A3A ) then
		f7_local0.xOffset, f7_local0.yOffset, f7_local0.zOffset = f7_arg0:GetDebugOffsets( f7_local0.xOffset, f7_local0.yOffset, f7_local0.zOffset )
	end
	f7_arg0:ApplyBaseOffsets( f7_local0 )
	local f7_local1 = FrontEndScene.GetWeaponRotationOffsets( f7_arg0._weaponBaseRef, {
		weaponModelName = f7_arg0._weaponModelName
	} )
	f7_local0.pitch = f7_local0.pitch + f7_local1.pitch
	f7_local0.yaw = f7_local0.yaw + f7_local1.yaw
	f7_local0.roll = f7_local0.roll + f7_local1.roll
	if Engine[0x2DA54CF5D6B7F02]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x207212EF5C79A3A ) then
		f7_local0.pitch, f7_local0.yaw, f7_local0.roll = f7_arg0:GetDebugRotations( f7_local0.pitch, f7_local0.yaw, f7_local0.roll )
	end
	f7_arg0:PoseWeapon( f7_local0 )
end

LUI.UIWeaponModel.SetSelectedLoadoutData = function ( f6_arg0, f6_arg1 )
	f6_arg0._selectedLoadoutData = f6_arg1
end

LUI.UIWeaponModel.SetNextPoseTagName = function ( f5_arg0, f5_arg1 )
	f5_arg0._nextPoseTagName = f5_arg1
end

LUI.UIWeaponModel.GetCurrentOffsetsAndRotations = function ( f4_arg0 )
	return f4_arg0._currentOffsetData
end

LUI.UIWeaponModel.GetOffsetsAndRotations = function ( f3_arg0, f3_arg1 )
	local f3_local0 = f3_arg0._clientWeaponIndex
	local f3_local1 = FrontEndScene.GetWeaponModelOffset( f3_arg1, f3_arg0._weaponOffsetFilePath )
	if Engine[0x2DA54CF5D6B7F02]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x207212EF5C79A3A ) then
		f3_local1.xOffset, f3_local1.yOffset, f3_local1.zOffset = f3_arg0:GetDebugOffsets( f3_local1.xOffset, f3_local1.yOffset, f3_local1.zOffset )
	end
	if Engine[0x2DA54CF5D6B7F02]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x207212EF5C79A3A ) then
		f3_local1.pitch, f3_local1.yaw, f3_local1.roll = f3_arg0:GetDebugRotations( f3_local1.pitch, f3_local1.yaw, f3_local1.roll )
	end
	return f3_local1
end

LUI.UIWeaponModel.SetWeaponModel = function ( f2_arg0, f2_arg1 )
	FrontEndScene.SetWeaponModel( f2_arg0._clientWeaponIndex, f2_arg1 )
	f2_arg0:SetOffsetsAndRotations( f2_arg1 )
	if f2_arg0._clientWeaponIndex <= FrontEndScene.MaxWeaponCutoutModelIndex then
		ClientWeapon[0x9ABB180A64F1EFC]( f2_arg0._clientWeaponIndex, true )
	end
end

LUI.UIWeaponModel.GetEntityNum = function ( f1_arg0 )
	return ClientWeapon[0x5DD69014A9C290]( f1_arg0._clientWeaponIndex )
end

LUI.UIWeaponModel.id = "UIWeaponModel"
