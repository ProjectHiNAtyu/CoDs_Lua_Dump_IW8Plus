-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
QUARTERMASTER = QUARTERMASTER or {}
QUARTERMASTER.storeSession = {}
QUARTERMASTER.itemData = {}
QUARTERMASTER.dlogEnabled = Dvar[0x9E5BE3B4BBA4E0E]( "#x3959053dfe08604a5" )
QUARTERMASTER.GetMenuSource = function ()
	if QUARTERMASTER.source then
		local f9_local0 = QUARTERMASTER.source
		QUARTERMASTER.source = nil
		return f9_local0
	else
		local f9_local0
		if Engine[0xCA085C21FCBD7CA]() then
			f9_local0 = "CPStore"
		else
			f9_local0 = "MPStore"
		end
	end
	return f9_local0
end

QUARTERMASTER.RecordStoreEnterEvent = function ( f8_arg0, f8_arg1, f8_arg2 )
	if QUARTERMASTER.dlogEnabled and f8_arg2 then
		local f8_local0 = {}
		if Engine[0x8B495DC361731F7]( f8_arg0 ) then
			f8_local0.storeName = Dvar[0x54084D7CA2317BB]( "#x36420f0be0e7ce3dc" )
		else
			f8_local0.storeName = Dvar[0x54084D7CA2317BB]( "#x35a850dc53e482d33" )
		end
		local f8_local1 = QUARTERMASTER.GetMenuSource()
		local f8_local2
		if not f8_local1 then
			f8_local2 = f8_local1
		else
			f8_local2 = "none"
		end
		f8_local0.sourceMenu = f8_local2
		f8_local0.storeRegion = Engine[0x2553ADACEC3D1C]()
		f8_local0.id = Engine[0x863AA6457598928]()
		f8_local0.storeLayout = f8_arg1
		f8_local0.recommendationsEnabled = f8_arg2.isEnabled
		f8_local0.recommendedItems = f8_arg2.items
		Engine[0x15D98DF5F61904B]( f8_arg0, "dlog_event_store_qm_entry", {
			store_name = f8_local0.storeName,
			store_session_id = f8_local0.id,
			source = f8_local0.sourceMenu,
			region = f8_local0.storeRegion,
			store_layout = f8_local0.storeLayout,
			recommendations_enabled = f8_local0.recommendationsEnabled,
			recommended_items = f8_local0.recommendedItems and tostring( f8_local0.recommendedItems ) or ""
		} )
		QUARTERMASTER.storeSession = f8_local0
	end
end

QUARTERMASTER.BeginItemBrowseEvent = function ( f7_arg0 )
	if QUARTERMASTER.dlogEnabled then
		local f7_local0 = 0
		if f7_arg0.endDate then
			local f7_local1, f7_local2, f7_local3 = STORE.GetCategoryTimeLeft( nil, f7_arg0.endDate )
			f7_local0 = f7_local1
		end
		local f7_local1 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f7_local1.id
		QUARTERMASTER.itemData.start_time = os.time()
		QUARTERMASTER.itemData.item_id = f7_arg0.id or 0
		QUARTERMASTER.itemData.item_name = f7_arg0.name
		QUARTERMASTER.itemData.bundle_id = f7_arg0.bundleID
		QUARTERMASTER.itemData.position_in_grid = f7_arg0.positionInGrid or 0
		QUARTERMASTER.itemData.remaining_time_in_seconds = f7_local0
	end
end

QUARTERMASTER.RecordItemBrowseEvent = function ( f6_arg0, f6_arg1 )
	if QUARTERMASTER.dlogEnabled then
		local f6_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f6_local0.id == QUARTERMASTER.itemData.sessionId then
			local f6_local1 = QUARTERMASTER.itemData
			local f6_local2 = f6_local1.start_time
			local f6_local3 = os.time()
			local f6_local4 = f6_local1.item_id
			local f6_local5 = f6_local1.item_name
			local f6_local6 = f6_local1.bundle_id
			local f6_local7 = f6_local1.position_in_grid
			local f6_local8 = f6_local1.remaining_time_in_seconds
			local f6_local9
			if not f6_local8 or 0 >= f6_local8 or f6_local8 >= STORE.LimitedTimeWarningThreshold then
				f6_local9 = false
			else
				f6_local9 = true
			end
			Engine[0x15D98DF5F61904B]( f6_arg0, "dlog_event_store_qm_item_browse", {
				store_name = f6_local0.storeName,
				store_session_id = f6_local0.id,
				source = f6_local0.sourceMenu,
				region = f6_local0.storeRegion,
				store_layout = f6_local0.storeLayout,
				item_id = f6_local4,
				item_name = f6_local5,
				bundle_id = f6_local6,
				start_time = f6_local2,
				end_time = f6_local3,
				interacted = f6_arg1,
				item_slot_in_category = f6_local7,
				remaining_time_in_seconds = f6_local8,
				is_timer_displayed = f6_local9
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.BeginMenuBrowseEvent = function ( f5_arg0, f5_arg1, f5_arg2 )
	if QUARTERMASTER.dlogEnabled then
		local f5_local0 = ""
		local f5_local1 = {}
		if f5_arg1.idPubVar then
			local f5_local2 = Dvar[0x54084D7CA2317BB]( f5_arg1.idPubVar ) or ""
			if not string.match( f5_local2, tostring( f5_arg2.id ) ) then
				if string.len( f5_local2 ) == 0 then
					f5_local2 = tostring( f5_arg2.id )
				else
					f5_local2 = f5_local2 .. "," .. tostring( f5_arg2.id )
				end
			end
			if f5_arg1.commsLocationId then
				f5_local2 = STORE.FormatRecommendationItems( Store.GetAdditionalCategoryItems( f5_arg1.commsLocationId ) .. "," .. f5_local2 )
			end
			local f5_local3 = split( f5_local2, "," )
			for f5_local4 = 1, #f5_local3, 1 do
				local f5_local7 = f5_local3[f5_local4]
				if string.len( f5_local0 ) == 0 and STORE.BundleAvailable( f5_arg0, f5_local7 ) then
					f5_local0 = f5_local7
				elseif STORE.BundleAvailable( f5_arg0, f5_local7 ) then
					f5_local0 = f5_local0 .. "," .. f5_local7
				end
				if #f5_local1 < f5_arg1.numItemsShown then
					table.insert( f5_local1, f5_local7 )
				end
			end
		end
		local f5_local2 = ""
		for f5_local3 = 1, #f5_local1, 1 do
			if string.len( f5_local2 ) == 0 then
				f5_local2 = f5_local1[f5_local3]
			else
				f5_local2 = f5_local2 .. "," .. f5_local1[f5_local3]
			end
		end
		local f5_local3 = 0
		if f5_arg1.endDate then
			local f5_local4, f5_local5, f5_local6 = STORE.GetCategoryTimeLeft( nil, f5_arg1.endDate )
			f5_local3 = f5_local4
		end
		f5_local4 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f5_local4.id
		QUARTERMASTER.itemData.start_time = os.time()
		QUARTERMASTER.itemData.category_index = f5_arg1.categoryIndex
		QUARTERMASTER.itemData.category_name = f5_arg1.name
		QUARTERMASTER.itemData.item_id = f5_arg2.id or 0
		QUARTERMASTER.itemData.item_name = f5_arg2.name
		QUARTERMASTER.itemData.position_in_grid = f5_arg2.positionInGrid or 0
		f5_local5 = QUARTERMASTER.itemData
		local f5_local6
		if not f5_local2 then
			f5_local6 = f5_local2
		else
			f5_local6 = ""
		end
		f5_local5.visible_items_in_row = f5_local6
		f5_local5 = QUARTERMASTER.itemData
		if not f5_local0 then
			f5_local6 = f5_local0
		else
			f5_local6 = ""
		end
		f5_local5.all_items_in_row = f5_local6
		QUARTERMASTER.itemData.remaining_time_in_seconds = f5_local3
	end
end

QUARTERMASTER.RecordMenuBrowseEvent = function ( f4_arg0, f4_arg1 )
	if QUARTERMASTER.dlogEnabled then
		local f4_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f4_local0.id == QUARTERMASTER.itemData.sessionId then
			local f4_local1 = QUARTERMASTER.itemData
			Engine[0x15D98DF5F61904B]( f4_arg0, "dlog_event_store_qm_menu_browse", {
				store_name = f4_local0.storeName,
				store_session_id = f4_local0.id,
				source = f4_local0.sourceMenu,
				region = f4_local0.storeRegion,
				store_layout = f4_local0.storeLayout,
				category_index = f4_local1.category_index or -1,
				category_name = f4_local1.category_name or "none",
				item_id = f4_local1.item_id or 0,
				item_name = f4_local1.item_name or "none",
				start_time = f4_local1.start_time,
				end_time = os.time(),
				interacted = f4_arg1,
				item_slot_in_category = f4_local1.position_in_grid,
				visible_items_in_row = f4_local1.visible_items_in_row,
				available_items_in_row = f4_local1.all_items_in_row
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.CoalesceBrowseData = function ()
	if QUARTERMASTER.dlogEnabled and QUARTERMASTER.storeSession.id == QUARTERMASTER.itemData.sessionId then
		QUARTERMASTER.storeSession.itemData = QUARTERMASTER.itemData
	end
end

QUARTERMASTER.RecordPurchaseConfirmEvent = function ( f2_arg0, f2_arg1, f2_arg2, f2_arg3 )
	if QUARTERMASTER.dlogEnabled then
		local f2_local0 = QUARTERMASTER.storeSession
		local f2_local1 = false
		if not f2_local0.itemData or f2_local0.itemData.sessionId ~= f2_local0.id then
			f2_local0.itemData = {}
			f2_local0.itemData.category_index = -1
			f2_local0.itemData.category_name = "none"
			f2_local0.itemData.item_id = 0
			f2_local0.itemData.item_name = "none"
			f2_local1 = true
		end
		local f2_local2 = {
			store_name = f2_local0.storeName,
			store_session_id = f2_local0.id,
			source = f2_local0.sourceMenu,
			region = f2_local0.storeRegion,
			store_layout = f2_local0.storeLayout,
			category_index = f2_local0.itemData.category_index,
			category_name = f2_local0.itemData.category_name,
			item_id = f2_local0.itemData.item_id,
			item_name = f2_local0.itemData.item_name,
			current_menu = LUI.FlowManager.GetMenuNameAtIndex( -1 ),
			previous_menu = f2_arg1,
			purchased = f2_arg2
		}
		local f2_local3
		if not f2_local1 then
			f2_local3 = f2_local1
		else
			f2_local3 = f2_arg3
		end
		f2_local2.err = f2_local3
		Engine[0x15D98DF5F61904B]( f2_arg0, "dlog_event_store_qm_item_purchase", f2_local2 )
	end
end

QUARTERMASTER.SetItemData = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.category_index = f1_arg0
		QUARTERMASTER.itemData.category_name = f1_arg1
		QUARTERMASTER.itemData.item_id = f1_arg2
		QUARTERMASTER.itemData.item_name = f1_arg3
		QUARTERMASTER.itemData.sessionId = QUARTERMASTER.storeSession.id
		QUARTERMASTER.storeSession.itemData = QUARTERMASTER.itemData
	end
end

