-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
LUI.MainMenuPopupManager = LUI.Class( LUI.UIElement )
LUI.MainMenuPopupManager.Instance = function ()
	return LUI.MainMenuPopupManager.GetLayer()
end

LUI.MainMenuPopupManager.GetLayer = function ()
	local f34_local0 = Engine[0xEE6F69FEA944B13]()
	return f34_local0.mainMenuPopupManager
end

LUI.MainMenuPopupManager.InitLayer = function ( f33_arg0 )
	
end

LUI.MainMenuPopupManager.ClearLayer = function ( f32_arg0, f32_arg1 )
	f32_arg0.closeChildren()
end

LUI.MainMenuPopupManager.ShouldBeVisible = function ( f31_arg0 )
	return true
end

LUI.MainMenuPopupManager.init = function ( f30_arg0, f30_arg1 )
	LUI.UIElement.init( f30_arg0 )
	f30_arg0.id = "MainMenuPopupManager"
	f30_arg0:registerEventHandler( "remove_menu_stack", LUI.MainMenuPopupManager.OnRemoveMenuStack )
end

LUI.MainMenuPopupManager.introPopups = {
	{
		name = "AgeGateNoticePopup",
		shouldShowFct = function ( f29_arg0 )
			return AGEGATES[0xB3026C7BB5015C7]( f29_arg0 )
		end,
		tryShow = function ( f28_arg0 )
			AGEGATES[0x2771ED017C94E3D]( f28_arg0 )
			return AGEGATES[0x1A0C04B5CACC1F2]
		end,
		postShow = function ( f27_arg0 )
			AGEGATES[0xC38EF5C058B5150]( f27_arg0 )
		end
	},
	{
		name = "SPCloudSaveOverridePopup",
		shouldShowFct = function ( f26_arg0 )
			if not CONDITIONS.IsSony() then
				return false
			elseif not Engine[0x647B2ED05194AAB]( f26_arg0 ) and not Dvar[0x9E5BE3B4BBA4E0E]( "ui_test_cloud_save_available" ) then
				return false
			else
				return true
			end
		end,
		tryShow = function ( f23_arg0 )
			LUI.FlowManager.RequestPopupMenu( nil, "PopupMessageAndButtons", true, f23_arg0, false, {
				defaultFocusIndex = 0,
				noBackButton = true,
				buttonsClosePopup = true,
				cancelClosesPopup = false,
				title = Engine[0xED84C33EC5F01EA]( 0x208225B05C94041 ),
				message = Engine[0xED84C33EC5F01EA]( 0x7040493BB69F205 ),
				controllerIndex = f23_arg0,
				buttons = {
					{
						label = Engine[0xED84C33EC5F01EA]( 0x4B554933FF8DC1C ),
						action = function ( f25_arg0, f25_arg1 )
							Engine[0xBF432D422FFC0A4]( f25_arg1 )
						end
					},
					{
						label = Engine[0xED84C33EC5F01EA]( 0x7151693BB7883CE ),
						action = function ()
							
						end
					}
				}
			} )
			return "PopupMessageAndButtons"
		end,
		postShow = function ( f22_arg0 )
			
		end
	},
	{
		name = "CinematicFullscreen",
		shouldShowFct = function ( f21_arg0 )
			local f21_local0 = SEASON.GetCurrentSeason()
			if not f21_local0 then
				DebugPrint( "DEBUG SEASON VIDEO: Season value is nil" )
				return false
			end
			local f21_local1 = LUI.DataSourceInControllerModel.new( "alwaysLoaded.hasPlayerSeenSeasonVideo" )
			if f21_local1:GetValue( f21_arg0 ) then
				DebugPrint( "DEBUG SEASON VIDEO: hasSeenSeasonVideoDataSource value is true." )
				return false
			end
			DebugPrint( "DEBUG SEASON VIDEO: hasSeenSeasonVideoDataSource value is false or nil. Proceeding for further checks" )
			local f21_local2 = Onboarding.SeasonVideo.WasCompleted( f21_arg0, f21_local0 )
			if f21_local2 == nil then
				DebugPrint( "DEBUG SEASON VIDEO: isVideoSeen is nil" )
				return false
			end
			if f21_local2 and not Dvar[0x9E5BE3B4BBA4E0E]( 0x3FC909B5D406C42 ) then
				DebugPrint( "DEBUG SEASON VIDEO:" .. "Season video is playing again because lui_skip_season_video dvar is turned off" )
				return true
			end
			local f21_local3 = DebugPrint
			local f21_local4 = "DEBUG SEASON VIDEO:"
			local f21_local5
			if f21_local2 then
				f21_local5 = "Season Video is seen"
			else
				f21_local5 = "Season video is not seen"
			end
			f21_local3( f21_local4 .. f21_local5 .. " for season " .. tostring( f21_local0 ) )
			return not f21_local2
		end,
		tryShow = function ( f18_arg0 )
			local f18_local0 = LUI.DataSourceInControllerModel.new( "alwaysLoaded.seasonVideoState" )
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x1D3FD8961BD9873 ) then
				DebugPrint( "DEBUG SEASON VIDEO: Skipping season video because lui_always_hide_season_video is turned on" )
				local f18_local1 = false
			end
			local f18_local1 = SEASON.GetCurrentSeason()
			local f18_local2 = StringTable[0x2DCF0973239E909]( CSV.seasons.file, CSV.seasons.cols.index, f18_local1, CSV.seasons.cols.videoName )
			local f18_local3 = Dvar[0x9E5BE3B4BBA4E0E]( 0x80BEBEDC3A3F8D5 )
			local f18_local4 = function ( f19_arg0 )
				return function ()
					DebugPrint( "In PostVideoFunc" )
					if Dvar[0x9E5BE3B4BBA4E0E]( 0x7306D043650DA06 ) then
						DebugPrint( "DEBUG SEASON VIDEO: Setting lui_skip_season_video because of autoskipsplashscreen" )
						Dvar[0x8EA06EEDB58D872]( 0x3FC909B5D406C42, true )
					end
					local f20_local0 = SEASON.GetCurrentSeason()
					local f20_local1 = Onboarding.SeasonVideo.WasCompleted( f19_arg0, f20_local0 )
					if f20_local1 ~= nil and not f20_local1 then
						DebugPrint( "DEBUG SEASON VIDEO: marking the video as seen" )
						Onboarding.SeasonVideo.MarkCompleted( f19_arg0, f20_local0 )
					end
					f19_arg0:SetValue( f19_arg0, GL_HACK.SeasonVideoState.FINISHED )
					if f19_arg0 ~= nil then
						Dvar[0x8EA06EEDB58D872]( 0x80BEBEDC3A3F8D5, f19_arg0 )
					end
				end
				
			end
			
			local f18_local5 = Onboarding.SeasonVideo.WasCompleted( f18_arg0, f18_local1 )
			if f18_local5 or Dvar[0x9E5BE3B4BBA4E0E]( 0x3FC909B5D406C42 ) or f18_local1 <= SEASON.DefaultSeason then
				DebugPrint( "DEBUG SEASON VIDEO: Skipping season video because video is already seen or dvar lui_skip_season_video is set. Current Season = " .. tostring( f18_local1 ) )
				return false
			elseif f18_local5 then
				DebugPrint( "DEBUG SEASON VIDEO: Showing season video even if player already seen it, since dvar lui_skip_season_video is false" )
			end
			if String.IsNilOrEmpty( f18_local2 ) then
				DebugPrint( "DEBUG SEASON VIDEO: Skipping season video because intro video name is not available" )
				return false
			end
			DebugPrint( "DEBUG SEASON VIDEO: Opening season video" )
			local f18_local6
			if not f18_local5 then
				f18_local6 = not CONDITIONS.IsDemoBuildOrDevBuildOrAreDevFeaturesEnabled()
			else
				f18_local6 = false
			end
			if f18_local6 then
				f18_local0:SetValue( f18_arg0, GL_HACK.SeasonVideoState.PLAYING_UNSKIPPABLE )
			end
			LUI.FlowManager.RequestPopupMenu( nil, "CinematicFullscreen", true, f18_arg0, false, {
				disableQuickAccess = true,
				widescreen = true,
				skipVideoOnPartyJoin = true,
				video = f18_local2,
				onVideoFinished = f18_local4( f18_arg0 ),
				unskippable = f18_local6,
				skipImmediate = not Dvar[0x9E5BE3B4BBA4E0E]( 0x4203CE3C40112EF )
			} )
			Dvar[0x8EA06EEDB58D872]( 0x80BEBEDC3A3F8D5, false )
			return "CinematicFullscreen"
		end,
		postShow = function ( f17_arg0 )
			
		end
	},
	{
		name = "LobbyRejoinPopup",
		shouldShowFct = function ( f16_arg0 )
			return LUI.RejoinManager.IsDataFetchCompleted()
		end,
		tryShow = function ( f15_arg0 )
			if LUI.RejoinManager.IsDataFetchCompleted() then
				RejoinUtils.FetchAndUpdateRejoinState( f15_arg0 )
			end
			return "LobbyRejoinPopup"
		end,
		postShow = function ( f14_arg0 )
			
		end
	},
	{
		name = "LoginRewardPopup",
		shouldShowFct = function ( f13_arg0 )
			if DataSources.telescope.seenloginreward:GetValue( f13_arg0 ) then
				DebugPrint( "[TELESCOPE]: Login reward has seen" )
				return false
			else
				DataSources.telescope.seenloginreward:SetValue( f13_arg0, true )
				if DataSources.telescope.conflictfullscreenwebview:GetValue( f13_arg0 ) then
					DebugPrint( "[TELESCOPE]: Login reward has conflict" )
					return false
				elseif not LUI.WebViewManager.LoginRewardPopupEnabled() then
					DebugPrint( "[TELESCOPE]: Login reward popup is disabled" )
					return false
				elseif IsTelescopeLiveEventReady( f13_arg0 ) and not ShouldPopupLoginReward( f13_arg0 ) then
					DebugPrint( "[TELESCOPE]: Do not need to show login reward popup" )
					return false
				else
					return true
				end
			end
		end,
		tryShow = function ( f12_arg0 )
			LUI.FlowManager.RequestPopupMenu( nil, "LoginReward", true, Engine[0x45B054C920178E9](), false, {}, nil, false, true )
			return "LoginReward"
		end,
		postShow = function ( f11_arg0 )
			
		end
	},
	{
		name = "MotdFullScreenPopup",
		shouldShowFct = function ( f10_arg0 )
			if DataSources.telescope.seenfullscreenmotd:GetValue( f10_arg0 ) then
				DebugPrint( "[TELESCOPE]: MOTD has seen" )
				return false
			else
				DataSources.telescope.seenfullscreenmotd:SetValue( f10_arg0, true )
				if DataSources.telescope.conflictfullscreenwebview:GetValue( f10_arg0 ) then
					DebugPrint( "[TELESCOPE]: MOTD has conflict" )
					return false
				elseif not Dvar[0x9E5BE3B4BBA4E0E]( 0xEF7A1FAC7B6759F ) then
					DebugPrint( "[TELESCOPE]: MOTD is disabled" )
					return false
				elseif not LUI.WebViewManager.MotdEnabled() then
					DebugPrint( "[TELESCOPE]: MOTD is disabled" )
					return false
				else
					return true
				end
			end
		end,
		tryShow = function ( f9_arg0 )
			local f9_local0 = LUI.WebViewManager.Instance()
			f9_local0:PreloadMotd()
			LUI.FlowManager.RequestPopupMenu( nil, "FullScreenMOTD", true, Engine[0x45B054C920178E9](), false, {}, nil, false, true )
			return "FullScreenMOTD"
		end,
		postShow = function ( f8_arg0 )
			
		end
	},
	{
		name = "SPUninstallPromptPopup",
		shouldShowFct = function ( f7_arg0 )
			if not Dvar[0x9E5BE3B4BBA4E0E]( 0x4BEB98EB1350EC5 ) then
				return false
			elseif not FILE_MANAGEMENT.IsFileManagementEnabled() then
				return false
			elseif not Engine[0xC8B174B6BF663C4]( CoD.Scenarios.SP22 ) then
				return false
			end
			local f7_local0 = PLAYER_DATA.IO( f7_arg0, CoD.StatsGroup.NonGame )
			if not f7_local0.spUninstallPromptLastSeenTimestamp then
				return false
			end
			local f7_local1 = CoD.GetUTC()
			local f7_local2 = f7_local0.spUninstallPromptLastSeenTimestamp:get() or 0
			local f7_local3 = Dvar[0x22EAAB59AA27E9B]( 0x21EB46761EF243A )
			if not f7_local3 then
				f7_local3 = FILE_MANAGEMENT.SP_UNINSTALL_PROMPT_REMIND_ME_LATER_DAYS_DEFAULT
			end
			if f7_local1 <= f7_local2 + f7_local3 * TIME.DAY then
				return false
			end
			return true
		end,
		tryShow = function ( f6_arg0 )
			local f6_local0 = FILE_MANAGEMENT.MissingModePopupValuesTable[CoD.Scenarios.SP22].contentId
			LUI.FlowManager.RequestPopupMenu( nil, "PopupMessageAndButtons", true, f6_arg0, false, FILE_MANAGEMENT.GetUninstallPromptPopupOptionsData( f6_arg0, 0xCFD726BB03ACA96, Engine[0xED84C33EC5F01EA]( 0x82B20F5679788D6, 0x4790FD6D8475432, FILE_MANAGEMENT.GetFileSizeString( GameInstall[0xFF73F28B5AA8062]( f6_local0 ) ) ), f6_local0 ) )
			return "PopupMessageAndButtons"
		end,
		postShow = function ( f5_arg0 )
			
		end
	}
}
LUI.MainMenuPopupManager.ShowCurrentPopup = function ( f4_arg0, f4_arg1 )
	local f4_local0 = f4_arg0.introPopups[DataSources.alwaysLoaded.mainMenuPopupIndex:GetValue( f4_arg1 )]
	if f4_local0.shouldShowFct( f4_arg1 ) then
		local f4_local1 = f4_local0.tryShow( f4_arg1 )
		if f4_local1 and LUI.FlowManager.IsInStack( f4_local1 ) then
			DataSources.alwaysLoaded.mainMenuPopupMenuName:SetValue( f4_arg1, f4_local1 )
			return true
		elseif f4_local0.postShow then
			f4_local0.postShow( f4_arg1 )
			Dvar[0x8EA06EEDB58D872]( 0x3EC3B87FCEEF73B, true )
		end
	end
	return false
end

LUI.MainMenuPopupManager.ShowNextPopup = function ( f3_arg0, f3_arg1 )
	local f3_local0 = DataSources.alwaysLoaded.mainMenuIntroPopupsFlowComplete:GetValue( f3_arg1 )
	if LUI.FlowManager.IsInStack( DataSources.alwaysLoaded.mainMenuPopupMenuName:GetValue( f3_arg1 ) ) then
		return 
	elseif not false then
		
	else
		
	end
end

LUI.MainMenuPopupManager.OnRemoveMenuStack = function ( f2_arg0, f2_arg1 )
	local f2_local0 = f2_arg1.controllerIndex
	local f2_local1 = DataSources.alwaysLoaded.mainMenuIntroPopupsFlowComplete:GetValue( f2_local0 )
	local f2_local2 = DataSources.alwaysLoaded.mainMenuPopupMenuName:GetValue( f2_local0 )
	if not f2_local1 and LUI.FlowManager.IsInStack( "MainMenu" ) and f2_arg1.menuName == f2_local2 then
		DebugPrint( "MAIN MENU HANDLING REMOVE MENU STACK OF " .. f2_local2 )
		local f2_local3 = f2_arg0.introPopups[DataSources.alwaysLoaded.mainMenuPopupIndex:GetValue( f2_local0 )]
		if f2_local3.postShow then
			f2_local3.postShow( f2_local0 )
		end
		local f2_local4 = LUI.MainMenuPopupManager.Instance()
		f2_local4:ShowNextPopup( f2_local0 )
		return true
	else
		return false
	end
end

LUI.MainMenuPopupManager.ShowIntroPopups = function ( f1_arg0, f1_arg1 )
	local f1_local0 = Dvar[0x9E5BE3B4BBA4E0E]( 0x4A3BD6828304049 )
	local f1_local1 = DataSources.alwaysLoaded.mainMenuIntroPopupsFlowComplete:GetValue( f1_arg1 )
	Dvar[0x8EA06EEDB58D872]( 0x3EC3B87FCEEF73B, true )
	if not MAIN_MENU.TryShowTitleUpdateAvailablePopup() and not f1_local1 and not f1_local0 then
		Dvar[0x8EA06EEDB58D872]( 0x3EC3B87FCEEF73B, false )
		local f1_local2 = LUI.MainMenuPopupManager.Instance()
		f1_local2:ShowNextPopup( f1_arg1 )
	end
end

