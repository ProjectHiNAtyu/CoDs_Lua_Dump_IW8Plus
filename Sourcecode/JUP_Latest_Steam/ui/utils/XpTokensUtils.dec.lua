-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
XPTOKENS = XPTOKENS or {}
XPTOKENS.tokensList = {}
XPTOKENS.ActivationFailureMessage = 0x3BCD0748D16B89A
XPTOKENS.DisableTypeAtBonusAmount = 100
XPTOKENS.SonyBonusXP = 25
XPTOKENS.DatasourceFromType = {
	[LOOT.doubleXpTypes.XP] = function ()
		return DataSources.alwaysLoaded.loot.playerXPTokenUseLocked
	end,
	[LOOT.doubleXpTypes.WEAPON] = function ()
		return DataSources.alwaysLoaded.loot.weaponXPTokenUseLocked
	end,
	[LOOT.doubleXpTypes.BATTLE_PASS] = function ()
		return DataSources.alwaysLoaded.loot.battlepassXPTokenUseLocked
	end
}
XPTOKENS.doubleXpTokenTypes = {
	BATTLE_PASS = 3,
	XP = 1,
	WEAPON = 2
}
XPTOKENS.durationTypes = {
	MINUTES_60 = 4,
	MINUTES_15 = 1,
	MINUTES_45 = 3,
	MINUTES_30 = 2
}
XPTOKENS.raritytoDurationTypes = {
	XPTOKENS.durationTypes.MINUTES_15,
	XPTOKENS.durationTypes.MINUTES_30,
	XPTOKENS.durationTypes.MINUTES_45,
	XPTOKENS.durationTypes.MINUTES_60
}
XPTOKENS.TokensMaterialsStrings = {
	[XPTOKENS.doubleXpTokenTypes.XP] = {
		skinBonusActive = 0x900E9177C5E8D72,
		partyBonusActive = 0xA689729CF6135B2,
		skinBonusInActive = 0xBD8F365BB6BB09A,
		inactive = 0x51AA2B62B402ADF,
		active = 0x3148967C9C72119
	},
	[XPTOKENS.doubleXpTokenTypes.WEAPON] = {
		skinBonusActive = 0x3A5DFA442A1D23D,
		partyBonusActive = 0x4BB238ED6267B7D,
		skinBonusInActive = 0x8BFC07C1C12CBC5,
		inactive = 0x9B3B1B5AE4F7CBC,
		active = 0x1819E956E76AFB6
	},
	[XPTOKENS.doubleXpTokenTypes.BATTLE_PASS] = {
		skinBonusActive = 0xC475A0AA1EF4B70,
		partyBonusActive = 0x9AD1D7502539B0,
		skinBonusInActive = 0x5878EE636B49D08,
		inactive = 0x451231E7A3DA255,
		active = 0x359FB3164D1723F
	}
}
XPTOKENS.TokensDurationMaterialsStrings = {
	[XPTOKENS.durationTypes.MINUTES_15] = 0xE6439EA9D2E5CE8,
	[XPTOKENS.durationTypes.MINUTES_30] = 0xE5D32EA9D283255,
	[XPTOKENS.durationTypes.MINUTES_45] = 0xE533DEA9D1FF081,
	[XPTOKENS.durationTypes.MINUTES_60] = 0xE4C34EA9D19C288
}
XPTOKENS.GetTokenData = function ( f34_arg0, f34_arg1 )
	if not f34_arg0 then
		return {}
	end
	local f34_local0 = CONSUMABLE.GetBundleByID( f34_arg0 )
	local f34_local1 = {
		tokenID = f34_arg0,
		XPName = Engine[0xED84C33EC5F01EA]( f34_local0[0x4BCADBA8E631B86] ),
		tokenAmount = f34_arg1,
		ref = LOOT.GetItemRef( f34_arg0 ),
		achievementID = f34_local0[0xACC083D56797E6],
		eventName = f34_local0[0x93DFE6EEC89B539],
		image = f34_local0[0xAB612888528489A],
		duration = Engine[0xED84C33EC5F01EA]( f34_local0[0xAF203AC9DD3208D] ),
		rarity = LOOT.RarityStrings[f34_local0[0x3A56EF37819B0CA]] or 0
	}
	if f34_local1.tokenID == LOOT.DOUBLE_XP_TOKENS.XP_Year then
		f34_local1.rarity = 5
	end
	return f34_local1
end

XPTOKENS.GetXPBoostActiveStates = function ( f33_arg0, f33_arg1, f33_arg2 )
	local f33_local0 = LOOT.IsDoubleXPActive()
	local f33_local1 = LOOT.IsDoubleWeaponXPActive()
	local f33_local2 = LOOT.IsDoubleBattlePassXPActive()
	if f33_local2 then
		f33_local2 = CONDITIONS.IsBattlePassEnabled()
	end
	if not Engine[0x8FF0F1C5B20321E]() then
		local f33_local3 = Lobby[0xB92DA1948EDB47D]( Lobby.PartyUIData.PLAYLIST_ID )
		if not f33_local0 then
			f33_local0 = PlaylistUtils.GetPlaylistXPScale( f33_arg0, f33_local3 ) == 2
		end
		if not f33_local1 then
			f33_local1 = false
		end
		if not f33_local2 then
			f33_local2 = PlaylistUtils.GetBattleXPScale( f33_arg0, f33_local3 ) == 2
		end
	end
	local f33_local3
	if not f33_arg2 or not f33_arg2[f33_arg1] or f33_arg2[f33_arg1] >= XPTOKENS.DisableTypeAtBonusAmount then
		f33_local3 = false
	else
		f33_local3 = true
	end
	local f33_local4
	if not f33_arg2 or not f33_arg2[f33_arg1] or f33_arg2[f33_arg1] < XPTOKENS.DisableTypeAtBonusAmount then
		f33_local4 = false
	else
		f33_local4 = true
	end
	if f33_arg1 == LOOT.doubleXpTypes.XP then
		return f33_local0, f33_local3, f33_local4
	elseif f33_arg1 == LOOT.doubleXpTypes.WEAPON then
		return f33_local1, f33_local3, f33_local4
	elseif f33_arg1 == LOOT.doubleXpTypes.BATTLE_PASS then
		return f33_local2, f33_local3, f33_local4
	else
		return false, false, false
	end
end

XPTOKENS.GetTokenImage = function ( f32_arg0, f32_arg1, f32_arg2, f32_arg3, f32_arg4 )
	if not f32_arg1 then
		local f32_local0
		if f32_arg4 then
			f32_local0 = XPTOKENS.TokensMaterialsStrings[f32_arg0].skinBonusInActive
			if not f32_local0 then
			
			else
				return f32_local0
			end
		end
		f32_local0 = XPTOKENS.TokensMaterialsStrings[f32_arg0].inactive
	elseif f32_arg2 then
		return XPTOKENS.TokensMaterialsStrings[f32_arg0].active
	elseif f32_arg4 then
		return XPTOKENS.TokensMaterialsStrings[f32_arg0].skinBonusActive
	elseif f32_arg3 then
		return XPTOKENS.TokensMaterialsStrings[f32_arg0].partyBonusActive
	else
		return XPTOKENS.TokensMaterialsStrings[f32_arg0].active
	end
end

XPTOKENS.GetTokenType = function ( f31_arg0 )
	if Table.IsItemIndexInArray( LOOT.DOUBLE_XP_TOKENS, f31_arg0 ) then
		return LOOT.doubleXpTypes.XP
	elseif Table.IsItemIndexInArray( LOOT.DOUBLE_WEAPON_XP_TOKENS, f31_arg0 ) then
		return LOOT.doubleXpTypes.WEAPON
	elseif Table.IsItemIndexInArray( LOOT.DOUBLE_BATTLE_PASS_TOKENS, f31_arg0 ) then
		return LOOT.doubleXpTypes.BATTLE_PASS
	else
		
	end
end

XPTOKENS.GetLootIdTable = function ( f30_arg0 )
	if f30_arg0 == LOOT.doubleXpTypes.XP then
		return LOOT.DOUBLE_XP_TOKENS
	elseif f30_arg0 == LOOT.doubleXpTypes.WEAPON then
		return LOOT.DOUBLE_WEAPON_XP_TOKENS
	elseif f30_arg0 == LOOT.doubleXpTypes.BATTLE_PASS then
		return LOOT.DOUBLE_BATTLE_PASS_TOKENS
	else
		return {}
	end
end

XPTOKENS.GetTokenUseTitle = function ( f29_arg0 )
	if f29_arg0 == LOOT.doubleXpTypes.XP then
		return Engine[0xED84C33EC5F01EA]( 0x82D1477BAA01F78 )
	elseif f29_arg0 == LOOT.doubleXpTypes.WEAPON then
		return Engine[0xED84C33EC5F01EA]( 0x2EFBD371106B687 )
	elseif f29_arg0 == LOOT.doubleXpTypes.BATTLE_PASS then
		return Engine[0xED84C33EC5F01EA]( 0xF462069240A8F85 )
	else
		return ""
	end
end

XPTOKENS.GetToastDataFromAchievementID = function ( f28_arg0 )
	local f28_local0 = {}
	f28_arg0 = tonumber( f28_arg0 )
	for f28_local8, f28_local9 in pairs( LOOT.doubleXpTypes ) do
		for f28_local4, f28_local5 in pairs( XPTOKENS.GetLootIdTable( f28_local9 ) ) do
			local f28_local7 = CONSUMABLE.GetBundleByID( f28_local5 )
			if tonumber( f28_local7[0xACC083D56797E6] ) == f28_arg0 then
				f28_local0.successTitle = XPTOKENS.GetTokenUseTitle( XPTOKENS.GetTokenType( f28_local7[0x28887F70BF5EBA] ) )
				f28_local0.duration = f28_local7[0xAF203AC9DD3208D] and Engine[0xED84C33EC5F01EA]( f28_local7[0xAF203AC9DD3208D] ) or ""
				return f28_local0
			end
		end
	end
	return f28_local0
end

XPTOKENS.GetTokenUseLocked = function ( f27_arg0, f27_arg1 )
	if f27_arg1 then
		local f27_local0 = XPTOKENS.DatasourceFromType[f27_arg1]
		if f27_local0 then
			f27_local0 = XPTOKENS.DatasourceFromType[f27_arg1]()
		end
		local f27_local1
		if f27_local0 then
			f27_local1 = f27_local0:GetValue( f27_arg0 )
			if not f27_local1 then
			
			else
				return f27_local1
			end
		end
		f27_local1 = false
	else
		return DataSources.alwaysLoaded.loot.xpTokenUseLocked and DataSources.alwaysLoaded.loot.xpTokenUseLocked:GetValue( f27_arg0 ) or false
	end
end

XPTOKENS.SetTokenUseLocked = function ( f26_arg0, f26_arg1, f26_arg2 )
	if f26_arg2 then
		local f26_local0 = XPTOKENS.DatasourceFromType[f26_arg2]
		if f26_local0 then
			f26_local0 = XPTOKENS.DatasourceFromType[f26_arg2]()
		end
		if f26_local0 then
			f26_local0:SetValue( f26_arg0, f26_arg1 )
		end
		return 
	elseif DataSources.alwaysLoaded.loot.xpTokenUseLocked then
		DataSources.alwaysLoaded.loot.xpTokenUseLocked:SetValue( f26_arg0, f26_arg1 )
	end
end

XPTOKENS.PopulateXPTokens = function ( f24_arg0 )
	XPTOKENS.tokensList = {}
	for f24_local11, f24_local12 in pairs( LOOT.doubleXpTypes ) do
		if not XPTOKENS.tokensList[f24_local12] then
			XPTOKENS.tokensList[f24_local12] = {}
		end
		local f24_local3 = XPTOKENS.GetLootIdTable( f24_local12 )
		local f24_local4 = XPTOKENS.GetTokenUseTitle( f24_local12 )
		for f24_local9, f24_local10 in pairs( f24_local3 ) do
			if f24_local10 ~= LOOT.DOUBLE_XP_TOKENS.XP_Year then
				local f24_local8 = XPTOKENS.GetTokenData( f24_local10, PROXY_LOOT.IsOwned( f24_arg0, f24_local10 ) )
				f24_local8.header = f24_local4
				f24_local8.type = f24_local12
				table.insert( XPTOKENS.tokensList[f24_local12], f24_local8 )
			end
		end
		table.sort( XPTOKENS.tokensList[f24_local12], function ( f25_arg0, f25_arg1 )
			if f25_arg0.rarity and f25_arg1.rarity then
				return f25_arg0.rarity < f25_arg1.rarity
			else
				
			end
		end )
	end
end

XPTOKENS.GetRemainingTimeForTokenType = function ( f23_arg0, f23_arg1 )
	local f23_local0 = 0
	local f23_local1 = 0
	local f23_local2 = CoD.GetUTC()
	if not f23_local2 then
		f23_local2 = tonumber( Engine[0x3B8CFB6758EF57C]() )
	end
	local f23_local3, f23_local4, f23_local5 = XPTOKENS.GetDoubleXPTimersForType( f23_arg0, f23_arg1 )
	if 0 < f23_local4 - f23_local2 then
		f23_local0 = f23_local4 - f23_local2
	end
	if 0 < f23_local3 - f23_local2 then
		f23_local1 = f23_local3 - f23_local2
	end
	return f23_local1, f23_local0
end

XPTOKENS.GetAllDoubleXpEventState = function ()
	local f22_local0 = LOOT.IsDoubleXPActive()
	local f22_local1 = LOOT.IsDoubleWeaponXPActive()
	local f22_local2 = LOOT.IsDoubleBattlePassXPActive()
	if f22_local2 then
		f22_local2 = CONDITIONS.IsBattlePassEnabled()
	end
	return f22_local0, f22_local1, f22_local2
end

XPTOKENS.IsAnyDoubleXPEventsActivated = function ()
	local f21_local0, f21_local1, f21_local2 = XPTOKENS.GetAllDoubleXpEventState()
	local f21_local3
	if not f21_local0 then
		f21_local3 = f21_local0
	elseif not f21_local1 then
		f21_local3 = f21_local1
	else
		f21_local3 = f21_local2
	end
	return f21_local3
end

XPTOKENS.GetAllXPTimers = function ( f20_arg0 )
	local f20_local0 = PROGRESSION.GetTokensEndTimesInSec( f20_arg0 )
	local f20_local1 = PROGRESSION.GetGlobalDoubleXPEventsEndTime()
	return {
		rankTokenEndTime = f20_local0[PROGRESSION.DoubleXPType.PLAYER],
		rankEventEndTime = f20_local1[PROGRESSION.DoubleXPType.PLAYER],
		weaponTokenEndTime = f20_local0[PROGRESSION.DoubleXPType.WEAPON],
		weaponEventEndTime = f20_local1[PROGRESSION.DoubleXPType.WEAPON],
		battlePassTokenEndTime = f20_local0[PROGRESSION.DoubleXPType.BATTLEPASS],
		battlePassEventEndTime = f20_local1[PROGRESSION.DoubleXPType.BATTLEPASS]
	}
end

XPTOKENS.GetDoubleXPTimersForType = function ( f19_arg0, f19_arg1 )
	local f19_local0 = XPTOKENS.GetAllXPTimers( f19_arg0 )
	local f19_local1, f19_local2, f19_local3 = XPTOKENS.GetAllDoubleXpEventState()
	if f19_arg1 == XPTOKENS.doubleXpTokenTypes.XP then
		return f19_local0.rankEventEndTime, f19_local0.rankTokenEndTime, f19_local1
	elseif f19_arg1 == XPTOKENS.doubleXpTokenTypes.WEAPON then
		return f19_local0.weaponEventEndTime, f19_local0.weaponTokenEndTime, f19_local2
	elseif f19_arg1 == XPTOKENS.doubleXpTokenTypes.BATTLE_PASS then
		return f19_local0.battlePassEventEndTime, f19_local0.battlePassTokenEndTime, f19_local3
	else
		return f19_local0
	end
end

XPTOKENS.GetSectionTokensData = function ( f18_arg0 )
	return XPTOKENS.tokensList[f18_arg0]
end

XPTOKENS.HasAvailableTokens = function ( f17_arg0, f17_arg1 )
	for f17_local3, f17_local4 in pairs( XPTOKENS.GetSectionTokensData( f17_arg1 ) ) do
		if 0 < f17_local4.tokenAmount then
			return true
		end
	end
	return false
end

XPTOKENS.GetAllDoubleXPStates = function ( f16_arg0 )
	local f16_local0 = CoD.GetUTC()
	if not f16_local0 then
		f16_local0 = tonumber( Engine[0x3B8CFB6758EF57C]() )
	end
	local f16_local1 = XPTOKENS.GetAllXPTimers( f16_arg0 )
	local f16_local2
	if (f16_local1.rankTokenEndTime == nil or 0 >= f16_local1.rankTokenEndTime - f16_local0) and (f16_local1.rankEventEndTime == nil or 0 >= f16_local1.rankEventEndTime - f16_local0) then
		f16_local2 = false
	else
		f16_local2 = true
	end
	local f16_local3
	if (f16_local1.weaponTokenEndTime == nil or 0 >= f16_local1.weaponTokenEndTime - f16_local0) and (f16_local1.weaponEventEndTime == nil or 0 >= f16_local1.weaponEventEndTime - f16_local0) then
		f16_local3 = false
	else
		f16_local3 = true
	end
	local f16_local4 = false
	if XPTOKENS.IsBattlePassOwned( f16_arg0 ) then
		if (f16_local1.battlePassTokenEndTime == nil or 0 >= f16_local1.battlePassTokenEndTime - f16_local0) and (f16_local1.battlePassEventEndTime == nil or 0 >= f16_local1.battlePassEventEndTime - f16_local0) then
			f16_local4 = false
		else
			f16_local4 = true
		end
	end
	local f16_local5, f16_local6, f16_local7 = XPTOKENS.GetAllDoubleXpEventState()
	local f16_local8
	if not f16_local5 then
		f16_local8 = f16_local5
	else
		f16_local8 = f16_local2
	end
	local f16_local9
	if not f16_local6 then
		f16_local9 = f16_local6
	else
		f16_local9 = f16_local3
	end
	local f16_local10
	if not f16_local7 then
		f16_local10 = f16_local7
	else
		f16_local10 = f16_local4
	end
	return f16_local8, f16_local9, f16_local10
end

XPTOKENS.IsDoubleXPActivatedForType = function ( f15_arg0, f15_arg1 )
	local f15_local0, f15_local1, f15_local2 = XPTOKENS.GetAllDoubleXPStates( f15_arg0 )
	if f15_arg1 == XPTOKENS.doubleXpTokenTypes.XP then
		return f15_local0
	elseif f15_arg1 == XPTOKENS.doubleXpTokenTypes.WEAPON then
		return f15_local1
	elseif f15_arg1 == XPTOKENS.doubleXpTokenTypes.BATTLE_PASS then
		return f15_local2
	else
		return false
	end
end

XPTOKENS.IsBattlePassOwned = function ( f14_arg0 )
	local f14_local0 = CONDITIONS.IsBattlePassEnabled()
	if f14_local0 then
		f14_local0 = BATTLEPASS.IsOwned( f14_arg0, SEASON.GetCurrentSeason() )
	end
	return f14_local0
end

XPTOKENS.IsDoubleXpEventBannerActive = function ()
	local f13_local0 = CONDITIONS.IsDvarBoolEnabled( 0xD48984A0AC52B61 )
	if f13_local0 then
		f13_local0 = XPTOKENS.IsAnyDoubleXPEventsActivated()
	end
	return f13_local0
end

XPTOKENS.IsTokenDataDisabled = function ( f12_arg0 )
	local f12_local0
	if f12_arg0.tokenAmount ~= 0 then
		if f12_arg0.type == XPTOKENS.doubleXpTokenTypes.XP then
			f12_local0 = XPTOKENS.DoubleXPActive
			if not f12_local0 then
			
			else
				return f12_local0
			end
		end
		if f12_arg0.type == XPTOKENS.doubleXpTokenTypes.WEAPON then
			f12_local0 = XPTOKENS.WeaponXPActive
			if not f12_local0 then
			
			else
				return f12_local0
			end
		end
		if f12_arg0.type == XPTOKENS.doubleXpTokenTypes.BATTLE_PASS then
			f12_local0 = XPTOKENS.BattlePassXPActive
		else
			f12_local0 = false
		end
	else
		f12_local0 = true
	end
	return f12_local0
end

XPTOKENS.GetXpTokensTitle = function ( f11_arg0 )
	if f11_arg0 == XPTOKENS.doubleXpTokenTypes.XP then
		return Engine[0xED84C33EC5F01EA]( 0x65848D7B8005D30 )
	elseif f11_arg0 == XPTOKENS.doubleXpTokenTypes.WEAPON then
		return Engine[0xED84C33EC5F01EA]( 0x41E761AAD00B2A3 )
	elseif f11_arg0 == XPTOKENS.doubleXpTokenTypes.BATTLE_PASS then
		return Engine[0xED84C33EC5F01EA]( 0x3D55227F00E2EAB )
	else
		
	end
end

XPTOKENS.OpenMobileXpTokensPanelAction = function ( f10_arg0, f10_arg1, f10_arg2 )
	if MobileFlyInPopupUtils.GetCurrentFlyInPopup() == MobileFlyInPopupUtils.PopupsEnum.XPTOKENS_PANEL then
		LUI.FlowManager.closeFlyInPopup( true )
		return 
	end
	local f10_local0 = MobileFlyInPopupUtils.Popups[MobileFlyInPopupUtils.PopupsEnum.XPTOKENS_PANEL]
	if not f10_arg2 then
		f10_arg2 = {}
	end
	f10_arg2.MobileFlyInRight = true
	MobileFlyInPopupUtils.MobileOpenFlyInPopup( f10_arg0, f10_arg1, f10_local0, f10_local0, f10_arg2 )
	MobileFlyInPopupUtils.SetCurrentFlyInPopup( MobileFlyInPopupUtils.PopupsEnum.XPTOKENS_PANEL )
end

XPTOKENS.MobileOpenBattlePassMenu = function ( f9_arg0, f9_arg1, f9_arg2 )
	LUI.FlowManager.closeFlyInPopup( true )
	ACTIONS.PopMenuStackUpToMenu( "MainMenuMobile", false )
	LUI.FlowManager.RequestAddMenu( "MobileBattlepassMenu", true, f9_arg1 )
end

XPTOKENS.MobileInitXPTokensHeaderDatasources = function ()
	if DataSources.frontEnd.mobile.header.xpToken == nil then
		DataSources.frontEnd.mobile.header.xpToken = {}
	end
	local f8_local0 = "frontEnd.mobile.header.xpToken"
	DataSources.frontEnd.mobile.header.xpToken.xpCurrentIcon = LUI.DataSourceInControllerModel.new( f8_local0 .. ".xpCurrentIcon", 0xA86CABE20306DA1 )
	DataSources.frontEnd.mobile.header.xpToken.xpCurrentTimer = LUI.DataSourceInControllerModel.new( f8_local0 .. ".xpCurrentTimer" )
	DataSources.frontEnd.mobile.header.xpToken.xpShowTimer = LUI.DataSourceInControllerModel.new( f8_local0 .. ".xpShowTimer" )
end

XPTOKENS.IsMobileXPTokensMenuEnabled = function ()
	return CONDITIONS.IsDvarBoolEnabled( 0xBBDBAE93FF854FA )
end

XPTOKENS.IsPartyRankXPEventEnabled = function ()
	return Dvar[0x22EAAB59AA27E9B]( 0x562364E09176965 ) == 2
end

XPTOKENS.IsPartyWeaponXPEventEnabled = function ()
	return Dvar[0x22EAAB59AA27E9B]( 0x562364E09176965 ) == 2
end

XPTOKENS.IsPartyXPEventEnabled = function ()
	local f4_local0 = XPTOKENS.IsPartyRankXPEventEnabled()
	if not f4_local0 then
		f4_local0 = XPTOKENS.IsPartyWeaponXPEventEnabled()
	end
	return f4_local0
end

XPTOKENS.IsPartyRankXPEventBoostActive = function ()
	local f3_local0 = XPTOKENS.IsPartyRankXPEventEnabled()
	if f3_local0 then
		f3_local0 = 1 < DataSources.alwaysLoaded.activeParty.memberCount:GetValue()
	end
	return f3_local0
end

XPTOKENS.IsPartyWeaponXPEventBoostActive = function ()
	local f2_local0 = XPTOKENS.IsPartyWeaponXPEventEnabled()
	if f2_local0 then
		f2_local0 = 1 < DataSources.alwaysLoaded.activeParty.memberCount:GetValue()
	end
	return f2_local0
end

XPTOKENS.IsPartyXPEventBoostActive = function ()
	local f1_local0 = XPTOKENS.IsPartyRankXPEventBoostActive()
	if not f1_local0 then
		f1_local0 = XPTOKENS.IsPartyWeaponXPEventBoostActive()
	end
	return f1_local0
end

