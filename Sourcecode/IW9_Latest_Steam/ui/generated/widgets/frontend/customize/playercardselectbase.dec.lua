-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:48
module( ..., package.seeall )
local f0_local0 = LUI.DataSourceInControllerModel.new( PlayercardUtils.PlayerCardModelPath .. ".backgroundIndex" )
local f0_local1 = LUI.DataSourceInControllerModel.new( "frontEnd.MP.Showcase.callingCardEditor" .. ".background" )
local f0_local2 = function ( f27_arg0, f27_arg1 )
	local f27_local0 = PlayercardUtils.GetDataSources( f27_arg1 )
	if CONDITIONS.IsMobileOrMobileSim() then
		local f27_local1 = CallingCardUtils.GetCardByIndex( f27_arg0._equippedPlayerCardIndex )
		f27_local1.isUnlocked = true
		f27_arg0.CallingCardMain:RefreshButton( f27_arg0, f27_local1, true, f27_arg0._favoritePlayerCards[f27_local1.image] )
		f27_arg0.CallingCardMain.SwapAction = function ( f30_arg0, f30_arg1 )
			f30_arg0._menu:EquipPlayerCard( f30_arg1 )
		end
		
		f27_arg0.CallingCardShowcases:SetNumChildren( SOCIAL.MAX_NUM_SHOWCASE_CARDS )
		f27_arg0.CallingCardShowcases:SetRefreshChild( function ( f28_arg0, f28_arg1, f28_arg2 )
			local f28_local0 = f27_arg0.CallingCardShowcases:GetContentIndex( f28_arg1, f28_arg2 )
			if f28_local0 < SOCIAL.MAX_NUM_SHOWCASE_CARDS then
				local f28_local1 = Social[0x3F036D81D04EA45]( f27_arg0 )
				local f28_local2 = CallingCardUtils.GetCardByIndex( f28_local1[f28_local0 + 1] )
				f28_local2.isUnlocked = true
				f28_arg0:RefreshButton( f27_arg0, f28_local2, true, f27_arg0._favoritePlayerCards[f28_local2.image] )
				f28_arg0.SwapAction = function ( f29_arg0, f29_arg1 )
					f29_arg0._menu._showcaseIndex = f28_arg0
					f29_arg0._menu:EquipPlayerCard( f29_arg1 )
					f29_arg0._menu._showcaseIndex = nil
				end
				
			end
		end )
	else
		f27_arg0.SmallPlayerCard:SetDataSource( f27_local0, f27_arg1 )
		if f27_arg0._showcaseIndex then
			local f27_local1 = CallingCardUtils.GetCardByIndex( f27_arg0._equippedPlayerCardIndex )
			f27_arg0.SmallPlayerCard:OverrideBackground( f27_local1.image )
		end
	end
end

local f0_local3 = function ( f26_arg0 )
	local f26_local0 = f26_arg0.PlayerCardGrid:GetCurrentActiveIndex()
	if not CONDITIONS.IsMobileOrMobileSim() or f26_local0 == -1 then
		f26_local0 = f26_arg0.PlayerCardGrid:GetFocusPositionIndex()
	end
	if f26_local0 then
		return f26_local0 + 1
	else
		
	end
end

local f0_local4 = function ( f25_arg0, f25_arg1 )
	local f25_local0
	if f25_arg0._equippedPlayerCardIndex ~= f25_arg1 then
		f25_local0 = Table.FindItemIndexInArray( f25_arg0._equippedShowcaseCardIndexes, f25_arg1 )
	else
		f25_local0 = true
	end
	return f25_local0
end

local f0_local5 = function ( f24_arg0 )
	if not LOOT.IsFavoritesEnabled( f24_arg0._controllerIndex ) then
		return 
	end
	local f24_local0 = f0_local0( f24_arg0 )
	if not f24_local0 then
		return 
	end
	local f24_local1 = f24_arg0._lootTable[f24_local0]
	if not f24_local1.isUnlocked then
		return 
	elseif f24_arg0._favoritePlayerCards[f24_local1.image] then
		LOOT.RemoveFavoriteForType( LOOT.itemTypes.PLAYERCARD, f24_local1.image )
	else
		if f24_arg0._favoritePlayerCards.count >= LOOT.maxFavorites then
			if f24_arg0.FavoriteAndSort then
				ACTIONS.AnimateSequence( f24_arg0.FavoriteAndSort.FavoritesPrompt, "Warning" )
			end
			Engine[0xC4146BA76D0F982]( SOUND_SETS.default.deny )
			return 
		end
		LOOT.AddFavoriteForType( LOOT.itemTypes.PLAYERCARD, f24_local1.image )
	end
	Engine[0xC4146BA76D0F982]( SOUND_SETS.default.selectAlt )
	local f24_local2 = ""
	local f24_local3 = ""
	if not f24_arg0._favoritePlayerCards[f24_local1.image] then
		f24_local2 = 0xE2E782ED8561FBF
		f24_local3 = "cac_equip_fill"
	else
		f24_local2 = 0xBAEC956CDA111AA
		f24_local3 = "cac_equip_ring"
	end
	f24_arg0:dispatchEventToRoot( {
		name = "send_toast_notification",
		immediate = true,
		options = {
			iconScale = 4.667263495923649E-62,
			displayTime = 1500,
			icon = f24_local3,
			iconColor = SWATCHES.genericMenu.notificationHighlight,
			header = Engine[0xED84C33EC5F01EA]( f24_local2 ),
			description = Engine[0xED84C33EC5F01EA]( f24_local1.name ),
			controllerIndex = controllerIndex
		}
	} )
	f24_arg0._favoritePlayerCards = LOOT.GetFavoritesForType( LOOT.itemTypes.PLAYERCARD )
	f24_arg0.PlayerCardGrid:RefreshContent()
	if 0 < #f24_arg0._lootTable then
		f24_arg0.NoPlayerCardsLabel:SetAlpha( 0 )
	end
	f24_arg0.PlayerCardGrid:SetFocusedPosition( f24_arg0.PlayerCardGrid:GetPositionForIndex( f24_local0 - 1 ), true )
end

local f0_local6 = function ( f23_arg0, f23_arg1 )
	local f23_local0 = CallingCardUtils.GetCardByIndex( f23_arg0._equippedPlayerCardIndex )
	local f23_local1 = f23_arg1.index
	local f23_local2 = f23_arg0._favoritePlayerCards[f23_arg1.image]
	LOOT.SendDlogLootEquipped( f23_arg0._controllerIndex, LOOT.itemTypes.PLAYERCARD, nil, nil, f23_local0.ref, f23_arg1.ref )
	if f23_arg0._showcaseIndex ~= nil and f23_arg0._showcaseIndex < SOCIAL.MAX_NUM_SHOWCASE_CARDS then
		if f23_arg0._equippedShowcaseCardIndexes[f23_arg0._showcaseIndex + 1] == f23_local1 then
			return 
		end
		Social[0x72F2E228AC7FD08]( f23_arg0._controllerIndex, f23_arg0._showcaseIndex, f23_local1 )
		local f23_local3 = f23_arg0.CallingCardShowcases:GetBuiltChildren()
		f23_local3[f23_arg0._showcaseIndex + 1]:RefreshButton( f23_arg0, f23_arg1, true, f23_local2 )
		f23_arg0._equippedShowcaseCardIndexes[f23_arg0._showcaseIndex + 1] = f23_local1
	else
		if f23_arg0._equippedPlayerCardIndex == f23_local1 then
			return 
		end
		Playercard[0x5C36BE0C34DB13F]( f23_arg0._controllerIndex, f23_local1 )
		f23_arg0.CallingCardMain:RefreshButton( f23_arg0, f23_arg1, true, f23_local2 )
		f23_arg0._equippedPlayerCardIndex = f23_local1
	end
	MenuUtils.CustomizeUpdateGrid( f23_arg0.PlayerCardGrid, #f23_arg0._lootTable, f23_arg0.NoPlayerCardsLabel )
end

local f0_local7 = function ( f21_arg0, f21_arg1, f21_arg2, f21_arg3 )
	f21_arg1:SetupContextualMenu()
	if LOOT.IsFavoritesEnabled( f21_arg0._controllerIndex ) then
		local f21_local0 = {
			id = "playerCardAddToFavorite"
		}
		local f21_local1
		if f21_arg3 then
			f21_local1 = Engine[0xED84C33EC5F01EA]( 0xABD3010A9142AB9 )
			if not f21_local1 then
			
			else
				f21_local0.actionName = f21_local1
				f21_local0.actionFunction = function ()
					f21_arg0:SetFavorite()
				end
				
				f21_arg1:AddContextualMenuAction( f21_local0 )
			end
		end
		f21_local1 = Engine[0xED84C33EC5F01EA]( 0xA483515816C5791 )
	end
end

local f0_local8 = function ( f18_arg0 )
	return function ( f19_arg0, f19_arg1, f19_arg2 )
		local f19_local0 = f18_arg0._lootTable[f19_arg1 + f19_arg2 * f18_arg0.PlayerCardGrid:GetNumColumns() + 1]
		local f19_local1 = f18_arg0._equippedPlayerCardIndex == tonumber( f19_local0.index )
		local f19_local2 = f18_arg0._favoritePlayerCards[f19_local0.image]
		f19_arg0:RefreshButton( f18_arg0, f19_local0, f19_local1, f19_local2 )
		f19_arg0.SwapAction = function ( f20_arg0, f20_arg1 )
			if f20_arg1 and f20_arg1 ~= CallingCardUtils.EmptyCardData then
				f19_arg0._lootTable[f19_arg0 + 1] = f20_arg1
			else
				table.remove( f19_arg0._lootTable, f19_arg0 + 1 )
			end
			MenuUtils.CustomizeUpdateGrid( f19_arg0.PlayerCardGrid, #f19_arg0._lootTable, f19_arg0.NoPlayerCardsLabel )
		end
		
		f18_arg0( f18_arg0, f19_arg0, f19_local0.name, f19_local2 )
	end
	
end

local f0_local9 = function ( f17_arg0 )
	return LOOT.GetItemID( CallingCardUtils.GetCardRef( f17_arg0._equippedPlayerCardIndex ) )
end

local f0_local10 = function ( f16_arg0 )
	f16_arg0.CallingCardMain:ButtonActionEvent()
end

local f0_local11 = function ( f14_arg0 )
	if f14_arg0._isComingFromFilterMenu and LUI.IsLastInputGamepad( f14_arg0._controllerIndex ) then
		local f14_local0 = function ()
			for f15_local3, f15_local4 in ipairs( f14_arg0._lootTable ) do
				if f15_local4.lootID == f14_arg0._currentSelectedLootID then
					return f15_local3 - 1
				end
			end
			return 0
		end
		
		f14_arg0.PlayerCardGrid:SetFocusedPosition( f14_arg0.PlayerCardGrid:GetPositionForIndex( f14_local0() ), true, nil, nil, nil )
		f14_arg0._isComingFromFilterMenu = false
		return true
	else
		
	end
end

local f0_local12 = function ( f12_arg0, f12_arg1 )
	local f12_local0 = {
		{
			name = Engine[0xED84C33EC5F01EA]( 0x62F120E633C627B )
		},
		{
			name = Engine[0xED84C33EC5F01EA]( 0x2D64D32C17EFF62 )
		}
	}
	if 0 < #f12_local0 then
		local f12_local1 = {}
		for f12_local5, f12_local6 in ipairs( f12_local0 ) do
			table.insert( f12_local1, {
				disabled = false,
				name = f12_local6.name,
				tabHeight = _1080p * 52,
				focusFunction = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
					assert( f13_arg2 + 1 > #CallingCardUtils.Categories )
					f12_arg0._allPlayerCardsTable = CallingCardUtils.GetAllPlayerCards()
					MenuUtils.CustomizeFilterTable( f12_arg0, f13_arg1, f12_arg0._lootType )
					MenuUtils.CustomizeUpdateGrid( f12_arg0.PlayerCardGrid, #f12_arg0._lootTable, f12_arg0.NoPlayerCardsLabel )
				end
			} )
		end
		f12_arg0.Tabs:SetTabs( f12_local1 )
		f12_arg0.Tabs:SetAlignment( LUI.Alignment.Left )
	end
end

local f0_local13 = function ( f9_arg0, f9_arg1 )
	if not LOOT.IsSortFilterEnabled() then
		
	else
		
	end
	if f9_arg0.HelperBar then
		f9_arg0.HelperBar:AddButtonHelperTextToElement( f9_arg0, {
			kbm_only = true,
			priority = 4,
			side = "left",
			button_ref = "button_alt1",
			helper_text = Engine[0xED84C33EC5F01EA]( 0x59D7A2BADD1083E )
		} )
	end
	f9_arg0:AddGamepadEventCallback( "button_alt1", function ( f10_arg0, f10_arg1 )
		local f10_local0 = f10_arg1.controller or f9_arg0
		if LUI.IsLastInputGamepad( f10_local0 ) then
			f10_arg0._currentSelectedLootID = f10_arg0._lootTable[f9_arg0( f10_arg0 )].lootID
		end
		local f10_local1 = MenuBuilder.BuildRegisteredType( "CustomizeSortingPopup", {
			controllerIndex = f10_local0,
			menu = f10_arg0,
			type = LOOT.itemTypes.PLAYERCARD
		} )
		LUI.FlowManager.RequestPopupMenu( nil, "FlyInPopup", true, f10_local0, false, {
			flyInLeftNarrow = true,
			widget = f10_local1
		} )
		f10_local1:addEventHandler( "menu_close", function ( f11_arg0, f11_arg1 )
			f10_arg0._isComingFromFilterMenu = true
			MenuUtils.CustomizeFilterTable( f10_arg0, f10_arg0, f10_arg0._lootType )
			MenuUtils.CustomizeUpdateGrid( f10_arg0.PlayerCardGrid, #f10_arg0._lootTable, f10_arg0.NoPlayerCardsLabel )
		end )
	end )
end

local f0_local14 = function ( f5_arg0, f5_arg1, f5_arg2 )
	assert( f5_arg0.MenuTitle )
	assert( f5_arg0.PlayerCardGrid )
	ACTIONS.AnimateSequence( f5_arg0, "InitializeDetails" )
	local f5_local0 = CONDITIONS.IsMobileOrMobileSim()
	if not f5_local0 and f5_arg0.EquippedWidget then
		f5_arg0.EquippedWidget:InitializeText( Engine[0xED84C33EC5F01EA]( 0x3FDB70668AFDB5E ) )
	end
	f5_arg0.SetFavorite = f0_local0
	f5_arg0.EquipPlayerCard = f0_local0
	f5_arg0.FocusFunction = f0_local0
	f5_arg0.GetCurrentGridIndex = f0_local0
	f5_arg0.AddFilterPrompt = f0_local0
	f5_arg0.IsEquippedCard = f0_local0
	f5_arg0._controllerIndex = f5_arg1
	f5_arg0._lootType = LOOT.itemTypes.PLAYERCARD
	f5_arg0._lootTable = {}
	f5_arg0._allLootTable = CallingCardUtils.GetAllPlayerCards()
	f5_arg0._favoritePlayerCards = LOOT.GetFavoritesForType( LOOT.itemTypes.PLAYERCARD )
	if f5_arg2 and f5_arg2.showcaseIndex then
		f5_arg0._showcaseIndex = f5_arg2.showcaseIndex
		f5_arg0._equippedPlayerCardIndex = f5_arg2.equipped
		if f5_arg0.SmallPlayerCard then
			f5_arg0.SmallPlayerCard:HideRank()
			ACTIONS.AnimateSequence( f5_arg0.SmallPlayerCard, "HideEmblem" )
		end
	else
		if CONDITIONS.IsMobileOrMobileSim() then
			f5_arg0._equippedShowcaseCardIndexes = Social[0x3F036D81D04EA45]( f5_arg1 )
		end
		f5_arg0._equippedPlayerCardIndex = f0_local0:GetValue( f5_arg1 )
		Playercard[0x2BB8FABC0D5D042]( f5_arg1 )
	end
	f5_arg0._isComingFromFilterMenu = false
	f0_local0( f5_arg0, f5_arg1 )
	if not f5_local0 then
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x40B1DD44D0F9FC0 ) and CallingCardUtils.AreAllVictoryChallengesUnlocked( f5_arg1 ) then
			f0_local0( f5_arg0, f5_arg1 )
		else
			f5_arg0.Tabs:closeTree()
			f5_arg0.Tabs = nil
		end
	end
	if CONDITIONS.IsMobileOrMobileSim() then
		LOOT.SetupMobileSortingBehavior( f5_arg0, f5_arg1, LOOT.itemTypes.PLAYERCARD )
	else
		LOOT.SetupSortingBehavior( f5_arg0, f5_arg1, LOOT.itemTypes.PLAYERCARD )
	end
	MenuUtils.CustomizeFilterTable( f5_arg0, f5_arg1, f5_arg0._lootType )
	f5_arg0.PlayerCardGrid:SetRefreshChild( f0_local0( f5_arg0 ) )
	MenuUtils.CustomizeUpdateGrid( f5_arg0.PlayerCardGrid, #f5_arg0._lootTable, f5_arg0.NoPlayerCardsLabel )
	f5_arg0:FocusFunction()
	if not CONDITIONS.IsMobileOrMobileSim() then
		FrontEndScene.HideAllCharacters()
		Engine[0x685AE31DEDA30A4]( "social" )
	end
	local f5_local1 = Engine[0x3B8CFB6758EF57C]()
	local f5_local2 = f0_local0( f5_arg0 )
	f5_arg0:addEventHandler( "menu_close", function ( f8_arg0, f8_arg1 )
		if f5_arg0._showcaseIndex then
			Social[0x6B83DE97344CD52]( f5_arg0 )
		else
			f5_arg0:SetValue( f5_arg0, f5_arg0._equippedPlayerCardIndex )
			Playercard[0xE7F7308D27872C9]( f5_arg0 )
			METRICS.IdentityUsageSendDLogEvent( f5_arg0, f5_arg0, f5_arg0, LOOT.itemTypes.PLAYERCARD, f5_arg0, f5_arg0( f5_arg0 ) )
		end
	end )
	if LOOT.IsFavoritesEnabled( f5_arg1 ) then
		f5_arg0:AddGamepadEventCallback( "button_right_trigger", function ( f7_arg0, f7_arg1 )
			f7_arg0:SetFavorite()
		end )
	end
	f5_arg0:AddFilterPrompt( f5_arg1 )
	f5_arg0:addAndCallEventHandler( "onVideoChange", function ()
		if f5_arg0.TabBacker then
			if CoD.CurrentAspectRatioCompare( LUI.AspectRatio.standard ) == LUI.COMPARE.higher then
				f5_arg0.TabBacker:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * -192, _1080p * 192, 0, _1080p * 160 )
			else
				f5_arg0.TabBacker:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 0, _1080p * 160 )
			end
		end
	end )
	if f5_arg0.Darken then
		ACTIONS.ScaleFullscreen( f5_arg0.Darken )
	end
	if not f5_local0 then
		if not IsLanguageArabic() and f5_arg0.NewItemPreviewNotification then
			f5_arg0.NewItemPreviewNotification:SetupLeftAlignment()
		end
		f5_arg0.MenuTitle:SetupBackButton( f5_arg1 )
	end
	if CONDITIONS.IsPC() and not CONDITIONS.IsMobileOrMobileSim() then
		ACTIONS.ScaleFullscreen( f5_arg0 )
	end
end

local f0_local15 = function ( f4_arg0, f4_arg1, f4_arg2 )
	f4_arg0.PostLoadShared = f0_local0
end

function PlayerCardSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "PlayerCardSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self.addButtonHelperFunction = function ( f3_arg0, f3_arg1 )
		f3_arg0:AddButtonHelperText( {
			side = "left",
			button_ref = "button_primary",
			priority = 1,
			helper_text = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 )
		} )
	end
	
	self:addEventHandler( "menu_create", self.addButtonHelperFunction )
	self:AddGamepadEventCallback( "button_secondary", function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or menu
		ACTIONS.LeaveMenu( menu )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "PlayerCardSelectBase", PlayerCardSelectBase )
LockTable( _M )
