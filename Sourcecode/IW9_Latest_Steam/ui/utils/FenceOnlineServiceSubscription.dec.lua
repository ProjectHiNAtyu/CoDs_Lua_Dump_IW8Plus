-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:48
module( ..., package.seeall )
FenceOnlineServiceSubscription = LUI.Class( LUI.Fence )
FenceOnlineServiceSubscription.UPSELL_STATE = {
	done = 3,
	selling = 2,
	inactive = 1
}
FenceOnlineServiceSubscription.init = function ( f22_arg0 )
	LUI.Fence.init( f22_arg0 )
	f22_arg0._perController = {}
	for f22_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		f22_arg0._perController[f22_local0] = {
			onlineUpsell = FenceOnlineServiceSubscription.UPSELL_STATE.inactive
		}
	end
	f22_arg0._isShowingBlockingPopup = false
end

FenceOnlineServiceSubscription.Start = function ( f21_arg0 )
	DebugPrint( "FenceOnlineServiceSubscription.Start" )
	if f21_arg0._isShowingBlockingPopup then
		LUI.FlowManager.RequestLeaveMenuByName( "popup_waiting_for_online_subscription_info", true )
		f21_arg0._isShowingBlockingPopup = false
	end
end

FenceOnlineServiceSubscription.Stop = function ( f20_arg0 )
	DebugPrint( "FenceOnlineServiceSubscription.Stop" )
	if f20_arg0._isShowingBlockingPopup then
		LUI.FlowManager.RequestLeaveMenuByName( "popup_waiting_for_online_subscription_info", true )
		f20_arg0._isShowingBlockingPopup = false
	end
end

FenceOnlineServiceSubscription.PostFail = function ( f19_arg0 )
	if f19_arg0._state == LUI.Fence.STATE.fail then
		LUI.FlowManager.RequestPopupMenu( nil, "PopupNoOnlineServiceSubscriptionError", false, nil, false, {
			controllerIndex = Engine[0x45B054C920178E9]()
		}, nil, false, true )
	end
end

FenceOnlineServiceSubscription.OnBackOut = function ( f18_arg0 )
	DebugPrint( "FenceOnlineServiceSubscription.OnBackOut" )
	local f18_local0 = Engine[0x45B054C920178E9]()
	Engine[0x7C75E608EA39B5C]( "xcancelinvitejoin", f18_local0 )
	if Engine[0xCBCF315DE9B8AC6]() and not Lobby[0x867E2628CAA1981]() then
		Engine[0xF8B2F41CC5CF158]( f18_local0, Enum[0x5BA77296D5B1B09][0x1F9B91EEF0E0752], "FenceOnlineServiceSubscription.OnBackOut" )
	end
	if Lobby[0x63537242F1D48FF]() and not Lobby[0x6957722EF74F5D2]() then
		Engine[0x5DEE98AA6FB3C2]( f18_local0, CoD.LeavePartyMoveUI.YES, CoD.LeavePartyShowMessage.NO, "FenceOnlineServiceSubscription.OnBackOut" )
	end
end

FenceOnlineServiceSubscription.UpdateState = function ( f17_arg0 )
	assert( f17_arg0._state ~= LUI.Fence.STATE.fail )
	f17_arg0._state = LUI.Fence.STATE.pass
	for f17_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f17_local0 ) then
			if Engine[0x810854172EF3376]( f17_local0 ) then
				if not Engine[0xDA7A89CE2B1A2CA]( f17_local0 ) then
					if f17_arg0._perController[f17_local0].onlineUpsell == FenceOnlineServiceSubscription.UPSELL_STATE.inactive then
						f17_arg0._perController[f17_local0].onlineUpsell = FenceOnlineServiceSubscription.UPSELL_STATE.selling
						f17_arg0._state = LUI.Fence.STATE.block
						Engine[0x649973B27FFBB2]( f17_local0 )
						break
					end
					local f17_local3 = f17_arg0._perController[f17_local0].onlineUpsell == FenceOnlineServiceSubscription.UPSELL_STATE.selling
					if Engine[0x8CF5A323493AFE2]( f17_local0 ) then
						f17_arg0._state = LUI.Fence.STATE.block
						if Engine[0x1D1EEFABC21D0E7]() and not f17_arg0._isShowingBlockingPopup then
							f17_arg0:OpenPopupWaitingForOnlineSubsciptionInfo()
							break
						end
					elseif f17_local3 then
						if Engine[0x1D1EEFABC21D0E7]() and f17_arg0._isShowingBlockingPopup then
							LUI.FlowManager.RequestLeaveMenuByName( "popup_waiting_for_online_subscription_info", true )
						end
						f17_arg0._perController[f17_local0].onlineUpsell = FenceOnlineServiceSubscription.UPSELL_STATE.done
						f17_arg0._state = LUI.Fence.STATE.fail
					end
				end
				if Engine[0x1D1EEFABC21D0E7]() and f17_arg0._isShowingBlockingPopup then
					LUI.FlowManager.RequestLeaveMenuByName( "popup_waiting_for_online_subscription_info", true )
				end
				f17_arg0._perController[f17_local0].onlineUpsell = FenceOnlineServiceSubscription.UPSELL_STATE.inactive
			end
			f17_arg0._state = LUI.Fence.STATE.block
			if not f17_arg0._isShowingBlockingPopup then
				f17_arg0:OpenPopupWaitingForOnlineSubsciptionInfo()
			end
		end
		f17_arg0._perController[f17_local0].onlineUpsell = FenceOnlineServiceSubscription.UPSELL_STATE.inactive
	end
end

FenceOnlineServiceSubscriptionOrTrial = LUI.Class( FenceOnlineServiceSubscription )
FenceOnlineServiceSubscriptionOrTrial.init = function ( f16_arg0 )
	FenceOnlineServiceSubscriptionOrTrial.super.init( f16_arg0 )
end

FenceOnlineServiceSubscriptionOrTrial.UpdateState = function ( f15_arg0 )
	if not Dvar[0x9E5BE3B4BBA4E0E]( 0x7E9D7B956416680 ) and Dvar[0x9E5BE3B4BBA4E0E]( 0xCBD3CB2E7570D1F ) then
		f15_arg0._state = LUI.Fence.STATE.pass
	else
		FenceOnlineServiceSubscriptionOrTrial.super.UpdateState( f15_arg0 )
	end
end

LUI.Fence.Register( "onlineServiceSubscriptionOrTrial", FenceOnlineServiceSubscriptionOrTrial )
FenceOnlineServiceSubscriptionMPMainMenu = LUI.Class( FenceOnlineServiceSubscriptionOrTrial )
FenceOnlineServiceSubscriptionMPMainMenu.UpdateState = function ( f14_arg0 )
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x70AAF80547BFC3A ) then
		FenceOnlineServiceSubscriptionMPMainMenu.super.UpdateState( f14_arg0 )
	else
		f14_arg0._state = LUI.Fence.STATE.pass
	end
end

LUI.Fence.Register( "onlineServiceSubscriptionMPMainMenu", FenceOnlineServiceSubscriptionMPMainMenu )
FenceOnlineServiceSubscriptionByPlaylist = LUI.Class( FenceOnlineServiceSubscription )
FenceOnlineServiceSubscriptionByPlaylist.init = function ( f13_arg0, f13_arg1 )
	FenceOnlineServiceSubscriptionByPlaylist.super.init( f13_arg0 )
	f13_arg0._GetCurrentPlaylist = f13_arg1
end

FenceOnlineServiceSubscriptionByPlaylist.UpdateState = function ( f12_arg0 )
	local f12_local0, f12_local1 = f12_arg0._GetCurrentPlaylist()
	if not Dvar[0x9E5BE3B4BBA4E0E]( 0x7E9D7B956416680 ) and PlaylistUtils.IsPlaylistF2P( Engine[0x45B054C920178E9](), f12_local0, f12_local1 ) then
		f12_arg0._state = LUI.Fence.STATE.pass
	else
		FenceOnlineServiceSubscriptionByPlaylist.super.UpdateState( f12_arg0 )
	end
end

local f0_local0 = function ()
	local f11_local0 = Playlist[0x7B3B2B73B53EB34]()
	local f11_local1 = Playlist[0xD78924AD23DE66B]()
	if Playlist[0x29DC19B8CA68312]( f11_local1 ) then
		f11_local0 = PlaylistUtils.USE_FILTERED_PLAYLIST_ID
	end
	return f11_local0, f11_local1
end

FenceOnlineServiceSubscriptionCPPlaylist = LUI.Class( FenceOnlineServiceSubscriptionByPlaylist )
FenceOnlineServiceSubscriptionCPPlaylist.init = function ( f10_arg0 )
	FenceOnlineServiceSubscriptionCPPlaylist.super.init( f10_arg0, f0_local0 )
end

LUI.Fence.Register( "onlineServiceSubscriptionCPPlaylist", FenceOnlineServiceSubscriptionCPPlaylist )
local f0_local1 = function ()
	if Engine[0x8FF0F1C5B20321E]() or Lobby[0xF1D2956B0C99DF6]() then
		local f9_local0 = Playlist[0x7B3B2B73B53EB34]()
		local f9_local1 = Playlist[0xD78924AD23DE66B]()
		if Playlist[0x29DC19B8CA68312]( f9_local1 ) then
			f9_local0 = PlaylistUtils.USE_FILTERED_PLAYLIST_ID
		end
		return f9_local0, f9_local1
	else
		return Lobby[0xB92DA1948EDB47D]( Lobby.PartyUIData.PLAYLIST_ID ), Lobby[0xB92DA1948EDB47D]( Lobby.PartyUIData.PLAYLIST_CATEGORY )
	end
end

FenceOnlineServiceSubscriptionMPPlaylist = LUI.Class( FenceOnlineServiceSubscriptionByPlaylist )
FenceOnlineServiceSubscriptionMPPlaylist.init = function ( f8_arg0 )
	FenceOnlineServiceSubscriptionMPPlaylist.super.init( f8_arg0, f0_local0 )
end

LUI.Fence.Register( "onlineServiceSubscriptionMPPlaylist", FenceOnlineServiceSubscriptionMPPlaylist )
function GetErrorMessageButtons( f4_arg0 )
	local f4_local0 = {
		label = Engine[0xED84C33EC5F01EA]( 0x5C33DA8F6CE65B0 ),
		action = function ( f7_arg0, f7_arg1 )
			LUI.FlowManager.RequestLeaveMenu( f7_arg0:GetCurrentMenu(), true )
		end
	}
	local f4_local1 = {
		label = CONDITIONS.IsCortezSubExe() and Engine[0xED84C33EC5F01EA]( 0x591BF0CC8C6FD71 ) or Engine[0xED84C33EC5F01EA]( 0x856E860DB34882C ),
		action = function ( f6_arg0, f6_arg1 )
			Dvar[0x8EA06EEDB58D872]( 0xD360034020A5D7A, false )
			if CONDITIONS.IsPS4() then
				Dvar[0x8EA06EEDB58D872]( 0xE76C11BF490DA8F, true )
			end
			Engine[0x4B0C2D659AE39D3]( "Going Offline", f4_arg0 )
			Engine[0x5DEE98AA6FB3C2]( f4_arg0, CoD.LeavePartyMoveUI.YES, CoD.LeavePartyShowMessage.NO, "FenceOnlineServiceSubscription goOfflineButton" )
			LUI.FlowManager.RequestLeaveMenu( f6_arg0:GetCurrentMenu(), true )
			if not CONDITIONS.IsCortezSubExe() then
				LUI.FlowManager.RequestAddMenu( "MainMenuOffline", false, f4_arg0 )
			else
				PLAY_MENU.ForcePlayerBackToCODHQExecutableOffline( f4_arg0 )
			end
		end
	}
	local f4_local2 = {
		label = Engine[0xED84C33EC5F01EA]( 0x4E76830223A336F ),
		action = function ( f5_arg0, f5_arg1 )
			LUI.FlowManager.RequestPopupMenu( self, "quit_popmenu", false, f5_arg1.controller )
		end
	}
	local f4_local3 = CONDITIONS
	if f4_local3.IsMobileOrMobileSim() then
		return {
			f4_local2
		}
	elseif f4_local3.ForceOnlineMenus() or f4_local3.IsPC() or f4_local3.IsPCMSStore() then
		return {
			f4_local0
		}
	elseif not f4_local3.CanAccessOfflineMenu( f4_arg0 ) and not f4_local3.IsPC() then
		return {
			f4_local1
		}
	elseif f4_local3.CanAccessOfflineMenu( f4_arg0 ) and f4_local3.IsPC() then
		return {
			f4_local1,
			f4_local2
		}
	else
		return {
			f4_local0,
			f4_local1
		}
	end
end

function PopupNoOnlineServiceSubscriptionError( f3_arg0, f3_arg1 )
	assert( f3_arg1 )
	local f3_local0 = nil
	if Engine[0x1DCFAFA7CE6F8D0]() or Engine[0x1DCFBFA7CE6FA83]() then
		f3_local0 = "PLATFORM/PSPLUS_REQUIRED"
	else
		f3_local0 = 0x931C6EAC9FC0F20
	end
	assert( f3_local0 )
	local f3_local1 = {
		controllerIndex = f3_arg1.controllerIndex,
		title = Engine[0xED84C33EC5F01EA]( 0xC5EDD4448BD0942 ),
		message = Engine[0xED84C33EC5F01EA]( f3_local0 )
	}
	local f3_local2 = not Engine[0xCA404C71196D651]( f3_arg1.controllerIndex )
	if f3_local2 then
		f3_local1.message = Engine[0xED84C33EC5F01EA]( 0xDCA55EDC9CE2B6C, Engine[0x7D3158A9539A355]( Engine[0x29680E4E30C45C2]( f3_arg1.controllerIndex ) ), f3_local1.message )
	end
	if f3_local2 then
		f3_local1.buttons = BOOT.GetOkayPopupButtons()
	else
		f3_local1.buttons = GetErrorMessageButtons( f3_arg1.controllerIndex )
	end
	local f3_local3 = nil
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_local3 = MenuBuilder.BuildRegisteredType( "PopupOK", f3_local1 )
	else
		f3_local3 = MenuBuilder.BuildRegisteredType( "PopupMessageAndButtons", f3_local1 )
	end
	f3_local3.id = "PopupNoOnlineServiceSubscriptionError"
	return f3_local3
end

FenceOnlineServiceSubscription.OpenPopupWaitingForOnlineSubsciptionInfo = function ( f2_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "popup_waiting_for_online_subscription_info", false, nil, false, args, nil, true, true )
	f2_arg0._isShowingBlockingPopup = true
end

function OpenPopupWaitingForOnlineSubsciptionInfo( f1_arg0, f1_arg1 )
	local f1_local0 = MenuBuilder.BuildRegisteredType( "live_dialog_text_box", {
		message = Engine[0xED84C33EC5F01EA]( 0x8A37636737C9610 )
	} )
	f1_local0.id = "popup_waiting_for_online_subscription_info"
	return f1_local0
end

MenuBuilder.registerType( "popup_waiting_for_online_subscription_info", OpenPopupWaitingForOnlineSubsciptionInfo )
MenuBuilder.registerType( "PopupNoOnlineServiceSubscriptionError", PopupNoOnlineServiceSubscriptionError )
LUI.Fence.Register( "onlineServiceSubscription", FenceOnlineServiceSubscription )
LockTable( _M )
