-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
FenceStore = LUI.Class( LUI.Fence )
FenceStore.init = function ( f6_arg0, f6_arg1, f6_arg2 )
	f6_arg0.super:init( f6_arg1, f6_arg2 )
	f6_arg0._controllerIndex = f6_arg2
	assert( f6_arg0._controllerIndex )
end

FenceStore.Start = function ( f5_arg0 )
	DebugPrint( "FenceStore.Start" )
	InGameStore.FetchCatalog( f5_arg0._controllerIndex, true, true )
end

FenceStore.Stop = function ( f4_arg0 )
	DebugPrint( "FenceStore.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "StoreInProgressPopup", true )
	f4_arg0._openedPopup = false
end

FenceStore.UpdateState = function ( f3_arg0 )
	assert( f3_arg0._state ~= LUI.Fence.STATE.fail )
	if f3_arg0._state == LUI.Fence.STATE.pass then
		return 
	end
	local f3_local0 = InGameStore.GetCatalogStatus( f3_arg0._controllerIndex )
	if f3_local0 == InGameStoreCatalogStatus.FETCHING then
		f3_arg0._state = LUI.Fence.STATE.block
		Engine[0x74CAD26749A8415]()
	elseif f3_local0 == InGameStoreCatalogStatus.READY then
		f3_arg0._state = LUI.Fence.STATE.pass
	else
		f3_arg0._state = LUI.Fence.STATE.fail
	end
	if f3_arg0._state == LUI.Fence.STATE.block and not f3_arg0._openedPopup then
		f3_arg0:ShowInProgressPopup()
	end
end

FenceStore.PostFail = function ( f2_arg0 )
	if f2_arg0._state == LUI.Fence.STATE.fail then
		local f2_local0 = Engine[0x836C8AD984F14F6]()
		if f2_local0 then
			f2_local0 = Commerce[0x38D9AC0641AEF71]()
		end
		if not f2_local0 then
			local f2_local1 = {}
			if Engine[0x5575DCFF312365A]() then
				local f2_local2 = Engine[0xF47248634BEA927]()
				if f2_local2 ~= nil then
					f2_local1.message = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE_ERROR", Engine[0x7D3158A9539A355]( f2_local2 ) )
					Engine[0x2B86472F39BE88]()
				else
					f2_local1.message = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE_PC" )
				end
			else
				f2_local1.message = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE", Engine[0x7D3158A9539A355]( Engine[0xDF84D082D73AFF6]() ) )
			end
			LUI.FlowManager.RequestPopupMenu( nil, "ErrorNoticePopup", false, f2_arg0._controllerIndex, false, f2_local1, nil, false, true )
		end
	end
	Engine[0x74CAD26749A8415]()
end

FenceStore.ShowInProgressPopup = function ( f1_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "StoreInProgressPopup", false, nil, false, {
		message = Engine[0xED84C33EC5F01EA]( "STORE/FETCHING_STORE_INFO" )
	}, nil, true, true )
	f1_arg0._openedPopup = true
end

LUI.Fence.Register( "store", FenceStore )
LockTable( _M )
