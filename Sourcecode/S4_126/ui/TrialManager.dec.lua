-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
LUI.TrialManager = LUI.Class( LUI.UIElement )
LUI.TrialManager.MenusBlockedInTrial = {
	nil,
	"CampaignMenu",
	"CampaignMenuOffline",
	"CPMainMenu",
	"CPSystemLinkMenu"
}
LUI.TrialManager.NotifiedTimesInSeconds = {
	nil,
	86400,
	43200,
	21600,
	-5584,
	3600,
	1800,
	300
}
local f0_local0 = 305
local f0_local1 = function ( f18_arg0, f18_arg1, f18_arg2 )
	local f18_local0 = TIME.FormatSeconds( f18_arg2, TIME.Format.READABLE, {
		hour = true,
		second = true,
		minute = true
	} )
	f18_arg0:dispatchEventToRoot( {
		name = "send_toast_notification",
		immediate = true,
		options = {
			displayTime = 5000,
			icon = "logo_mw",
			header = Engine[0xED84C33EC5F01EA]( "TRIAL/MP_TRIAL_VERSION" ),
			description = Engine[0xED84C33EC5F01EA]( "TRIAL/TRIAL_ENDS_IN", f18_local0 ),
			controllerIndex = f18_arg1
		}
	} )
	Social[0x19E9D844AE456F]( f18_arg1, Engine[0xED84C33EC5F01EA]( "TRIAL/TRIAL_ENDS_IN", f18_local0 ) )
end

local f0_local2 = function ( f17_arg0, f17_arg1 )
	f17_arg0:dispatchEventToRoot( {
		name = "send_toast_notification",
		immediate = true,
		options = {
			displayTime = -6384,
			icon = "logo_mw",
			header = Engine[0xED84C33EC5F01EA]( "TRIAL/TRIAL_ENDED" ),
			description = Engine[0xED84C33EC5F01EA]( "TRIAL/LAST_GAME" ),
			controllerIndex = f17_arg1
		}
	} )
	Social[0x19E9D844AE456F]( f17_arg1, Engine[0xED84C33EC5F01EA]( "TRIAL/LAST_GAME" ) )
end

local f0_local3 = function ( f14_arg0, f14_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "MessagePopup", true, f14_arg1, false, {
		headerText = Engine[0xED84C33EC5F01EA]( "TRIAL/TRIAL_ENDED" ),
		messageText = Engine[0xED84C33EC5F01EA]( "TRIAL/TO_PLAY_FURTHER_PLEASE_PURCHASE" ),
		noBackButton = true,
		buttons = {
			{
				label = Engine[0xED84C33EC5F01EA]( "TRIAL/PURCHASE_FULL_GAME" ),
				action = function ( f16_arg0 )
					LUI.FlowManager.RequestAddMenu( "MPBattlenetStoreMenu" )
				end
			},
			{
				label = Engine[0xED84C33EC5F01EA]( "LUA_MENU/QUIT_DESKTOP" ),
				action = function ()
					Engine[0xDEE6107B26F8BB6]()
				end
			}
		}
	} )
end

local f0_local4 = function ( f11_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "MessagePopup", true, f11_arg0, false, {
		headerText = Engine[0xED84C33EC5F01EA]( "TRIAL/NOT_AVAILABLE_IN_TRIAL" ),
		messageText = Engine[0xED84C33EC5F01EA]( "TRIAL/MENU_BLOCKED" ),
		buttons = {
			{
				label = Engine[0xED84C33EC5F01EA]( "TRIAL/PURCHASE_FULL_GAME" ),
				action = function ( f13_arg0 )
					LUI.FlowManager.RequestAddMenu( "MPBattlenetStoreMenu" )
				end
			},
			{
				label = Engine[0xED84C33EC5F01EA]( "MENU/BACK" ),
				action = function ()
					
				end
			}
		}
	} )
end

LUI.TrialManager.InitTrialMode = function ()
	LUI.TrialManager.InTrialMode = false
	LUI.TrialManager.TrialEndTime = Engine[0xF16311E3FCA3DCF]() + f0_local0
end

LUI.TrialManager.GetTrialRemainingTime = function ( f9_arg0 )
	return f9_arg0.TrialEndTime - Engine[0xF16311E3FCA3DCF]()
end

LUI.TrialManager.TrialHasEnded = function ( f8_arg0 )
	if f8_arg0.InTrialMode then
		return f8_arg0:GetTrialRemainingTime() <= 0
	else
		return false
	end
end

LUI.TrialManager.HandleTrialHasEnded = function ( f7_arg0, f7_arg1 )
	if f7_arg0.InTrialMode and f7_arg0:TrialHasEnded() then
		if Engine[0x12586A3F4FB490E]() then
			f0_local0( f7_arg0, f7_arg1 )
		else
			f0_local0( f7_arg0, f7_arg1 )
		end
		return true
	else
		return false
	end
end

LUI.TrialManager.HandleMenuBlocked = function ( f6_arg0, f6_arg1, f6_arg2 )
	if f6_arg0.InTrialMode then
		local f6_local0 = nil
		local f6_local1 = type( f6_arg1 )
		if f6_local1 == "number" and LUI.FlowManager.FlowMenus[f6_arg1] then
			f6_local0 = LUI.FlowManager.FlowMenus[f6_arg1]
		elseif f6_local1 == "string" then
			f6_local0 = f6_arg1
		else
			return false
		end
		for f6_local5, f6_local6 in ipairs( LUI.TrialManager.MenusBlockedInTrial ) do
			if f6_local6 == f6_local0 then
				f0_local0( f6_arg2 )
				return true
			end
		end
	end
	return false
end

LUI.TrialManager.InitLayer = function ( f4_arg0 )
	f4_arg0._controllerIndex = Engine[0x45B054C920178E9]()
	if f4_arg0.InTrialMode then
		f4_arg0.trialTimer = LUI.UITimer.new( {
			interval = 1000,
			event = "trial_tick"
		} )
		f4_arg0:addElement( f4_arg0.trialTimer )
		f4_arg0:registerEventHandler( "trial_tick", function ( element, event )
			if element:HandleTrialHasEnded( element._controllerIndex ) and element.trialTimer then
				element.trialTimer:closeTree()
				element.trialTimer = nil
			end
			for f5_local3, f5_local4 in ipairs( element.NotifiedTimesInSeconds ) do
				if element:GetTrialRemainingTime() == f5_local4 then
					f4_arg0( element, element._controllerIndex, f5_local4 )
				end
			end
		end )
	end
end

LUI.TrialManager.ShouldBeVisible = function ( f3_arg0 )
	return LUI.TrialManager.InTrialMode
end

LUI.TrialManager.ClearLayer = function ( f2_arg0, f2_arg1 )
	f2_arg0:closeChildren()
end

LUI.TrialManager.GetLayer = function ()
	local f1_local0 = Engine[0xEE6F69FEA944B13]()
	return f1_local0.trialManager
end

