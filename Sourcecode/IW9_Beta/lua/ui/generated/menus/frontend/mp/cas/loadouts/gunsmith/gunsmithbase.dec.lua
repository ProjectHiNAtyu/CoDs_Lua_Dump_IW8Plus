-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:01
module( ..., package.seeall )
local f0_local0 = "GLGunsmithButton"
local f0_local1 = {
	{
		down = 6,
		up = 2,
		left = 1,
		right = 6
	},
	{
		down = 6,
		up = 2,
		left = 1,
		right = 3
	},
	{
		down = 7,
		up = 3,
		left = 2,
		right = 4
	},
	{
		down = 8,
		up = 4,
		left = 3,
		right = 5
	},
	{
		down = 10,
		up = 4,
		left = 4,
		right = 5
	},
	{
		down = 7,
		up = 2,
		left = 1,
		right = 7
	},
	{
		down = 8,
		up = 3,
		left = 6,
		right = 8
	},
	{
		down = 8,
		up = 4,
		left = 7,
		right = 9
	},
	{
		down = 9,
		up = 10,
		left = 8,
		right = 10
	},
	{
		down = 9,
		up = 5,
		left = 9,
		right = 10
	}
}
local f0_local2 = 1
local f0_local3 = 5
local f0_local4 = 6
local f0_local5 = 10
local f0_local6 = function ( f40_arg0, f40_arg1 )
	f40_arg0.Tabs = LUI.TabManager.new( {
		spacing = 4,
		wrap = true,
		tabHeight = _1080p * 52,
		buildTab = function ()
			return MenuBuilder.BuildRegisteredType( "SubMenuTab", {
				controllerIndex = f40_arg0.controllerIndex
			} )
		end,
		controllerIndex = f40_arg1.controllerIndex
	} )
	f40_arg0.Tabs.id = "Tabs"
	f40_arg0.Tabs:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 90, _1080p * 993, _1080p * 108, _1080p * 160 )
	f40_arg0:addElement( f40_arg0.Tabs )
	local f40_local0 = LUI.FlowManager.GetScopedData( f40_arg0 )
	local f40_local1 = {}
	if not GUNSMITH.IsDisabled( f40_arg0._weaponTable.weapon ) then
		f40_local1[#f40_local1 + 1] = {
			menuName = "GunsmithAttachments",
			name = ToUpperCase( Engine[0xED84C33EC5F01EA]( 0xE16A742EB9B4477 ) )
		}
	end
	if not GUNSMITH.IsCustomizationDisabled( f40_arg0._weaponTable.weapon ) and Engine[0xBE5345D3926D620]() and Engine[0x5EA7EB683287036]( f40_arg0._controllerIndex ) then
		f40_local1[#f40_local1 + 1] = {
			name = ToUpperCase( Engine[0xED84C33EC5F01EA]( 0xAFB88FBDAA55912 ) ),
			menuName = GUNSMITH.GetGunsmithCustomizeTabFrameRef()
		}
	end
	if #f40_local1 == 1 then
		f40_arg0.Tabs:SetAlpha( 0 )
	elseif #f40_local1 < 1 then
		f40_arg0.Tabs:closeTree()
		f40_arg0.Tabs = nil
		return 
	end
	local f40_local2 = {}
	for f40_local6, f40_local7 in ipairs( f40_local1 ) do
		table.insert( f40_local2, {
			name = f40_local7.name,
			disabled = f40_local7.disabled,
			hasDefaultFocus = f40_local6 - 1 == f40_local0.activeTabIndex,
			focusFunction = function ( f41_arg0, f41_arg1, f41_arg2, f41_arg3 )
				if f40_arg0.activeTabIndex and f41_arg2 == f40_arg0.activeTabIndex and f40_arg0.activeTabWidget then
					return 
				end
				TAB.UpdateBuiltWidgetOnTabChange( f40_arg0, f40_arg0.activeTabIndex, "activeTabWidget", f41_arg2, f41_arg3, f40_arg0.menuName, f40_arg0 )
				f40_arg0.activeTabIndex = f41_arg2
				local f41_local0
				if f40_arg0.previousTabName == "GunsmithAttachments" then
					f41_local0 = "attachmentTimeSpent"
				else
					f41_local0 = "customizeTimeSpent"
				end
				local f41_local1 = f40_arg0.lastTimeStamp
				local f41_local2 = Engine[0x3B8CFB6758EF57C]()
				f40_arg0.lastTimeStamp = Engine[0x3B8CFB6758EF57C]()
				if f40_arg0.menuName == "GunsmithAttachments" then
					f40_arg0[f41_local0] = f40_arg0[f41_local0] + Engine[0x250B0A331992E67]( f41_local2, "-" .. f41_local1 )
					f40_arg0.previousTabName = "GunsmithAttachments"
					if f40_arg0.HelperBar then
						f40_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
							side = "left",
							button_ref = "button_alt2",
							priority = 5,
							helper_text = Engine[0xED84C33EC5F01EA]( 0xE2F778D98189FBF )
						} )
					end
				else
					f40_arg0[f41_local0] = f40_arg0[f41_local0] + Engine[0x250B0A331992E67]( f41_local2, "-" .. f41_local1 )
					f40_arg0.previousTabName = GUNSMITH.GetGunsmithCustomizeTabFrameRef()
					if f40_arg0.HelperBar then
						f40_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
							side = "left",
							button_ref = "button_alt2"
						} )
					end
				end
				Engine[0xC4146BA76D0F982]( SOUND_SETS.default.tabHighlight )
			end
		} )
	end
	f40_arg0.Tabs:SetTabs( f40_local2 )
	f40_local3, f40_local4 = GUNSMITH.CheckNewAttachmentAndCustomization( f40_arg0._controllerIndex, f40_arg0._weaponPlayerData )
	for f40_local5 = 1, #f40_local1, 1 do
		local f40_local8 = LUI.TabManager.GetTabAtIndex( f40_arg0.Tabs, f40_local5 )
		if f40_local1[f40_local5].menuName == "GunsmithAttachments" then
			local f40_local9 = f40_local8.NewItemSmallIcon
			local f40_local10 = f40_local9
			f40_local9 = f40_local9.UpdateAlpha
			local f40_local11
			if f40_local3 then
				f40_local11 = 1
			else
				f40_local11 = 0
			end
			f40_local9( f40_local10, f40_local11, 0 )
		end
		if f40_local1[f40_local5].menuName == GUNSMITH.GetGunsmithCustomizeTabFrameRef() then
			local f40_local9 = f40_local8.NewItemSmallIcon
			local f40_local10 = f40_local9
			f40_local9 = f40_local9.UpdateAlpha
			local f40_local11
			if f40_local4 then
				f40_local11 = 1
			else
				f40_local11 = 0
			end
			f40_local9( f40_local10, f40_local11, 0 )
		end
	end
end

local f0_local7 = function ( f38_arg0, f38_arg1, f38_arg2 )
	local f38_local0 = LOOT.GetItemID( LOOT.itemTypes.WEAPON, f38_arg0._weaponTable.weapon )
	if f38_arg0.SaveMod then
		local f38_local1 = GUNSMITH.CountAvailableCustomModSlots( f38_arg1, f38_arg0._weaponTable.weapon, f38_local0 )
		local f38_local2 = GUNSMITH.CountModSlotsUnlocked( f38_arg1, f38_local0 )
		f38_arg0.CustomModSlotCount:setText( Engine[0xED84C33EC5F01EA]( 0x8BD409EFCF83213, f38_local2 - f38_local1, f38_local2 ) )
		local f38_local3 = GUNSMITH.GetNextModUnlockRank( f38_arg1, f38_arg0._weaponTable.weapon, f38_local0 )
		if f38_local3 ~= nil and 0 < #f38_local3 then
			f38_arg0.NextSlotUnlock:setText( Engine[0xED84C33EC5F01EA]( 0x6495AF31E018C8A, f38_local3 ) )
		else
			f38_arg0.NextSlotUnlock:SetAlpha( 0 )
		end
		if f38_arg0.HelperBar then
			f38_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
				kbm_only = true,
				priority = 11,
				side = "left",
				button_ref = "button_left_trigger",
				helper_text = Engine[0xED84C33EC5F01EA]( 0x9ABCD1A3258EFA )
			} )
		end
		f38_arg0.bindButton:addEventHandler( "button_left_trigger", function ( f39_arg0, f39_arg1 )
			Engine[0xC4146BA76D0F982]( SOUND_SETS.default.menuDecode )
			local f39_local0 = LOOT.GetItemID( LOOT.itemTypes.WEAPON, f38_arg0._weaponTable.weapon )
			local f39_local1 = nil
			if 0 < #f38_arg0._weaponTable.blueprintName then
				f39_local1 = GUNSMITH.GetCustomModSlot( f38_arg0._weaponTable.blueprintName )
			else
				f39_local1 = GUNSMITH.GetFirstFreeCustomModSlot( f38_arg0, f38_arg0._weaponTable.weapon, f39_local0 )
			end
			if f39_local1 then
				LUI.FlowManager.RequestPopupMenu( nil, "SaveCustomMod", true, f38_arg0, false, {
					loadoutIndex = f38_arg0.loadoutIndex,
					weaponIndex = f38_arg0.weaponSlot,
					modSlot = f39_local1
				} )
			else
				LUI.FlowManager.RequestPopupMenu( nil, "CustomModSlotsFull", true, f38_arg0, false, {
					weaponRef = f38_arg0._weaponTable.weapon
				} )
			end
		end )
	else
		local f38_local1 = GUNSMITH.GetNextModUnlockRank( f38_arg1, f38_arg0._weaponTable.weapon, f38_local0 )
		if f38_local1 ~= nil and 0 < #f38_local1 then
			f38_arg0.NextSlotUnlock:setText( Engine[0xED84C33EC5F01EA]( 0xD79A91D2714CA68, f38_local1 ) )
		else
			f38_arg0.NextSlotUnlock:SetAlpha( 0 )
		end
	end
end

local f0_local8 = function ( f36_arg0, f36_arg1 )
	return function ()
		FrontEndScene.HideWeaponModels()
		f36_arg0._weaponModel = WEAPON.GetWeaponModel( f36_arg0, FrontEndScene.ClientWeapons.Preview, CSV.weaponOffsets.previewFile )
		f36_arg0:addElement( f36_arg0._weaponModel )
		WEAPON.LoadAndSetModel( f36_arg0, f36_arg0._weaponModel, f36_arg0._weaponTable )
		f36_arg0:processEvent( {
			name = "scene_transitioned"
		} )
	end
	
end

local f0_local9 = function ( f35_arg0, f35_arg1, f35_arg2 )
	if not f35_arg2.loadoutIndex then
		DebugPrint( "WARNING: Missing \"loadoutIndex\" option for Gunsmith menu. Only OK after a MyChanges." )
		f35_arg2.loadoutIndex = 0
	end
	if not f35_arg2.weaponSlot then
		DebugPrint( "WARNING: Missing \"weaponSlot\" option for Gunsmith menu. Only OK after a MyChanges." )
		f35_arg2.weaponSlot = 0
	end
end

local f0_local10 = function ( f34_arg0 )
	local f34_local0, f34_local1 = nil
	local f34_local2 = GUNSMITH.GetCustomModName( f34_arg0._weaponPlayerData.blueprintName:get() )
	if f34_local2 and 0 < #f34_local2 then
		f34_local0 = f34_local2
	elseif f34_arg0._weaponTable and f34_arg0._weaponTable.lootID ~= LOOT.emptyID then
		f34_local0 = WEAPON.GetLootWeaponName( f34_arg0._weaponTable.weapon, f34_arg0._weaponTable.lootID )
	else
		f34_local0 = Engine[0xED84C33EC5F01EA]( 0xEA96979AEBBB476, WEAPON.GetName( f34_arg0._weaponTable.weapon ) )
	end
	if CONDITIONS.IsGLGunsmithEnabled() then
		local f34_local3 = GL_HACK.GetWeaponPlatformName( f34_arg0._weaponTable.weapon )
		if f34_local3 ~= nil and 0 < #f34_local3 then
			f34_local0 = f34_local3
		end
	end
	f34_arg0.MenuTitle:SetTitle( f34_local0 )
end

local f0_local11 = function ( f33_arg0, f33_arg1 )
	local f33_local0 = LUI.FlowManager.GetScopedData( f33_arg0 )
	f33_local0.startTime = Engine[0x3B8CFB6758EF57C]()
	local f33_local1 = f33_local0.lastTimeStamp
	if not f33_local1 then
		f33_local1 = Engine[0x3B8CFB6758EF57C]()
	end
	f33_local0.lastTimeStamp = f33_local1
	f33_local0.attachmentTimeSpent = f33_local0.attachmentTimeSpent or 0
	f33_local0.customizeTimeSpent = f33_local0.customizeTimeSpent or 0
	f33_local0.previousAttachmentConfig = ATTACHMENT.GetConfigString( f33_arg0._weaponTable )
	f33_local0.previousCosmeticConfig = WEAPON.GetCosmeticConfigString( f33_arg0._weaponTable )
	f33_local0.previousBlueprintString = WEAPON.GetWeaponBlueprintString( f33_arg1, f33_arg0._weaponTable, f33_local0.previousAttachmentConfig )
end

local f0_local12 = function ( f32_arg0, f32_arg1, f32_arg2 )
	local f32_local0 = LOADOUT.GetLoadoutSquadMember( f32_arg1 )
	f32_arg0._loadoutPlayerData = f32_local0.loadouts[f32_arg2.loadoutIndex]
	f32_arg0._weaponPlayerData = f32_arg0._loadoutPlayerData.weaponSetups[f32_arg2.weaponSlot]
	f32_arg0._weaponTable = WEAPON.GenerateWeaponTable( f32_arg0._weaponPlayerData )
end

local f0_local13 = function ( f29_arg0, f29_arg1 )
	if Engine[0x12586A3F4FB490E]() then
		local f29_local0 = Onboarding.Gunsmith.WasCompleted( f29_arg0, f29_arg1 )
		local f29_local1 = function ( f31_arg0, f31_arg1 )
			if not Onboarding.WeaponMod.WasCompleted( f31_arg0, f31_arg1 ) then
				LUI.FlowManager.RequestPopupMenu( f31_arg0, "onboardingpopup", true, f31_arg1, false, ONBOARDING_DATA.GetOnboardingWeaponModData() )
				Onboarding.WeaponMod.MarkCompleted( f31_arg0, f31_arg1 )
			end
		end
		
		if not f29_local0 then
			local f29_local2 = ONBOARDING_DATA.GetOnboardingGunsmithData()
			if CONDITIONS.GunsmithCanMakeModification( f29_arg0, f29_arg1 ) then
				f29_local2.confirmButton.action = function ( f30_arg0, f30_arg1 )
					ACTIONS.LeaveMenu( f30_arg0 )
					f29_arg0( f29_arg0, f30_arg1 )
				end
				
			end
			LUI.FlowManager.RequestPopupMenu( f29_arg0, "onboardingpopup", true, f29_arg1, false, f29_local2 )
			Onboarding.Gunsmith.MarkCompleted( f29_arg0, f29_arg1 )
		elseif CONDITIONS.GunsmithCanMakeModification( f29_arg0, f29_arg1 ) then
			f29_local1( f29_arg0, f29_arg1 )
		end
	end
end

local f0_local14 = function ( f28_arg0, f28_arg1, f28_arg2 )
	f28_arg2.weaponTable = WEAPON.GenerateWeaponTable( f28_arg0._weaponPlayerData )
	if 0 < tonumber( f28_arg2.weaponTable.variantID ) then
		f28_arg2.weaponTable.lootName = WEAPON.GetLootWeaponName( f28_arg2.weaponTable.weapon, f28_arg2.weaponTable.lootID )
	end
	LUI.FlowManager.RequestAddMenu( GUNSMITH.GetWeaponPreviewMenuRef(), true, controllerIndex, false, f28_arg2, true )
	if f28_arg1.qualifier == "keyboard" or f28_arg1.qualifier == "gamepad" then
		Engine[0xC4146BA76D0F982]( CoD.SFX.MouseClick )
	end
end

local f0_local15 = function ( f24_arg0, f24_arg1, f24_arg2 )
	if not f24_arg0.bindButton then
		f24_arg0.bindButton = LUI.UIBindButton.new()
		f24_arg0.bindButton.id = "selfBindButton"
		f24_arg0:addElement( f24_arg0.bindButton )
	end
	if CONDITIONS.IsWeaponPreviewEnabled() then
		if f24_arg0.HelperBar then
			f24_arg0.HelperBar.Background:SetAlpha( 0 )
			LUI.TextChat.SetupMenuForNoChat( f24_arg0 )
			f24_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
				side = "left",
				priority = 10,
				replaceTop = true,
				button_ref = "button_l3",
				helper_text = Engine[0xED84C33EC5F01EA]( 0xCBEAF62674E5E75 )
			} )
		end
		f24_arg0.bindButton:addEventHandler( "button_left_stick", function ( f27_arg0, f27_arg1 )
			f24_arg0:OpenWeaponPreview( f27_arg1, f24_arg0 )
		end )
	end
	f24_arg0.bindButton:addEventHandler( "button_secondary", function ( f26_arg0, f26_arg1 )
		if LUI.FlowManager.IsInStack( LOADOUT.GetLoadoutMenuRef() ) then
			local f26_local0 = LUI.FlowManager.GetScopedData( LOADOUT.GetLoadoutMenuRef() )
			local f26_local1 = LUI.FlowManager.GetScopedData( f24_arg0 )
			local f26_local2 = f26_local1.lastTimeStamp or "0"
			local f26_local3 = Engine[0x3B8CFB6758EF57C]()
			if f26_local1.attachmentTimeSpent and f26_local1.customizeTimeSpent then
				f26_local1.attachmentTimeSpent = f26_local1.attachmentTimeSpent + Engine[0x250B0A331992E67]( f26_local3, "-" .. f26_local2 )
				f26_local1.customizeTimeSpent = f26_local1.customizeTimeSpent + Engine[0x250B0A331992E67]( f26_local3, "-" .. f26_local2 )
				METRICS.GunsmithSessionSendDLogEvent( f24_arg0, f26_local0.sessionID, f24_arg0._weaponTable, f24_arg0.loadoutIndex, f26_local1.attachmentTimeSpent, f26_local1.customizeTimeSpent, f26_local1.previousAttachmentConfig, f26_local1.previousCosmeticConfig, f26_local1.previousBlueprintString )
			end
		end
	end )
	if CONDITIONS.IsFrontendFiringRangeEnabled() then
		f24_arg0.bindButton:addEventHandler( "button_alt2", function ( f25_arg0, f25_arg1 )
			f24_arg0.currentWeaponTable = WEAPON.GenerateWeaponTable( f24_arg0._weaponPlayerData )
			local f25_local0 = f24_arg0._weaponSlot
			local f25_local1 = WEAPON.PrimarySlot
			f24_arg0.secondaryWeaponTable = WEAPON.GenerateWeaponTable( f24_arg0._loadoutPlayerData.weaponSetups[REG12 and WEAPON.SecondarySlot or WEAPON.PrimarySlot] )
			f24_arg0.fromGunsmith = true
			if 0 < tonumber( f24_arg0.currentWeaponTable.variantID ) then
				f24_arg0.currentWeaponTable.lootName = WEAPON.GetLootWeaponName( f24_arg0.currentWeaponTable.weapon, f24_arg0.currentWeaponTable.lootID )
			end
			if 0 < tonumber( f24_arg0.secondaryWeaponTable.variantID ) then
				f24_arg0.secondaryWeaponTable.lootName = WEAPON.GetLootWeaponName( f24_arg0.secondaryWeaponTable.weapon, f24_arg0.secondaryWeaponTable.lootID )
			end
			LUI.FlowManager.RequestAddMenu( "FiringRangeMenu", true, f24_arg0, false, f24_arg0, true )
			if f25_arg1.qualifier == "keyboard" or f25_arg1.qualifier == "gamepad" then
				Engine[0xC4146BA76D0F982]( CoD.SFX.MouseClick )
			end
		end )
	end
end

local f0_local16 = function ( f23_arg0 )
	for f23_local0 = 1, GL_HACK.GetGunsmithMaxCategories() + 1, 1 do
		if not f23_arg0._usedButtons[f23_local0] then
			local f23_local3 = f23_arg0[f0_local0 .. f23_local0]
			assert( f23_local3 )
			f23_local3:closeTree()
			f23_arg0[f0_local0 .. f23_local0] = nil
		end
	end
	f23_arg0._buttonsRemoved = true
end

local f0_local17 = function ( f22_arg0, f22_arg1, f22_arg2 )
	local f22_local0 = GL_HACK.GetGunsmithMaxCategories() / 2
	local f22_local1
	if f22_arg2 then
		f22_local1 = 1
	else
		f22_local1 = f0_local0
	end
	local f22_local2
	if f22_arg2 then
		f22_local2 = f0_local0
		if not f22_local2 then
		
		else
			local f22_local3, f22_local4 = nil
			for f22_local5 = f22_arg1, f22_local1, -1 do
				if f22_arg0._usedButtons[f22_local5] then
					f22_local3 = f22_local5
					break
				end
			end
			for f22_local5 = f22_arg1, f22_local2, 1 do
				if f22_arg0._usedButtons[f22_local5] then
					f22_local4 = f22_local5
					break
				end
			end
			if f22_local3 then
				local f22_local5 = f22_arg1 - f22_local3
				if not f22_local5 then
				
				else
					if f22_local4 then
						local f22_local6 = f22_local4 - f22_arg1
						if not f22_local6 then
						
						else
							if f22_local5 < f22_local6 and not f22_local3 then
								f22_local7 = f22_local3
							else
								local f22_local7 = f22_local4
							end
							return f22_local7
						end
					end
					f22_local6 = f22_local2
				end
			end
			f22_local5 = f22_local2
		end
	end
	f22_local2 = GL_HACK.GetGunsmithMaxCategories()
end

local f0_local18 = function ( f21_arg0 )
	for f21_local0 = 1, GUNSMITH.maxCategories, 1 do
		if f21_arg0._usedButtons[f21_local0] then
			local f21_local3 = f21_arg0._usedButtons[f21_local0]
			local f21_local4 = f21_arg0[f0_local0 .. f21_local0]
			f21_local4.navigation = f21_local4.navigation or {}
			local f21_local5 = f0_local0[f21_local0].up
			if f21_local5 == f0_local0 and not f21_arg0._usedButtons[f21_local5] then
				f21_local5 = f0_local0
			end
			f21_local5 = f0_local0( f21_arg0, f21_local5, f0_local0 <= f21_local0 )
			if f21_local5 then
				f21_local4.navigation.up = f21_arg0[f0_local0 .. f21_local5]
			end
			local f21_local6 = f0_local0( f21_arg0, f0_local0[f21_local0].down, f0_local0 <= f21_local0 )
			if f21_local6 then
				f21_local4.navigation.down = f21_arg0[f0_local0 .. f21_local6]
			end
			local f21_local7 = f0_local0[f21_local0].left
			if f21_local7 then
				local f21_local8 = f21_local7
				local f21_local9 = f0_local0 and f0_local0 or f0_local0
				for f21_local10 = f21_local7, f21_local9, -1 do
					if f21_arg0._usedButtons[f21_local10] then
						f21_local8 = f21_local10
						break
					end
				end
				f21_local4.navigation.left = f21_arg0[f0_local0 .. f21_local8]
			end
			local f21_local8 = f0_local0[f21_local0].right
			if f21_local8 then
				local f21_local9 = f21_local8
				local f21_local10 = f0_local0 and f0_local0 or f0_local0
				for f21_local11 = f21_local8, f21_local10, 1 do
					if f21_arg0._usedButtons[f21_local11] then
						f21_local9 = f21_local11
						break
					end
				end
				f21_local4.navigation.right = f21_arg0[f0_local0 .. f21_local9]
			end
		end
	end
	f21_arg0._navigationSetup = true
end

local f0_local19 = function ( f20_arg0 )
	local f20_local0 = StringTable[0x8073B436CDE1BF]( CSV.attachmentCategoryLocks.file, CSV.attachmentCategoryLocks.cols.ref, f20_arg0 )
	local f20_local1
	if f20_local0 then
		f20_local1 = f20_local0
	else
		f20_local1 = 0 <= f20_local0
	end
	return f20_local1
end

local f0_local20 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = {
		unlockLevel = 4294967295,
		isLocked = false
	}
	local f19_local1 = WEAPON.GetWeaponModelName( f19_arg0._weaponTable.weapon, f19_arg0._weaponTable, {
		includeAttachments = true
	} )
	local f19_local2 = ClientWeapon[0x8E1E8769A4A0774]( f19_arg1, f19_local1 )
	local f19_local3 = 0 < #f19_arg0._categoryLockDetails
	for f19_local10, f19_local11 in pairs( f19_arg0._usedButtons ) do
		if f19_local11 then
			local f19_local7 = f19_arg0[f0_local0 .. f19_local10]
			assert( f19_local7 )
			local f19_local8 = {
				category = f19_local11,
				attachments = f19_arg0._attachments[f19_local11],
				weaponPlayerData = f19_arg0._weaponPlayerData,
				isTunable = ATTACHMENT.IsSelectedAttachmentInCategoryTunable( f19_arg1, f19_local11, f19_local1, f19_arg0._weaponTable, f19_local2 ),
				loadoutIndex = f19_arg0._loadoutIndex,
				weaponSlot = f19_arg0._weaponSlot,
				weaponTable = f19_arg0._weaponTable,
				weaponModelName = f19_local1
			}
			local f19_local9
			if f0_local0( f19_arg0._weaponTable.weapon ) then
				if f19_arg0._categoryLockDetails[f19_local11] then
					f19_local9 = f19_arg0._categoryLockDetails[f19_local11]
					if not f19_local9 then
					
					else
						f19_local8.categoryLockData = f19_local9
						f19_local7:Setup( f19_arg1, f19_local8 )
					end
				end
				if not f19_local0 then
					f19_local9 = f19_local0
				else
					f19_local9 = f19_local0
				end
			else
				f19_local9 = f19_local0
			end
			f19_local8.categoryLockData = f19_local9
			f19_local7:Setup( f19_arg1, f19_local8 )
		end
	end
	if not f19_arg0._buttonsRemoved then
		f0_local0( f19_arg0 )
	end
	if not f19_arg0._navigationSetup then
		f0_local0( f19_arg0 )
	end
end

local f0_local21 = function ( f18_arg0, f18_arg1 )
	if f18_arg0._weaponModel == nil then
		f18_arg0._weaponModel = WEAPON.GetWeaponModel( f18_arg1, FrontEndScene.ClientWeapons.Preview, CSV.weaponOffsets.previewFile )
	end
	f18_arg0._weaponTable = WEAPON.GenerateWeaponTable( f18_arg0._weaponPlayerData )
	WEAPON.LoadAndSetModel( f18_arg1, f18_arg0._weaponModel, f18_arg0._weaponTable )
	if f18_arg0.GunsmithWeaponDetails and f18_arg0.GunsmithWeaponDetails.StatsWithDetails and f18_arg0.GunsmithWeaponDetails.StatsWithDetails.WeaponAttributes then
		local f18_local0 = WEAPON.GetWeaponModelName( f18_arg0._weaponTable.weapon, f18_arg0._weaponTable, {
			includeAttachments = true
		} )
		local f18_local1 = ClientWeapon[0x75228338D174290]( f18_arg1, f18_local0, false, true, true )
		local f18_local2 = ClientWeapon[0x75228338D174290]( f18_arg1, f18_local0, true )
		if f18_local1 and f18_local2 then
			local f18_local3 = {}
			for f18_local7, f18_local8 in pairs( f18_local1 ) do
				f18_local3[f18_local7] = {
					total = f18_local2[f18_local7],
					weapon = f18_local2[f18_local7],
					attachment = f18_local8 - f18_local2[f18_local7]
				}
			end
			if f18_local3 then
				f18_arg0.GunsmithWeaponDetails.StatsWithDetails.WeaponAttributes:Setup( f18_local3, true, false )
			end
		end
	end
end

local f0_local22 = function ( f17_arg0, f17_arg1, f17_arg2 )
	if f17_arg0.GunsmithWeaponDetails then
		f17_arg0.GunsmithWeaponDetails:Setup( f17_arg1, WEAPON.GetAmmoData( f17_arg1, f17_arg2 ) )
	end
end

local f0_local23 = function ( f16_arg0, f16_arg1 )
	return ClientModel[0x9088CC2C1E6A1E9]( CLIENT_MODEL.GetClientModelIndex( f16_arg0 ), f16_arg1 )
end

local f0_local24 = function ( f15_arg0, f15_arg1, f15_arg2, f15_arg3 )
	local f15_local0 = CLIENT_MODEL.GetClientModelIndex( f15_arg1 )
	local f15_local1 = ClientModel[0x7FE4C5AFE1F4377]( f15_local0 )
	local f15_local2 = Engine[0xC3B7925CCAC9430]( f15_arg0, f15_arg2, f15_arg3 )
	f15_local1.yAngle = f15_local2.yAngle
	f15_local1.xAngle = f15_local2.xAngle
	ClientModel[0xEFA1738E096A743]( f15_local0, f15_local1 )
end

local f0_local25 = function ( f14_arg0, f14_arg1 )
	local f14_local0 = 0
	local f14_local1 = 0
	local f14_local2 = ""
	local f14_local3 = ""
	for f14_local4 = 1, #f14_arg0._weaponTable.attachments, 1 do
		local f14_local7 = f14_arg0._weaponTable.attachments[f14_local4].ref
		local f14_local8 = ATTACHMENT.GetCategory( f14_local7 )
		if f14_local8 == "magazine" then
			f14_local2 = f14_local7
		end
		if f14_local8 == "undermount" then
			f14_local3 = f14_local7
		end
	end
	local f14_local4 = ATTACHMENT.GetListBundle()
	assert( f14_local4 )
	for f14_local7, f14_local8 in ipairs( f14_local4[0xA8636246CD7AB2A] ) do
		if f14_local8[0x8B6F2336E5960E5] ~= nil then
			local f14_local10 = Engine[0x6093D047200548]( 0xC2C9813BB16552F .. (f14_local8[0x8B6F2336E5960E5] or "") )
			if f14_local10[0x271998548F2F402] and f14_local10[0xA7B103262A7BA7A] == f14_local2 then
				f14_local0 = f14_local10[0x271998548F2F402]
			end
			if f14_local10[0x271998548F2F402] and f14_local10[0xA7B103262A7BA7A] == f14_local3 then
				f14_local1 = f14_local10[0x271998548F2F402]
			end
		end
	end
	return math.max( f14_local0, f14_local1 )
end

local f0_local26 = function ( f13_arg0 )
	for f13_local3, f13_local4 in pairs( f13_arg0 ) do
		CLIENT_MODEL.SetModel( f13_local4, "tag_origin" )
	end
end

local f0_local27 = function ( f9_arg0, f9_arg1 )
	CLIENT_MODEL.InitGunViseModels()
	local f9_local0 = {
		base = CLIENT_MODEL.coreMPModels.GUN_VISE_MAGWELL_BASE,
		insert = CLIENT_MODEL.coreMPModels.GUN_VISE_MAGWELL_INSERT
	}
	local f9_local1 = {
		base = CLIENT_MODEL.coreMPModels.GUN_VISE_SUPPORT_BASE,
		insert = CLIENT_MODEL.coreMPModels.GUN_VISE_SUPPORT_INSERT
	}
	local f9_local2 = ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview )
	ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, 0, 0, 0 )
	f0_local0( f9_local1 )
	CLIENT_MODEL.SetModel( CLIENT_MODEL.coreMPModels.MAG_DISPLAY, "tag_origin" )
	local f9_local3 = CLIENT_MODEL.GetClientModelIndex( CLIENT_MODEL.coreMPModels.AMMO_DISPLAY )
	CLIENT_MODEL.SetAmmoAngle( f9_local3 )
	CLIENT_MODEL.ResetAmmoModelPosition( f9_local3 )
	local f9_local4 = f9_arg0.GunsmithWeaponDetails:Wait( 5 )
	f9_local4.onComplete = function ()
		GUNSMITH.UpdateAmmoModel( f9_arg0, f9_arg0, f9_arg0 )
		local f10_local0 = Engine[0xF3C157C48E60860]( f9_arg0, f9_arg0, "offset_vise_attach" )
		local f10_local1 = Engine[0xF3C157C48E60860]( f9_arg0, f9_arg0, "tag_flash_silenced" )
		local f10_local2 = Engine[0xF3C157C48E60860]( f9_arg0, f9_arg0, "tag_flash_muzzle" )
		local f10_local3
		if f10_local1 then
			f10_local3 = "tag_flash_silenced"
		elseif f10_local2 then
			f10_local3 = "tag_flash_muzzle"
		else
			f10_local3 = "tag_flash"
		end
		local f10_local4 = "offset_vise_rear"
		local f10_local5 = Engine[0xC3B7925CCAC9430]( f9_arg0, f9_arg0, "j_gun" )
		local f10_local6 = Engine[0xC3B7925CCAC9430]( f9_arg0, f9_arg0, f10_local3 )
		local f10_local7 = Engine[0xC3B7925CCAC9430]( f9_arg0, f9_arg0, f10_local4 )
		local f10_local8 = f9_arg0( CLIENT_MODEL.coreMPModels.GUN_VISE_BASE, CLIENT_MODEL.coreMPModels.GUN_VISE_BASE.tagOrigin )
		local f10_local9 = (f10_local6.xPosition + f10_local7.xPosition) / 2
		local f10_local10 = (f10_local6.yPosition + f10_local7.yPosition) / 2
		local f10_local11 = f10_local5.xPosition - f10_local9
		local f10_local12 = f10_local5.yPosition - f10_local10
		local f10_local13 = f10_local5.xPosition - f10_local8.xPosition + f10_local11
		local f10_local14 = f10_local5.yPosition - f10_local8.yPosition + f10_local12
		local f10_local15 = Engine[0xC3B7925CCAC9430]( f9_arg0, f9_arg0, "tag_mag_attach" )
		local f10_local16 = f9_arg0( f9_arg0.insert, f9_arg0.insert.tagGunAttach )
		ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, f10_local13, f10_local14, f10_local16.zPosition - f10_local15.zPosition + f9_arg0( f9_arg0, f9_arg0 ) )
		f9_arg0( f9_arg0 )
		f9_arg0( f9_arg0, f9_arg0.insert, f9_arg0, "offset_vise_attach" )
		local f10_local17 = f9_arg0.GunsmithWeaponDetails.StatsWithDetails:Wait( 5 )
		f10_local17.onComplete = function ()
			local f11_local0 = StringTable[0x2DCF0973239E909]( CSV.attachmentCategories.file, CSV.attachmentCategories.cols.ref, "receiver", CSV.attachmentCategories.cols.bone )
			local f11_local1 = Engine[0xC3B7925CCAC9430]( f10_local0, f10_local0, f11_local0 )
			Engine[0x6055C55456F05DF]( "attach_zoom," .. "receiver" .. "," .. f11_local0 .. "," .. f11_local1.xPosition .. "," .. f11_local1.yPosition .. "," .. f11_local1.zPosition .. "," .. f11_local1.xAngle .. "," .. f11_local1.yAngle .. "," .. f11_local1.zAngle, 1 )
			local f11_local2 = LUI.FlowManager.GetScopedData( f10_local0 )
			local f11_local3 = ATTACHMENT.GetAttachmentCategoryButton( "receiver" )
			if f11_local2 and f11_local2.buttonCategoryToFocus then
				f10_local0[f10_local0 .. ATTACHMENT.GetAttachmentCategoryButton( f11_local2.buttonCategoryToFocus )].processEvent( f11_local4[f10_local0 .. ATTACHMENT.GetAttachmentCategoryButton( f11_local2.buttonCategoryToFocus )], {
					immediate = true,
					name = "gain_focus"
				} )
			elseif f10_local0._usedButtons[f11_local3] then
				f10_local0[f10_local0 .. f11_local3].processEvent( f11_local4[f10_local0 .. f11_local3], {
					immediate = true,
					name = "gain_focus"
				} )
			elseif 0 < #f10_local0._usedButtons then
				f10_local0[f10_local0 .. ATTACHMENT.GetAttachmentCategoryButton( f10_local0._usedButtons[1] )].processEvent( f11_local4[f10_local0 .. ATTACHMENT.GetAttachmentCategoryButton( f10_local0._usedButtons[1] )], {
					immediate = true,
					name = "gain_focus"
				} )
			end
			local f11_local4 = f10_local0( f10_local0.insert, f10_local0.insert.tagOrigin )
			f10_local0 = f10_local0( f10_local0.insert, f10_local0.insert.tagGunAttach )
			f10_local0 = Engine[0xC3B7925CCAC9430]( f10_local0, f10_local0, "offset_vise_attach" )
			f11_local4.xPosition = f10_local0.xPosition - f10_local0.xPosition - f11_local4.xPosition
			f11_local4.yPosition = f10_local0.yPosition - f10_local0.yPosition - f11_local4.yPosition
			ClientModel[0x9C89C00DF9B85ED]( CLIENT_MODEL.GetClientModelIndex( f10_local0.insert ), f11_local4 )
			local f11_local5 = f10_local0.GunsmithWeaponDetails.StatsWithDetails.WeaponAttributes:Wait( 5 )
			f11_local5.onComplete = function ()
				local f12_local0 = f11_local0( f11_local0.base, f11_local0.base.tagOrigin )
				f11_local0 = f11_local0( f11_local0.insert, f11_local0.insert.tagOrigin )
				f12_local0.xPosition = f11_local0.xPosition
				f12_local0.yPosition = f11_local0.yPosition
				ClientModel[0x9C89C00DF9B85ED]( CLIENT_MODEL.GetClientModelIndex( f11_local0.base ), f12_local0 )
			end
			
		end
		
	end
	
end

local f0_local28 = function ( f8_arg0, f8_arg1 )
	f8_arg0.FrontendCameraMover = MenuBuilder.BuildRegisteredType( "FrontendCameraMover", {
		disableInput = true,
		disableLayout = true,
		enableZoom = true,
		controllerIndex = f8_arg1
	} )
	f8_arg0.FrontendCameraMover.id = "FrontendCameraMover"
	f8_arg0.FrontendCameraMover:SetLimits( -0.3, 0.3, -0.3, 0.3 )
	f8_arg0.FrontendCameraMover:SetVelocity( 1 )
	f8_arg0.FrontendCameraMover:SetMaxZoom( 0 )
	f8_arg0.FrontendCameraMover:SetSwayValues( 0, 0, 0 )
	f8_arg0:addElement( f8_arg0.FrontendCameraMover )
	f8_arg0._basePositionAndAxis = GUNSMITH.GetFrontendTagWorldPositionAndAxis( f8_arg1, f8_arg0._weaponTable.weapon, f8_arg0._weaponTable.variantID, "receiver" )
end

local f0_local29 = function ( f6_arg0, f6_arg1 )
	f6_arg0:addEventHandler( "update_frontend_camera", function ( f7_arg0, f7_arg1 )
		if f7_arg1.category == "extra" then
			return 
		end
		local f7_local0 = ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview )
		local f7_local1 = ""
		local f7_local2 = ""
		if f7_arg1.category == "gunperk" then
			f7_local1 = "ammo_display_origin"
			local f7_local3 = CLIENT_MODEL.GetClientModelIndex( CLIENT_MODEL.coreMPModels.AMMO_DISPLAY )
			local f7_local4 = ClientModel[0x9088CC2C1E6A1E9]( f7_local3, CLIENT_MODEL.coreMPModels.GUN_VISE_BASE.tagOrigin )
			local f7_local5 = ClientModel[0x7FE4C5AFE1F4377]( f7_local3 )
			f7_local2 = "attach_zoom," .. f7_arg1.category .. "," .. f7_local1 .. "," .. f7_local4.xPosition .. "," .. f7_local4.yPosition .. "," .. f7_local4.zPosition .. "," .. 0 .. "," .. f7_local5.yAngle .. "," .. f7_local5.zAngle
		else
			f7_local1 = StringTable[0x2DCF0973239E909]( CSV.attachmentCategories.file, CSV.attachmentCategories.cols.ref, f7_arg1.category, CSV.attachmentCategories.cols.bone )
			local f7_local3 = Engine[0xC3B7925CCAC9430]( f6_arg0, f7_local0, f7_local1 )
			f7_local2 = "attach_zoom," .. f7_arg1.category .. "," .. f7_local1 .. "," .. f7_local3.xPosition .. "," .. f7_local3.yPosition .. "," .. f7_local3.zPosition .. "," .. f7_local3.xAngle .. "," .. f7_local3.yAngle .. "," .. f7_local3.zAngle
		end
		Engine[0x6055C55456F05DF]( f7_local2, 1 )
	end )
end

local f0_local30 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0._controllerIndex = f3_arg1
	if Engine[0x2DA54CF5D6B7F02]() then
		f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	end
	if CONDITIONS.IsFrontendFiringRangeEnabled() and CONDITIONS.InFrontendPublicMP() and f3_arg0.HelperBar then
		f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 1,
			ignoreTooltipPrompt = true,
			button_ref = "button_alt2",
			helper_text = Engine[0xED84C33EC5F01EA]( 0x87F441FF1147495 ),
			container = f3_arg0.FiringRangePrompt
		} )
	end
	assert( f3_arg2.loadoutIndex )
	assert( f3_arg2.weaponSlot )
	f3_arg0._loadoutIndex = f3_arg2.loadoutIndex
	f3_arg0._weaponSlot = f3_arg2.weaponSlot
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	if not CONDITIONS.IsGLGunsmithEnabled() then
		f0_local0( f3_arg0 )
	end
	WEAPON.SetPreviewSceneForWeapon( f3_arg0._weaponTable.weapon )
	ClientWeapon[0x59B77D6F41ED417]( FrontEndScene.ClientWeapons.Preview, false )
	MenuUtils.SetupSceneChangeCallback( f3_arg0, f0_local0( f3_arg0, f3_arg1 ) )
	f0_local0( f3_arg0, f3_arg1 )
	f0_local0( f3_arg0, f3_arg1 )
	f3_arg2.loadoutPlayerData = f3_arg0._loadoutPlayerData
	f3_arg2.weaponPlayerData = f3_arg0._weaponPlayerData
	f0_local0( f3_arg0, f3_arg1 )
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	local f3_local0 = GL_HACK.GetWeaponMPRef( f3_arg0._weaponTable.weapon )
	f0_local0( f3_arg0, f3_arg1, f3_arg0._weaponTable )
	if CONDITIONS.IsGLGunsmithEnabled() then
		f0_local0( f3_arg0, f3_arg1 )
		local f3_local1 = LUI.FlowManager.GetScopedData( f3_arg0 )
		if f3_local1.attachmentData and f3_local1.attachmentData[f3_local0] then
			f3_arg0._attachments = f3_local1.attachmentData[f3_local0].attachments
			f3_arg0._bucketItems = f3_local1.attachmentData[f3_local0].bucketItems
		else
			f3_arg0._attachments, f3_arg0._bucketItems = GL_HACK.GetAttachmentsAndBucketItems( f3_arg1, {
				isWeaponParts = true,
				isForceRequestingAttachmentData = true,
				weaponRef = f3_local0,
				blueprintID = f3_arg0._weaponTable.lootID
			} )
			f3_local1.attachmentData = {}
			f3_local1.attachmentData[f3_local0] = {}
			f3_local1.attachmentData[f3_local0].attachments = f3_arg0._attachments
			f3_local1.attachmentData[f3_local0].bucketItems = f3_arg0._bucketItems
		end
		f3_arg0._usedButtons = GUNSMITH.GetUsedAttachmentIndices( f3_arg0._weaponTable.weapon, f3_arg0._attachments )
		if CONDITIONS.IsGLGunsmithEnabled() and f3_arg0._attachments.receiver and 0 < #f3_arg0._attachments.receiver then
			f3_arg0._usedButtons[ATTACHMENT.GetAttachmentCategoryButton( "receiver" )] = "receiver"
		end
		f3_arg0._categoryLockDetails = GUNSMITH.GetCategoryLockDetails( f3_arg1, f3_arg0._weaponTable.weapon )
		f0_local0( f3_arg0, f3_arg1 )
		f3_arg0:addEventHandler( "update_tune_button", function ( f5_arg0, f5_arg1 )
			if f3_arg0._curTuneButton then
				f3_arg0._curTuneButton:SetAlpha( 0 )
			end
			if f3_arg0._curReticleButton then
				f3_arg0._curReticleButton:SetAlpha( 0 )
			end
			f3_arg0._curTuneButton = f5_arg1.tuneButton
			f3_arg0._curReticleButton = f5_arg1.reticleButton
		end )
		ACTIONS.AnimateSequence( f3_arg0, "GL_Layout" )
		local f3_local2 = GUNSMITH.GetEquipCounts( f3_arg0._weaponTable.weapon, f3_arg0._weaponTable, f3_arg0._weaponTable.attachments )
		f3_arg0.GunsmithWeaponDetails:UpdateModification( f3_local2.attachmentCount, f3_arg0.GunsmithWeaponDetails.AttachmentEquipPips._maxPips )
		if f3_arg0.Vignette then
			ACTIONS.ScaleFullscreen( f3_arg0.Vignette )
		end
		if f3_arg0.Gradient then
			ACTIONS.ScaleFullscreen( f3_arg0.Gradient )
		end
		if f3_arg0.SaveMod then
			f3_arg0.SaveMod:SetAlpha( 0 )
		end
		if f3_arg0.CustomModSlotCount then
			f3_arg0.CustomModSlotCount:SetAlpha( 0 )
		end
		f3_arg0.NextSlotUnlock:SetAlpha( 0 )
	else
		f0_local0( f3_arg0, f3_arg2 )
		f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	end
	f0_local0( f3_arg0, f3_arg1 )
	if IsLanguageArabic() then
		ACTIONS.AnimateSequence( f3_arg0, "AR" )
	end
	f3_arg0:addEventHandler( "restore_focus", function ()
		for f4_local3, f4_local4 in ipairs( f3_arg0._usedButtons ) do
			f3_arg0[f3_arg0 .. ATTACHMENT.GetAttachmentCategoryButton( f4_local4 )].processEvent( REG5[f3_arg0 .. ATTACHMENT.GetAttachmentCategoryButton( f4_local4 )], {
				immediate = true,
				name = "lose_focus"
			} )
		end
		return true
	end )
end

local f0_local31 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
	f2_arg0.OpenWeaponPreview = f0_local0
end

function GunsmithBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "GunsmithBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "GunsmithBase", GunsmithBase )
LockTable( _M )
