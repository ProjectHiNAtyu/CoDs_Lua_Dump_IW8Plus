-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
LUI.ShaderPreloadLayer = LUI.Class( LUI.UIElement )
local f0_local0 = 800
local f0_local1 = 88
local f0_local2 = 300
local f0_local3 = {
	[CoD.PlayMode.SP] = "PSO_PRECACHE/PACK1",
	[CoD.PlayMode.Core] = "PSO_PRECACHE/PACK2",
	[CoD.PlayMode.Aliens] = "PSO_PRECACHE/PACK3"
}
LUI.ShaderPreloadLayer.States = {
	COMPLETED = 4,
	IN_PROGRESS = 2,
	PAUSED = 3,
	PENDING = 1
}
LUI.ShaderPreloadLayer.PreloadPSOReasonStringRef = {
	[CoD.PreloadPSORebuildReason.PRELOADPSO_DETERMINING] = "",
	[CoD.PreloadPSORebuildReason.PRELOADPSO_NOCONFIG] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_FILECHANGED_NEWFILE" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_FORCED] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_FORCED" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_FILECHANGED] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_FILECHANGED_NEWFILE" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_NEWFILE] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_FILECHANGED_NEWFILE" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_DRIVERVERSION] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_DRIVERVERSION" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_HARDWARECHANGED] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_HARDWARECHANGED" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_OTHEREXEC] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_MATCHING_EXEC" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_CORRUPTEDFILE] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_BADCONFIG" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_OSVERSION] = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_CAUSE_OSVERSION" ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_UNKNOWN] = ""
}
LUI.ShaderPreloadLayer.init = function ( f20_arg0, f20_arg1 )
	LUI.UIElement.init( f20_arg0 )
	local f20_local0 = f20_arg1.controllerIndex
	if not f20_local0 then
		f20_local0 = Engine[0x45B054C920178E9]()
	end
	f20_arg0._controllerIndex = f20_local0
	f20_arg0.id = "ShaderPreloadLayer"
	f20_arg0._isShaderPreloadingVisible = false
end

LUI.ShaderPreloadLayer.ShouldBeVisible = function ( f19_arg0 )
	local f19_local0 = Engine[0xEE6F69FEA944B13]()
	f19_local0 = f19_local0.flowManager:GetStackTop()
	local f19_local1
	if f19_local0 then
		f19_local1 = f19_local0
	else
		f19_local1 = f19_local0.name == "CinematicFullscreen"
	end
	local f19_local2
	if f19_local0 then
		f19_local2 = f19_local0
	else
		f19_local2 = f19_local0.name == "LobbyFtueTutorial"
	end
	local f19_local3 = Engine[0x721BC4A85447B1D]()
	if f19_local3 then
		f19_local3 = Dvar[0x9E5BE3B4BBA4E0E]( "#x345ffbc1f5d45143e" )
	end
	local f19_local4 = Engine[0x575E9C5B9AAB6F4]()
	if f19_local4 then
		f19_local4 = Engine[0x12586A3F4FB490E]()
	end
	if not f19_arg0._isShaderPreloadingVisible then
		f19_arg0._isShaderPreloadingVisible = ShaderUpload[0x11014FCF5F64C7B]()
	end
	local f19_local5
	if f19_local4 then
		f19_local5 = f19_local4
	else
		if not f19_local3 then
			f19_local5 = f19_arg0._isShaderPreloadingVisible
			if f19_local5 then
				if not f19_local1 then
					f19_local5 = not f19_local2
				else
					f19_local5 = false
				end
			else
				return f19_local5
			end
		end
		f19_local5 = false
	end
	return f19_local5
end

LUI.ShaderPreloadLayer.GetCurrentState = function ( f18_arg0 )
	local f18_local0 = f18_arg0._currentState
	if not f18_local0 then
		f18_local0 = LUI.ShaderPreloadLayer.States.NONE
	end
	return f18_local0
end

local f0_local4 = function ( f17_arg0 )
	f17_arg0.shaderPreloadContainer:SetTop( 0, f0_local0 )
	f17_arg0.shaderPreloadContainer:SetBottom( f0_local0 * _1080p, f0_local0 )
end

local f0_local5 = function ( f16_arg0 )
	f16_arg0.shaderPreloadContainer:SetTop( -f0_local0 * _1080p, f0_local0 )
	f16_arg0.shaderPreloadContainer:SetBottom( 0, f0_local0 )
end

LUI.ShaderPreloadLayer.SetLayerPending = function ( f15_arg0 )
	f0_local0( f15_arg0 )
	f15_arg0._currentState = LUI.ShaderPreloadLayer.States.PENDING
end

LUI.ShaderPreloadLayer.SetLayerInProgress = function ( f14_arg0 )
	f0_local0( f14_arg0 )
	ACTIONS.AnimateSequence( f14_arg0.shaderPreloadContainer, "InProgress" )
	ACTIONS.AnimateSequence( f14_arg0.shaderPreloadContainer.ContentInternal, "InProgressInternal" )
	f14_arg0:UpdateProgress()
	f14_arg0._currentState = LUI.ShaderPreloadLayer.States.IN_PROGRESS
	f14_arg0.shaderPreloadContainer:UpdateLayout( f14_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetLayerPaused = function ( f13_arg0, f13_arg1 )
	if f13_arg1 then
		f0_local0( f13_arg0 )
	end
	f13_arg0.shaderPreloadContainer.ContentInternal.Text:setText( Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADER_DURING_GAMEPLAY" ) )
	ACTIONS.AnimateSequence( f13_arg0.shaderPreloadContainer, "Paused" )
	ACTIONS.AnimateSequence( f13_arg0.shaderPreloadContainer.ContentInternal, "PausedInternal" )
	f13_arg0.shaderPreloadContainer:UpdateProgressBarAndText()
	f13_arg0._currentState = LUI.ShaderPreloadLayer.States.PAUSED
	f13_arg0.shaderPreloadContainer:UpdateLayout( f13_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetLayerComplete = function ( f12_arg0 )
	ACTIONS.AnimateSequence( f12_arg0.shaderPreloadContainer, "Completed" )
	ACTIONS.AnimateSequence( f12_arg0.shaderPreloadContainer.ContentInternal, "CompletedInternal" )
	f12_arg0.shaderPreloadContainer:CompleteSequence()
	f12_arg0._currentState = LUI.ShaderPreloadLayer.States.COMPLETED
	f12_arg0.shaderPreloadContainer:UpdateLayout( f12_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetShaderPreloadingVisible = function ( f11_arg0 )
	local f11_local0 = Engine[0xEE6F69FEA944B13]()
	f11_local0.shaderPreloadLayer._isShaderPreloadingVisible = f11_arg0
end

local f0_local6 = function ( f10_arg0 )
	local f10_local0 = ShaderUpload[0xC00366D65DAD0D7]()
	local f10_local1 = false
	if f10_local0 ~= f10_arg0._previousProcessingMode then
		f10_arg0._previousProcessingMode = f10_local0
		f10_local1 = true
	end
	return f0_local0[f10_local0], f10_local1
end

local f0_local7 = function ( f9_arg0 )
	local f9_local0, f9_local1 = f0_local0( f9_arg0 )
	local f9_local2 = LUI.DataSourceInGlobalModel.new( "frontEnd.psoPreload.PSOPreloadReason" )
	f9_arg0:dispatchEventToRoot( {
		name = "send_toast_notification",
		immediate = true,
		options = {
			iconScale = 1.589942647E-314,
			displayTime = 4000,
			icon = "hud_info_alert",
			iconColor = SWATCHES.genericMenu.toastHighlight,
			header = LUI.ShaderPreloadLayer.PreloadPSOReasonStringRef[f9_local2:GetValue( f9_arg0._controllerIndex )],
			description = Engine[0xED84C33EC5F01EA]( "PSO_PRECACHE/SHADERS_COMPILATION_TOASTNOTIFICATION_CAUSE_TITLE", f9_local0 ),
			controllerIndex = f9_arg0._controllerIndex
		}
	} )
end

local f0_local8 = function ( f8_arg0 )
	local f8_local0, f8_local1 = f0_local0( f8_arg0 )
	f8_arg0.shaderPreloadContainer:UpdateProgressContent( f8_arg0._controllerIndex, f8_local0, ShaderUpload[0xC00366D65DAD0D7]() )
	if f8_local1 then
		f8_arg0.shaderPreloadContainer:UpdateLayout( LUI.ShaderPreloadLayer.GetCurrentState( f8_arg0 ) )
		f0_local0( f8_arg0 )
	end
end

LUI.ShaderPreloadLayer.InPartyOrLobby = function ()
	local f7_local0 = 1 < #Friends[0xE30C6358EF728A1]( Engine[0x45B054C920178E9]() )
	local f7_local1 = Engine[0x26F7462AEAB0A8F]()
	if f7_local1 then
		f7_local1 = Tournament[0x7E86050E6607699]()
		if not f7_local1 then
			f7_local1 = LUI.FlowManager.IsInStack( "TournamentLoadingScreen" )
		end
	end
	local f7_local2 = Lobby[0xF1D2956B0C99DF6]()
	if not f7_local2 then
		f7_local2 = IsPrivateMatch() or f7_local1
	end
	local f7_local3
	if not f7_local0 then
		f7_local3 = f7_local0
	else
		f7_local3 = f7_local2
	end
	return f7_local3
end

local f0_local9 = function ( f5_arg0 )
	local self = LUI.UITimer.new( {
		event = "update_layer",
		interval = 200
	} )
	self.id = "timer"
	f5_arg0:addElement( self )
	f5_arg0.shaderPreloadContainer:registerEventHandler( "update_layer", function ( element, event )
		if f5_arg0._isShaderPreloadingVisible then
			local f6_local0 = LUI.ShaderPreloadLayer.GetCurrentState( f5_arg0 )
			if ShaderUpload[0x235D0443F9C8321]() and ShaderUpload[0x11014FCF5F64C7B]() then
				if f6_local0 ~= LUI.ShaderPreloadLayer.States.IN_PROGRESS then
					LUI.ShaderPreloadLayer.SetLayerInProgress( f5_arg0 )
				end
				f5_arg0:UpdateProgress()
			else
				local f6_local1
				if f6_local0 == LUI.ShaderPreloadLayer.States.PENDING then
					f6_local1 = LUI.ShaderPreloadLayer.InPartyOrLobby()
				else
					f6_local1 = false
				end
				if f6_local0 == LUI.ShaderPreloadLayer.States.IN_PROGRESS or f6_local1 then
					if ShaderUpload[0x11014FCF5F64C7B]() then
						LUI.ShaderPreloadLayer.SetLayerPaused( f5_arg0, f6_local1 )
					else
						LUI.ShaderPreloadLayer.SetLayerComplete( f5_arg0 )
					end
				end
			end
		end
	end )
end

LUI.ShaderPreloadLayer.InitLayer = function ( f4_arg0 )
	local shaderPreloadContainer = MenuBuilder.BuildRegisteredType( "PreloadingShadersContent", {
		controllerIndex = f4_arg0._controllerIndex
	} )
	shaderPreloadContainer.id = "PreloadingShadersContent"
	shaderPreloadContainer:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -f0_local0 / 2, _1080p * f0_local0 / 2, -f0_local0 * _1080p, 0 )
	f4_arg0:addElement( shaderPreloadContainer )
	f4_arg0.shaderPreloadContainer = shaderPreloadContainer
	
	LUI.ShaderPreloadLayer.SetLayerPending( f4_arg0 )
	f0_local0( f4_arg0 )
	f4_arg0._previousProcessingMode = ShaderUpload[0xC00366D65DAD0D7]()
	f0_local0( f4_arg0 )
	f4_arg0.UpdateProgress = f0_local0
end

LUI.ShaderPreloadLayer.ClearLayer = function ( f2_arg0, f2_arg1 )
	if f2_arg0.shaderPreloadContainer then
		LUI.ShaderPreloadLayer.SetLayerPending( f2_arg0 )
		
		local clearLayerTimer = LUI.UITimer.new( {
			event = "clear_layer",
			interval = f0_local0
		} )
		f2_arg0:addElement( clearLayerTimer )
		f2_arg0.clearLayerTimer = clearLayerTimer
		
		f2_arg0:registerEventHandler( "clear_layer", function ()
			if f2_arg0.clearLayerTimer ~= nil then
				f2_arg0.clearLayerTimer:closeTree()
				f2_arg0.clearLayerTimer = nil
			end
			f2_arg0:closeChildren()
			f2_arg0.shaderPreloadContainer = nil
		end )
	end
end

LUI.ShaderPreloadLayer.GetLayer = function ()
	local f1_local0 = Engine[0xEE6F69FEA944B13]()
	return f1_local0.shaderPreloadLayer
end

