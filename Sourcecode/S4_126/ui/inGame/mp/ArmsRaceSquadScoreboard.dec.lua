-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.inGame.mp.TeamStatusContainer" )
require( "ui.widgets.ScoreboardTitleRow" )
require( "ui.widgets.ButtonHelperBar" )
local f0_local0 = "inGame.MP.scoreboard"
local f0_local1 = {}
local f0_local2 = function ( f10_arg0 )
	f10_arg0._squadMemberList = {}
	for f10_local0 = 0, MP.BRTeamMaxSize - 1, 1 do
		local f10_local3 = LUI.DataSourceFromOmnvar.new( "ui_arm_squadmember_" .. f10_local0 )
		local f10_local4 = f10_local3:Filter( "entNumDataSource", function ( f12_arg0, f12_arg1 )
			if f12_arg0 == -1 then
				return -1
			else
				return BitwiseOperators.band( f12_arg0, 2047 )
			end
		end )
		f10_arg0:SubscribeToModel( f10_local4:GetModel( f10_arg0._controllerIndex ), function ()
			local f11_local0 = f10_arg0:GetValue( f10_arg0._controllerIndex )
			if f11_local0 == -1 or f11_local0 == CoD.ENTITYNUM_NONE then
				if f10_arg0._squadMemberList[f10_arg0] then
					f10_arg0._squadMemberList[f10_arg0] = nil
				end
				return 
			elseif not f10_arg0._squadMemberList[f10_arg0] then
				f10_arg0._squadMemberList[f10_arg0] = {}
			end
			f10_arg0._squadMemberList[f10_arg0]._entNum = f11_local0
		end )
	end
end

local f0_local3 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0._scoreboardActive = false
	f2_arg0._squadMemberList = {}
	f0_local0( f2_arg0 )
	f2_arg0.Scoreboard = LUI.Scoreboard.new( f2_arg2, {
		scrollingThresholdX = 0,
		maxVelocity = 5000,
		alwaysSnap = true,
		scrollingThresholdY = 0,
		wrapX = false,
		maxVisibleColumns = 1,
		wrapY = false,
		numColumns = 1,
		forcePrimaryAxisScrolling = true,
		springCoefficient = 400,
		maxVisibleRows = MP.BRTeamMaxSize,
		controllerIndex = f2_arg1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "ScoreboardRow", {
				isFriendly = true,
				isEnemy = false,
				controllerIndex = f2_arg0
			} )
		end,
		refreshChild = function ( f8_arg0, f8_arg1, f8_arg2 )
			f8_arg0.isFriendly = f2_arg0.isFriendly
			f8_arg0.isEnemy = f2_arg0.isEnemy
			if f2_arg0.Scoreboard then
				local f8_local0 = f2_arg0.Scoreboard:GetTeamIndex()
				if f8_local0 then
					local f8_local1 = f8_arg2
					local f8_local2 = Game[0xC22F90682BB5BF5]( f8_local0 )
					if f8_arg2 == 0 then
						for f8_local3 = 0, f8_local2, 1 do
							local f8_local6 = Game[0xE5834060F6632A7]( f8_local0, f8_local3, true )
							if f8_local6 and f8_local6.clientNum then
								for f8_local7 = 0, MP.BRTeamMaxSize - 1, 1 do
									if f2_arg0._squadMemberList[f8_local7] and f2_arg0._squadMemberList[f8_local7]._entNum == f8_local6.clientNum then
										f2_arg0._squadMemberList[f8_local7]._rowNum = f8_local3
									end
								end
							end
						end
					end
					if f2_arg0._squadMemberList[f8_local1] then
						f8_arg0:RefreshRowContent( f8_local0, f2_arg0._squadMemberList[f8_local1]._rowNum )
					end
				end
			end
			f2_arg0.Rows:SetRGBFromTable( COLORBLIND_UTILS.GetCustomColorFromColorNameAndColorBlindType( f2_arg0, COLORBLIND_UTILS.CUSTOM_COLORS.ALLY, SWATCHES.highlight.vAllyHighlight ), 0 )
		end,
		numRows = MP.BRTeamMaxSize,
		spacingX = SCOREBOARD.spacingX,
		spacingY = SCOREBOARD.spacingY,
		columnWidth = SCOREBOARD.columnWidth,
		rowHeight = SCOREBOARD.rowHeight,
		horizontalAlignment = LUI.Alignment.Left,
		verticalAlignment = LUI.Alignment.Top
	} )
	f2_arg0.Scoreboard.id = "Scoreboard"
	f2_arg0:addElement( f2_arg0.Scoreboard )
	f2_arg0:SubscribeToModel( DataSources.inGame.MP.match.spectatingTeam:GetModel( f2_arg1 ), function ( f7_arg0 )
		f2_arg0.Scoreboard:SetTeamIndex( DataModel[0x614D394F6F9A18D]( f7_arg0 ) )
	end )
	f2_arg0.Scoreboard:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 60, _1080p * -42, _1080p * 115, _1080p * 280 )
	f2_arg0.Scoreboard:SetMask( f2_arg0.FriendlyMask )
	f2_arg0.Rows:SetMask( f2_arg0.FriendlyMask )
	f2_arg0.Backer:SetMask( f2_arg0.FriendlyMask )
	local f2_local0 = LUI.DataSourceFromOmnvar.new( "ui_squad_data" )
	local f2_local1 = f2_local0:Filter( "squadIndex", function ( f6_arg0, f6_arg1 )
		return BitwiseOperators.band( f6_arg0, 31 )
	end )
	f2_arg0:SubscribeToModel( f2_local1:GetModel( f2_arg1 ), function ()
		local f5_local0 = f2_arg0:GetValue( f2_arg0 )
		if f5_local0 and -1 < f5_local0 and f5_local0 < 4 then
			f2_arg0.SquadName:setText( Engine[0xED84C33EC5F01EA]( "MPUI/TOURNAMENT_TEAM_NAME_" .. f5_local0 ) )
			f2_arg0.SquadName:SetVisible( true )
		else
			f2_arg0.SquadName:SetVisible( false )
		end
	end )
	f2_arg0:registerEventHandler( "open_scoreboard", function ( element, event )
		f2_arg0._scoreboardActive = true
		f2_arg0.Scoreboard:processEvent( {
			name = "open_scoreboard"
		} )
		ACTIONS.GainFocus( f2_arg0, "Scoreboard", f2_arg0 )
	end )
	f2_arg0:registerEventHandler( "close_scoreboard", function ( element, event )
		f2_arg0._scoreboardActive = false
		f2_arg0.Scoreboard:processEvent( {
			name = "close_scoreboard"
		} )
		ACTIONS.LoseFocus( f2_arg0, "Scoreboard", f2_arg0 )
	end )
end

function ArmsRaceSquadScoreboard( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 920 * _1080p, 0, 285 * _1080p )
	self.id = "ArmsRaceSquadScoreboard"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local ScoreboardDarkener = nil
	
	ScoreboardDarkener = LUI.UIImage.new()
	ScoreboardDarkener.id = "ScoreboardDarkener"
	ScoreboardDarkener:SetRGBFromInt( 0, 0 )
	ScoreboardDarkener:SetAlpha( 0.45, 0 )
	ScoreboardDarkener:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, _1080p * -22, _1080p * 22 )
	self:addElement( ScoreboardDarkener )
	self.ScoreboardDarkener = ScoreboardDarkener
	
	local Backer = nil
	
	Backer = LUI.UIImage.new()
	Backer.id = "Backer"
	Backer:SetRGBFromTable( SWATCHES.HUD.vHUDDarkOutline, 0 )
	Backer:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 56, _1080p * -25, _1080p * 114, _1080p * 519 )
	self:addElement( Backer )
	self.Backer = Backer
	
	local Rows = nil
	
	Rows = LUI.UIImage.new()
	Rows.id = "Rows"
	Rows:SetRGBFromTable( SWATCHES.HUD.vHUDTertiary, 0 )
	Rows:setImage( RegisterMaterial( "v_ui_elmnt_tech_scoreboard_rows" ), 0 )
	Rows:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 60, _1080p * -30, _1080p * 119, _1080p * 523 )
	self:addElement( Rows )
	self.Rows = Rows
	
	local f1_local6 = nil
	if not CONDITIONS.IsArenaEvoGameType() then
		f1_local6 = MenuBuilder.BuildRegisteredType( "TeamStatusContainer", {
			controllerIndex = f1_local1
		} )
		f1_local6.id = "TeamStatusContainer"
		f1_local6:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -467, 0, _1080p * -7, _1080p * 57 )
		self:addElement( f1_local6 )
		self.TeamStatusContainer = f1_local6
	end
	local FriendlyMask = nil
	
	FriendlyMask = LUI.UIImage.new()
	FriendlyMask.id = "FriendlyMask"
	FriendlyMask:setImage( RegisterMaterial( "stencil_mask" ), 0 )
	FriendlyMask:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 8, _1080p * 902, _1080p * 114, _1080p * 280 )
	self:addElement( FriendlyMask )
	self.FriendlyMask = FriendlyMask
	
	local ScoreboardTitleRowFriendlyDivider = nil
	
	ScoreboardTitleRowFriendlyDivider = LUI.UIImage.new()
	ScoreboardTitleRowFriendlyDivider.id = "ScoreboardTitleRowFriendlyDivider"
	ScoreboardTitleRowFriendlyDivider:SetRGBFromTable( SWATCHES.HUD.vHUDTertiary, 0 )
	ScoreboardTitleRowFriendlyDivider:SetAlpha( 0.5, 0 )
	ScoreboardTitleRowFriendlyDivider:setImage( RegisterMaterial( "v_ui_elmnt_tech_separator" ), 0 )
	ScoreboardTitleRowFriendlyDivider:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 64, _1080p * 882, _1080p * 84, _1080p * 88 )
	self:addElement( ScoreboardTitleRowFriendlyDivider )
	self.ScoreboardTitleRowFriendlyDivider = ScoreboardTitleRowFriendlyDivider
	
	local ScoreboardTitleRowFriendly = nil
	
	ScoreboardTitleRowFriendly = MenuBuilder.BuildRegisteredType( "ScoreboardTitleRow", {
		controllerIndex = f1_local1
	} )
	ScoreboardTitleRowFriendly.id = "ScoreboardTitleRowFriendly"
	ScoreboardTitleRowFriendly:SetRGBFromTable( SWATCHES.HUD.vHUDTertiary, 0 )
	ScoreboardTitleRowFriendly:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 64, _1080p * 882, _1080p * 87, _1080p * 120 )
	self:addElement( ScoreboardTitleRowFriendly )
	self.ScoreboardTitleRowFriendly = ScoreboardTitleRowFriendly
	
	local SquadName = nil
	
	SquadName = LUI.UIStyledText.new()
	SquadName.id = "SquadName"
	SquadName:setText( "", 0 )
	SquadName:SetFont( FONTS.GetFont( FONT_STYLES.fontStyle_LHeaderBold.font.File ) )
	SquadName:SetFontSize( FONT_STYLES.fontStyle_LHeaderBold.size )
	SquadName:SetMinFontSize( FONT_STYLES.fontStyle_LHeaderBold.minSize )
	SquadName:SetWordWrap( false )
	SquadName:SetAlignment( LUI.Alignment.Left )
	SquadName:SetVerticalAlignment( LUI.Alignment.Center )
	SquadName:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 60, _1080p * 453, _1080p * -7, _1080p * 57 )
	self:addElement( SquadName )
	self.SquadName = SquadName
	
	local ButtonHelperBar = nil
	
	ButtonHelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	ButtonHelperBar.id = "ButtonHelperBar"
	ButtonHelperBar:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 920, _1080p * 291, _1080p * 339 )
	self:addElement( ButtonHelperBar )
	self.ButtonHelperBar = ButtonHelperBar
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ArmsRaceSquadScoreboard", ArmsRaceSquadScoreboard )
LockTable( _M )
