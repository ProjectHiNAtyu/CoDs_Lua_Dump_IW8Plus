-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
local f0_local0 = 500
local f0_local1 = {
	GAMEPAD = 2,
	MOUSE = 1
}
local f0_local2 = function ( f24_arg0, f24_arg1, f24_arg2 )
	if not f24_arg0._focusedButton then
		return 
	else
		local f24_local0
		if f24_arg2 == f0_local0.GAMEPAD then
			f24_local0 = Dvar[0xEDCFC612B39E0C0]( 0x7A7A6A53F7EEA9E )
			if not f24_local0 then
				f24_local0 = 2
			end
		else
			f24_local0 = Dvar[0xEDCFC612B39E0C0]( 0xBA5C25747DBF5A9 ) or 140
		end
	end
	f24_arg1 = f24_local0 * f24_arg1
	local f24_local1 = f24_arg0._focusedButton.unlockData
	local f24_local2 = f24_local1.rotationUpperLimit
	if not f24_local2 then
		f24_local2 = Dvar[0xEDCFC612B39E0C0]( 0x7C0AEE6B0263F12 ) or 70
	end
	local f24_local3 = f24_local1.rotationLowerLimit
	if not f24_local3 then
		f24_local3 = Dvar[0xEDCFC612B39E0C0]( 0x89CC896DB6C6D33 ) or -60
	end
	local f24_local4 = BATTLEMAP.GetBattlemapModels( f24_arg0._focusedButton.unlockData )
	if f24_local4 and f24_local4.index then
		local f24_local5 = ClientModel[0x7FE4C5AFE1F4377]( f24_local4.index, CLIENT_MODEL.defaultTags.INVALID )
		f24_local5.yAngle = LUI.clamp( f24_local5.yAngle + f24_arg1, f24_local4.angles.yAngle + f24_local3, f24_local4.angles.yAngle + f24_local2 )
		ClientModel[0xEFA1738E096A743]( f24_local4.index, f24_local5 )
		if f24_arg0._autoRotateModels and (f24_local5.yAngle <= f24_local3 or f24_local2 <= f24_local5.yAngle) then
			f24_arg0._directionModifier = f24_arg0._directionModifier * -1
		end
	end
end

local f0_local3 = function ( f22_arg0 )
	f22_arg0.rotationTimer = LUI.UITimer.new( {
		interval = 20,
		event = "modelRotateEvent"
	} )
	f22_arg0.rotationTimer.id = "rotationTimer"
	f22_arg0:addElement( f22_arg0.rotationTimer )
	f22_arg0._directionModifier = 1
	f22_arg0:addEventHandler( "modelRotateEvent", function ( f23_arg0, f23_arg1 )
		if f23_arg0._isRotationPaused and f23_arg0._waitTimer and f23_arg0._waitTimer < 100 then
			f23_arg0._waitTimer = f23_arg0._waitTimer + 20
		else
			f23_arg0._isRotationPaused = false
			if f22_arg0._reachedLimit then
				f22_arg0._directionModifier = f22_arg0._directionModifier * -1
			end
			f23_arg0:RotateDiorama( 0.1 * f22_arg0._directionModifier, f22_arg0.GAMEPAD )
		end
	end )
end

local f0_local4 = function ( f21_arg0 )
	local f21_local0, f21_local1 = BATTLEMAP.GetNumberOfCompleteSectorsAndRewards( f21_arg0._controllerIndex )
	if f21_local0 == 1 and f21_arg0._mapMenu then
		local f21_local2 = CONDITIONS.IsMobileOrMobileSim() and LUI.FlowManager.GetScopedData( f21_arg0 ) or LUI.FlowManager.GetMainScopedData()
		f21_local2.state = BATTLEMAP.SectorMapState.UNLOCK
	end
end

local f0_local5 = nil
f0_local5 = function ( f13_arg0, f13_arg1, f13_arg2 )
	f13_arg0._state = f13_arg2
	local f13_local0 = function ( f20_arg0, f20_arg1 )
		f13_arg0:SetMouseFocusBlocker( f20_arg0 )
		if f13_arg0._focusedButton then
			if f20_arg1 then
				local f20_local0 = f13_arg0._focusedButton
				local f20_local1 = f20_local0
				f20_local0 = f20_local0.processEvent
				local f20_local2 = {}
				local f20_local3
				if f20_arg0 then
					f20_local3 = "button_up"
				else
					f20_local3 = "button_over"
				end
				f20_local2.name = f20_local3
				f20_local2.controller = f13_arg0
				f20_local0( f20_local1, f20_local2 )
			end
			f13_arg0._focusedButton:SetButtonDisabled( f20_arg0 )
		end
	end
	
	if f13_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_INDIVIDUAL_WAIT then
		if f13_arg0._focusedButton then
			f13_arg0._focusedButton:SetPrimaryPrompt( nil )
		end
		f13_local0( true, false )
		if f13_arg0._focusedButton then
			ACTIONS.AnimateSequence( f13_arg0._focusedButton, "ShowSpinner" )
		end
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_INDIVIDUAL then
		f13_local0( true, false )
		Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpHVTVFX )
		if not f13_arg0._isPremium and f13_arg0._focusedButton and f13_arg0._focusedButton._isFree then
			Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpSmallFreeUnlock )
		else
			Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpSmallUnlock )
		end
		if f13_arg0._focusedButton then
			ACTIONS.AnimateSequence( f13_arg0._focusedButton, "HideSpinner" )
			if f13_arg0._focusedButton.CelebrationSprite then
				f13_arg0._focusedButton.CelebrationSprite:SetVisible( true )
				f13_arg0._focusedButton.CelebrationSprite.SpriteSheet:SetBlendMode( BLEND_MODE.addWithAlpha )
				local f13_local1 = f13_arg0._focusedButton.CelebrationSprite
				local f13_local2 = f13_local1
				f13_local1 = f13_local1.SetColorOpParam
				local f13_local3
				if f13_arg0._isPremium then
					f13_local3 = 1
				else
					f13_local3 = 0
				end
				f13_local1( f13_local2, f13_local3 )
				f13_arg0._focusedButton.CelebrationSprite:Play( {
					onCompleteCallback = function ()
						if f13_arg0._focusedButton.CelebrationSprite then
							f13_arg0._focusedButton.CelebrationSprite:SetVisible( false )
						end
					end
				} )
			end
		end
		f13_arg0.InspectPanel:SetupInspectPanel( f13_arg1, f13_arg0._isPremium, f13_arg0._isComplete, f13_arg0._sectorIndex, f13_arg0, true )
		f13_arg0.InspectPanel:ShowUnlockEffect( f13_arg0._focusedButton.unlockData )
		f13_arg0:UpdatePreviewMapState( f13_arg1, BATTLEMAP.SectorPreviewState.NORMAL )
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_HVT then
		f13_local0( true, false )
		Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpHVTVFX )
		if not f13_arg0._isPremium and f13_arg0._focusedButton and f13_arg0._focusedButton._isFree then
			Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpHVTFreeUnlock )
		else
			Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpHVTUnlock )
		end
		if f13_arg0._focusedButton then
			ACTIONS.AnimateSequence( f13_arg0._focusedButton, "HideSpinner" )
			if f13_arg0._focusedButton.CelebrationSprite then
				f13_arg0._focusedButton.CelebrationSprite:SetVisible( true )
				f13_arg0._focusedButton.CelebrationSprite.SpriteSheet:SetBlendMode( BLEND_MODE.addWithAlpha )
				local f13_local1 = f13_arg0._focusedButton.CelebrationSprite
				local f13_local2 = f13_local1
				f13_local1 = f13_local1.SetColorOpParam
				local f13_local3
				if f13_arg0._isPremium then
					f13_local3 = 1
				else
					f13_local3 = 0
				end
				f13_local1( f13_local2, f13_local3 )
				f13_arg0._focusedButton.CelebrationSprite:Play( {
					onCompleteCallback = function ()
						if f13_arg0._mapMenu then
							local f18_local0 = CONDITIONS.IsMobileOrMobileSim() and LUI.FlowManager.GetScopedData( f13_arg0 ) or LUI.FlowManager.GetMainScopedData()
							f18_local0.state = BATTLEMAP.SectorMapState.UNLOCK
						end
						f13_arg0:UpdatePreviewMapState( f13_arg0, BATTLEMAP.SectorPreviewState.NORMAL )
					end
				} )
			end
		end
		f13_arg0.InspectPanel:SetupInspectPanel( f13_arg1, f13_arg0._isPremium, f13_arg0._isComplete, f13_arg0._sectorIndex, f13_arg0, true )
		f13_arg0.InspectPanel:ShowUnlockEffect( f13_arg0._focusedButton.unlockData )
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.PREVIEW_OUTRO then
		f13_local0( true, false )
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.FIXING_UP then
		f13_local0( true, false )
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_SECTOR_WAIT then
		if f13_arg0._focusedButton then
			f13_arg0._focusedButton:SetPrimaryPrompt( nil )
		end
		f13_local0( true, true )
		local f13_local1 = f13_arg0.InspectPanel.SectorUnlocksGrid:GetBuiltChildren()
		table.insert( f13_local1, f13_arg0.InspectPanel.SectorMainUnlock )
		for f13_local5, f13_local6 in ipairs( f13_local1 ) do
			if f13_local6.unlockData and not f13_local6.unlockData.isOwned then
				ACTIONS.AnimateSequence( f13_local6, "ShowSpinner" )
			end
		end
	elseif f13_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_SECTOR then
		f13_local0( true, true )
		Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpHVTVFX )
		Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpClaimSectorPreview )
		f13_arg0.TokenWidget:UpdateTokenWidget( f13_arg0._isPremium, f13_arg0._isComplete )
		f13_arg0.TokenWidget:PlayUpdateAnim()
		f0_local0( f13_arg0 )
		local f13_local1 = function ( f16_arg0, f16_arg1 )
			ACTIONS.AnimateSequence( f13_arg0._focusedButton, "HideSpinner" )
			if f16_arg0.CelebrationSprite then
				f16_arg0.CelebrationSprite:SetVisible( true )
				f16_arg0.CelebrationSprite.SpriteSheet:SetBlendMode( BLEND_MODE.addWithAlpha )
				local f16_local0 = f16_arg0.CelebrationSprite
				local f16_local1 = f16_local0
				f16_local0 = f16_local0.SetColorOpParam
				local f16_local2
				if f13_arg0._isPremium then
					f16_local2 = 1
				else
					f16_local2 = 0
				end
				f16_local0( f16_local1, f16_local2 )
				f16_local0 = function ()
					if f16_arg0.CelebrationSprite then
						f16_arg0.CelebrationSprite:SetVisible( false )
					end
				end
				
				f16_arg0.CelebrationSprite:Play( {
					onCompleteCallback = f16_arg1
				} )
			end
		end
		
		for f13_local6, f13_local7 in ipairs( f13_arg0.InspectPanel.SectorUnlocksGrid:GetBuiltChildren() ) do
			f13_local1( f13_local7, function ()
				if f13_arg0._focusedButton.CelebrationSprite then
					f13_arg0._focusedButton.CelebrationSprite:SetVisible( false )
				end
			end )
		end
		f13_local1( f13_arg0.InspectPanel.SectorMainUnlock, function ()
			if f13_arg0._mapMenu then
				local f14_local0 = CONDITIONS.IsMobileOrMobileSim() and LUI.FlowManager.GetScopedData( f13_arg0 ) or LUI.FlowManager.GetMainScopedData()
				f14_local0.state = BATTLEMAP.SectorMapState.UNLOCK
			end
			f13_arg0:UpdatePreviewMapState( f13_arg0, BATTLEMAP.SectorPreviewState.NORMAL )
		end )
		f13_arg0.InspectPanel:SetupInspectPanel( f13_arg1, f13_arg0._isPremium, f13_arg0._isComplete, f13_arg0._sectorIndex, f13_arg0, true, nil, true )
		f13_arg0.InspectPanel.SectorMainUnlock:processEvent( {
			name = "button_over",
			controller = f13_arg1
		} )
		f13_arg0.InspectPanel:ShowUnlockEffect( f13_arg0._focusedButton.unlockData )
		f13_arg0:UpdatePreviewMapState( f13_arg1, BATTLEMAP.SectorPreviewState.NORMAL )
	else
		f13_local0( false, true )
		local f13_local1 = f13_arg0.InspectPanel.SectorUnlocksGrid:GetBuiltChildren()
		table.insert( f13_local1, f13_arg0.InspectPanel.SectorMainUnlock )
		for f13_local5, f13_local6 in ipairs( f13_local1 ) do
			ACTIONS.AnimateSequence( f13_local6, "HideSpinner" )
		end
		f13_arg0.BattlePassPurchaseButton:UpdateButtonState( f13_arg1, f13_arg0._isPremium, f13_arg0._isComplete, f13_arg0._needFixUp )
		f13_arg0.TokenWidget:UpdateTokenWidget( f13_arg0._isPremium, f13_arg0._isComplete )
		f13_arg0.InspectPanel._isUnlocking = false
	end
end

local f0_local6 = nil
f0_local6 = function ( f12_arg0 )
	if f12_arg0._state == BATTLEMAP.SectorPreviewState.UNLOCK_INDIVIDUAL_WAIT then
		f12_arg0.TokenWidget:UpdateTokenWidget( f12_arg0._isPremium, f12_arg0._isComplete )
		f12_arg0.TokenWidget:PlayUpdateAnim()
		if f12_arg0._focusedButton and f12_arg0._focusedButton._isHVT then
			f12_arg0:UpdatePreviewMapState( f12_arg0._controllerIndex, BATTLEMAP.SectorPreviewState.UNLOCK_HVT )
		else
			Engine[0xC4146BA76D0F982]( SOUND_SETS.battlePass.bpPurchaseIndividual )
			f12_arg0:UpdatePreviewMapState( f12_arg0._controllerIndex, BATTLEMAP.SectorPreviewState.UNLOCK_INDIVIDUAL )
		end
	end
end

local f0_local7 = function ( f9_arg0 )
	if CONDITIONS[0x2F9F94DF6F92292]() and CONDITIONS.EnableDioramaUpdatePosition() then
		
	else
		
	end
	f9_arg0._lastMouseX = nil
	if not f9_arg0.KbmRotatorZone then
		local f9_local0 = Engine[0x8B8310D828196D1]()
		local DebugMouseRotateZone = LUI.UIButton.new()
		DebugMouseRotateZone.id = "kbmRotatorZone"
		DebugMouseRotateZone:SetAnchorsAndPosition( 0, 1, 0, 1, 500, f9_local0, 120, 960 )
		DebugMouseRotateZone:SetFocusable( false )
		DebugMouseRotateZone:setActionSFX( nil )
		f9_arg0:addElement( DebugMouseRotateZone )
		f9_arg0.KbmRotatorZone = DebugMouseRotateZone
		
		LUI.UIMouseCursor.SetAndUpdateEventMouseCursorTypes( DebugMouseRotateZone, f9_arg0._controllerIndex, MouseCursorType.CURSOR_TYPE_MOVE_HOVER, MouseCursorType.CURSOR_TYPE_MOVE_CLICK )
		DebugMouseRotateZone:addEventHandler( "button_action", function ( f11_arg0, f11_arg1 )
			f9_arg0._lastMouseX = nil
		end )
		DebugMouseRotateZone:registerEventHandler( "mousedrag", function ( self, event )
			if f9_arg0._state ~= BATTLEMAP.SectorPreviewState.NORMAL then
				return true
			end
			event.x = event.x
			local f10_local0 = f9_arg0.KbmRotatorZone:GetAnchorsAndPosition()
			if not f9_arg0._lastMouseX or f9_arg0._lastMouseX < f10_local0.left or f10_local0.right < f9_arg0._lastMouseX then
				f9_arg0._lastMouseX = event.x
			end
			f9_arg0._isRotationPaused = true
			f9_arg0._waitTimer = 0
			f9_arg0( f9_arg0, (event.x - f9_arg0._lastMouseX) / f9_arg0, f9_arg0.MOUSE )
			f9_arg0._lastMouseX = event.x
			return true
		end )
	end
	if CONDITIONS[0x2F9F94DF6F92292]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x8F1D7C30B0A8807 ) then
		if not f9_arg0.DebugMouseRotateZone then
			local f9_local0 = f9_arg0.KbmRotatorZone:GetAnchorsAndPosition()
			
			local DebugMouseRotateZone = LUI.UIImage.new()
			DebugMouseRotateZone:SetRGB( COLORS.green )
			DebugMouseRotateZone:SetAnchorsAndPosition( f9_local0.leftAnchor, f9_local0.rightAnchor, f9_local0.topAnchor, f9_local0.bottomAnchor, f9_local0.left, f9_local0.right, f9_local0.top, f9_local0.bottom )
			DebugMouseRotateZone:SetAlpha( 0.5, 0 )
			f9_arg0:addElement( DebugMouseRotateZone )
			f9_arg0.DebugMouseRotateZone = DebugMouseRotateZone
			
		end
	elseif f9_arg0.DebugMouseRotateZone then
		f9_arg0.DebugMouseRotateZone:closeTree()
		f9_arg0.DebugMouseRotateZone = nil
	end
end

local f0_local8 = function ( f8_arg0, f8_arg1, f8_arg2 )
	if f8_arg0.RotationSetupWidget then
		f8_arg0.RotationSetupWidget:UpdateCameraDefaultPosition( f8_arg1, f8_arg2 )
	end
end

local f0_local9 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdatePreviewMapState = f0_local0
	f3_arg0.CelebrateSpendToken = f0_local0
	f3_arg0.UpdateCameraDefaultPosition = f0_local0
	f3_arg0.menuEnterTime = CoD.GetUTC()
	BATTLEMAP.SendBattleMapNavDlogEvent( f3_arg0, f3_arg1, "Sector Inspect Menu", "Entering sector" .. tostring( f3_arg2.sectorIndex ) )
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0._mapMenu = f3_arg2.mapMenu
	f3_arg0._isOnboarding = f3_arg2.isOnboarding
	if not CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0:UpdatePreviewMapState( f3_arg1, BATTLEMAP.SectorPreviewState.PREVIEW_OUTRO )
	end
	if not f3_arg2.sectorIndex then
		f3_arg2.sectorIndex = 1
	end
	f3_arg0._sectorIndex = f3_arg2.sectorIndex
	f3_arg0._isPremium = f3_arg2.isPremium
	f3_arg0._isComplete = f3_arg2.isComplete
	f3_arg0._needFixUp = f3_arg2.needFixUp
	f3_arg0.MenuTitle:SetTitle( " " )
	if f3_arg0.MenuTitle.Line then
		f3_arg0.MenuTitle.Line:SetVisible( false )
	end
	f3_arg0:addEventHandler( "gain_focus", function ( f7_arg0, f7_arg1 )
		f7_arg0.InspectPanel:processEvent( {
			name = "gain_focus",
			controller = f7_arg1.controller
		} )
		return true
	end )
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0:addEventHandler( "gamepad_button", function ( f6_arg0, f6_arg1 )
			if f3_arg0._state ~= BATTLEMAP.SectorPreviewState.NORMAL then
				return true
			elseif f6_arg1.button == "alt1" then
				f6_arg0.BattlePassPurchaseButton:ShowPurchasePopup( f3_arg0 )
				return true
			elseif f6_arg1.qualifier ~= "mousewheel" then
				return 
			else
				local f6_local0
				if f6_arg1.button == "down" then
					f6_local0 = 1
				else
					f6_local0 = 0
				end
			end
			f3_arg0._isRotationPaused = true
			f3_arg0._waitTimer = 0
			f3_arg0( f3_arg0, f6_local0, f3_arg0.MOUSE )
		end )
	else
		f0_local0( f3_arg0 )
	end
	f3_arg0:registerEventHandler( "gamepad_button", function ( element, event )
		if element._state ~= BATTLEMAP.SectorPreviewState.NORMAL then
			return true
		elseif event.button == "alt1" then
			element.BattlePassPurchaseButton:ShowPurchasePopup( f3_arg0._controllerIndex )
			return true
		else
			
		end
	end )
	f3_arg0.InspectPanel:SetupInspectPanel( f3_arg1, f3_arg0._isPremium, f3_arg0._isComplete, f3_arg0._sectorIndex, f3_arg0, false, f3_arg0._isOnboarding )
	f3_arg0.BattlePassPurchaseButton:UpdateButtonState( f3_arg1, f3_arg0._isPremium, f3_arg0._isComplete, f3_arg0._needFixUp )
	local f3_local0 = LUI.DataSourceInControllerModel.new( "stick.r.notify" )
	f3_arg0:SubscribeToModel( f3_local0:GetModel( f3_arg0._controllerIndex ), function ()
		local f4_local0 = {}
		local f4_local1 = LUI.DataSourceInControllerModel.new( "stick.r.x" )
		f4_local0.rightStickYaw = f4_local1:GetValue( f3_arg0._controllerIndex )
		f3_arg0._isRotationPaused = true
		f3_arg0._waitTimer = 0
		f3_arg0( f3_arg0, f4_local0.rightStickYaw, f3_arg0.GAMEPAD )
	end, true )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.RotateText:setText( Engine[0xED84C33EC5F01EA]( 0xB9C0235DC08AD56 ), 0 )
		f3_arg0.RotateText:setCaseStyle( LUI.CaseStyle.Uppercase )
	end
end

local f0_local10 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
	f2_arg0.RotateDiorama = f0_local0
	f2_arg0:SetHandleMouseMove( true )
	f2_arg0:SetHandleMouseButton( true )
	f2_arg0._autoRotateModels = Dvar[0x9E5BE3B4BBA4E0E]( 0x57FF8665C534F4E )
	if f2_arg0._autoRotateModels then
		f0_local0( f2_arg0 )
	end
end

function BattleMapSectorPreviewBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIMenu.new()
	f1_local1.id = "BattleMapSectorPreviewBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f1_local2 = f1_local0.ValidateControllerIndex( f1_local1, f1_local2 )
	local f1_local3 = f1_local1
	f0_local0( f1_local1, f1_local2, f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0x3ACEDDD66DB60DE, BattleMapSectorPreviewBase )
LockTable( _M )
