-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
PostGameFanfare = {
	states = {
		AAR_SUMMARY = 0,
		AAR_CP_POINTS = 1,
		AAR_VALIDATE_DMZ_LOADOUT = 2,
		AAR_START = 4294967295
	}
}
local f0_local0 = function ( f6_arg0, f6_arg1 )
	f6_arg0._state = f6_arg1
	if f6_arg0._state == PostGameFanfare.states.AAR_SUMMARY then
		Lobby.OpenAfterActionReport( f6_arg0._controllerIndex, false, true, nil, f6_arg0._forceOpenAAR )
	end
	if f6_arg0._state == PostGameFanfare.states.AAR_CP_POINTS then
		Lobby.OpenAfterActionReport( f6_arg0._controllerIndex, false, false, true )
	end
	if f6_arg0._state == PostGameFanfare.states.AAR_VALIDATE_DMZ_LOADOUT then
		DMZ.Validate( f6_arg0._controllerIndex )
	end
end

local f0_local1 = function ( f5_arg0, f5_arg1 )
	if f5_arg0._state == f5_arg1 then
		local f5_local0
		if BATTLEMAP.UseJUPBattleMapDesign() then
			f5_local0 = "JupAARContainer"
		else
			f5_local0 = GAMEMODE_SCRIPTBUNDLE_UTILS.GetFrontendAARMenuLuaName()
		end
		local f5_local1 = LUI.FlowManager.GetMenuByName( f5_local0 )
		if f5_local1 then
			local f5_local2 = f5_local1
		elseif f5_local1.scopedData then
			local f5_local2 = f5_local1.scopedData.displaySummary
		end
		LUI.FlowManager.RequestLeaveMenuByName( f5_local0, true )
	end
	f5_arg0._state = nil
end

local f0_local2 = function ( f4_arg0, f4_arg1 )
	if f4_arg1 == nil then
		f0_local0( f4_arg0, f4_arg0._state )
	end
	f0_local0( f4_arg0, f4_arg1 )
end

PostGameFanfare.start = function ( f3_arg0 )
	f3_arg0._forceOpenAAR = false
	f0_local0( f3_arg0, PostGameFanfare.states.AAR_START )
	f3_arg0._controllerIndex = Engine[0x45B054C920178E9]()
	InitAARDataSources( f3_arg0._controllerIndex )
	f3_arg0:advance()
end

PostGameFanfare.debugStart = function ( f2_arg0 )
	f2_arg0._forceOpenAAR = true
	f0_local0( f2_arg0, PostGameFanfare.states.AAR_START )
	f2_arg0._controllerIndex = Engine[0x45B054C920178E9]()
	InitAARDataSources( f2_arg0._controllerIndex )
	f2_arg0:advance()
end

PostGameFanfare.advance = function ( f1_arg0 )
	if f1_arg0._state == nil then
		local f1_local0
		if BATTLEMAP.UseJUPBattleMapDesign() then
			f1_local0 = "JupAARContainer"
		else
			f1_local0 = GAMEMODE_SCRIPTBUNDLE_UTILS.GetFrontendAARMenuLuaName()
		end
		local f1_local1 = LUI.FlowManager.GetMenuByName( f1_local0 )
		if f1_local1 then
			local f1_local2 = f1_local1
		elseif f1_local1.scopedData then
			local f1_local2 = f1_local1.scopedData.displaySummary
		end
		LUI.FlowManager.RequestLeaveMenuByName( f1_local0, true )
		return 
	end
	local f1_local0 = f1_arg0._controllerIndex == Engine[0x45B054C920178E9]()
	if f1_arg0._state < PostGameFanfare.states.AAR_SUMMARY then
		f0_local0( f1_arg0, PostGameFanfare.states.AAR_SUMMARY )
		return 
	elseif f1_arg0._state < PostGameFanfare.states.AAR_CP_POINTS and Dvar[0x54084D7CA2317BB]( 0x65E9A96EB2FF62B ) == CP.SPEC_OPS and Dvar[0x9E5BE3B4BBA4E0E]( 0xB4EABBC563514D1 ) then
		f0_local0( f1_arg0, PostGameFanfare.states.AAR_CP_POINTS )
		return 
	elseif f1_arg0._state < PostGameFanfare.states.AAR_VALIDATE_DMZ_LOADOUT and CoD.IsDMZMatch() then
		f0_local0( f1_arg0, PostGameFanfare.states.AAR_VALIDATE_DMZ_LOADOUT )
		return 
	end
	local f1_local1 = f1_arg0._controllerIndex
	local f1_local2 = Engine[0xB686A0A723E6442]() - 1
	for f1_local3 = f1_arg0._controllerIndex + 1, f1_local2, 1 do
		if Engine[0x10A5732AB1DAE9F]( f1_local3 ) then
			f1_arg0._controllerIndex = f1_local3
			break
		end
	end
	f0_local0( f1_arg0, nil )
	if f1_arg0._controllerIndex ~= f1_local1 then
		f1_arg0._state = PostGameFanfare.states.AAR_START
		return f1_arg0:advance()
	end
	local f1_local3 = Engine[0x45B054C920178E9]()
	if Engine[0x220CB915CEFC1FE]() and not Engine[0x8B495DC361731F7]( f1_local3 ) and CONDITIONS.IsMagmaEnabled() and Dvar[0x9E5BE3B4BBA4E0E]( 0x9744FE656AB5E62 ) and not CONDITIONS.IsBRGameType() then
		local f1_local6 = PLAYER_DATA.IO( f1_local3, CoD.StatsGroup.Ranked )
		if f1_local6.pulsedPlaylistActive and f1_local6.pulsedPlaylistActive:get() == 1 and f1_local6.pulsedMatchesPlayed then
			local f1_local7 = f1_local6.pulsedMatchesPlayed:get() + 1
			local f1_local8 = Dvar[0x22EAAB59AA27E9B]( 0x8247D82BDC1AC86 )
			if f1_local8 and f1_local8 == f1_local7 then
				LUI.FlowManager.RequestPopupMenu( f1_arg0, "MagmaUpsellPopup", true, f1_local3, false, nil )
			end
			f1_local6.pulsedMatchesPlayed:set( f1_local7 )
			ACTIONS.UploadStats( f1_arg0, f1_local3 )
		end
	end
end

