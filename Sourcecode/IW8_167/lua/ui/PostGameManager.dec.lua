-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
LUI.PostGameManager = LUI.Class( LUI.UIElement )
PostGameState = {
	SCOREBOARD = 5,
	INACTIVE = 0,
	BROSHOT = 7,
	CLASSIC_REWARDSCREEN = 11,
	POTG = 4,
	FINAL_KILLCAM = 3,
	BR_END_SPLASH = 9,
	ACTIVE = 1,
	GAMEBATTLE_RESULT = 6,
	CP_RETRY_POPUP = 10,
	ROUND_END = 2,
	NUKE_TOTAL_WHITE = 12,
	TAC_OPS_INTERMISSION = 8,
	NUKE_BNK = 13,
	SHOW_INGAME_AAR = 14,
	SHOW_WINNERS = 15
}
LUI.PostGameManager.init = function ( f15_arg0, f15_arg1 )
	LUI.UIElement.init( f15_arg0 )
	assert( f15_arg1 )
	f15_arg0._controllerIndex = f15_arg1
	f15_arg0.id = "PostGameManager"
end

LUI.PostGameManager.ShouldBeVisible = function ( f14_arg0 )
	local f14_local0 = Engine.EAAHGICFBD()
	if f14_local0 then
		f14_local0 = Game.HJHDJDCBF()
		if f14_local0 then
			f14_local0 = f14_arg0.IsPostGame( f14_arg0._controllerIndex )
		end
	end
	return f14_local0
end

LUI.PostGameManager.IsHidden = function ( f13_arg0 )
	local f13_local0 = DataSources.inGame.HUD.isScoreboardOpen:GetValue( f13_arg0._controllerIndex )
	if Engine.ECHCFGDDDF() and not f13_local0 then
		f13_local0 = AnyActiveMenusInStack( Engine.DBFFAEEFGJ() )
	end
	return f13_local0
end

LUI.PostGameManager.UpdateAlpha = function ( f12_arg0 )
	local f12_local0 = f12_arg0
	local f12_local1 = f12_arg0.SetAlpha
	local f12_local2
	if f12_arg0:IsHidden() then
		f12_local2 = 0
	else
		f12_local2 = 1
	end
	f12_local1( f12_local0, f12_local2 )
end

LUI.PostGameManager.InitLayer = function ( f8_arg0 )
	f8_arg0.showing = PostGameState.INACTIVE
	f8_arg0:registerOmnvarHandler( "post_game_state", function ( f11_arg0 )
		f11_arg0:Refresh()
	end )
	assert( not f8_arg0._subscriptionToScoreboard )
	f8_arg0._subscriptionToScoreboard = f8_arg0:SubscribeToModel( DataSources.inGame.HUD.isScoreboardOpen:GetModel( f8_arg0._controllerIndex ), function ( f10_arg0 )
		f8_arg0:UpdateAlpha()
	end )
	if Engine.ECHCFGDDDF() then
		f8_arg0:registerEventHandler( "pause", function ( element, event )
			LUI.FlowManager.RequestAddMenu( CoD.GetPauseMenu(), true, event.controllerIndex, false )
			f8_arg0:UpdateAlpha()
		end )
		f8_arg0:registerEventHandler( "empty_menu_stack", f8_arg0.UpdateAlpha )
		f8_arg0:registerEventHandler( "non_empty_menu_stack", f8_arg0.UpdateAlpha )
	end
	f8_arg0:Refresh()
end

LUI.PostGameManager.ClearLayer = function ( f6_arg0, f6_arg1 )
	f6_arg0:Refresh()
	f6_arg0:closeChildren()
	f6_arg0:registerOmnvarHandler( "post_game_state", function ()
		
	end )
	if f6_arg0._subscriptionToScoreboard then
		f6_arg0:UnsubscribeFromModel( f6_arg0._subscriptionToScoreboard )
		f6_arg0._subscriptionToScoreboard = nil
	end
	if LUI.PostGameManager.wasInFinalKillcam then
		local f6_local0 = Engine.DBFFAEEFGJ()
		f6_local0.inWorldManager:EndFinalKillcam()
		LUI.PostGameManager.wasInFinalKillcam = false
	end
end

LUI.PostGameManager.IsPostGame = function ( f5_arg0 )
	if Engine.EAAHGICFBD() and Game.HJHDJDCBF() then
		return Game.BFEEGCHICA( f5_arg0, "post_game_state" ) ~= PostGameState.INACTIVE
	else
		return false
	end
end

LUI.PostGameManager.IsBRExfilStarted = function ( f4_arg0 )
	if CONDITIONS.IsMagmaGameMode() then
		if Game.BFEEGCHICA( f4_arg0, "ui_br_end_game_splash_type" ) then
			return 12 < Game.BFEEGCHICA( f4_arg0, "ui_br_end_game_splash_type" )
		else
			return false
		end
	else
		return false
	end
end

LUI.PostGameManager.FinalizeCPGame = function ( f3_arg0 )
	if f3_arg0._finalizedCPGame then
		DebugPrint( "CP Game already done" )
		return 
	elseif not Engine.EAIICIFIFA() or not CONDITIONS.IsAliensOnline( f3_arg0 ) then
		DebugPrint( " Not CP Mode or Not Online" )
		return 
	elseif not Engine.JCFIBGGJB() then
		DebugPrint( "No client data" )
		return 
	else
		f3_arg0._finalizedCPGame = true
	end
end

LUI.PostGameManager.FinalizeMission = function ( f2_arg0 )
	if not f2_arg0._dlogRecordingDone then
		METRICS.MatchEndDLogRecording( f2_arg0._controllerIndex )
		f2_arg0._dlogRecordingDone = true
	end
	if f2_arg0._finalizedMission then
		DebugPrint( "Mission already finalized" )
		return 
	elseif Engine.EAIICIFIFA() or not Dvar.IBEGCHEFE( "LTSNLQNRKO" ) then
		DebugPrint( " Aliens Mode or Not Online" )
		return 
	elseif not Engine.JCFIBGGJB() or not CONDITIONS.IsPublicMatch() then
		DebugPrint( "No client data and Not Public Match" )
		return 
	elseif MissionUtils.GetFlowState() == MissionUtils.FlowState.PRE_INIT then
		DebugPrint( "Mission State is PRE_INIT - " .. MissionUtils.FlowState.PRE_INIT )
		return 
	end
	local f2_local0 = f2_arg0._controllerIndex
	local f2_local1 = PlayerData.BFFBGAJGD( f2_local0, CoD.StatsGroup.Common )
	local f2_local2 = f2_local1.round.scoreboardType:get()
	if f2_local2 == "none" then
		DebugPrint( "Scoreboard Type is None" )
		return 
	end
	DebugPrint( "LUI.PostGameManager.FinalizeMission" )
	local f2_local3 = 0
	local f2_local4 = 0
	local f2_local5 = Engine.EAIADADAIH( "scoreboardPlayerCount" )
	local f2_local6 = ""
	if Engine.DHCFHGIABE then
		f2_local6 = Engine.DHCFHGIABE( f2_local0 )
		DebugPrint( "Searching for user " .. f2_local6 )
	end
	if f2_local5 ~= nil and 0 < f2_local5 then
		for f2_local7 = 1, f2_local5, 1 do
			DebugPrint( "Looking at " .. f2_local7 )
			DebugPrint( "Scoreboard Type " .. f2_local2 )
			local f2_local10 = Engine.EAIADADAIH( "scoreboards", ComputeScoreboardSlot( f2_local2, f2_local7 - 1 ) )
			DebugPrint( "Player " .. f2_local10 )
			if 0 <= f2_local10 then
				local f2_local11 = Engine.EAIADADAIH( "players", f2_local10, "username" )
				DebugPrint( "Found Player " .. f2_local11 )
				if f2_local11 == f2_local6 then
					f2_local3 = f2_local1.round.timePlayed:get()
					DebugPrint( "Timeplayed " .. f2_local3 )
					local f2_local12 = Engine.EAIADADAIH( "players", f2_local10, "team" )
					local f2_local13 = Engine.EAIADADAIH( "axisScore" )
					local f2_local14 = Engine.EAIADADAIH( "alliesScore" )
					if f2_local12 == "axis" then
						if f2_local14 <= f2_local13 then
							DebugPrint( "Axis Win" )
							f2_local4 = 1
							break
						end
					elseif f2_local12 == "allies" and f2_local13 <= f2_local14 then
						DebugPrint( "Allies Win" )
						f2_local4 = 1
						break
					end
				end
			end
		end
	end
	DebugPrint( "Post Game" .. f2_local3 .. " Result " .. f2_local4 )
	for f2_local7 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		if Engine.BBHAECABBD( f2_local7 ) then
			Engine.FEDEBFDHD( "post_game", {
				controllerIndex = f2_local7,
				timePlayed = f2_local3,
				result = f2_local4
			} )
		end
	end
	DebugPrint( " Setting Mission State to MISSION_OVER - " .. MissionUtils.FlowState.MISSION_OVER )
	MissionUtils.SetFlowState( MissionUtils.FlowState.MISSION_OVER )
	f2_arg0._finalizedMission = true
end

LUI.PostGameManager.Refresh = function ( f1_arg0 )
	if f1_arg0._videoPlaying and not CONDITIONS.IsNukeEndState( f1_arg0, f1_arg0._controllerIndex ) then
		Engine.EBCGADABJ()
		f1_arg0._videoPlaying = false
	end
	local f1_local0 = Game.BFEEGCHICA( f1_arg0._controllerIndex, "post_game_state" )
	DebugPrint( "########post_game_state value = " .. f1_local0 or "" )
	if not CONDITIONS.InGameAndBR() and not CONDITIONS.InGameAndBRTDM() and not f1_arg0.menuChatSetup and f1_local0 ~= PostGameState.INACTIVE then
		LUI.HUD.AllowChatInHUD()
		f1_arg0.menuChatSetup = true
	elseif f1_local0 == PostGameState.INACTIVE and f1_arg0.menuChatSetup then
		LUI.HUD.DisallowChatInHUD()
		f1_arg0.menuChatSetup = false
	end
	if f1_local0 ~= f1_arg0.showing then
		f1_arg0:closeChildren()
		if f1_local0 == PostGameState.ROUND_END then
			local f1_local1 = nil
			if not CONDITIONS.IsBRGameType( f1_arg0 ) then
				if Engine.ECHCFGDDDF() then
					if GameX.gameModeIsFFA() then
						f1_local1 = MenuBuilder.BuildRegisteredType( "RoundEndFFAHUD", {
							controllerIndex = f1_arg0._controllerIndex
						} )
					else
						if CONDITIONS.IsInTrialEvent() then
							f1_local1 = MenuBuilder.BuildRegisteredType( "RoundEndTrialEvent", {
								controllerIndex = f1_arg0._controllerIndex
							} )
						else
							f1_local1 = MenuBuilder.BuildRegisteredType( "RoundEndTeamHUD", {
								controllerIndex = f1_arg0._controllerIndex
							} )
						end
						f1_arg0._videoPlaying = true
					end
				elseif CONDITIONS.IsThirdGameMode() then
					f1_local1 = MenuBuilder.BuildRegisteredType( "RoundEndTeamHUD", {
						controllerIndex = f1_arg0._controllerIndex
					} )
					f1_arg0._videoPlaying = true
				end
				if f1_local1 then
					f1_arg0:addElement( f1_local1 )
				end
			end
		elseif f1_local0 == PostGameState.FINAL_KILLCAM or f1_local0 == PostGameState.POTG then
			local f1_local2 = MP.IsRoundEndTitleEndOfMatch( DataSources.inGame.MP.roundEnd.roundEndTitleIndex:GetValue( f1_arg0._controllerIndex ) )
			local f1_local3 = not f1_local2
			local f1_local4 = f1_local0 == PostGameState.POTG
			local f1_local5 = f1_local0 == PostGameState.FINAL_KILLCAM
			if f1_local4 then
				f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "PlayOfTheGame", {
					controllerIndex = f1_arg0._controllerIndex,
					isFinal = f1_local2,
					isRoundEnd = f1_local3,
					isPOTG = f1_local4
				} ) )
			elseif f1_local5 then
				LUI.PostGameManager.wasInFinalKillcam = true
				f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "Killcam", {
					controllerIndex = f1_arg0._controllerIndex,
					isFinal = f1_local2,
					isRoundEnd = f1_local3,
					isPOTG = f1_local4
				} ) )
				local f1_local6 = Engine.DBFFAEEFGJ()
				f1_local6.inWorldManager:StartFinalKillcam()
			end
		elseif f1_local0 == PostGameState.SCOREBOARD then
			local f1_local1 = Dvar.DHEEJCCJBH( "MOLPOSLOMO" )
			if Engine.EAIICIFIFA() then
				f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "CPPostMatchScreen", {
					controllerIndex = f1_arg0._controllerIndex
				} ) )
			else
				f1_arg0:dispatchEventToRoot( {
					dispatchChildren = true,
					name = "Frontend_Preload"
				} )
			end
		elseif f1_local0 == PostGameState.CLASSIC_REWARDSCREEN then
			LUI.FlowManager.RequestAddMenu( "SOPostMatchScreen", true, f1_arg0._controllerIndex, false )
		elseif f1_local0 == PostGameState.BROSHOT then
			local f1_local1 = LUI.ScoreboardLayer:GetInstance()
			if f1_local1 then
				f1_local1:CloseScoreboard()
			end
			f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "Broshot", {
				controllerIndex = f1_arg0._controllerIndex
			} ) )
		elseif f1_local0 == PostGameState.TAC_OPS_INTERMISSION then
			DebugPrint( "########post_game_state TAC_OPS_INTERMISSION" )
		elseif f1_local0 == PostGameState.BR_END_SPLASH then
			f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "BrEndGameResultSplash", {
				controllerIndex = f1_arg0._controllerIndex
			} ) )
			local f1_local2 = Dvar.CFHDGABACF( "use_old_end_game_flow" )
			local f1_local3
			if f1_local2 and f1_local2 ~= 0 then
				f1_local3 = false
			else
				f1_local3 = true
			end
			if not f1_local3 then
				local f1_local4 = LUI.SquadEliminatedLayer:GetInstance()
				f1_local4:SetVisibilityOverride( false )
				f1_local4 = LUI.SquadEliminatedLayer:GetInstance()
				f1_local4:SetVisibilityOverride( nil )
			end
		elseif f1_local0 == PostGameState.CP_RETRY_POPUP then
			LUI.FlowManager.RequestAddMenu( "CPPostRetryVote", true, f1_arg0._controllerIndex, false )
		elseif f1_local0 == PostGameState.SHOW_INGAME_AAR then
			BR.SetupEndgameDataSource( f1_arg0._controllerIndex )
		end
		f1_arg0.showing = f1_local0
	end
	f1_arg0:FinalizeCPGame()
	f1_arg0:FinalizeMission()
end

