-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
GridMovableObjectUtils = GridMovableObjectUtils or {}
GridMovableObjectUtils.PlaceholderPosition = {
	BeneathChild = 0,
	BetweenChild = 1
}
GridMovableObjectUtils.ChildMovement = {
	Insert = 1,
	Swap = 0
}
local f0_local0 = function ( f18_arg0, f18_arg1 )
	if not f18_arg0.GridBackground then
		local self = LUI.UIElement.new()
		self.id = "GridBackground"
		local f18_local1 = f18_arg1:GetAnchorsAndPosition()
		self:SetAnchorsAndPosition( f18_local1.leftAnchor, f18_local1.rightAnchor, f18_local1.topAnchor, f18_local1.bottomAnchor, f18_local1.left, f18_local1.right, f18_local1.top, f18_local1.bottom )
		f18_arg0:addElement( self )
		f18_arg0.GridBackground = self
	end
end

local f0_local1 = function ( f16_arg0, f16_arg1, f16_arg2 )
	DragAndDrop.SetupForTouch( f16_arg1, {
		minUnitsMovementThreshold = 0,
		getDragDummyFunction = function ()
			if not f16_arg0._dragAndDropDummy and f16_arg0._canDrag then
				local f17_local0 = MenuBuilder.BuildRegisteredType( f16_arg0._typeName, {
					controllerIndex = f16_arg0.controllerIndex
				} )
				f17_local0.id = f16_arg0.id .. "Dummy"
				f17_local0._currentTargetIndex = f16_arg0.index
				f17_local0:SetData( f16_arg0:GetData() )
				f16_arg0.GridBackground:addElement( f17_local0 )
				f16_arg0:SetVisible( false )
				f16_arg0._dragAndDropDummy = f17_local0
			end
			return f16_arg0._dragAndDropDummy
		end,
		inProgressCallback = GridMovableObjectUtils.inProgressCallback
	} )
end

local f0_local2 = function ( f15_arg0, f15_arg1, f15_arg2 )
	local f15_local0, f15_local1, f15_local2, f15_local3 = f15_arg0:getCurrentGlobalRect()
	local f15_local4, f15_local5, f15_local6, f15_local7 = f15_arg0:GetAnchorData()
	local f15_local8 = LAYOUT.GetElementHeight( f15_arg2.Placeholder )
	local f15_local9 = LAYOUT.GetElementWidth( f15_arg2.Placeholder )
	local f15_local10, f15_local11, f15_local12, f15_local13 = f15_arg2:GetUnitsRect()
	local f15_local14 = f15_local0 - f15_local10
	local f15_local15 = f15_local0 + f15_local9 - f15_local10
	local f15_local16 = f15_local1 - f15_local11
	local f15_local17 = f15_local1 + f15_local8 - f15_local11
	f15_arg2.Placeholder:SetVisible( true )
	f15_arg2.Placeholder:SetAnchorsAndPosition( f15_local4, f15_local6, f15_local5, f15_local7, f15_local14, f15_local15, f15_local16, f15_local17 )
end

local f0_local3 = function ( f14_arg0, f14_arg1, f14_arg2 )
	local f14_local0, f14_local1, f14_local2, f14_local3 = f14_arg0:getCurrentGlobalRect()
	local f14_local4, f14_local5, f14_local6, f14_local7 = f14_arg0:GetAnchorData()
	local f14_local8 = LAYOUT.GetElementHeight( f14_arg2.Placeholder )
	local f14_local9 = LAYOUT.GetElementWidth( f14_arg2.Placeholder )
	local f14_local10, f14_local11, f14_local12, f14_local13 = f14_arg2:GetUnitsRect()
	local f14_local14 = (f14_arg1:GetSpacingX() + f14_local9) * 0.5
	local f14_local15 = f14_local0 - f14_local10 - f14_local14
	local f14_local16 = f14_local0 + f14_local9 - f14_local10 - f14_local14
	local f14_local17 = f14_local1
	local f14_local18 = f14_local1 + f14_local8
	f14_arg2.Placeholder:SetVisible( true )
	f14_arg2.Placeholder:SetAnchorsAndPosition( f14_local4, f14_local6, f14_local5, f14_local7, f14_local15, f14_local16, f14_local17, f14_local18 )
end

local f0_local4 = function ( f13_arg0 )
	local f13_local0 = f13_arg0:GetNumColumns()
	if f13_local0 and 1 < f13_local0 then
		local f13_local1 = f13_arg0:GetBuiltChildren()
		local f13_local2 = f13_local1[1]
		local f13_local3 = f13_local1[2]
		local f13_local4, f13_local5, f13_local6, f13_local7 = f13_local2:getRect()
		local f13_local8, f13_local9, f13_local10, f13_local11 = f13_local3:getRect()
		f13_arg0._screenSpacingX = f13_local8 - f13_local6
	else
		f13_arg0._screenSpacingX = 0
	end
end

local f0_local5 = function ( f12_arg0, f12_arg1, f12_arg2, f12_arg3 )
	if not f12_arg0._screenSpacingX then
		f0_local0( f12_arg0 )
	end
	local f12_local0, f12_local1, f12_local2, f12_local3 = f12_arg1:getRect()
	local f12_local4 = f12_arg0._screenSpacingX / 2
	local f12_local5
	if f12_local0 - f12_local4 > f12_arg2 or f12_arg2 >= f12_local2 + f12_local4 then
		f12_local5 = false
	else
		f12_local5 = true
	end
	local f12_local6
	if f12_local1 > f12_arg3 or f12_arg3 >= f12_local3 then
		f12_local6 = false
	else
		f12_local6 = true
	end
	local f12_local7
	if f12_local5 then
		f12_local7 = f12_local5
	else
		f12_local7 = f12_local6
	end
	return f12_local7
end

local f0_local6 = function ( f11_arg0, f11_arg1, f11_arg2, f11_arg3, f11_arg4 )
	local f11_local0 = f0_local0( f11_arg2, f11_arg1, f11_arg4.x, f11_arg4.y )
	local f11_local1 = f11_arg3._gridMovableObject.options.PlaceholderPosition
	if not f11_local1 then
		f11_local1 = GridMovableObjectUtils.PlaceholderPosition.BeneathChild
	end
	if not f11_local0 then
		return false
	elseif f11_local1 == GridMovableObjectUtils.PlaceholderPosition.BetweenChild then
		if not f11_arg1.index or not f11_arg0.index then
			return false
		elseif f11_arg1.index == f11_arg0.index or f11_arg1.index == f11_arg0.index + 1 then
			return false
		else
			f0_local0( f11_arg1, f11_arg2, f11_arg3 )
			return true
		end
	else
		f0_local0( f11_arg1, f11_arg2, f11_arg3 )
		return true
	end
end

local f0_local7 = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	if not f10_arg2.Placeholder then
		return 
	end
	f10_arg2.Placeholder:SetVisible( false )
	for f10_local3, f10_local4 in ipairs( f10_arg1:GetBuiltChildren() ) do
		if f0_local0( f10_arg0, f10_local4, f10_arg1, f10_arg2, f10_arg3 ) then
			break
		end
	end
end

local f0_local8 = function ( f9_arg0, f9_arg1 )
	local f9_local0 = f9_arg0:GetData()
	local f9_local1 = f9_arg1:GetData()
	if not f9_local0 or not f9_local1 then
		return 
	else
		f9_arg0:SetData( f9_local1 )
		f9_arg1:SetData( f9_local0 )
		f9_arg0._currentData = nil
		f9_arg1._currentData = nil
	end
end

local f0_local9 = function ( f8_arg0, f8_arg1 )
	local f8_local0 = f8_arg1:GetData()
	if not f8_local0 then
		return 
	else
		f8_arg0:SetData( f8_local0 )
		f8_arg1._currentData = nil
	end
end

local f0_local10 = function ( f7_arg0, f7_arg1, f7_arg2, f7_arg3 )
	local f7_local0 = f7_arg3.x
	local f7_local1 = f7_arg3.y
	local f7_local2 = f7_arg2:GetBuiltChildren()
	for f7_local12, f7_local13 in ipairs( f7_local2 ) do
		if not f7_local13.index then
			break
		end
		local f7_local6 = f7_local13.index ~= f7_arg0.index
		if f0_local0( f7_arg2, f7_local13, f7_local0, f7_local1 ) and f7_local13:IsVisible() then
			f7_local13:SetVisible( false )
			local f7_local7 = f7_arg0.index + 1
			if f7_arg1._currentTargetIndex then
				if not f7_arg0:IsVisible() and f7_arg0.index ~= f7_local13.index then
					f7_arg0:SetVisible( true )
				end
				f7_local7 = f7_arg1._currentTargetIndex + 1
				f7_local2[f7_local7]:SetVisible( true )
			end
			local f7_local8 = f7_local13.index + 1
			if f7_local7 < f7_local8 then
				for f7_local9 = f7_local7, f7_local8 - 1, 1 do
					f0_local0( f7_local2[f7_local9], f7_local2[f7_local9 + 1] )
				end
			else
				for f7_local9 = f7_local7 - 1, f7_local8, -1 do
					f0_local0( f7_local2[f7_local9 + 1], f7_local2[f7_local9] )
				end
			end
			f7_arg1._currentTargetIndex = f7_local13.index
		end
	end
end

GridMovableObjectUtils.inProgressCallback = function ( f6_arg0, f6_arg1, f6_arg2 )
	local f6_local0 = f6_arg0:getParent()
	local f6_local1 = f6_local0:getParent()
	local f6_local2 = f6_local1._gridMovableObject.options.ChildMovement
	if not f6_local2 then
		f6_local2 = GridMovableObjectUtils.ChildMovement.Swap
	end
	f0_local0( f6_arg0, f6_local0, f6_local1, f6_arg2 )
	if f6_local2 == GridMovableObjectUtils.ChildMovement.Insert then
		f0_local0( f6_arg0, f6_arg1, f6_local0, f6_arg2 )
	end
end

local f0_local11 = function ( f5_arg0, f5_arg1, f5_arg2 )
	local f5_local0 = f5_arg2.endPosX
	local f5_local1 = f5_arg2.endPosY
	local f5_local2 = false
	local f5_local3 = false
	for f5_local7, f5_local8 in ipairs( f5_arg0:GetBuiltChildren() ) do
		if f0_local0( f5_arg0, f5_local8, f5_local0, f5_local1 ) then
			f5_local3 = true
			if f5_local8.index ~= f5_arg1.index then
				if f5_local8._canDrag then
				
				else
					f0_local0( f5_arg1, f5_local8 )
					break
				end
				f5_arg1:SetVisible( true )
			elseif f5_local8.index == f5_arg1.index then
				f5_arg1:SetVisible( true )
				break
			end
		end
	end
	if not f5_local3 then
		f5_arg1:SetVisible( true )
	end
end

local f0_local12 = function ( f4_arg0, f4_arg1, f4_arg2 )
	local f4_local0 = f4_arg2.endPosX
	local f4_local1 = f4_arg2.endPosY
	for f4_local5, f4_local6 in ipairs( f4_arg0:GetBuiltChildren() ) do
		if not f4_local6.index then
			break
		elseif f0_local0( f4_arg0, f4_local6, f4_local0, f4_local1 ) then
			f0_local0( f4_local6, f4_arg1._dragAndDropDummy )
			f4_local6:SetVisible( true )
			break
		end
		f4_local6:SetVisible( true )
	end
	f4_arg1:SetVisible( true )
end

local f0_local13 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg2:registerEventHandler( "drag_and_drop_end", function ( element, event )
		local f3_local0 = f2_arg0._gridMovableObject.options.ChildMovement
		if not f3_local0 then
			f3_local0 = GridMovableObjectUtils.ChildMovement.Swap
		end
		if f3_local0 == GridMovableObjectUtils.ChildMovement.Swap then
			f2_arg0( f2_arg0, element, event )
		else
			f2_arg0( f2_arg0, element, event )
		end
		if element._dragAndDropDummy then
			f2_arg0.GridBackground:RemoveElement( element._dragAndDropDummy )
			element._dragAndDropDummy:SetVisible( false )
			element._dragAndDropDummy:closeTree()
			element._dragAndDropDummy = nil
		end
		element._currentData = nil
		if f2_arg0.Placeholder then
			f2_arg0.Placeholder:SetVisible( false )
		end
		return true
	end )
end

GridMovableObjectUtils.Setup = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3 )
	assert( f1_arg2.GetData, "Every child of the grid must have a GetData function that returns its data to be copied over when moving arround." )
	assert( f1_arg2.SetData, "Every child of the grid must have a SetData function that sets the default data of the child." )
	assert( f1_arg3.controllerIndex, "The options need to contain the controllerIndex." )
	if not f1_arg2._initDragOnce then
		if not f1_arg0._gridMovableObject then
			local f1_local0 = {}
			local f1_local1
			if not f1_arg3 then
				f1_local1 = f1_arg3
			else
				f1_local1 = {}
			end
			f1_local0.options = f1_local1
			f1_arg0._gridMovableObject = f1_local0
		end
		f0_local0( f1_arg0, f1_arg1 )
		f0_local0( f1_arg0, f1_arg2, f1_arg3 )
		f0_local0( f1_arg0, f1_arg1, f1_arg2 )
		if f1_arg2._canDrag == nil then
			f1_arg2._canDrag = true
		end
		f1_arg2._initDragOnce = true
	end
end

