-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
local f0_local0 = 12
local f0_local1 = function ( f14_arg0, f14_arg1, f14_arg2, f14_arg3 )
	local f14_local0 = f14_arg1:getParent()
	if f14_local0 ~= f14_arg2 then
		f14_arg2[f14_arg1.id] = f14_arg1
		if f14_local0 then
			f14_local0:RemoveElement( f14_arg1 )
		end
		f14_arg2:addElement( f14_arg1 )
	end
end

local f0_local2 = function ( f13_arg0 )
	if not LUI.StringIsNilOrEmpty( f13_arg0.desc ) and 1 < string.len( f13_arg0.desc ) then
		return f13_arg0.desc
	end
	local f13_local0 = ""
	local f13_local1 = ATTACHMENT.GetBundleByRef( f13_arg0.attachmentRef )
	if f13_local1 and not String.IsNilOrEmpty( f13_local1[0xCC44970C8397929] ) then
		f13_local0 = "\n" .. Engine[0xED84C33EC5F01EA]( f13_local1[0xCC44970C8397929] or 0x0 )
	end
	return f13_local0
end

local f0_local3 = function ( f12_arg0, f12_arg1, f12_arg2, f12_arg3 )
	local f12_local0 = f12_arg0._weaponAttributes == nil
	f12_arg0.Title:setText( Engine[0xEB2A2834B76AEA4]( f12_arg3.name ) )
	f12_arg0.Desc:setText( f0_local0( f12_arg3 ) )
	local f12_local1 = f12_arg3.weaponRef
	local f12_local2 = f12_arg3.showFullDetails
	if f12_arg3.category == ATTACHMENT.receiverCategory then
		f12_local1 = WEAPON.GetWeaponRefByRec( f12_arg3.attachmentRef )
	end
	local f12_local3 = ACTIONS.AnimateSequence
	local f12_local4 = f12_arg0
	local f12_local5
	if f12_local2 then
		f12_local5 = "ShowBranding"
	else
		f12_local5 = "HideBranding"
	end
	f12_local3( f12_local4, f12_local5 )
	f12_arg0.StatsWithDetails:SetVisible( f12_local2 )
	f12_arg0.WeaponLevel:SetVisible( f12_local2 )
	if f12_arg0.WeaponLevelProgress then
		f12_arg0.WeaponLevelProgress:SetVisible( f12_local2 )
	end
	if not f12_arg0._weaponAttributes then
		f12_arg0._weaponAttributes = f12_arg3.statsDetails.weaponAttributes
		f12_arg1._weaponAttributes = f12_arg3.statsDetails.weaponAttributes
	end
	if not f12_arg0._defaultAttachmentData then
		f12_arg0._defaultAttachmentData = f12_arg3.statsDetails.defaultAttachmentData
		f12_arg1._defaultAttachmentData = f12_arg3.statsDetails.defaultAttachmentData
	end
	if not f12_local2 then
		f12_arg0.BlockedText:setText( "" )
	else
		f12_local3 = f12_arg3.statsDetails
		local f12_local6 = GL_HACK.GetWeaponMPRef( f12_local1 )
		f12_arg0.StatsWithDetails:Setup( f12_arg2, f12_local3.ammoData )
		f12_local4 = f12_local3.weaponAttributes
		if f12_local0 then
			if f12_local4 then
				f12_arg0.StatsWithDetails.WeaponAttributes:Setup( f12_local4, true, false )
				if f12_local3.modifiedAttributeSet then
					f12_arg0.StatsWithDetails.WeaponAttributes:GrayOutStats( f12_local3.modifiedAttributeSet )
				end
			end
		else
			f12_arg0.StatsWithDetails.WeaponAttributes:Update( f12_local4 )
		end
		f12_local5 = f12_arg3.brandingMaterialName
		if not String.IsNilOrEmpty( f12_local5 ) then
			f12_arg0.Branding:setImage( RegisterMaterial( f12_local5 ) )
			f12_arg0.Branding:SetVisible( true )
			if f12_arg0.Manufacturer then
				f12_arg0.Manufacturer:SetVisible( true )
				local f12_local7 = f12_arg0.Manufacturer:GetAnchorsAndPosition()
				f12_arg0.Branding:SetLeft( f12_local7.left + LAYOUT.GetTextWidth( f12_arg0.Manufacturer ) + 6 * _1080p )
				local f12_local8 = f12_arg0.Branding:GetAnchorsAndPosition()
				f12_arg0.Branding:SetRight( f12_local8.left + GUNSMITH.GetBrandingSmallMaterialWidth( f12_arg3.brandDataRef ) )
			end
		else
			f12_arg0.Branding:SetVisible( false )
			if f12_arg0.Manufacturer then
				f12_arg0.Manufacturer:SetVisible( false )
			end
		end
		f12_arg0.WeaponLevel:setText( Engine[0xEB2A2834B76AEA4]( Engine[0xED84C33EC5F01EA]( 0x137A1B25F4CFC21, PROGRESSION.GetWeaponDisplayLevel( f12_arg2, f12_local1 ), PROGRESSION.GetMaxWeaponDisplayLevel( f12_local1 ) ) ) )
		if f12_arg0.WeaponLevelProgress then
			f12_arg0.WeaponLevelProgress:Setup( f12_arg2, f12_local1 )
		end
	end
	f12_arg0.ModifiersList:SetupMods( f12_arg3.modifiersValues )
	local f12_local6 = f12_arg3.showModifiers
	f12_local4 = f12_arg0.ModifiersList
	local f12_local7 = f12_local4
	f12_local4 = f12_local4.SetVisibility
	local f12_local9
	if f12_local6 then
		f12_local9 = LUI.Visibility.Visible
		if not f12_local9 then
		
		else
			f12_local4( f12_local7, f12_local9 )
			if not String.IsNilOrEmpty( f12_arg3.reticlePreviewImageName ) and f12_arg1.id == LOADOUT.GetAttachmentSelectMenuRef() and f12_arg0.ReticlePreview then
				ACTIONS.AnimateSequence( f12_arg0, "ShowReticlePreview" )
				f12_arg0.ReticlePreview:SetPreviewImage( f12_arg3.reticlePreviewImageName )
			else
				ACTIONS.AnimateSequence( f12_arg0, "HideReticlePreview" )
			end
			f12_local4 = f12_arg3.isUnlocked
			f12_arg0._optionalMessageWidgets = {}
			if hasChallenge and f12_local4 then
				ACTIONS.AnimateSequence( f12_arg0.UnlockRequirements, "Challenge" )
			elseif LAYOUT.GetElementHeight( f12_arg0.UnlockRequirements.UnlockCriteria ) < LAYOUT.GetTextHeight( f12_arg0.UnlockRequirements.UnlockCriteria, f12_arg2 ) then
				ACTIONS.AnimateSequence( f12_arg0.UnlockRequirements, "UnlockTwoLines" )
				f12_arg0.UnlockRequirements.UnlockCriteria:SetMaxVisibleLines( 2 )
			else
				ACTIONS.AnimateSequence( f12_arg0.UnlockRequirements, "Unlock" )
				f12_arg0.UnlockRequirements.UnlockCriteria:SetMaxVisibleLines( 1 )
			end
			if f12_arg3.showChooseAppearance then
				table.insert( f12_arg0._optionalMessageWidgets, f12_arg0.BlueprintTag )
			end
			if f12_arg3.blockedCategoryWarningText then
				table.insert( f12_arg0._optionalMessageWidgets, f12_arg0.BlockWarning )
				f12_arg0.BlockWarning:setText( f12_arg3.blockedCategoryWarningText )
			end
			if CONDITIONS.IsSplitscreen() and CONDITIONS.InGame() then
				ACTIONS.AnimateSequence( f12_arg0, "Splitscreen" )
			else
				ACTIONS.AnimateSequence( f12_arg0, "StandardLayout" )
				if not f12_local4 then
					if f12_arg3.hasSecondaryChallenge then
						f12_arg0.WeaponChallengeUnlock:SetChallenges( f12_arg3.gunsmithAttach.challengeID, f12_arg1._controllerIndex, false )
						ACTIONS.AnimateSequence( f12_arg0, "ChallengeLockedLayout" )
					else
						f12_local5 = f12_arg3.unlockCriteria
						if not String.IsNilOrEmpty( f12_local5 ) then
							f12_arg0.LockedText:setText( f12_local5 )
						end
						if f12_arg3.hasProgressChallenge then
							f12_arg0.WeaponChallengeUnlock:SetChallenges( f12_arg3.gunsmithAttach.challengeID, f12_arg1._controllerIndex, true )
							ACTIONS.AnimateSequence( f12_arg0, "ChallengeLockedLayout" )
						else
							ACTIONS.AnimateSequence( f12_arg0, "LockedTextLayout" )
						end
					end
				end
			end
			if IsLanguageFrench() then
				ACTIONS.AnimateSequence( f12_arg0, "FR" )
			end
			if IsLanguageArabic() then
				ACTIONS.AnimateSequence( f12_arg0, "AR" )
			end
		end
	end
	f12_local9 = LUI.Visibility.Hidden
end

local f0_local4 = function ( f11_arg0, f11_arg1, f11_arg2, f11_arg3 )
	f11_arg0.StatsWithDetails.WeaponAttributes:Update( ATTACHMENT.UpdateWeaponAttributesWithAttachmentStats( f11_arg2._weaponAttributes, f11_arg3, f11_arg0._defaultAttachmentData ) )
end

local f0_local5 = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	if not IsLanguageArabic() then
		local f10_local0 = LAYOUT.GetTextWidth( f10_arg1, f10_arg0 )
		local f10_local1 = 6 * _1080p
		local f10_local2 = f10_arg2
		local f10_local3 = f10_arg2.SetLeft
		local f10_local4 = f10_arg1:GetAnchorsAndPosition()
		f10_local3( f10_local2, f10_local4.left + f10_local0 + f10_local1 )
		f10_local2 = f10_arg2
		f10_local3 = f10_arg2.SetRight
		f10_local4 = f10_arg2:GetAnchorsAndPosition()
		f10_local3( f10_local2, f10_local4.left + f10_arg2:getWidth() )
		f10_local3 = LAYOUT.GetTextWidth( f10_arg2, f10_arg0 )
		f10_local4 = f10_arg3
		local f10_local5 = f10_arg3.SetLeft
		local f10_local6 = f10_arg2:GetAnchorsAndPosition()
		f10_local5( f10_local4, f10_local6.right + f10_local1 )
		f10_local4 = f10_arg3
		f10_local5 = f10_arg3.SetRight
		f10_local6 = f10_arg3:GetAnchorsAndPosition()
		f10_local5( f10_local4, f10_local6.left + f10_arg3:getWidth() )
	end
end

local f0_local6 = function ( f9_arg0, f9_arg1, f9_arg2 )
	if f9_arg2 and f9_arg2[1] then
		f9_arg0.HTuningLabel:setText( Engine[0xED84C33EC5F01EA]( f9_arg2[1].sliderLabel ) )
		f9_arg0.HTuningUnit:setText( Engine[0xED84C33EC5F01EA]( f9_arg2[1].sliderLabelUnits ) )
		f0_local0( f9_arg1, f9_arg0.HTuningLabel, f9_arg0.HTuningValue, f9_arg0.HTuningUnit )
	end
	if f9_arg2 and f9_arg2[2] then
		f9_arg0.VTuningLabel:setText( Engine[0xED84C33EC5F01EA]( f9_arg2[2].sliderLabel ) )
		f9_arg0.VTuningUnit:setText( Engine[0xED84C33EC5F01EA]( f9_arg2[2].sliderLabelUnits ) )
		f0_local0( f9_arg1, f9_arg0.VTuningLabel, f9_arg0.VTuningValue, f9_arg0.VTuningUnit )
	end
end

local f0_local7 = function ( f8_arg0 )
	return "%.2f"
end

local f0_local8 = function ( f7_arg0, f7_arg1, f7_arg2 )
	f7_arg1:setText( string.format( f7_arg0.GetTuningValueFormatString( f7_arg2 ), f7_arg2 ) )
end

local f0_local9 = function ( f6_arg0, f6_arg1 )
	if f6_arg0.HTuningValue then
		f6_arg0:SetTuningValue( f6_arg0.HTuningValue, f6_arg1 )
	end
end

local f0_local10 = function ( f5_arg0, f5_arg1 )
	if f5_arg0.VTuningValue then
		f5_arg0:SetTuningValue( f5_arg0.VTuningValue, f5_arg1 )
	end
end

local f0_local11 = function ( f4_arg0, f4_arg1 )
	ACTIONS.AnimateSequence( f4_arg0, "TuningLayout" )
	ACTIONS.AnimateSequence( f4_arg0.StatsWithDetails, "TuningLayout" )
	ACTIONS.AnimateSequence( f4_arg0.StatsWithDetails.WeaponAttributes, "TuningLayout" )
end

local f0_local12 = function ( f3_arg0, f3_arg1, f3_arg2 )
	assert( f3_arg0.Desc )
	f3_arg0.Setup = f0_local0
	f3_arg0.SetupTuningInfo = f0_local0
	f3_arg0.SetTuningValue = f0_local0
	f3_arg0.SetHTuningValue = f0_local0
	f3_arg0.SetVTuningValue = f0_local0
	f3_arg0.ActivateTuningLayout = f0_local0
	f3_arg0.GetTuningValueFormatString = f0_local0
	f3_arg0.UpdateWeaponAttributes = f0_local0
	f0_local0( f3_arg0, f3_arg0.Title, f3_arg0.DescriptionContainer )
	f0_local0( f3_arg0, f3_arg0.Desc, f3_arg0.DescriptionContainer )
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.StatsWithDetails = f3_arg0.StatsExpander.StatsWithDetails
	end
	f3_arg0._optionalMessageWidgets = {}
	f3_arg0._prevOptionalMessageWidgets = nil
	local self = LUI.UIVerticalStackedLayout.new()
	local f3_local1 = self
	local f3_local2 = self.SetAnchorsAndPosition
	local f3_local3 = 0
	local f3_local4 = 0
	local f3_local5 = 0
	local f3_local6 = 1
	local f3_local7 = _1080p * 28
	local f3_local8 = _1080p * -28
	local f3_local9 = _1080p
	local f3_local10
	if CONDITIONS.IsGLGunsmithEnabled() then
		f3_local10 = 550
	else
		f3_local10 = 575
	end
	f3_local2( f3_local1, f3_local3, f3_local4, f3_local5, f3_local6, f3_local7, f3_local8, f3_local9 * f3_local10, _1080p * 585 )
	self:SetSpacing( f0_local0 * _1080p )
	f3_arg0.OptionalMessages = self
	f3_arg0:addElement( f3_arg0.OptionalMessages )
	f3_local2 = MenuBuilder.BuildRegisteredType( "UnlockRequirements", {
		controllerIndex = f3_arg1
	} )
	f3_local2.id = "UnlockRequirements"
	f3_local2:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * -28, _1080p * 0, _1080p * 0, _1080p * 130 )
	f3_arg0.UnlockRequirements = f3_local2
	local f3_local11 = LUI.UIText.new()
	f3_local11.id = "ChooseAppearance"
	f3_local11:SetRGBFromTable( SWATCHES.genericButton.description )
	f3_local11:SetAlpha( 0, 0 )
	f3_local11:setText( Engine[0xED84C33EC5F01EA]( 0xFBD051082C0D540 ), 0 )
	f3_local11:SetFont( FONTS.GetFont( FONTS.PrimaryRegular.File ) )
	f3_local11:SetWordWrap( true )
	f3_local11:SetAlignment( LUI.Alignment.Left )
	f3_local11:SetTintFontIcons( true )
	f3_local11:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 0, _1080p * 356, _1080p * 0, _1080p * 24 )
	f3_arg0.ChooseAppearance = f3_local11
	f3_local1 = nil
	f3_local1 = MenuBuilder.BuildRegisteredType( "BlueprintTag", {
		controllerIndex = f3_arg1
	} )
	f3_local1.id = "BlueprintTag"
	f3_local1:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 0, _1080p * 300, _1080p * 0, _1080p * 30 )
	f3_arg0.BlueprintTag = f3_local1
	f3_arg0.BlueprintTag:SetBlueprintText( Engine[0xED84C33EC5F01EA]( 0x1580DB40A0528B1 ) )
	f3_local3 = LUI.UIText.new()
	f3_local3.id = "BlockWarning"
	f3_local3:SetRGBFromTable( SWATCHES.genericMenu.mainTitle, 0 )
	f3_local3:SetAlpha( 0, 0 )
	f3_local3:setText( Engine[0xED84C33EC5F01EA]( 0xA40C8E247024F5E ), 0 )
	f3_local3:SetFont( FONTS.GetFont( FONTS.PrimaryRegular.File ) )
	f3_local3:SetWordWrap( true )
	f3_local3:SetAlignment( LUI.Alignment.Left )
	f3_local3:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 0, _1080p * 356, _1080p * 0, _1080p * 20 )
	f3_arg0.BlockWarning = f3_local3
end

local f0_local13 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function GunsmithDetailsBase( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 450 * _1080p, 0, 650 * _1080p )
	self.id = "GunsmithDetailsBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f0_local0( self, LUI.ValidateControllerIndex( self, f1_local1 ), controller )
	return self
end

MenuBuilder.registerType( "GunsmithDetailsBase", GunsmithDetailsBase )
LockTable( _M )
