-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
local f0_local0 = -12
local f0_local1 = 55
local f0_local2 = 10
local f0_local3 = 90
local f0_local4 = -34
local f0_local5 = 1.1
local f0_local6 = function ( f18_arg0, f18_arg1 )
	local f18_local0 = LUI.IsKBMActiveInputMethodForPrompts( f18_arg1 )
	local f18_local1 = SEASON.GetCurrentSeason()
	local f18_local2 = ""
	if f18_arg0._needFixUp then
		f18_local2 = 0xFE725977334F69D
	elseif f18_arg0._isPremium then
		local f18_local3 = BATTLEMAP.GetTokenMaxAvailable( f18_arg1 ) == 0
		if f18_arg0._isComplete then
			f18_local2 = 0x3F884854D3D32B9
		elseif f18_local3 then
			f18_local2 = 0x22CAE52ECD4170F
		else
			f18_local2 = 0x5CCA692B73B54ED
		end
		local f18_local4 = f18_arg0
		local f18_local5 = f18_arg0.SetMouseFocusBlocker
		local f18_local6
		if not f18_local3 then
			f18_local6 = f18_local3
		else
			f18_local6 = f18_arg0._isComplete
		end
		f18_local5( f18_local4, f18_local6 )
	else
		f18_local2 = 0xCF746F3A16519AC
	end
	f18_arg0.PurchaseText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f18_local2 ) ) )
	f18_arg0.SeasonText:setText( ToUpperCase(), Engine[0xED84C33EC5F01EA]( "BATTLEPASS/SEASON_NUM", string.format( "%02d", f18_local1 ) ) )
	local f18_local3 = Dvar[0x22EAAB59AA27E9B]( 0x56A3EB47046945B ) or 604800
	local f18_local5 = function ( f19_arg0, f19_arg1 )
		local f19_local0
		if f19_arg1 then
			f19_local0 = f19_arg1
		else
			f19_local0 = f19_arg1 <= f18_arg0
		end
		if not f19_arg0._isPlayingExpiryPulse and f19_local0 then
			ACTIONS.AnimateSequence( f18_arg0, "SeasonExpiryPulse" )
			f19_arg0._isPlayingExpiryPulse = true
		end
		if f18_arg0.SeasonExpiryWarning then
			f18_arg0.SeasonExpiryWarning:SetVisible( f19_local0 )
		end
	end
	
	if not f18_arg0._seasonTimer then
		f18_arg0._seasonTimer = Challenge.SetupSeasonEndsTimer( f18_arg0, f18_arg0.ResetText, nil, f18_local5 )
	end
	local f18_local7 = f18_arg0.ResetBacker:GetAnchorsAndPosition()
	f18_local7 = f18_local7.right
	local f18_local4 = LAYOUT.GetTextWidth( f18_arg0.SeasonText )
	local f18_local8 = f18_local7 - LAYOUT.GetElementWidth( f18_arg0.ResetBacker ) - f0_local0
	local f18_local9 = f18_local8 - f18_local4 - f0_local0
	f18_arg0.SeasonBacker:SetRight( f18_local8 )
	f18_arg0.SeasonBacker:SetLeft( f18_local9 )
	local f18_local10 = f18_arg0.PurchaseText:GetAnchorsAndPosition()
	f18_local10 = f18_local10.right
	local f18_local11 = LAYOUT.GetTextWidth( f18_arg0.PurchaseText ) * (IsLanguageArabic() and f0_local0 or 1)
	local f18_local12 = 0
	if f18_arg0.Button then
		f18_local12 = LAYOUT.GetElementWidth( f18_arg0.Button )
		f18_arg0.Button:SetRight( f18_local10 - f18_local11 - f0_local0 )
		f18_arg0.Button:SetLeft( f18_local10 - f18_local11 - f0_local0 - f18_local12 )
	end
	local f18_local13 = f18_arg0.Backer:GetAnchorsAndPosition()
	local f18_local14 = f18_local13.right - f18_local11 - f0_local0
	local f18_local15
	if f18_local0 then
		f18_local15 = 0
	else
		f18_local15 = f18_local12 + f0_local0
	end
	f18_local14 = f18_local14 - f18_local15
	if f18_local9 < f18_local14 then
		f18_local14 = f18_local9
	end
	f18_arg0.Backer:SetLeft( f18_local14 )
	f18_local15 = LAYOUT.GetElementWidth( f18_arg0.BackerArrows )
	local f18_local16 = f18_local14 - f0_local0
	local f18_local17 = f18_local16 - f18_local15
	f18_arg0.BackerArrows:SetRight( f18_local16 )
	f18_arg0.BackerArrows:SetLeft( f18_local17 )
	if f18_arg0.KBMOverBackerArrow then
		f18_arg0.KBMOverBackerArrow:SetRight( f18_local16 )
		f18_arg0.KBMOverBackerArrow:SetLeft( f18_local17 )
	end
	if f18_arg0.RarityInfo then
		local f18_local18 = LAYOUT.GetElementWidth( f18_arg0.RarityInfo )
		local f18_local19 = f18_local17
		local f18_local20 = f18_local19 - f18_local18
		f18_arg0.RarityInfo:SetRight( f18_local19 )
		f18_arg0.RarityInfo:SetLeft( f18_local20 )
	end
	if f18_arg0.Button then
		local f18_local18 = f18_arg0.Button
		local f18_local20 = f18_local18
		f18_local18 = f18_local18.SetVisible
		local f18_local21
		if not f18_arg0:IsDisabled() then
			f18_local21 = not f18_local0
		else
			f18_local21 = false
		end
		f18_local18( f18_local20, f18_local21 )
	end
end

local f0_local7 = function ( f17_arg0, f17_arg1, f17_arg2, f17_arg3, f17_arg4 )
	f17_arg0._isPremium = f17_arg2
	f17_arg0._isComplete = f17_arg3
	f17_arg0._needFixUp = f17_arg4
	local f17_local0 = 0 < BATTLEMAP.GetTokenMaxAvailable( f17_arg1 )
	local f17_local1 = false
	if f17_arg4 then
		local f17_local2 = ACTIONS.AnimateSequence
		local f17_local3 = f17_arg0
		local f17_local4
		if f17_arg2 then
			f17_local4 = "Premium"
		else
			f17_local4 = "Free"
		end
		f17_local2( f17_local3, f17_local4 )
	elseif f17_arg3 and f17_arg2 then
		f17_local1 = true
		ACTIONS.AnimateSequence( f17_arg0, "Complete" )
	elseif f17_arg2 and not f17_local0 then
		f17_local1 = true
		ACTIONS.AnimateSequence( f17_arg0, "MaxTokens" )
	else
		local f17_local2 = ACTIONS.AnimateSequence
		local f17_local3 = f17_arg0
		local f17_local4
		if f17_arg2 then
			f17_local4 = "Premium"
		else
			f17_local4 = "Free"
		end
		f17_local2( f17_local3, f17_local4 )
	end
	f17_arg0:SetButtonDisabled( f17_local1 )
	f0_local0( f17_arg0, f17_arg1 )
end

local f0_local8 = function ( f13_arg0, f13_arg1 )
	local f13_local0 = nil
	local f13_local1 = {
		[BATTLEPASS.PurchaseCallbackKeys.SUCCESS] = function ( f16_arg0, f16_arg1 )
			f13_arg0( f16_arg0 )
			return false
		end,
		[BATTLEPASS.PurchaseCallbackKeys.FAILURE] = function ( f15_arg0, f15_arg1 )
			f13_arg0( f15_arg0 )
			local f15_local0 = BATTLEPASS.GetErrorMessage( f15_arg1.errorCode, f15_arg1.itemID )
			return false
		end
	}
	f13_local0 = function ( f14_arg0 )
		BATTLEPASS.DeRegisterPurchaseCallbacks( f14_arg0, {
			BATTLEPASS.PurchaseCallbackKeys.SUCCESS,
			BATTLEPASS.PurchaseCallbackKeys.FAILURE
		} )
		f14_arg0._needFixUp = BATTLEPASS.NeedFixUp( f13_arg0 )
		if f14_arg0.UpdateMapState then
			f14_arg0:UpdateMapState( f13_arg0, BATTLEMAP.SectorMapState.NORMAL )
		elseif f14_arg0.UpdatePreviewMapState then
			f14_arg0:UpdatePreviewMapState( f13_arg0, BATTLEMAP.SectorMapState.NORMAL )
		end
	end
	
	BATTLEPASS.RegisterPurchaseCallbacks( f13_arg0, f13_arg1, f13_local1 )
	BATTLEPASS.FixUp( f13_arg1 )
	if f13_arg0.UpdateMapState then
		f13_arg0:UpdateMapState( f13_arg1, BATTLEMAP.SectorMapState.FIXING_UP )
	elseif f13_arg0.UpdatePreviewMapState then
		f13_arg0:UpdatePreviewMapState( f13_arg1, BATTLEMAP.SectorPreviewState.FIXING_UP )
	end
end

local f0_local9 = function ( f10_arg0, f10_arg1 )
	local f10_local0 = f10_arg0:getParent()
	if BATTLEPASS.NeedFixUp( f10_arg1 ) then
		f0_local0( f10_local0, f10_arg1 )
	elseif f10_local0._isPremium then
		if not f10_local0._isComplete and 0 < BATTLEMAP.GetTokenMaxAvailable( f10_arg1 ) then
			LUI.FlowManager.RequestAddMenu( BATTLEPASS.GetBattlePassTokenPurchaseMenuRef(), true, f10_arg1, false, {
				menuState = BATTLEMAP.TokenMenuState.PURCHASING
			}, true )
		end
	else
		STORE.Popups.OpenGenericFetchPopup( f10_arg1 )
		STORE.AsyncFetchCatalogue( f10_arg0, f10_arg1, {
			useCache = false,
			showEmptyStoreDialog = true,
			onFetchSuccess = function ()
				STORE.Popups.CloseGenericFetchPopup()
				LUI.FlowManager.RequestAddMenu( BATTLEPASS.GetBattlePassPurchaseMenuRef(), true, f10_arg0, false, {
					storeFetchSuccess = true,
					fromSectorPreview = f10_arg0.id == BATTLEPASS.GetBattlePassSectorPreviewMenuRef()
				}, true )
			end,
			onFetchError = function ( f11_arg0, f11_arg1 )
				STORE.Popups.CloseGenericFetchPopup()
				LUI.FlowManager.RequestAddMenu( BATTLEPASS.GetBattlePassPurchaseMenuRef(), true, f10_arg0, false, {
					storeFetchSuccess = false,
					fromSectorPreview = f10_arg0.id == BATTLEPASS.GetBattlePassSectorPreviewMenuRef()
				}, true )
			end
		} )
	end
end

local f0_local10 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdateButtonState = f0_local0
	f3_arg0.ShowPurchasePopup = f0_local0
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0:SubscribeToInputTypeModel( f3_arg1, function ( f9_arg0, f9_arg1 )
		local f9_local0 = f9_arg1._controllerIndex
		if f9_arg1.Button then
			local f9_local1 = f9_arg1.Button
			local f9_local2 = f9_local1
			f9_local1 = f9_local1.SetVisible
			local f9_local3
			if not f9_arg1:IsDisabled() then
				f9_local3 = not CONDITIONS.IsKbm( f9_local0 )
			else
				f9_local3 = false
			end
			f9_local1( f9_local2, f9_local3 )
		end
		f3_arg0( f9_arg1, f9_local0 )
	end )
	ACTIONS.AnimateSequence( f3_arg0, "GradientPulse" )
	f3_arg0:addEventHandler( "button_over", function ( f8_arg0, f8_arg1 )
		Engine[0xC4146BA76D0F982]( SOUND_SETS.default.gainFocus )
		ACTIONS.AnimateSequence( f3_arg0, "ButtonOver" )
	end )
	f3_arg0:addEventHandler( "button_up", function ( f7_arg0, f7_arg1 )
		ACTIONS.AnimateSequence( f3_arg0, "ButtonUp" )
		f7_arg0:UpdateButtonState( f3_arg0, f3_arg0._isPremium, f3_arg0._isComplete, f3_arg0._needFixUp )
	end )
	f3_arg0:addEventHandler( "enable", function ( f6_arg0, f6_arg1 )
		ACTIONS.AnimateSequence( f3_arg0, "GradientPulse" )
	end )
	f3_arg0:addEventHandler( "disable", function ( f5_arg0, f5_arg1 )
		ACTIONS.AnimateSequence( f3_arg0, "Disable" )
	end )
	f3_arg0:addEventHandler( "button_action", function ( f4_arg0, f4_arg1 )
		f4_arg0:ShowPurchasePopup( f4_arg1.controller or f3_arg0 )
		return true
	end )
	if IsLanguageArabic() then
		ACTIONS.AnimateSequence( f3_arg0, "AR" )
	end
end

local f0_local11 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
	f2_arg0:setActionDisabledSFX()
	f2_arg0:setGainFocusAllSFX( nil, {
		clearChildrenSFX = true
	} )
end

function BattlePassPurchaseButtonBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIButton.new()
	f1_local1:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 500, 0, 100 )
	f1_local1.id = "BattlePassPurchaseButtonBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f0_local0( f1_local1, f1_local0.ValidateControllerIndex( f1_local1, f1_local2 ), f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0x50B4DD1BEC998B8, BattlePassPurchaseButtonBase )
LockTable( _M )
