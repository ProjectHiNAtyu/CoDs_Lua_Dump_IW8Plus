-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.widgets.MPPlayerDetails" )
require( "ui.widgets.LobbyMembersFooter" )
require( "ui.widgets.SubMenuTab" )
require( "ui.widgets.MenuTitle" )
local f0_local0 = nil
f0_local0 = function ( f16_arg0, f16_arg1 )
	local f16_local0 = f16_arg0:Wait( 3000, true )
	f16_local0.onComplete = function ()
		return f16_arg0( f16_arg0, f16_arg0 )
	end
	
	if f16_arg0.activeTabID == CLANS.ClanSearchTabIDs.INBOX then
		if Engine[0x9D348E40740E9A8]() then
			Engine[0xB81A5136C5503E4]( "friends_refresh", f16_arg1 )
		end
		FRIENDS.RefreshData( f16_arg0.activeTabID, f16_arg0.activeTabWidget:GetPlayerGrid(), f16_arg1 )
	end
end

local f0_local1 = function ( f8_arg0, f8_arg1, f8_arg2 )
	f8_arg0._clanID = Clans[0x43F567012B7061]( f8_arg1 )
	f8_arg0.tabIDToIndex = {}
	f8_arg0.tabNamesAndIDs = {}
	local f8_local0 = function ( f15_arg0, f15_arg1 )
		local f15_local0 = #f8_arg0.tabNamesAndIDs + 1
		f8_arg0.tabIDToIndex[f15_arg1] = f15_local0
		f8_arg0.tabNamesAndIDs[f15_local0] = {
			name = ToUpperCase( Engine[0xED84C33EC5F01EA]( f15_arg0 ) ),
			id = f15_arg1
		}
	end
	
	if CONDITIONS.IsClansBrowsingEnabled() then
		if (not f8_arg0._clanID or f8_arg0._clanID == CLANS.INVALID_CLAN_ID) and CONDITIONS.IsClansRecommendedEnabled() then
			f8_local0( "CLANS/BROWSE_CLAN_RECOMMENDED", CLANS.ClanSearchTabIDs.SUGGESTED )
		end
		f8_local0( "CLANS/BROWSE_CLAN_ALL_CLANS", CLANS.ClanSearchTabIDs.ALL_CLANS )
	end
	if CONDITIONS.IsSocialInboxEnabled() then
		f8_local0( "CLANS/BROWSE_CLAN_INBOX", CLANS.ClanSearchTabIDs.INBOX )
	end
	local f8_local1 = LUI.FlowManager.GetScopedData( f8_arg0 )
	local f8_local2 = {}
	for f8_local7, f8_local8 in ipairs( f8_arg0.tabNamesAndIDs ) do
		local f8_local9 = table.insert
		local f8_local10 = f8_local2
		local f8_local11 = {
			name = f8_local8.name
		}
		local f8_local6
		if (not f8_local1.activeTabIndex or f8_local7 ~= f8_local1.activeTabIndex) and (f8_local1.activeTabIndex ~= nil or f8_arg2.defaultActiveTab ~= f8_local8.id) then
			f8_local6 = false
		else
			f8_local6 = true
		end
		f8_local11.hasDefaultFocus = f8_local6
		f8_local11.focusFunction = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
			local f13_local0 = f8_arg0.tabNamesAndIDs[f13_arg2 + 1].id
			if f8_arg0.activeTabID ~= f13_local0 then
				f8_arg0.activeTabID = f13_local0
				if f8_arg0.activeTabWidget then
					f8_arg0.activeTabWidget:closeTree()
					f8_arg0.activeTabWidget = nil
				end
				f8_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
					button_ref = "button_secondary"
				} )
				f8_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
					button_ref = "button_primary"
				} )
				f8_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
					button_ref = "button_start"
				} )
				if f13_local0 == CLANS.ClanSearchTabIDs.SUGGESTED then
					f8_arg0.activeTabWidget = MenuBuilder.BuildRegisteredType( "ClanBrowserList", {
						useSuggestedClans = true,
						controllerIndex = f13_arg1,
						parentButtonHelperBar = f8_arg0.HelperBar
					} )
				elseif f13_local0 == CLANS.ClanSearchTabIDs.ALL_CLANS then
					f8_arg0.activeTabWidget = MenuBuilder.BuildRegisteredType( "ClanBrowserList", {
						controllerIndex = f13_arg1,
						parentButtonHelperBar = f8_arg0.HelperBar
					} )
					f8_arg0.activeTabWidget._parent = f8_arg0
				elseif f13_local0 == CLANS.ClanSearchTabIDs.INBOX then
					f8_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
						button_ref = "button_left_stick"
					} )
					f8_arg0.activeTabWidget = MenuBuilder.BuildRegisteredType( "SocialInboxMenu", {
						useClansInbox = true,
						controllerIndex = f13_arg1
					} )
				else
					assert( false )
				end
				f8_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
					side = "left",
					button_ref = "button_secondary",
					priority = 0,
					helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/BACK" )
				} )
				f8_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
					side = "left",
					button_ref = "button_primary",
					priority = 1,
					helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/SELECT" )
				} )
				f8_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
					side = "left",
					button_ref = "button_start",
					priority = -29,
					helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/OPTIONS" )
				} )
				if f13_arg3 ~= FocusType.MenuFlow then
					Engine[0xC4146BA76D0F982]( SOUND_SETS.default.tabHighlight )
				end
				f8_arg0.activeTabWidget:setPriority( -1 )
				f8_arg0:addElement( f8_arg0.activeTabWidget )
				f8_arg0.activeTabWidget._socialMenu = f8_arg0
				if f8_arg0.activeTabWidget.SetupButtonBinds then
					f8_arg0.activeTabWidget.SetupButtonBinds()
				end
				if f8_arg0 ~= f8_arg0.activeTabIndex and f13_arg3 ~= FocusType.MouseOver and f13_arg3 ~= FocusType.MenuFlow then
					f8_arg0.activeTabWidget:processEvent( {
						name = "gain_focus"
					} )
				end
				f8_arg0.activeTabIndex = f8_arg0
				if f8_arg0.activeTabID == CLANS.ClanSearchTabIDs.INBOX then
					local f13_local1 = f8_arg0.activeTabWidget:GetPlayerGrid()
					local f13_local2 = FRIENDS.GetPlayerGridScrollFunctionality( f13_arg1, f13_local1, f8_arg0.activeTabID, function ()
						FRIENDS.RefreshData( f13_arg0.activeTabID, f13_arg0, f13_arg0 )
					end )
					FRIENDS.InitPlayerRequestData( f13_local1, FRIENDS.SOCIAL_MENU_CACHED_FRIENDS / 2 )
					f13_local1:AddScrollbar( f13_local2 )
					FRIENDS.RefreshData( f8_arg0.activeTabID, f13_local1, f13_arg1 )
				end
			end
		end
		
		f8_local9( f8_local10, f8_local11 )
	end
	f8_arg0.Tabs:SetTabs( f8_local2 )
	f0_local0( f8_arg0, f8_arg1 )
	CLANS.SubscribeToClanDataSource( f8_arg0, f8_arg1, CLANS.DataSourceIDs.INVITATION_COUNT, function ( f12_arg0 )
		local f12_local0 = f8_arg0.tabIDToIndex[CLANS.ClanSearchTabIDs.INBOX]
		local f12_local1
		if f12_local0 then
			f12_local1 = f12_local0
		else
			f12_local1 = f8_arg0.Tabs:GetTabAtIndex( f12_local0 )
		end
		if f12_local1 and f12_local1.SetBreadcrumb then
			f12_local1:SetBreadcrumb( 0 < f12_arg0 )
		end
	end )
	f8_arg0.bindButton:registerEventHandler( "button_secondary", function ( element, event )
		local f11_local0 = event.controller or f8_arg0
		ACTIONS.LeaveMenu( f8_arg0 )
		local f11_local1 = LUI.FlowManager.GetVisibleMenu()
		if f11_local1 then
			f11_local1:processEvent( {
				name = "closing_quick_access_menu",
				controllerIndex = f11_local0
			} )
		end
	end )
	f8_arg0.bindButton:registerEventHandler( "restore_focus", function ( element, event )
		if f8_arg0.activeTabWidget.SearchForClans then
			f8_arg0.activeTabWidget:SearchForClans( f8_arg0 )
		end
	end )
	SEQUENCEPRESETS.RegisterAnimation( f8_arg0, LUI.Transition.TransFrom, "OutDepthForward", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f8_arg0, LUI.Transition.TransTo, "InDepthForward", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f8_arg0, LUI.Transition.TransBackFrom, "OutDepthBack", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f8_arg0, LUI.Transition.TransBackTo, "InDepthBack", 0 )
	f8_arg0:addAndCallEventHandler( "update_input_type", function ( f9_arg0, f9_arg1 )
		if LUI.IsLastInputGamepad( f8_arg0 ) then
			ACTIONS.AnimateSequence( f9_arg0, "Gamepad" )
		else
			ACTIONS.AnimateSequence( f9_arg0, "KBM" )
		end
	end )
end

function ClanBrowserMenu( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "ClanBrowserMenu"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	self.HelperBar.id = "HelperBar"
	self.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	self.HelperBar:setPriority( 10 )
	self:addElement( self.HelperBar )
	local f1_local2 = self
	local f1_local3 = nil
	if CONDITIONS.IsUserSignedInDemonware( f1_local1 ) then
		f1_local3 = MenuBuilder.BuildRegisteredType( "MPPlayerDetails", {
			controllerIndex = f1_local1
		} )
		f1_local3.id = "PlayerDetails"
		f1_local3:setPriority( 10 )
		f1_local3:SetAnchorsAndPosition( 1, 0, 0, 1, _1080p * -596, _1080p * -96, _1080p * 54, _1080p * 114 )
		self:addElement( f1_local3 )
		self.PlayerDetails = f1_local3
	end
	local f1_local4 = nil
	if CONDITIONS.InFrontend() then
		f1_local4 = MenuBuilder.BuildRegisteredType( "LobbyMembersFooter", {
			controllerIndex = f1_local1
		} )
		f1_local4.id = "LobbyMembersFooter"
		f1_local4:setPriority( 10 )
		f1_local4:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 0, _1080p * 150 )
		self:addElement( f1_local4 )
		self.LobbyMembersFooter = f1_local4
	end
	local Tabs = nil
	
	Tabs = LUI.TabManager.new( {
		spacing = 4,
		wrap = true,
		tabHeight = _1080p * 45,
		buildTab = function ()
			return MenuBuilder.BuildRegisteredType( "SubMenuTab", {
				controllerIndex = menu
			} )
		end,
		controllerIndex = f1_local1
	} )
	Tabs.id = "Tabs"
	Tabs:setPriority( 10 )
	Tabs:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 992, _1080p * 102, _1080p * 154 )
	self:addElement( Tabs )
	self.Tabs = Tabs
	
	local MenuTitle = nil
	
	MenuTitle = MenuBuilder.BuildRegisteredType( "MenuTitle", {
		controllerIndex = f1_local1
	} )
	MenuTitle.id = "MenuTitle"
	MenuTitle:setPriority( 10 )
	MenuTitle.MenuTitle:SetAlpha( 0.15, 0 )
	MenuTitle.MenuTitle:setText( ToUpperCase( "" ), 0 )
	MenuTitle.Line:SetLeft( 0, 0 )
	MenuTitle:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 1024, 0, _1080p * 100 )
	self:addElement( MenuTitle )
	self.MenuTitle = MenuTitle
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local7 = nil
	Tabs:RegisterAnimationSequence( "Gamepad", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Left,
			value = _1080p * 96
		},
		{
			duration = -28,
			property = TWEEN_PROPERTY.Right,
			value = _1080p * 992
		}
	} )
	self._sequences.Gamepad = function ()
		menu:AnimateSequence( "Gamepad" )
	end
	
	self._sequenceLengths.Gamepad = 100
	local f1_local8 = nil
	Tabs:RegisterAnimationSequence( "KBM", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Left,
			value = _1080p * 55
		},
		{
			duration = -28,
			property = TWEEN_PROPERTY.Right,
			value = _1080p * 951
		}
	} )
	self._sequences.KBM = function ()
		menu:AnimateSequence( "KBM" )
	end
	
	self._sequenceLengths.KBM = 100
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		button_ref = "button_secondary",
		helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/BACK" )
	} )
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		button_ref = "button_primary",
		priority = 1,
		helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/SELECT" )
	} )
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		priority = 10,
		kbmTooltipPromptOverload = "button_quick_options",
		button_ref = "button_start",
		helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/OPTIONS" )
	} )
	if not self.bindButton then
		local f1_local9 = LUI.UIBindButton.new()
		f1_local9.id = "selfBindButton"
		self:addElement( f1_local9 )
		self.bindButton = f1_local9
	end
	self.bindButton:addEventHandler( "button_secondary", function ( f3_arg0, f3_arg1 )
		local f3_local0 = f3_arg1.controller or menu
		ACTIONS.LeaveMenu( menu, true )
	end )
	self.bindButton:addEventHandler( "button_start", function ( f2_arg0, f2_arg1 )
		ACTIONS.OpenOptionsMenu( f2_arg1.controller or menu, "", "" )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ClanBrowserMenu", ClanBrowserMenu )
LockTable( _M )
