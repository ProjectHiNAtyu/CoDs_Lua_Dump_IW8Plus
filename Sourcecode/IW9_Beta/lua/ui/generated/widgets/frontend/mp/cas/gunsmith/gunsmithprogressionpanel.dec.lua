-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
local f0_local0 = 330
local f0_local1 = 200
local f0_local2 = 142
local f0_local3 = 30
local f0_local4 = 300
local f0_local5 = f0_local1
local f0_local6 = f0_local2 - f0_local3
local f0_local7 = 94
local f0_local8 = 84
local f0_local9 = 424
local f0_local10 = 337
local f0_local11 = f0_local5 - 463 + 453
local f0_local12 = 458
local f0_local13 = function ( f22_arg0, f22_arg1 )
	for f22_local3, f22_local4 in ipairs( f22_arg0._progressionRows ) do
		if f22_local4._weaponRef == f22_arg1 then
			return f22_local3
		end
	end
end

local f0_local14 = function ( f21_arg0, f21_arg1 )
	local f21_local0 = f21_arg0._WeaponLists[f21_arg1]
	if f21_arg0._currentFocus ~= f21_local0 then
		if f21_arg0._currentFocus then
			f21_arg0._currentFocus.ProgressionList:dispatchEventToChildren( {
				isFocused = false,
				name = "gunsmith_update_focus"
			} )
			f21_arg0._currentFocus.ProgressionList:FocusFirstItem()
			f21_arg0._currentFocus.GunsmithProgressionWeapon:SetFocus( false )
			f21_arg0._currentFocus:processEvent( {
				name = "lose_focus"
			} )
		end
		f21_local0.ProgressionList:dispatchEventToChildren( {
			isFocused = true,
			name = "gunsmith_update_focus"
		} )
		f21_local0.GunsmithProgressionWeapon:SetFocus( true )
		f21_local0:processEvent( {
			name = "gain_focus"
		} )
		f21_arg0._currentFocus = f21_local0
	end
end

local f0_local15 = function ( f20_arg0, f20_arg1 )
	if f20_arg1 <= 1 or f20_arg0._weaponCount <= f20_arg1 then
		return 
	end
	for f20_local0 = 1, #f20_arg0._progressionRows, 1 do
		local f20_local3
		if f20_arg1 - 2 < f20_local0 and f20_local0 < f20_arg1 + 2 then
			f20_local3 = LUI.Visibility.Visible
			if not f20_local3 then
			
			else
				f20_arg0._progressionRows[f20_local0]:SetVisibility( f20_local3 )
			end
		end
		f20_local3 = LUI.Visibility.Hidden
	end
end

local f0_local16 = function ( f19_arg0, f19_arg1, f19_arg2, f19_arg3, f19_arg4 )
	local f19_local0, f19_local1, f19_local2, f19_local3 = f19_arg0._progressionRows[f19_arg0._currentRow]:getLocalRect()
	if f0_local0 < f19_local0 + f19_arg2 or f19_local2 + f19_arg2 < f0_local0 + f0_local0 + 560 then
		return 
	elseif f19_arg0 and f19_arg0._progressionRows then
		for f19_local4 = 1, #f19_arg0._progressionRows, 1 do
			local f19_local7 = f19_arg0._progressionRows[f19_local4]
			local f19_local8, f19_local9, f19_local10, f19_local11 = f19_local7:getLocalRect()
			local f19_local12 = f19_local7
			local f19_local13 = f19_local7.SetAnchorsAndPosition
			local f19_local14 = 0
			local f19_local15 = 1
			local f19_local16 = 0
			local f19_local17 = 1
			local f19_local18 = f19_local8 + f19_arg2
			local f19_local19 = f19_local10 + f19_arg2
			local f19_local20 = f19_local9 + f19_arg3
			local f19_local21 = f19_local11 + f19_arg3
			local f19_local22
			if not f19_arg4 then
				f19_local22 = f19_arg4
			else
				f19_local22 = 0
			end
			f19_local13( f19_local12, f19_local14, f19_local15, f19_local16, f19_local17, f19_local18, f19_local19, f19_local20, f19_local21, f19_local22 )
		end
	end
end

local f0_local17 = function ( f15_arg0, f15_arg1 )
	local f15_local0 = function ( f18_arg0, f18_arg1 )
		if f18_arg0._drag then
			f18_arg0._curMouseUnitX, f18_arg0._curMouseUnitY = f18_arg1.root:PixelsToUnits( f18_arg1.x, f18_arg1.y )
			local f18_local0 = f18_arg0._curMouseUnitX - f18_arg0._preMouseUnitX
			local f18_local1 = f18_arg0._curMouseUnitY - f18_arg0._preMouseUnitY
			f15_arg0( f18_arg0, f15_arg0, f18_local0, 0 )
			f18_arg0._preMouseUnitX = f18_arg0._curMouseUnitX
			f18_arg0._preMouseUnitY = f18_arg0._curMouseUnitY
		elseif f18_arg0._down then
			f18_arg0._curMouseUnitX, f18_arg0._curMouseUnitY = f18_arg1.root:PixelsToUnits( f18_arg1.x, f18_arg1.y )
			f18_arg0._preMouseUnitX, f18_arg0._preMouseUnitY = f18_arg1.root:PixelsToUnits( f18_arg1.x, f18_arg1.y )
			f18_arg0._drag = true
		end
	end
	
	local f15_local1 = function ( f17_arg0, f17_arg1 )
		f17_arg0._down = true
	end
	
	local f15_local2 = function ( f16_arg0, f16_arg1 )
		f16_arg0._down = false
		f16_arg0._drag = false
	end
	
	f15_arg0:SetHandleMouse( true )
	f15_arg0:registerEventHandler( "leftmousedown", f15_local1 )
	f15_arg0:registerEventHandler( "leftmouseup", f15_local2 )
	f15_arg0:registerEventHandler( "mouse_capture_lost", f15_local2 )
	f15_arg0:registerEventHandler( "mousedrag", f15_local0 )
end

local f0_local18 = function ( f14_arg0, f14_arg1, f14_arg2 )
	local f14_local0 = f14_arg2.weaponRef
	local f14_local1 = f14_arg2.yOffset
	local f14_local2 = nil
	f14_local2 = MenuBuilder.BuildRegisteredType( "GunsmithProgressionRow", {
		controllerIndex = f14_arg1
	} )
	f14_local2.id = "GunsmithProgressionRow" .. f14_arg0._weaponCount
	f14_local2:SetProgressionRowData( f14_local0, f14_arg2.progressionUnlocks, f14_local1 )
	f14_arg0:addElement( f14_local2 )
	local f14_local3 = f14_local2.GunsmithProgressionWeapon
	local f14_local4 = f14_arg2.weaponUnlockLayoutNum or 0
	local f14_local5 = f14_arg2.xOffset + (f14_local4 * f0_local0 + f14_local4 * 10) / 2 + f0_local0
	local f14_local6 = #f14_local2._progressionUnlocks * f0_local0 + (#f14_local2._progressionUnlocks - 1) * 10
	f14_local2:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * (f0_local0 + f14_local5), _1080p * (f0_local0 + f14_local5 + f14_local6), _1080p * (f0_local0 + f14_local1), _1080p * (f0_local0 + f0_local0 + f14_local1) )
	f14_local2.ProgressionList:SetRight( _1080p * (f0_local0 + f14_local6) )
	f14_local2.ProgressBar:SetRight( _1080p * (f0_local0 + f14_local6) )
	if f14_local4 == 0 then
		f14_local3.UnlockLines:SetVisible( false )
	end
	local f14_local7 = f14_local3.UnlockLines:GetAnchorsAndPosition()
	f14_local7 = f14_local7.left + (f14_local4 * f0_local0 + f14_local4 * 10) / 2 - 30
	local f14_local8
	if f14_arg2.isLineUp then
		f14_local8 = -1
	else
		f14_local8 = 1
	end
	if not f14_arg2.isLineUp then
		ACTIONS.AnimateSequence( f14_local3, "UnlockedFromUnder" )
	end
	f14_local3.UnlockLines:SetRight( f14_local7 * _1080p )
	local f14_local9 = f14_local3.UnlockLines
	local f14_local10 = f14_local9
	f14_local9 = f14_local9.SetTop
	local f14_local11 = _1080p
	local f14_local12
	if f14_arg2.isLineUp then
		f14_local12 = 0
	else
		f14_local12 = -40
	end
	f14_local9( f14_local10, f14_local11 * (f14_local12 + f14_local8 * f0_local0 / 1.55) )
	f14_local3:Setup( f14_arg1, f14_local0, f14_arg2.isWeaponLocked, f14_arg0["weaponRef" .. f14_arg0._weaponCount - 1], f14_local4 )
	f14_arg0._WeaponLists[f14_local0] = f14_local2
	table.insert( f14_arg0._progressionRows, f14_local2 )
	local f14_local13 = PROGRESSION.GetWeaponProgress( f14_arg1, f14_local0 )
	if f14_local13 then
		f14_local10 = f14_local13.xp
		if not f14_local10 then
		
		else
			f14_local11 = PROGRESSION.GetWeaponMaxLevelXP( f14_arg1, f14_local0 )
			f14_local12 = f14_local10 / f14_local11
			f14_local2.ProgressBar.curWeaponProgression = f14_local10
			f14_local2.ProgressBar.maxWeaponProgression = f14_local11
			f14_local2.ProgressBar:SetImmediateProgress( LUI.clamp( f14_local12, 0, 1 ) )
			return f14_local5, f14_local1
		end
	end
	f14_local10 = 0
end

local f0_local19 = function ( f12_arg0, f12_arg1 )
	table.sort( f12_arg0._progressionRows, function ( f13_arg0, f13_arg1 )
		return f13_arg0._yOffset < f13_arg1._yOffset
	end )
end

local f0_local20 = function ( f11_arg0, f11_arg1, f11_arg2 )
	f11_arg0._moveRight = false
	f0_local0( f11_arg0, f11_arg1 )
	local f11_local0, f11_local1, f11_local2, f11_local3 = f11_arg0._progressionRows[f11_arg0._currentRow]:getLocalRect()
	f0_local0( f11_arg0, f11_arg2, f0_local0 - f11_local0, f0_local0 - f11_local1, f0_local0 )
end

local f0_local21 = function ( f10_arg0, f10_arg1, f10_arg2 )
	f10_arg0._defaultIndex = 1
	for f10_local0 = 1, #f10_arg0._progressionRows, 1 do
		if f10_arg2 == f10_arg0._progressionRows[f10_local0]._weaponRef then
			f10_arg0._defaultIndex = f10_local0
		end
	end
	f10_arg0._currentRow = f10_arg0._defaultIndex
	f0_local0( f10_arg0, f10_arg2, f10_arg1 )
	f0_local0( f10_arg0, f10_arg0._defaultIndex )
end

local f0_local22 = function ( f9_arg0 )
	f9_arg0:dispatchEventToParent( {
		unlockLevel = 0,
		name = "progression_button_over",
		weaponRef = f9_arg0._progressionRows[f9_arg0._currentRow]._weaponRef
	} )
end

local f0_local23 = function ( f8_arg0, f8_arg1, f8_arg2 )
	f8_arg0._weaponCount = f8_arg0._weaponCount + 1
	f8_arg0["weaponRef" .. f8_arg0._weaponCount] = f8_arg2.weaponRef
	return f0_local0( f8_arg0, f8_arg1, f8_arg2 )
end

local f0_local24 = function ( f6_arg0, f6_arg1 )
	f6_arg0:addEventHandler( "gamepad_button", function ( f7_arg0, f7_arg1 )
		if f6_arg0._enabled then
			local f7_local0 = f6_arg0._progressionRows[f7_arg0._currentRow]
			local f7_local1 = f7_local0.ProgressionList
			local f7_local2 = f7_local0.GunsmithProgressionWeapon
			local f7_local3 = f7_local1:GetFocusPositionIndex()
			if f7_arg1.down then
				local f7_local4 = false
				local f7_local5 = false
				local f7_local6 = false
				if f7_arg1.button == "left" and f7_local3 == 0 then
					f7_local2:processEvent( {
						name = "gain_focus"
					} )
					f7_local1:processEvent( {
						name = "lose_focus"
					} )
				elseif f7_arg1.button == "left" and f7_local3 == 1 then
					if f6_arg0._moveRight then
						f7_local6 = true
					end
				elseif f7_arg1.button == "right" and f7_local3 and 6 < f7_local3 then
					if not f6_arg0._moveRight then
						f7_local5 = true
					end
				elseif f7_arg1.button == "down" then
					if f6_arg0._currentRow < f6_arg0._weaponCount then
						f6_arg0._currentRow = f6_arg0._currentRow + 1
						f7_local4 = true
					end
				elseif f7_arg1.button == "up" then
					if 1 < f6_arg0._currentRow then
						f6_arg0._currentRow = f6_arg0._currentRow - 1
						f7_local4 = true
					end
				elseif f7_arg1.button == "secondary" then
					f6_arg0:dispatchEventToParent( {
						menuType = 1,
						name = "progression_switch_menus"
					} )
				end
				if f7_local4 then
					f6_arg0( f7_arg0, f6_arg0._progressionRows[f7_arg0._currentRow]._weaponRef, f6_arg0 )
					f6_arg0( f6_arg0, f6_arg0._currentRow )
				end
				if f7_local5 then
					f6_arg0._moveRight = true
					f6_arg0( f7_arg0, f6_arg0, -500, 0, f6_arg0 )
				end
				if f7_local6 then
					f6_arg0._moveRight = false
					f6_arg0( f7_arg0, f6_arg0, 500, 0, f6_arg0 )
				end
				f6_arg0( f7_arg0 )
			end
		end
	end )
end

local f0_local25 = function ( f4_arg0, f4_arg1 )
	f4_arg0:addEventHandler( "OnMiniNavBarButtonAction", function ( f5_arg0, f5_arg1 )
		if f4_arg0._enabled then
			f4_arg0._currentRow = f4_arg0( f5_arg0, f5_arg1.weaponRef )
			f4_arg0( f5_arg0, f5_arg1.weaponRef, f4_arg0 )
			f4_arg0( f5_arg0, f5_arg0._currentRow )
		end
		return true
	end )
end

local f0_local26 = function ( f3_arg0, f3_arg1 )
	f3_arg0._enabled = f3_arg1
end

local f0_local27 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._weaponCount = 0
	f2_arg0._currentRow = 1
	f2_arg0._progressionRows = {}
	f2_arg0._WeaponLists = {}
	f2_arg0.SetupProgressionUnlocks = f0_local0
	f2_arg0.SetupDefaultFocus = f0_local0
	f2_arg0.SortProgressionUnlocksElements = f0_local0
	f2_arg0.SetEnabled = f0_local0
	f0_local0( f2_arg0, f2_arg1 )
	f0_local0( f2_arg0, f2_arg1 )
	f0_local0( f2_arg0, f2_arg1 )
end

function GunsmithProgressionPanel( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "GunsmithProgressionPanel"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self:setUseStencil( true )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "GunsmithProgressionPanel", GunsmithProgressionPanel )
LockTable( _M )
