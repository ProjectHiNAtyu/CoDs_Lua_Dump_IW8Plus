-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:49
module( ..., package.seeall )
local f0_local0 = 468
local f0_local1 = 64
local f0_local2 = 90
local f0_local3 = 16
local f0_local4 = 24
local f0_local5 = 200
local f0_local6 = 15
local f0_local7 = 804
local f0_local8 = function ( f12_arg0, f12_arg1, f12_arg2, f12_arg3 )
	local f12_local0 = {}
	local f12_local1 = #f12_arg2
	for f12_local2 = 1, f12_local1, 1 do
		local f12_local5 = f12_arg2[f12_local2]
		local f12_local6 = OnlineChallenges[0xF76B36D35A1A81D]( f12_arg1, f12_local5.id )
		f12_local5.order = f12_local2
		f12_local5.orderOutOf = f12_local1
		local f12_local7 = not String.IsNilOrEmpty( f12_local5.factionToUnlock )
		f12_local5.lockedByRepChallenge = f12_local7
		local f12_local8
		if f12_local7 then
			f12_local8 = f12_local7
		else
			f12_local8 = f12_arg3[f12_local5.factionToUnlock].currentLevel - 1 < tonumber( f12_local5.factionRankToUnlock )
		end
		f12_local5.lockedByRep = f12_local8
		f12_local5.completedChallenge = f12_local6 == Challenge.State.FINISHED
		f12_local5.requiresPreviousCompletion = 1 < f12_local2
		if f12_local6 ~= Challenge.State.IN_PROGRESS then
			f12_local8 = not f12_local5.completedChallenge
		else
			f12_local8 = false
		end
		f12_local5.lockedByCompletion = f12_local8
		f12_local5.premiumChallenge = DMZ.IsPMCPremium( f12_local5.factionToUnlock )
		f12_local8 = f12_local5.premiumChallenge
		if f12_local8 then
			f12_local8 = not Engine[0x8B495DC361731F7]( f12_arg1 )
		end
		f12_local5.lockedByPremium = f12_local8
		if f12_local5.pmc ~= "" then
			f12_local8 = DMZ.GetPMCUnlockRequirement( f12_local5.pmc, f12_arg1 )
			local f12_local9
			if f12_local5.pmc ~= "crown" and not f12_local8 then
				f12_local9 = f12_local8
			else
				f12_local9 = ""
			end
			f12_local5.factionUnlockString = f12_local9
			f12_local5.unlockDailyMission = true
		end
		if #f12_local0 == 0 and f12_local5.amountEarned ~= f12_local5.amountNeeded then
			f12_local0[1] = f12_local5
		end
		if f12_local5.amountEarned ~= f12_local5.amountNeeded then
			f12_local0[#f12_local0 + 1] = f12_local5
		end
	end
	for f12_local2 = 1, #f12_arg2, 1 do
		local f12_local5 = f12_arg2[f12_local2]
		if f12_local5.amountNeeded <= f12_local5.amountEarned then
			f12_local0[#f12_local0 + 1] = f12_local5
		end
	end
	return f12_local0
end

local f0_local9 = function ( f11_arg0 )
	local f11_local0 = {}
	local f11_local1 = {}
	for f11_local2 = 1, #f11_arg0, 1 do
		local f11_local5 = f11_arg0[f11_local2]
		local f11_local6 = true
		for f11_local10, f11_local11 in ipairs( f11_local5 ) do
			if f11_local11.amountEarned < f11_local11.amountNeeded then
				f11_local6 = false
				break
			end
		end
		if f11_local6 then
			table.insert( f11_local0, f11_local5 )
		else
			table.insert( f11_local1, f11_local5 )
		end
	end
	for f11_local12, f11_local5 in ipairs( f11_local0 ) do
		table.insert( f11_local1, f11_local5 )
	end
	return f11_local1
end

local f0_local10 = function ( f10_arg0 )
	local f10_local0 = math.abs( f10_arg0._scrollOffset )
	local f10_local1 = f10_local0 + f0_local0
	local f10_local2 = 0
	local f10_local3 = 0
	for f10_local12, f10_local13 in ipairs( f10_arg0._trackButtons ) do
		local f10_local7 = f0_local0
		local f10_local14 = f10_local13.TopButton
		local f10_local15 = f10_local13:HasChildren()
		if f10_local15 then
			f10_local7 = f0_local0
		end
		f10_local2 = f10_local2 + f10_local7
		if f10_local3 == 0 then
			f10_local2 = 0
		end
		f10_local3 = f10_local3 + f10_local7
		if f10_local14:isInFocus() and not f10_local13:IsExpanded() then
			if f10_local12 == 1 then
				f10_arg0._scrollOffset = 0
			elseif f10_local2 < f10_local0 then
				local f10_local8
				if f10_local15 then
					f10_local8 = f0_local0
					if not f10_local8 then
					
					else
						f10_arg0._scrollOffset = f10_local2 + f10_local8
					end
				end
				f10_local8 = f0_local0
			elseif f10_local1 < f10_local3 then
				local f10_local8 = f10_local3 - f0_local0
				local f10_local9
				if f10_local15 then
					f10_local9 = f0_local0
					if not f10_local9 then
					
					else
						f10_arg0._scrollOffset = f10_local8 + f10_local9
					end
				end
				f10_local9 = f0_local0
			end
		end
		local f10_local8 = f10_local13:GetExpansionOffset()
		local f10_local9 = f10_local13:HasChildInFocus()
		f10_local2 = f10_local2 + f10_local8
		f10_local3 = f10_local3 + f10_local8
		if f10_local14:isInFocus() or f10_local9 then
			if f10_local12 == 1 then
				f10_arg0._scrollOffset = 0
			elseif f10_local2 < f10_local0 then
				local f10_local10
				if f10_local15 then
					f10_local10 = f0_local0
					if not f10_local10 then
					
					else
						f10_arg0._scrollOffset = f10_local2 + f10_local10
					end
				end
				f10_local10 = f0_local0
			elseif f10_local1 < f10_local3 then
				local f10_local10 = f10_local3 - f0_local0
				local f10_local11
				if f10_local15 then
					f10_local11 = f0_local0
					if not f10_local11 then
					
					else
						f10_arg0._scrollOffset = f10_local10 + f10_local11
					end
				end
				f10_local11 = f0_local0
			end
		end
		local f10_local10
		if f10_local15 then
			f10_local10 = f0_local0
			if not f10_local10 then
			
			else
				f10_local2 = f10_local2 + f10_local10
				if f10_local15 then
					f10_local10 = f0_local0
					if not f10_local10 then
					
					else
						f10_local3 = f10_local3 + f10_local10
					end
				end
				f10_local10 = f0_local0
			end
		end
		f10_local10 = f0_local0
	end
	if f10_local3 < f0_local0 then
		f10_arg0._scrollOffset = 0
	elseif f0_local0 < f10_local3 and f10_local3 - f10_arg0._scrollOffset < f0_local0 then
		f10_arg0._scrollOffset = f10_local3 - f0_local0
	end
end

local f0_local11 = function ( f9_arg0, f9_arg1 )
	if f9_arg1 then
		f9_arg0._scrollOffset = f9_arg1
	else
		f0_local0( f9_arg0 )
	end
	local f9_local0 = -f9_arg0._scrollOffset
	for f9_local1 = 1, #f9_arg0._trackButtons, 1 do
		local f9_local4 = f9_arg0._trackButtons[f9_local1]
		local f9_local5 = f9_local4:HasChildren() and f0_local0 or f0_local0
		f9_local4:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f0_local0 * _1080p, f9_local0 * _1080p, (f9_local0 + f9_local5) * _1080p, f0_local0 )
		f9_local0 = f9_local0 + f9_local5 + f9_local4:GetExpansionOffset() + (f9_local4:HasChildren() and f0_local0 or f0_local0)
	end
	f9_arg0._maxScrollHeight = f9_local0 - f0_local0 + f9_arg0._scrollOffset
	if f9_arg0._maxScrollHeight == 0 then
		f9_local1 = 0
	else
		local f9_local1 = f9_arg0._scrollOffset / f9_arg0._maxScrollHeight
	end
	local f9_local2 = {
		name = "dmz_upgrades_scroll"
	}
	if f0_local0 > f9_local0 and 0 >= f9_arg0._scrollOffset then
		f9_local3 = false
	else
		local f9_local3 = true
	end
	f9_local2.visible = f9_local3
	f9_local2.vertical = f9_arg0._maxScrollHeight
	f9_local2.percent = f9_local1
	f9_arg0:dispatchEventToCurrentLayer( f9_local2 )
end

local f0_local12 = function ( f8_arg0, f8_arg1 )
	f8_arg0._activelyExpandedWidget = nil
	if 0 < #f8_arg0._trackButtons then
		for f8_local3, f8_local4 in ipairs( f8_arg0._trackButtons ) do
			f8_local4:closeTree()
		end
		f8_arg0._trackButtons = {}
	end
	local f8_local0 = f0_local0( f8_arg1.tracks )
	f8_arg0._scrollOffset = 0
	local f8_local1 = 0
	for f8_local2 = 1, #f8_local0, 1 do
		local f8_local5 = f0_local0( f8_arg0, f8_arg0._controllerIndex, f8_local0[f8_local2], f8_arg0._factionReputationData )
		local f8_local6 = MenuBuilder.BuildRegisteredType( "DMZBaseExpander" )
		f8_arg0:addElement( f8_local6 )
		table.insert( f8_arg0._trackButtons, f8_local6 )
		f8_local6:SetTrack( f8_local5 )
		local f8_local7
		if f8_local6:HasChildren() and not f8_local6:IsExpanded() then
			f8_local7 = f0_local0
			if not f8_local7 then
			
			else
				f8_local6.TopButton:Setup( f8_local5[1] )
				f8_local6:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f0_local0 * _1080p, f8_local1 * _1080p, (f8_local1 + f8_local7) * _1080p )
				f8_local1 = f8_local1 + f8_local7 + (f8_local6:HasChildren() and f0_local0 or f0_local0)
				if f8_local6:HasChildren() then
					ACTIONS.AnimateSequence( f8_local6, "ShowExpanderUtility" )
				else
					ACTIONS.AnimateSequence( f8_local6, "HideExpanderUtility" )
				end
			end
		end
		f8_local7 = f0_local0
	end
	f8_arg0._maxScrollHeight = f8_local1 - f0_local0 + f8_arg0._scrollOffset
	f8_arg0:dispatchEventToCurrentLayer( {
		name = "dmz_upgrades_scroll",
		percent = 0,
		visible = f0_local0 < f8_local1,
		vertical = f8_arg0._maxScrollHeight
	} )
	f8_arg0._elementInFocus = 1
	f8_arg0._trackButtons[f8_arg0._elementInFocus].TopButton:processEvent( {
		name = "gain_focus",
		controller = f8_arg0._controllerIndex
	} )
end

local f0_local13 = function ( f7_arg0, f7_arg1 )
	f0_local0( f7_arg0, f7_arg0._maxScrollHeight - f7_arg1 )
end

local f0_local14 = function ( f6_arg0 )
	return f6_arg0._trackButtons[f6_arg0._elementInFocus]
end

local f0_local15 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0.SetupCategoryTracks = f0_local0
	f2_arg0.RepositionTrackWidgets = f0_local0
	f2_arg0.SetScrollOffset = f0_local0
	f2_arg0.GetElementInFocus = f0_local0
	f2_arg0._trackButtons = {}
	f2_arg0._activelyExpandedWidget = nil
	f2_arg0._scrollOffset = 0
	f2_arg0._factionReputationData = {}
	for f2_local3, f2_local4 in pairs( DMZ.FactionReputationChallenges ) do
		f2_arg0._factionReputationData[f2_local3] = DMZ.GetPMCFactionReputationData( f2_arg1, f2_local3 )
	end
	f2_arg0:registerEventHandler( "dmz_upgrades_expander", function ( element, event )
		local f4_local0 = element._dirty and true
		if element._activelyExpandedWidget and element._activelyExpandedWidget:IsExpanded() then
			if element._activelyExpandedWidget:Collapse() then
				element._trackButtons[element._elementInFocus].TopButton:processEvent( {
					name = "gain_focus",
					controller = f2_arg0._controllerIndex
				} )
			end
			element._trackButtons[element._elementInFocus]._childrenInFocus = false
			element._trackButtons[element._elementInFocus]._elementInFocus = 0
			element._dirty = true
		end
		if event.expanderWidget and element._activelyExpandedWidget ~= event.expanderWidget and event.expanderWidget:CanExpand() then
			event.expanderWidget:Expand()
			element._activelyExpandedWidget = event.expanderWidget:IsExpanded() and event.expanderWidget or nil
			element._dirty = true
		elseif element._activelyExpandedWidget == event.expanderWidget and element._dirty then
			element._activelyExpandedWidget = nil
		end
		if element._dirty then
			element:RepositionTrackWidgets()
			f4_local0 = element:Wait( f2_arg0 + f2_arg0 )
			f4_local0.onComplete = function ( f5_arg0 )
				f5_arg0._dirty = false
			end
			
		end
		return true
	end )
	f2_arg0:addEventHandler( "gamepad_button", function ( f3_arg0, f3_arg1 )
		if not f3_arg1.down then
			return 
		elseif f3_arg1.qualifier == "mousewheel" and 0 < f2_arg0._maxScrollHeight then
			local f3_local0 = f2_arg0
			local f3_local1 = f2_arg0._scrollOffset
			local f3_local2 = f2_arg0._maxScrollHeight * 0.25
			local f3_local3
			if f3_arg1.button == "up" then
				f3_local3 = -1
			else
				f3_local3 = 1
			end
			f3_local0._scrollOffset = f3_local1 + f3_local2 * f3_local3
			f2_arg0._scrollOffset = LUI.clamp( f2_arg0._scrollOffset, 0, f2_arg0._maxScrollHeight )
			f2_arg0( f2_arg0, f2_arg0._scrollOffset )
			if f2_arg0._maxScrollHeight == 0 then
				f3_local0 = 0
			else
				f3_local0 = f2_arg0._scrollOffset / f2_arg0._maxScrollHeight
			end
			f2_arg0:dispatchEventToCurrentLayer( {
				name = "dmz_upgrades_scroll",
				visible = 0 < f2_arg0._maxScrollHeight,
				vertical = f2_arg0._maxScrollHeight,
				percent = f3_local0
			} )
		elseif f3_arg1.qualifier ~= "mousewheel" then
			local f3_local0 = f3_arg0._elementInFocus
			local f3_local1 = f3_arg0._trackButtons[f3_arg0._elementInFocus]
			if f3_arg1.button == "down" then
				if f3_local1:IsExpanded() and not f3_local1:HandleMovement( true ) then
					f3_arg0._trackButtons[f3_local0].TopButton:processEvent( {
						name = "lose_focus",
						controller = f3_arg0._controllerIndex
					} )
					f2_arg0( f2_arg0 )
					return true
				end
				f3_arg0._elementInFocus = f3_arg0._elementInFocus + 1
				if #f3_arg0._trackButtons < f3_arg0._elementInFocus then
					f3_arg0._elementInFocus = 1
				end
			elseif f3_arg1.button == "up" then
				if f3_local1:IsExpanded() and not f3_local1:HandleMovement( false ) then
					f2_arg0( f2_arg0 )
					return true
				end
				f3_arg0._elementInFocus = f3_arg0._elementInFocus - 1
				if f3_arg0._elementInFocus == 0 then
					f3_arg0._elementInFocus = #f3_arg0._trackButtons
				end
				if f3_arg0._trackButtons[f3_arg0._elementInFocus]:IsExpanded() then
					f3_arg0._trackButtons[f3_local0].TopButton:processEvent( {
						name = "lose_focus",
						controller = f3_arg0._controllerIndex
					} )
					f3_arg0._trackButtons[f3_arg0._elementInFocus]:HandleMovement( false )
					f2_arg0( f2_arg0 )
					return 
				end
			end
			if f3_local0 ~= f3_arg0._elementInFocus then
				f3_arg0._trackButtons[f3_local0].TopButton:processEvent( {
					name = "lose_focus",
					controller = f3_arg0._controllerIndex
				} )
				f3_arg0._trackButtons[f3_arg0._elementInFocus].TopButton:processEvent( {
					name = "gain_focus",
					controller = f3_arg0._controllerIndex
				} )
				f2_arg0( f2_arg0 )
				return true
			end
		end
	end )
	f2_arg0:SetHandleMouse( true )
end

function DMZBaseList( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 556 * _1080p, 0, 804 * _1080p )
	self.id = "DMZBaseList"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f0_local0( self, LUI.ValidateControllerIndex( self, f1_local1 ), controller )
	return self
end

MenuBuilder.registerType( "DMZBaseList", DMZBaseList )
LockTable( _M )
