-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.widgets.AARContentHeader" )
require( "ui.frontEnd.LimitedTimeItem" )
require( "ui.widgets.ButtonPromptContainer" )
local f0_local0 = function ( f27_arg0 )
	if f27_arg0._bundleData then
		return f27_arg0._bundleData.name
	else
		
	end
end

local f0_local1 = function ( f26_arg0 )
	f26_arg0:SetVisible( false )
	f26_arg0:SetMouseFocusBlocker( true )
	if f26_arg0._currentMenu then
		if f26_arg0._usePrimary then
			f26_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_primary"
			} )
		elseif f26_arg0._altButton == "alt1" then
			f26_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_alt1"
			} )
		elseif f26_arg0._altButton == "left_trigger" then
			f26_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_left_trigger"
			} )
		end
	end
end

local f0_local2 = function ( f25_arg0, f25_arg1 )
	f25_arg0:SetVisible( true )
	f25_arg0:SetMouseFocusBlocker( false )
	f25_arg0.BundleTypeLabel.Text:setText( Engine[0xED84C33EC5F01EA]( f25_arg1.bundleType ) )
	if f25_arg1.image and 0 < #f25_arg1.image then
		f25_arg0.BundleImage:setImage( RegisterMaterial( f25_arg1.image ) )
	else
		f25_arg0.BundleImage:setImage( RegisterMaterial( "white" ) )
	end
	if f25_arg1.titleImage and 0 < #f25_arg1.titleImage then
		f25_arg0.BundleNameImage:setImage( RegisterMaterial( f25_arg1.titleImage ) )
	else
		f25_arg0.BundleNameImage:setImage( RegisterMaterial( "white" ) )
	end
	f25_arg0.LimitedTime:SetupTimeLimit( nil )
	f25_arg0.LimitedTime:SetAlpha( 0 )
	if f25_arg0._currentMenu then
		if f25_arg0._usePrimary then
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_primary"
			} )
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PushButtonPrompt( {
				force_display = true,
				ignoreTooltipPrompt = true,
				priority = 1,
				side = "left",
				button_ref = "button_primary",
				helper_text = Engine[0xED84C33EC5F01EA]( "MENU/VIEW_BUNDLE_PROMPT" ),
				container = f25_arg0.BundlePromptContainer
			} )
		elseif f25_arg0._altButton == "alt1" then
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_alt1"
			} )
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_left_trigger"
			} )
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PushButtonPrompt( {
				side = "left",
				ignoreTooltipPrompt = true,
				priority = 1,
				button_ref = "button_alt1",
				helper_text = Engine[0xED84C33EC5F01EA]( "MENU/VIEW_BUNDLE_PROMPT" ),
				container = f25_arg0.BundlePromptContainer
			} )
		elseif f25_arg0._altButton == "left_trigger" then
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_left_trigger"
			} )
			f25_arg0._currentMenu.HelperBar.ButtonHelperText:PushButtonPrompt( {
				side = "left",
				ignoreTooltipPrompt = true,
				priority = 1,
				button_ref = "button_left_trigger",
				helper_text = Engine[0xED84C33EC5F01EA]( "MENU/VIEW_BUNDLE_PROMPT" ),
				container = f25_arg0.BundlePromptContainer
			} )
		end
	end
end

local f0_local3 = function ( f24_arg0, f24_arg1 )
	local f24_local0
	if LUI.IsItemInArray( f24_arg0.hiddenItemsIDs, f24_arg1 ) == nil and LUI.IsItemInArray( f24_arg0.visibleItemsIDs, f24_arg1 ) == nil then
		f24_local0 = false
	else
		f24_local0 = true
	end
	return f24_local0
end

local f0_local4 = function ( f23_arg0, f23_arg1, f23_arg2 )
	local f23_local0 = STORE.GetAllBundles( f23_arg2 )
	local f23_local1 = nil
	if f23_arg0 == LOOT.itemTypes.WEAPON and WEAPON.IsVariantRef( f23_arg1 ) then
		f23_local1 = WEAPON.GetVariantID( f23_arg1 )
	else
		f23_local1 = LOOT.GetItemID( f23_arg0, f23_arg1 )
	end
	local f23_local2 = {}
	for f23_local9, f23_local10 in ipairs( f23_local0 ) do
		local f23_local6
		if f23_local1 then
			f23_local6 = f0_local0( f23_local10, f23_local1 )
			if not f23_local6 then
			
			else
				local f23_local7 = f23_local10.id
				local f23_local8
				if f23_local6 then
					f23_local8 = f23_local6
				else
					f23_local8 = STORE.BundleAvailable( f23_arg2, f23_local7 )
				end
				if f23_local8 then
					table.insert( f23_local2, f23_local10 )
				end
			end
		end
		f23_local6 = false
	end
	return f23_local2
end

local f0_local5 = function ( f22_arg0 )
	return hashset( split( Engine[0x8B495DC361731F7]( f22_arg0 ) and Dvar[0x54084D7CA2317BB]( "#x3956a2235503bc524" ) or Dvar[0x54084D7CA2317BB]( "#x32688a49a40cfb94b" ), "," ) )
end

local f0_local6 = function ( f21_arg0, f21_arg1, f21_arg2 )
	local f21_local0 = OPERATOR.GetOperatorSkinRefs( f21_arg1 )
	local f21_local1 = {}
	local f21_local2 = #f21_local0
	for f21_local3 = 1, f21_local2, 1 do
		LUI.ConcatenateToTable( f21_local1, f0_local0( LOOT.itemTypes.OPERATOR_SKIN, f21_local0[f21_local3], f21_arg2 ) )
	end
	local f21_local3 = f0_local0( f21_arg2 )
	local f21_local4 = nil
	for f21_local8, f21_local9 in ipairs( f21_local1 ) do
		if f21_local3[f21_local9.id] then
			f21_local4 = f21_local9
			break
		end
	end
	if not f21_local4 then
		f21_local5 = f21_local4
	else
		f21_local5 = f21_local1[1]
	end
	return f21_local5
end

local f0_local7 = function ( f20_arg0, f20_arg1, f20_arg2 )
	if f20_arg0 == LOOT.itemTypes.OPERATOR then
		return f0_local0( f20_arg0, f20_arg1, f20_arg2 )
	else
		local f20_local0 = f0_local0( f20_arg0, f20_arg1, f20_arg2 )
		return f20_local0[1]
	end
end

local f0_local8 = function ( f19_arg0, f19_arg1 )
	if f19_arg0._bundleData then
		if f19_arg0._preOpenStoreBundlePreviewFunc then
			f19_arg0:_preOpenStoreBundlePreviewFunc( f19_arg1 )
		end
		local f19_local0 = tonumber( f19_arg0._bundleData.id )
		local f19_local1 = STORE.IsFirstPartyBundle( f19_local0 )
		local f19_local2 = nil
		if f19_local1 then
			f19_local2 = STORE.GetFirstPartyBundleData( f19_arg0._controllerIndex, f19_local0, STORE.GetFirstPartyProductID( f19_local0 ) )
		else
			f19_local2 = {
				displayUpsellPopup = true,
				bundleID = tonumber( f19_arg0._bundleData.id ),
				rarity = tonumber( f19_arg0._bundleData.rarity ),
				description = f19_arg0._bundleData.description,
				bundleType = f19_arg0._bundleData.bundleType,
				titleImage = f19_arg0._bundleData.titleImage,
				currencyID = tonumber( f19_arg0._bundleData.currencyID ),
				currencyAmount = tonumber( f19_arg0._bundleData.currencyAmount ),
				timerPubVar = f19_arg0._timePubVar
			}
		end
		LUI.FlowManager.RequestAddMenu( "StoreBundlePreview", true, f19_arg0._controllerIndex, false, f19_local2, false, true )
		return true
	else
		
	end
end

local f0_local9 = function ( f18_arg0, f18_arg1 )
	if not f18_arg0._bundleData then
		f18_arg0:HideButton()
		f18_arg0:processEvent( {
			name = "on_upsell_button_hidden",
			controllerIndex = f18_arg1
		} )
		f18_arg0:registerEventHandler( "button_action", nil )
		f18_arg0:registerEventHandler( "view_bundle", nil )
	else
		f18_arg0:ShowButton( f18_arg0._bundleData )
		f18_arg0:processEvent( {
			name = "on_upsell_button_shown",
			controllerIndex = f18_arg1
		} )
		f18_arg0:registerEventHandler( "button_action", f0_local0 )
		f18_arg0:registerEventHandler( "view_bundle", f0_local0 )
	end
end

local f0_local10 = function ( f17_arg0, f17_arg1, f17_arg2, f17_arg3, f17_arg4 )
	if not f17_arg4 then
		if Dvar[0x9E5BE3B4BBA4E0E]( "#x3cf763f815071797d" ) and not CONDITIONS.InGame() then
			f17_arg0._bundleData = f0_local0( f17_arg2, f17_arg3, f17_arg1 )
		else
			f17_arg0._bundleData = nil
		end
	else
		f17_arg0._bundleData = f17_arg4
	end
	f17_arg0:RefreshUpsellButton( f17_arg1 )
end

local f0_local11 = function ( f16_arg0, f16_arg1 )
	f16_arg0._preOpenStoreBundlePreviewFunc = f16_arg1
end

local f0_local12 = function ( f15_arg0 )
	f15_arg0._usePrimary = true
end

local f0_local13 = function ( f14_arg0, f14_arg1, f14_arg2 )
	f14_arg0._altButton = f14_arg1
end

local f0_local14 = function ( f12_arg0 )
	f12_arg0:registerEventHandler( "gamepad_button", function ( element, event )
		if not element._usePrimary and element:IsVisible() and event.button == element._altButton and event.down then
			f12_arg0( element, event )
		end
	end )
end

local f0_local15 = function ( f6_arg0, f6_arg1, f6_arg2 )
	f6_arg0._usePrimary = false
	f6_arg0._altButton = "alt2"
	f6_arg0._controllerIndex = f6_arg1
	f6_arg0.SetupUpsellButton = f0_local0
	f6_arg0.SetPreOpenStoreBundlePreviewFunc = f0_local0
	f6_arg0.RefreshUpsellButton = f0_local0
	f6_arg0.HideButton = f0_local0
	f6_arg0.ShowButton = f0_local0
	f6_arg0.SetButtonPrimary = f0_local0
	f6_arg0.SetButtonAlt = f0_local0
	f6_arg0.GetBundleName = f0_local0
	f6_arg0:HideButton()
	f0_local0( f6_arg0, f6_arg0._altButton )
	f0_local0( f6_arg0 )
	f6_arg0.BundleImage:SetMask( f6_arg0.Mask )
	f6_arg0:addEventHandler( "on_close", function ( f11_arg0 )
		f11_arg0._preOpenStoreBundlePreviewFunc = nil
	end )
	f6_arg0:addAndCallEventHandler( "update_input_type", function ( f10_arg0, f10_arg1 )
		if LUI.IsLastInputMouseNavigation( f6_arg0 ) then
			f10_arg0:SetFocusable( true )
		else
			f10_arg0:SetFocusable( false )
			f10_arg0:processEvent( {
				name = "lose_focus"
			} )
		end
	end )
	if IsLanguageChinese() or IsLanguageArabic() then
		ACTIONS.AnimateSequence( f6_arg0, "LimitedTimeCHTAR" )
	end
	if not IsLanguageArabic() then
		f6_arg0.LimitedTime:SetIsShort( true )
	end
	local f6_local0 = function ( f9_arg0, f9_arg1 )
		if not f9_arg0._currentMenu then
			f9_arg0._currentMenu = f9_arg0:GetCurrentMenu()
		end
		if f9_arg0._bundleData then
			f9_arg0:ShowButton( f9_arg0._bundleData )
		end
	end
	
	f6_arg0:addEventHandler( "menu_create", function ( f8_arg0, f8_arg1 )
		f6_arg0( f8_arg0, f8_arg1 )
	end )
	f6_arg0:addEventHandler( "tab_create", function ( f7_arg0, f7_arg1 )
		f6_arg0( f7_arg0, f7_arg1 )
	end )
end

function BundleUpsellButton( menu, controller )
	local self = LUI.UIButton.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 450 * _1080p, 0, 204 * _1080p )
	self.id = "BundleUpsellButton"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local BundleImage = nil
	
	BundleImage = LUI.UIFixedAspectRatioImage.new()
	BundleImage.id = "BundleImage"
	BundleImage:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, _1080p * -33, _1080p * 237 )
	self:addElement( BundleImage )
	self.BundleImage = BundleImage
	
	local BundleNameImage = nil
	
	BundleNameImage = LUI.UIImage.new()
	BundleNameImage.id = "BundleNameImage"
	BundleNameImage:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 10, _1080p * 240, _1080p * 11, _1080p * 125 )
	self:addElement( BundleNameImage )
	self.BundleNameImage = BundleNameImage
	
	local TitleDarkener = nil
	
	TitleDarkener = LUI.UIImage.new()
	TitleDarkener.id = "TitleDarkener"
	TitleDarkener:SetRGBFromTable( SWATCHES.genericMenu.blackBackground, 0 )
	TitleDarkener:SetAlpha( 0.6, 0 )
	TitleDarkener:setImage( RegisterMaterial( "widg_gradient_bottom_to_top" ), 0 )
	TitleDarkener:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, _1080p * 116, _1080p * 171 )
	self:addElement( TitleDarkener )
	self.TitleDarkener = TitleDarkener
	
	local BundleTypeLabel = nil
	
	BundleTypeLabel = MenuBuilder.BuildRegisteredType( "AARContentHeader", {
		controllerIndex = f1_local1
	} )
	BundleTypeLabel.id = "BundleTypeLabel"
	BundleTypeLabel.Text:setText( Engine[0xED84C33EC5F01EA]( "MENU/BUNDLE_TYPE_OPERATOR" ), 0 )
	BundleTypeLabel.Text:SetAlignment( LUI.Alignment.Left )
	BundleTypeLabel:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 10, _1080p * -12, _1080p * 117, _1080p * 167 )
	self:addElement( BundleTypeLabel )
	self.BundleTypeLabel = BundleTypeLabel
	
	local LimitedTime = nil
	
	LimitedTime = MenuBuilder.BuildRegisteredType( "LimitedTimeItem", {
		controllerIndex = f1_local1
	} )
	LimitedTime.id = "LimitedTime"
	LimitedTime:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 197, _1080p * 438, _1080p * 11, _1080p * 41 )
	self:addElement( LimitedTime )
	self.LimitedTime = LimitedTime
	
	local Mask = nil
	
	Mask = LUI.UIImage.new()
	Mask.id = "Mask"
	Mask:setImage( RegisterMaterial( "stencil_mask" ), 0 )
	Mask:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, _1080p * -5, _1080p * 171 )
	self:addElement( Mask )
	self.Mask = Mask
	
	local BundlePromptContainer = nil
	BundlePromptContainer = MenuBuilder.BuildRegisteredType( "ButtonPromptContainer", {
		controllerIndex = f1_local1
	} )
	BundlePromptContainer.id = "BundlePromptContainer"
	if CONDITIONS.AlwaysFalse() then
		BundlePromptContainer.Label:setText( "ButtonPrompt", 0 )
	end
	if CONDITIONS.AlwaysFalse() then
		BundlePromptContainer.Label:SetAlignment( LUI.Alignment.Center )
	end
	BundlePromptContainer:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * -1, _1080p * 449, _1080p * 176, _1080p * 206 )
	self:addElement( BundlePromptContainer )
	self.BundlePromptContainer = BundlePromptContainer
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local10 = nil
	BundleImage:RegisterAnimationSequence( "ButtonOver", {
		{
			value = -2.3534382785503553E-185,
			duration = 150,
			property = TWEEN_PROPERTY.Scale,
			easing = LUI.EASING.outQuadratic
		}
	} )
	self._sequences.ButtonOver = function ()
		menu:AnimateSequence( "ButtonOver" )
	end
	
	self._sequenceLengths.ButtonOver = 150
	local f1_local11 = nil
	BundleImage:RegisterAnimationSequence( "ButtonUp", {
		{
			value = 0,
			duration = -48,
			property = TWEEN_PROPERTY.Scale,
			easing = LUI.EASING.outQuadratic
		}
	} )
	self._sequences.ButtonUp = function ()
		menu:AnimateSequence( "ButtonUp" )
	end
	
	self._sequenceLengths.ButtonUp = 80
	local f1_local12 = nil
	LimitedTime:RegisterAnimationSequence( "LimitedTimeCHTAR", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Left,
			value = _1080p * 197
		},
		{
			duration = 0,
			property = TWEEN_PROPERTY.Right,
			value = _1080p * 438
		}
	} )
	self._sequences.LimitedTimeCHTAR = function ()
		menu:AnimateSequence( "LimitedTimeCHTAR" )
	end
	
	self._sequenceLengths.LimitedTimeCHTAR = 0
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "BundleUpsellButton", BundleUpsellButton )
LockTable( _M )
