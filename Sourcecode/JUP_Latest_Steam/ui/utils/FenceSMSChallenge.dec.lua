-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
LUI.FenceSMSChallenge = LUI.Class( LUI.Fence )
LUI.FenceSMSChallenge.init = function ( f16_arg0 )
	LUI.Fence.init( f16_arg0 )
	f16_arg0._smsChallengePassed = false
	f16_arg0._smsScreenOpened = false
	f16_arg0._phoneVerificationPassed = false
	f16_arg0._phoneVerificationScreenOpened = false
	f16_arg0._waitingOnSMSChallengeFlowToBeProcessed = false
	f16_arg0._waitingOnPhoneVerificationFlowToBeProcessed = false
end

local f0_local0 = function ( f15_arg0, f15_arg1 )
	if not f15_arg1.IsPhoneVerificationFlowProcessed( f15_arg0._controllerIndex ) then
		if not f15_arg0._waitingOnPhoneVerificationFlowToBeProcessed then
			f15_arg0._waitingOnPhoneVerificationFlowToBeProcessed = true
		end
		return true
	elseif f15_arg0._waitingOnPhoneVerificationFlowToBeProcessed then
		f15_arg0._waitingOnPhoneVerificationFlowToBeProcessed = false
	end
	return false
end

local f0_local1 = function ( f14_arg0 )
	if f14_arg0._phoneVerificationScreenOpened then
		if LUI.FlowManager.IsInStack( "SMSVerificationMenu" ) then
			return true
		end
		f14_arg0._phoneVerificationScreenOpened = false
	end
	return false
end

local f0_local2 = function ( f13_arg0 )
	if CONDITIONS[0x2DA54CF5D6B7F02]() and Dvar[0x9E5BE3B4BBA4E0E]( 0x672939948A3DD6C ) then
		if not f13_arg0._phoneVerificationPassed then
			f13_arg0._phoneVerificationPassed = true
		end
		return true
	else
		return false
	end
end

local f0_local3 = function ()
	local f12_local0 = LUI.FlowManager.GetTopMostOpenMenuInfo( nil )
	if f12_local0 and f12_local0.buildData then
		return f12_local0.buildData.isOnboardingMatureContent
	else
		return false
	end
end

local f0_local4 = function ( f11_arg0, f11_arg1 )
	if not f11_arg1.IsSMSChallengeFlowProcessed( f11_arg0._controllerIndex ) then
		if not f11_arg0._waitingOnSMSChallengeFlowToBeProcessed then
			f11_arg0._waitingOnSMSChallengeFlowToBeProcessed = true
		end
		return true
	elseif f11_arg0._waitingOnSMSChallengeFlowToBeProcessed then
		f11_arg0._waitingOnSMSChallengeFlowToBeProcessed = false
	end
	return false
end

local f0_local5 = function ( f10_arg0 )
	if f10_arg0._smsScreenOpened then
		if LUI.FlowManager.IsInStack( "SMSVerificationMenu" ) then
			return true
		end
		f10_arg0._smsScreenOpened = false
	end
	return false
end

local f0_local6 = function ( f9_arg0 )
	if PHONE_VERIFICATION.ShouldIgnoreSMSChallenge() then
		if not f9_arg0._smsChallengePassed then
			f9_arg0._smsChallengePassed = true
		end
		return true
	else
		return false
	end
end

LUI.FenceSMSChallenge.ProcessingVerification = function ( f8_arg0, f8_arg1, f8_arg2 )
	if f8_arg0:ProcessingPhoneVerification( f8_arg1, f8_arg2 ) then
		return 
	elseif f8_arg0:ProcessingSMSChallenge( f8_arg1, f8_arg2 ) then
		return 
	else
		f8_arg0:ProcessingPhoneVerificationConfirmation( f8_arg1, f8_arg2 )
	end
end

LUI.FenceSMSChallenge.ProcessingPhoneVerification = function ( f7_arg0, f7_arg1, f7_arg2 )
	if not PHONE_VERIFICATION.PlatformSupportPhoneVerification( f7_arg2 ) then
		return false
	end
	local f7_local0 = PHONE_VERIFICATION.PLATFORM_DATA[f7_arg2].phoneVerificationData
	if f0_local0( f7_arg0, f7_local0 ) then
		f7_arg0._state = LUI.Fence.STATE.block
		return true
	end
	local f7_local1 = f7_local0.IsPhoneRequired( f7_arg1 )
	if not f7_local1 then
		f7_local1 = Dvar[0x9E5BE3B4BBA4E0E]( 0x375CA29406A46CF )
	end
	local f7_local2 = f0_local0( f7_arg0, f7_arg1 )
	if not f7_local2 then
		f7_local2 = f7_arg0._phoneVerificationPassed and not f7_local1
	end
	if f7_local2 then
		return false
	elseif f0_local0( f7_arg0 ) or f0_local0() then
		f7_arg0._state = LUI.Fence.STATE.block
		return true
	elseif not f7_arg0._phoneVerificationPassed then
		if f7_local1 then
			f7_arg0._state = LUI.Fence.STATE.block
			PHONE_VERIFICATION.ResetPhoneVerificationConfirmationPending( f7_arg1 )
			LUI.FlowManager.RequestPopupMenu( nil, "SMSVerificationMenu", false, f7_arg1, false, {
				screen = f7_local0.screen
			}, nil, true, true )
			f7_arg0._phoneVerificationScreenOpened = true
			return true
		end
		f7_arg0._phoneVerificationPassed = true
		return false
	end
end

LUI.FenceSMSChallenge.ProcessingSMSChallenge = function ( f6_arg0, f6_arg1, f6_arg2 )
	if not PHONE_VERIFICATION.PlatformSupportSMSChallenge( f6_arg2 ) then
		return false
	end
	local f6_local0 = PHONE_VERIFICATION.PLATFORM_DATA[f6_arg2].smsChallengeData
	if f0_local0( f6_arg0, f6_local0 ) then
		f6_arg0._state = LUI.Fence.STATE.block
		return true
	end
	local f6_local1 = f6_local0.IsUserChallenged( f6_arg1 )
	if not f6_local1 then
		f6_local1 = Dvar[0x9E5BE3B4BBA4E0E]( 0x3FE1728C4DF0D0C )
	end
	local f6_local2 = f0_local0( f6_arg0, f6_arg1 )
	if not f6_local2 then
		f6_local2 = f6_arg0._smsChallengePassed and not f6_local1
	end
	if f6_local2 then
		return false
	elseif f0_local0( f6_arg0 ) then
		f6_arg0._state = LUI.Fence.STATE.block
		return true
	elseif not f6_arg0._smsChallengePassed then
		if f6_local1 then
			f6_arg0._state = LUI.Fence.STATE.block
			LUI.FlowManager.RequestPopupMenu( nil, "SMSVerificationMenu", false, f6_arg1, false, {
				screen = f6_local0.screen,
				url = f6_local0.GetSMSUrl( f6_arg1 )
			}, nil, true, true )
			f6_arg0._smsScreenOpened = true
			return true
		end
		f6_arg0._smsChallengePassed = true
		return false
	end
end

LUI.FenceSMSChallenge.ProcessingPhoneVerificationConfirmation = function ( f5_arg0, f5_arg1, f5_arg2 )
	if not PHONE_VERIFICATION.PlatformSupportPhoneVerification( f5_arg2 ) then
		return false
	end
	local f5_local0 = Engine[0x7B17D94988FD5D0]( "phoneVerificationRestartPending", f5_arg1 )
	if f5_local0 then
		if not Dvar[0x9E5BE3B4BBA4E0E]( 0x52210C273E4FAE0 ) then
			f5_local0 = not Dvar[0x9E5BE3B4BBA4E0E]( 0x672939948A3DD6C )
		else
			f5_local0 = false
		end
	end
	if f5_local0 then
		PHONE_VERIFICATION.DisplayPhoneVerificationConfirmationToast( f5_arg1 )
		PHONE_VERIFICATION.ResetPhoneVerificationConfirmationPending( f5_arg1 )
	end
end

LUI.FenceSMSChallenge.Start = function ( f4_arg0 )
	f4_arg0._controllerIndex = Engine[0x45B054C920178E9]()
end

LUI.FenceSMSChallenge.Stop = function ( f3_arg0 )
	
end

LUI.FenceSMSChallenge.PostFail = function ( f2_arg0 )
	
end

LUI.FenceSMSChallenge.UpdateState = function ( f1_arg0 )
	f1_arg0._state = LUI.Fence.STATE.pass
	if CONDITIONS.IsConsoleGame() then
		return 
	elseif CONDITIONS.IsBattleNet() then
		return 
	elseif CONDITIONS.IsSteamGame() then
		f1_arg0:ProcessingVerification( f1_arg0._controllerIndex, ClientPlatform.STEAM )
		return 
	else
		
	end
end

LUI.Fence.Register( "smsChallenge", LUI.FenceSMSChallenge )
LockTable( _M )
