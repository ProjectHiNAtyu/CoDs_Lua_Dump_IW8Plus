-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:04
QUARTERMASTER = QUARTERMASTER or {}
QUARTERMASTER.storeSession = {
	id = 0
}
QUARTERMASTER.itemData = {}
QUARTERMASTER.dlogEnabled = Dvar[0x9E5BE3B4BBA4E0E]( 0x83CB8EEA5E59813 )
QUARTERMASTER._logForDirectPurchase = false
QUARTERMASTER.GetMenuSource = function ( f21_arg0 )
	if f21_arg0 == "BladeMenu" then
		return f21_arg0
	elseif LUI.FlowManager.IsMenuOnTop( "BRMainMenu" ) then
		return "BRStore"
	elseif LUI.FlowManager.IsMenuOnTop( "MiniStorePopup" ) then
		return "MiniStore"
	else
		local f21_local0
		if Engine[0xCA085C21FCBD7CA]() then
			f21_local0 = "CPStore"
		else
			f21_local0 = "MPStore"
		end
	end
	return f21_local0
end

QUARTERMASTER.RefreshStoreSession = function ( f20_arg0, f20_arg1 )
	if Engine[0x8B495DC361731F7]( f20_arg0 ) then
		QUARTERMASTER.storeSession.storeName = Dvar[0x54084D7CA2317BB]( 0x64110B2B092E8FA )
	else
		QUARTERMASTER.storeSession.storeName = Dvar[0x54084D7CA2317BB]( 0x5015D57F0DB76C1 )
	end
	QUARTERMASTER.storeSession.storeRegion = Engine[0x2553ADACEC3D1C]()
	QUARTERMASTER.storeSession.storeLayout = f20_arg1.storeLayout or 0
	local f20_local0 = QUARTERMASTER.storeSession
	local f20_local1 = f20_arg1.recommendationData
	if f20_local1 then
		f20_local1 = f20_arg1.recommendationData.isEnabled
	end
	f20_local0.recommendationsEnabled = f20_local1
	QUARTERMASTER.storeSession.recommendedItems = f20_arg1.recommendationData and f20_arg1.recommendationData.items or "none"
end

QUARTERMASTER.RecordStoreEnterEvent = function ( f19_arg0, f19_arg1, f19_arg2, f19_arg3, f19_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.storeSession = {}
		QUARTERMASTER.storeSession.id = Engine[0x863AA6457598928]()
		local f19_local0 = QUARTERMASTER.GetMenuSource( f19_arg3 )
		QUARTERMASTER.RefreshStoreSession( f19_arg0, {
			storeLayout = f19_arg1
		} )
		local f19_local1 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f19_arg0, "dlog_event_item_shop_entry", {
			recommended_items = nil,
			recommendations_enabled = false,
			store_name = f19_local1.storeName,
			store_session_id = f19_local1.id,
			source = f19_local0,
			region = f19_local1.storeRegion,
			store_layout = f19_local1.storeLayout,
			is_premium = Engine[0x8B495DC361731F7]( f19_arg0 ) or false,
			categories = QUARTERMASTER.categories or "",
			is_entered = f19_arg4
		} )
		QUARTERMASTER.storeSession = f19_local1
		SOCIAL.GeneratePlayerSocialContextInstrumentation( f19_arg0, "dlog_event_player_social_context_store", false )
	end
end

QUARTERMASTER.RecordFocusPurchaseCPItemEvent = function ( f18_arg0, f18_arg1 )
	if not f18_arg1 then
		return 
	elseif QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f18_arg0, {
			storeLayout = 0
		} )
		local f18_local0 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f18_arg0, "dlog_event_store_item_browse", {
			store_name = f18_local0.storeName,
			store_session_id = f18_local0.id,
			source = QUARTERMASTER.GetMenuSource(),
			region = f18_local0.storeRegion,
			store_layout = f18_local0.storeLayout,
			item_id = f18_arg1.productId,
			item_name = f18_arg1.title,
			bundle_id = f18_arg1.productId,
			item_slot_in_category = f18_arg1.itemIndex
		} )
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.RecordRowChanged = function ( f17_arg0, f17_arg1, f17_arg2, f17_arg3, f17_arg4, f17_arg5, f17_arg6, f17_arg7 )
	if not f17_arg1 then
		return 
	end
	local f17_local0, f17_local1, f17_local2, f17_local3 = STORE.Bundles.Price( f17_arg0, f17_arg1 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f17_arg0, {
			storeLayout = 0
		} )
		local f17_local4 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f17_arg0, "dlog_event_store_qm_row_revealed", {
			store_name = f17_local4.storeName,
			store_session_id = f17_local4.id,
			source = QUARTERMASTER.GetMenuSource(),
			region = f17_local4.storeRegion,
			store_layout = f17_local4.storeLayout,
			category_index = f17_arg3,
			category_name = f17_arg2,
			item_id = STORE.Bundles.GetProductID( f17_arg1 ),
			item_name = STORE.Bundles.GetName( f17_arg1 ),
			bundle_id = f17_local2,
			item_slot_in_category = f17_arg4,
			tile_size = f17_arg5,
			num_items_shown = f17_arg6,
			sku_list = f17_arg7
		} )
		QUARTERMASTER.itemData = nil
	end
end

local f0_local0 = nil
QUARTERMASTER.RecordFocusStoreBundleEventStart = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3, f16_arg4 )
	if f0_local0 and f0_local0.bundle == f16_arg1 and f0_local0.categoryButtonIndex == f16_arg4 and f0_local0.categoryRowIndex == f16_arg3 and f0_local0.categoryName == f16_arg2 then
		return 
	else
		QUARTERMASTER.RecordFocusStoreBundleEventEnd( f16_arg0 )
		f0_local0 = {
			start_time = CoD.GetUTC(),
			bundle = f16_arg1,
			categoryName = f16_arg2,
			categoryRowIndex = f16_arg3,
			categoryButtonIndex = f16_arg4
		}
	end
end

QUARTERMASTER.GetSkuListFromBundles = function ( f15_arg0, f15_arg1 )
	local f15_local0 = {}
	for f15_local4, f15_local5 in ipairs( f15_arg1 ) do
		local f15_local6, f15_local7, f15_local8 = STORE.Bundles.Price( f15_arg0, f15_local5 )
		table.insert( f15_local0, f15_local8 )
	end
	return table.concat( f15_local0, "," )
end

QUARTERMASTER.RecordFocusStoreBundleEventEnd = function ( f14_arg0 )
	if not f0_local0 then
		return 
	end
	local f14_local0 = f0_local0.bundle
	local f14_local1 = f0_local0.categoryName
	local f14_local2 = f0_local0.categoryRowIndex
	local f14_local3 = f0_local0.categoryButtonIndex
	local f14_local4, f14_local5, f14_local6, f14_local7 = STORE.Bundles.Price( f14_arg0, f14_local0 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f14_arg0, {
			storeLayout = 0
		} )
		local f14_local8 = QUARTERMASTER.storeSession
		local f14_local9 = ""
		if not String.IsNilOrEmpty( f14_local1 ) then
			local f14_local10 = STORE.Cache.GetStorefrontData( f14_arg0 )
			local f14_local11 = f14_local10[STORE.Category.GetOrderNumber( f14_arg0, f14_local1 )]
			f14_local9 = QUARTERMASTER.GetSkuListFromBundles( f14_arg0, STORE.Bundles.GetAvailableBundlesWithSkus( f14_arg0, f14_local11.skuList, f14_local11.numItemsShown ) )
		end
		Engine[0x15D98DF5F61904B]( f14_arg0, "dlog_event_store_item_shop_item_browse", {
			store_name = f14_local8.storeName,
			store_session_id = f14_local8.id,
			source = QUARTERMASTER.GetMenuSource(),
			category_index = f14_local2,
			category_name = f14_local1,
			sku_list = f14_local9,
			region = f14_local8.storeRegion,
			store_layout = f14_local8.storeLayout,
			item_id = STORE.Bundles.GetProductID( f14_local0 ),
			item_name = STORE.Bundles.GetName( f14_local0 ),
			bundle_id = f14_local6,
			item_slot_in_category = f14_local3,
			start_time = f0_local0.start_time,
			end_time = CoD.GetUTC()
		} )
		QUARTERMASTER.itemData = nil
	end
	f0_local0 = nil
end

QUARTERMASTER.BeginMenuBrowseEvent = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3, f13_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f13_arg0, {
			storeLayout = f13_arg3,
			recommendationData = f13_arg4
		} )
		local f13_local0 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f13_local0.id
		QUARTERMASTER.itemData.start_time = Engine[0x3B8CFB6758EF57C]()
		QUARTERMASTER.itemData.category_index = f13_arg1.categoryIndex
		QUARTERMASTER.itemData.category_name = f13_arg1.name
		QUARTERMASTER.itemData.item_id = f13_arg2.id or 0
		QUARTERMASTER.itemData.item_name = f13_arg2.name
		QUARTERMASTER.itemData.position_in_grid = f13_arg2.positionInGrid or 0
	end
end

QUARTERMASTER.RecordMenuBrowseEvent = function ( f12_arg0, f12_arg1, f12_arg2 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f12_arg0, {
			storeLayout = 0
		} )
		local f12_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f12_local0.id == QUARTERMASTER.itemData.sessionId then
			local f12_local1 = QUARTERMASTER.GetMenuSource( f12_arg2 )
			local f12_local2 = QUARTERMASTER.itemData
			Engine[0x15D98DF5F61904B]( f12_arg0, "dlog_event_store_qm_menu_browse", {
				store_name = f12_local0.storeName,
				store_session_id = f12_local0.id,
				source = f12_local1,
				region = f12_local0.storeRegion,
				store_layout = f12_local0.storeLayout,
				category_index = f12_local2.category_index,
				category_name = f12_local2.category_name or "NA",
				item_id = f12_local2.item_id,
				item_name = f12_local2.item_name or "NA",
				start_time = tonumber( f12_local2.start_time ),
				end_time = tonumber( Engine[0x3B8CFB6758EF57C]() ),
				interacted = f12_arg1,
				item_slot_in_category = f12_local2.position_in_grid
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.RecordEnterDirectPurchase = function ( f11_arg0, f11_arg1 )
	if not QUARTERMASTER.dlogEnabled or not f11_arg1 then
		return 
	end
	local f11_local0, f11_local1 = nil
	if STORE.Bundles.IsDiscounted( f11_arg1 ) then
		f11_local0, f11_local0, f11_local1 = STORE.Bundles.DiscountedPrice( f11_arg1 )
	else
		f11_local0, f11_local0, f11_local1 = STORE.Bundles.Price( f11_arg0, f11_arg1 )
	end
	local f11_local2, f11_local3, f11_local4, f11_local5 = QUARTERMASTER.GetCurrentAndPreviousMenusAndTabs()
	Engine[0x15D98DF5F61904B]( f11_arg0, "dlog_event_store_direct_purchase_entry", {
		ts = Engine[0x3B8CFB6758EF57C](),
		current_menu = f11_local2,
		current_tab = f11_local3,
		previous_menu = f11_local4,
		previous_tab = f11_local5,
		item_id = STORE.Bundles.GetProductID( f11_arg1 ),
		item_name = STORE.Bundles.GetName( f11_arg1 ),
		sku_id = f11_local1,
		try_a_gun_enabled = CONDITIONS.IsTryAGunEnabled(),
		is_try_a_gun_region = CONDITIONS.IsTryAGunRegion()
	} )
end

QUARTERMASTER.InteractionType = {
	ATTEMPT_TO_PURCHASE = 2,
	OPEN_MINI_STORE_PREVIEW = 3,
	ATTEMPT_MINI_STORE_PURCHASE = 4,
	OPEN_PREVIEW = 1
}
QUARTERMASTER.GetCurrentAndPreviousMenusAndTabs = function ()
	local f9_local0 = LUI.FlowManager.GetMenuStack()
	local f9_local1 = #f9_local0
	if 1 <= f9_local1 then
		
	else
		
	end
	local f9_local2 = function ( f10_arg0 )
		if f10_arg0 < 1 then
			return 0x0, 0x0
		end
		local f10_local0 = f9_local0[f10_arg0]
		local f10_local1 = f10_local0.name or 0x0
		local f10_local2 = f10_local0.scopedData.focusedTabWidgetName or 0x0
		if type( f10_local1 ) ~= "xhash" then
			f10_local1 = 0x0 .. f10_local1
		end
		if type( f10_local2 ) ~= "xhash" then
			f10_local2 = 0x0 .. f10_local2
		end
		return f10_local1, f10_local2
	end
	
	local f9_local3, f9_local4 = f9_local2( f9_local1 )
	local f9_local5, f9_local6 = f9_local2( f9_local1 - 1 )
	return f9_local3, f9_local4, f9_local5, f9_local6
end

QUARTERMASTER.RecordInteraction = function ( f8_arg0, f8_arg1, f8_arg2 )
	if not QUARTERMASTER.dlogEnabled then
		return 
	else
		local f8_local0, f8_local1, f8_local2, f8_local3 = QUARTERMASTER.GetCurrentAndPreviousMenusAndTabs()
		local f8_local4, f8_local5, f8_local6 = STORE.Bundles.Price( f8_arg0, f8_arg1 )
		Engine[0x15D98DF5F61904B]( f8_arg0, "dlog_event_store_item_interact", {
			sku_id = f8_local6,
			item_id = STORE.Bundles.GetProductID( f8_arg1 ),
			item_name = STORE.Bundles.GetName( f8_arg1 ),
			interaction_type = f8_arg2,
			current_menu = f8_local0,
			current_tab = f8_local1,
			previous_menu = f8_local2,
			previous_tab = f8_local3
		} )
	end
end

local f0_local1 = nil
QUARTERMASTER.BeginStoreBundlePurchase = function ( f7_arg0, f7_arg1, f7_arg2, f7_arg3, f7_arg4, f7_arg5 )
	local f7_local0, f7_local1, f7_local2 = nil
	if STORE.Bundles.IsDiscounted( f7_arg1 ) then
		f7_local0, f7_local1, f7_local2 = STORE.Bundles.DiscountedPrice( f7_arg1 )
	else
		f7_local0, f7_local1, f7_local2 = STORE.Bundles.Price( f7_arg0, f7_arg1 )
	end
	local f7_local3 = {
		skuID = f7_local2,
		itemID = STORE.Bundles.GetProductID( f7_arg1 ),
		itemName = STORE.Bundles.GetName( f7_arg1 )
	}
	local f7_local4
	if f7_local1 == LOOT.CurrencyIDs.COD_POINTS and not f7_local0 then
		f7_local4 = f7_local0
	else
		f7_local4 = -1
	end
	f7_local3.priceCP = f7_local4
	if not f7_arg2 then
		f7_local4 = f7_arg2
	else
		f7_local4 = 1
	end
	f7_local3.quantity = f7_local4
	if not f7_arg3 then
		f7_local4 = f7_arg3
	else
		f7_local4 = STORE.DirectPurchaseCategoryName
	end
	f7_local3.categoryName = f7_local4
	if not f7_arg4 then
		f7_local4 = f7_arg4
	else
		f7_local4 = -1
	end
	f7_local3.categoryRowIndex = f7_local4
	if not f7_arg5 then
		f7_local4 = f7_arg5
	else
		f7_local4 = -1
	end
	f7_local3.categoryButtonIndex = f7_local4
	f0_local0 = f7_local3
end

QUARTERMASTER.EndStoreBundlePurchase = function ( f6_arg0, f6_arg1 )
	if not f0_local0 then
		return 
	elseif QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f6_arg0, f0_local0 )
		local f6_local0 = QUARTERMASTER.storeSession
		local f6_local1 = false
		local f6_local2 = QUARTERMASTER.GetMenuSource( f0_local0.source )
		local f6_local3, f6_local4, f6_local5, f6_local6 = QUARTERMASTER.GetCurrentAndPreviousMenusAndTabs()
		local f6_local7 = {
			store_name = f6_local0.storeName,
			store_session_id = f6_local0.id or 0,
			source = f6_local2,
			region = f6_local0.storeRegion,
			store_layout = f6_local0.storeLayout,
			category_index = f0_local0.categoryRowIndex,
			category_name = f0_local0.categoryName,
			item_id = f0_local0.itemID,
			item_name = f0_local0.itemName,
			sku_id = f0_local0.skuID,
			price_cp = f0_local0.priceCP,
			current_menu = f6_local3,
			current_tab = f6_local4,
			previous_menu = f6_local5,
			previous_tab = f6_local6,
			purchased = f6_arg1,
			err = not f6_arg1,
			item_slot_in_category = f0_local0.categoryButtonIndex,
			try_a_gun_enabled = CONDITIONS.IsTryAGunEnabled(),
			is_try_a_gun_region = CONDITIONS.IsTryAGunRegion(),
			quantity = f0_local0.quantity
		}
		Engine[0x15D98DF5F61904B]( f6_arg0, "dlog_event_store_qm_item_purchase", f6_local7 )
		Engine[0x15D98DF5F61904B]( f6_arg0, "dlog_event_item_shop_direct_purchase_upsell", f6_local7 )
	end
	f0_local0 = nil
end

QUARTERMASTER.FlushData = function ( f5_arg0 )
	if not QUARTERMASTER.storeSession.id then
		return 
	else
		QUARTERMASTER.RecordMenuBrowseEvent( f5_arg0, false )
	end
end

QUARTERMASTER.RecordCategories = function ( f4_arg0, f4_arg1 )
	QUARTERMASTER.categories = f4_arg1
end

QUARTERMASTER.RecordStorefrontEvent = function ( f3_arg0, f3_arg1 )
	if QUARTERMASTER.dlogEnabled then
		Engine[0x15D98DF5F61904B]( f3_arg0, "dlog_event_storefront_loaded", {
			category_name = f3_arg1.name,
			num_items_shown = f3_arg1.numItemsShown,
			sku_list = f3_arg1.skuList,
			tile_size = f3_arg1.tileSize,
			response_time_ms = f3_arg1.responseTime,
			task_time_ms = f3_arg1.taskTime
		} )
	end
end

QUARTERMASTER.RecordStorefrontErrorEvent = function ( f2_arg0, f2_arg1, f2_arg2, f2_arg3, f2_arg4, f2_arg5 )
	if QUARTERMASTER.dlogEnabled then
		Engine[0x15D98DF5F61904B]( f2_arg0, "dlog_event_storefront_error", {
			err_code = f2_arg1,
			type = f2_arg2,
			response_code = f2_arg3,
			response_time_ms = f2_arg4,
			error = f2_arg5
		} )
	end
end

QUARTERMASTER.WishlistLocationAdded = {
	SCOREBOARD = 3,
	SHOWCASE = 1,
	KILLCAM = 2,
	STORE = 0
}
QUARTERMASTER.RecordWishlistAddEvent = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3, f1_arg4 )
	if QUARTERMASTER.dlogEnabled then
		local f1_local0, f1_local1, f1_local2 = STORE.Bundles.Price( f1_arg0, f1_arg1 )
		local f1_local3, f1_local4, f1_local5, f1_local6 = QUARTERMASTER.GetCurrentAndPreviousMenusAndTabs()
		local f1_local7 = QUARTERMASTER.storeSession
		if f1_local7 then
			QUARTERMASTER.RefreshStoreSession( f1_arg0, {
				storeLayout = f1_local7.storeLayout
			} )
		end
		local f1_local8 = {
			sku_id = f1_local2
		}
		local f1_local9
		if not f1_arg2 then
			f1_local9 = f1_arg2
		else
			f1_local9 = 0
		end
		f1_local8.item_id = f1_local9
		if f1_arg2 then
			f1_local9 = LOOT.GetItemRef( f1_arg2 )
			if not f1_local9 then
			
			else
				f1_local8.item_name = f1_local9
				if f1_local7 then
					f1_local9 = f1_local7.storeName
					if not f1_local9 then
					
					else
						f1_local8.store_name = f1_local9
						if f1_local7 then
							f1_local9 = f1_local7.id
							if not f1_local9 then
							
							else
								f1_local8.store_session_id = f1_local9
								if f1_local7 then
									f1_local9 = f1_local7.storeRegion
									if not f1_local9 then
									
									else
										f1_local8.region = f1_local9
										if f1_local7 then
											f1_local9 = f1_local7.storeLayout
											if not f1_local9 then
											
											else
												f1_local8.store_layout = f1_local9
												f1_local8.current_menu = f1_local3
												f1_local8.current_tab = f1_local4
												f1_local8.previous_menu = f1_local5
												f1_local8.previous_tab = f1_local6
												f1_local8.location_added = f1_arg3
												f1_local8.succeeded = f1_arg4
												Engine[0x15D98DF5F61904B]( f1_arg0, "dlog_event_store_wishlist_add", f1_local8 )
											end
										end
										f1_local9 = 0
									end
								end
								f1_local9 = 0
							end
						end
						f1_local9 = 0
					end
				end
				f1_local9 = ""
			end
		end
		f1_local9 = ""
	end
end

