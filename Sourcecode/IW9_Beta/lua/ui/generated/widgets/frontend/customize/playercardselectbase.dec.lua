-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:01
module( ..., package.seeall )
local f0_local0 = LUI.DataSourceInControllerModel.new( PlayercardUtils.PlayerCardModelPath .. ".backgroundIndex" )
local f0_local1 = LUI.DataSourceInControllerModel.new( "frontEnd.MP.Showcase.callingCardEditor" .. ".background" )
local f0_local2 = function ( f29_arg0, f29_arg1 )
	local f29_local0 = PlayercardUtils.GetDataSources( f29_arg1 )
	if CONDITIONS.IsMobileOrMobileSim() then
		local f29_local1 = {
			index = f29_arg0._equippedPlayerCardIndex,
			image = f29_local0.background:GetValue( f29_arg1 ),
			isUnlocked = true
		}
		f29_arg0.CallingCardMain:RefreshButton( f29_arg0, f29_local1, false, f29_arg0._favoritePlayerCards[f29_local1.image] )
		f29_arg0.CallingCardShowcases:SetRefreshChild( function ( f30_arg0, f30_arg1, f30_arg2 )
			local f30_local0 = {
				index = 0,
				image = "mgl_ui_playercard_placeholder",
				isUnlocked = false
			}
			local f30_local1 = f29_arg0._favoritePlayerCards[f30_local0.image]
			f30_arg0:RefreshButton( f29_arg0, f30_local0, false, false )
		end )
	else
		f29_arg0.SmallPlayerCard:SetDataSource( f29_local0, f29_arg1 )
		if f29_arg0._showcaseIndex then
			local f29_local1 = CallingCardUtils.GetCardRef( f29_arg0._equippedPlayerCardIndex )
			local f29_local2 = CallingCardUtils.GetCardImage
			local f29_local3
			if not f29_local1 then
				f29_local3 = f29_local1
			else
				f29_local3 = ""
			end
			f29_arg0.SmallPlayerCard:OverrideBackground( f29_local2( f29_local3 ) )
		end
	end
end

local f0_local3 = function ( f28_arg0 )
	local f28_local0 = f28_arg0.PlayerCardGrid:GetCurrentActiveIndex()
	if not CONDITIONS.IsMobileOrMobileSim() or f28_local0 == -1 then
		f28_local0 = f28_arg0.PlayerCardGrid:GetFocusPositionIndex()
	end
	if f28_local0 then
		return f28_local0 + 1
	else
		
	end
end

local f0_local4 = function ( f26_arg0, f26_arg1 )
	f26_arg0._playerCardTable = {}
	if not f26_arg0._allPlayerCardsTable then
		f26_arg0._allPlayerCardsTable = CallingCardUtils.GetAllPlayerCards( f26_arg1, {
			unlockType = CallingCardUtils.Categories.CORE
		} )
	end
	local f26_local0 = 0
	local f26_local1 = 0
	for f26_local2 = 1, #f26_arg0._allPlayerCardsTable, 1 do
		local f26_local5 = f26_arg0._allPlayerCardsTable[f26_local2]
		if f26_local5.hideInUI ~= "1" then
			if f26_local5.isUnlocked then
				f26_local0 = f26_local0 + 1
				f26_local1 = f26_local1 + 1
			end
			if not f26_local5.isPremium then
				f26_local1 = f26_local1 + 1
			end
		end
	end
	f26_arg0.ItemsCollected:setText( Engine[0xED84C33EC5F01EA]( 0x48D718D82BA33FF, f26_local0, f26_local1 ) )
	for f26_local2 = 1, #f26_arg0._allPlayerCardsTable, 1 do
		if f26_arg0._allPlayerCardsTable[f26_local2].isUnlocked or f26_arg0.lockedSortingType == LOOT.lockedSortingOptions.SHOW then
			if not CONDITIONS.IsMobileOrMobileSim() or f26_arg0._equippedPlayerCardIndex ~= tonumber( f26_arg0._allPlayerCardsTable[f26_local2].index ) then
				table.insert( f26_arg0._playerCardTable, f26_arg0._allPlayerCardsTable[f26_local2] )
			else
				f26_arg0._equippedPlayerCard = f26_arg0._allPlayerCardsTable[f26_local2]
			end
		end
	end
	table.sort( f26_arg0._playerCardTable, function ( f27_arg0, f27_arg1 )
		if f26_arg0._favoritePlayerCards[f27_arg0.ref] ~= f26_arg0._favoritePlayerCards[f27_arg1.ref] then
			local f27_local0 = f26_arg0._favoritePlayerCards[f27_arg0.ref]
			if f27_local0 then
				f27_local0 = not f26_arg0._favoritePlayerCards[f27_arg1.ref]
			end
			return f27_local0
		end
		local f27_local0 = Loot[0xB853FAE9166621]( f26_arg0._controllerIndex, f27_arg0.lootID )
		local f27_local1 = Loot[0xB853FAE9166621]( f26_arg0._controllerIndex, f27_arg1.lootID )
		if f27_local0 ~= f27_local1 then
			local f27_local2
			if f27_local0 then
				f27_local2 = f27_local0
			else
				f27_local2 = not f27_local1
			end
			return f27_local2
		elseif f27_arg0.isUnlocked ~= f27_arg1.isUnlocked then
			local f27_local2 = f27_arg0.isUnlocked
			if f27_local2 then
				f27_local2 = not f27_arg1.isUnlocked
			end
			return f27_local2
		elseif f27_arg0.season ~= f27_arg1.season and f26_arg0.seasonsSortingType ~= LOOT.seasonsSortingOptions.NONE then
			if f26_arg0.seasonsSortingType == LOOT.seasonsSortingOptions.OLD_FIRST then
				return f27_arg0.season < f27_arg1.season
			elseif f26_arg0.seasonsSortingType == LOOT.seasonsSortingOptions.RECENT_FIRST then
				return f27_arg1.season < f27_arg0.season
			end
		end
		if f27_arg0.rarity ~= f27_arg1.rarity and f26_arg0.raritySortingType ~= LOOT.raritySortingOptions.NONE then
			if f26_arg0.raritySortingType == LOOT.raritySortingOptions.LOW_FIRST then
				return f27_arg0.rarity < f27_arg1.rarity
			elseif f26_arg0.raritySortingType == LOOT.raritySortingOptions.HIGH_FIRST then
				return f27_arg1.rarity < f27_arg0.rarity
			end
		end
		local f27_local2 = Engine[0xED84C33EC5F01EA]( f27_arg0.name )
		local f27_local3 = Engine[0xED84C33EC5F01EA]( f27_arg1.name )
		if f27_local2 ~= f27_local3 then
			return f27_local2 < f27_local3
		end
		return false
	end )
	if f26_arg0.FavoriteAndSort then
		f26_arg0.FavoriteAndSort:Update( f26_arg1, f26_arg0 )
	end
end

local f0_local5 = function ( f25_arg0 )
	if not LOOT.IsFavoritesEnabled( f25_arg0._controllerIndex ) then
		return 
	end
	local f25_local0 = f0_local0( f25_arg0 )
	if not f25_local0 then
		return 
	end
	local f25_local1 = f25_arg0._playerCardTable[f25_local0]
	if not f25_local1.isUnlocked then
		return 
	elseif f25_arg0._favoritePlayerCards[f25_local1.image] then
		LOOT.RemoveFavoriteForType( LOOT.itemTypes.PLAYERCARD, f25_local1.image )
	else
		if f25_arg0._favoritePlayerCards.count >= LOOT.maxFavorites then
			if f25_arg0.FavoriteAndSort then
				ACTIONS.AnimateSequence( f25_arg0.FavoriteAndSort.FavoritesPrompt, "Warning" )
			end
			Engine[0xC4146BA76D0F982]( SOUND_SETS.default.deny )
			return 
		end
		LOOT.AddFavoriteForType( LOOT.itemTypes.PLAYERCARD, f25_local1.image )
	end
	Engine[0xC4146BA76D0F982]( SOUND_SETS.default.selectAlt )
	local f25_local2 = ""
	local f25_local3 = ""
	if not f25_arg0._favoritePlayerCards[f25_local1.image] then
		f25_local2 = 0xE2E782ED8561FBF
		f25_local3 = "cac_equip_fill"
	else
		f25_local2 = 0xBAEC956CDA111AA
		f25_local3 = "cac_equip_ring"
	end
	f25_arg0:dispatchEventToRoot( {
		name = "send_toast_notification",
		immediate = true,
		options = {
			iconScale = 4.667263495923649E-62,
			displayTime = 1500,
			icon = f25_local3,
			iconColor = SWATCHES.genericMenu.notificationHighlight,
			header = Engine[0xED84C33EC5F01EA]( f25_local2 ),
			description = Engine[0xED84C33EC5F01EA]( f25_local1.name ),
			controllerIndex = controllerIndex
		}
	} )
	f25_arg0._favoritePlayerCards = LOOT.GetFavoritesForType( LOOT.itemTypes.PLAYERCARD )
	f25_arg0.PlayerCardGrid:RefreshContent()
	if 0 < #f25_arg0._playerCardTable then
		f25_arg0.NoPlayerCardsLabel:SetAlpha( 0 )
	end
	f25_arg0.PlayerCardGrid:SetFocusedPosition( f25_arg0.PlayerCardGrid:GetPositionForIndex( f25_local0 - 1 ), true )
end

local f0_local6 = function ( f24_arg0 )
	local f24_local0 = f0_local0( f24_arg0 )
	if not f24_local0 then
		return 
	end
	local f24_local1 = f24_arg0._playerCardTable[f24_local0]
	local f24_local2 = tonumber( f24_local1.index )
	if f24_arg0._equippedPlayerCardIndex ~= f24_local2 then
		if f24_arg0._showcaseIndex ~= nil then
			Social[0x72F2E228AC7FD08]( f24_arg0._controllerIndex, f24_arg0._showcaseIndex, f24_local2 )
		else
			Playercard[0x5C36BE0C34DB13F]( f24_arg0._controllerIndex, f24_local2 )
		end
		if CONDITIONS.IsMobileOrMobileSim() then
			f24_arg0.CallingCardMain:RefreshButton( f24_arg0, f24_local1, false, f24_arg0._favoritePlayerCards[f24_local1.image] )
			if f24_arg0._equippedPlayerCard then
				f24_arg0._playerCardTable[f24_local0] = f24_arg0._equippedPlayerCard
			end
			f24_arg0._equippedPlayerCard = f24_local1
		else
			f24_arg0.SmallPlayerCard.PlayerCardImage:setImage( RegisterMaterial( f24_local1.image ) )
			local f24_local3 = "hud_cmd_active_backer"
			if f24_local1.image ~= "" then
				f24_local3 = f24_local1.image
			end
			f24_arg0:dispatchEventToRoot( {
				name = "send_toast_notification",
				immediate = true,
				options = {
					displayTime = 2000,
					icon = f24_local3,
					header = Engine[0xED84C33EC5F01EA]( f24_arg0._showcaseIndex and 0xD04998DCB140084 or 0xBC74AC6BC9565D0 ),
					description = Engine[0xED84C33EC5F01EA]( f24_local1.name ),
					type = LUI.ToastManager.NotificationType.PlayerCardEquipped,
					controllerIndex = f24_arg0._controllerIndex
				}
			} )
		end
		f24_arg0._equippedPlayerCardIndex = f24_local2
		f24_arg0:UpdateGrid()
	end
end

local f0_local7 = function ( f22_arg0, f22_arg1, f22_arg2, f22_arg3 )
	f22_arg1:SetupContextualMenu()
	if LOOT.IsFavoritesEnabled( f22_arg0._controllerIndex ) then
		local f22_local0 = {
			id = "playerCardAddToFavorite"
		}
		local f22_local1
		if f22_arg3 then
			f22_local1 = Engine[0xED84C33EC5F01EA]( 0xABD3010A9142AB9 )
			if not f22_local1 then
			
			else
				f22_local0.actionName = f22_local1
				f22_local0.actionFunction = function ()
					f22_arg0:SetFavorite()
				end
				
				f22_arg1:AddContextualMenuAction( f22_local0 )
			end
		end
		f22_local1 = Engine[0xED84C33EC5F01EA]( 0xA483515816C5791 )
	end
end

local f0_local8 = function ( f21_arg0 )
	f21_arg0.PlayerCardGrid:RemoveFocusFromChild()
	if CONDITIONS.IsMobileOrMobileSim() then
		f21_arg0.PlayerCardGrid:SetShouldFocus( false )
	end
	f21_arg0.PlayerCardGrid:SetNumChildren( #f21_arg0._playerCardTable )
	f21_arg0.PlayerCardGrid:RefreshContent()
	if 0 < #f21_arg0._playerCardTable then
		f21_arg0.NoPlayerCardsLabel:SetAlpha( 0 )
	end
end

local f0_local9 = function ( f19_arg0 )
	return function ( f20_arg0, f20_arg1, f20_arg2 )
		local f20_local0 = f19_arg0._playerCardTable[f20_arg1 + f20_arg2 * f19_arg0.PlayerCardGrid:GetNumColumns() + 1]
		local f20_local1 = f19_arg0._equippedPlayerCardIndex == tonumber( f20_local0.index )
		local f20_local2 = f19_arg0._favoritePlayerCards[f20_local0.image]
		f20_arg0:RefreshButton( f19_arg0, f20_local0, f20_local1, f20_local2 )
		f19_arg0( f19_arg0, f20_arg0, f20_local0.name, f20_local2 )
	end
	
end

local f0_local10 = function ( f18_arg0 )
	return LOOT.GetItemID( LOOT.itemTypes.PLAYERCARD, CallingCardUtils.GetCardRef( f18_arg0._equippedPlayerCardIndex ) )
end

local f0_local11 = function ( f16_arg0 )
	local f16_local0 = function ()
		for f17_local3, f17_local4 in ipairs( f16_arg0._playerCardTable ) do
			if f16_arg0._equippedPlayerCardIndex == tonumber( f17_local4.index ) then
				return f17_local3 - 1
			end
		end
		return 0
	end
	
	f16_arg0.PlayerCardGrid:SetFocusedPosition( f16_arg0.PlayerCardGrid:GetPositionForIndex( f16_local0() ), true )
end

local f0_local12 = function ( f14_arg0 )
	if f14_arg0._isComingFromFilterMenu and LUI.IsLastInputGamepad( f14_arg0._controllerIndex ) then
		local f14_local0 = function ()
			for f15_local3, f15_local4 in ipairs( f14_arg0._playerCardTable ) do
				if f15_local4.lootID == f14_arg0._currentSelectedLootID then
					return f15_local3 - 1
				end
			end
			return 0
		end
		
		f14_arg0.PlayerCardGrid:SetFocusedPosition( f14_arg0.PlayerCardGrid:GetPositionForIndex( f14_local0() ), true, nil, nil, nil )
		f14_arg0._isComingFromFilterMenu = false
		return true
	else
		
	end
end

local f0_local13 = function ( f12_arg0, f12_arg1 )
	local f12_local0 = {
		{
			name = Engine[0xED84C33EC5F01EA]( 0x62F120E633C627B )
		},
		{
			name = Engine[0xED84C33EC5F01EA]( 0x2D64D32C17EFF62 )
		}
	}
	if 0 < #f12_local0 then
		local f12_local1 = {}
		for f12_local5, f12_local6 in ipairs( f12_local0 ) do
			table.insert( f12_local1, {
				disabled = false,
				name = f12_local6.name,
				tabHeight = _1080p * 52,
				focusFunction = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
					assert( f13_arg2 + 1 > #CallingCardUtils.Categories )
					f12_arg0._allPlayerCardsTable = CallingCardUtils.GetAllPlayerCards( f13_arg1, {
						unlockType = f13_arg2 + 1
					} )
					f12_arg0( f12_arg0, f13_arg1 )
					f12_arg0:UpdateGrid()
				end
			} )
		end
		f12_arg0.Tabs:SetTabs( f12_local1 )
		f12_arg0.Tabs:SetAlignment( LUI.Alignment.Left )
	end
end

local f0_local14 = function ( f9_arg0, f9_arg1 )
	if not LOOT.IsSortFilterEnabled() then
		
	else
		
	end
	if f9_arg0.HelperBar then
		f9_arg0.HelperBar:AddButtonHelperTextToElement( f9_arg0, {
			kbm_only = true,
			priority = 4,
			side = "left",
			button_ref = "button_alt1",
			helper_text = Engine[0xED84C33EC5F01EA]( 0x59D7A2BADD1083E )
		} )
	end
	f9_arg0.bindButton:addEventHandler( "button_alt1", function ( f10_arg0, f10_arg1 )
		if LUI.IsLastInputGamepad( f10_arg1.controller ) then
			local f10_local0 = f9_arg0( f9_arg0 )
			f9_arg0._currentSelectedLootID = f9_arg0._playerCardTable[f9_arg0( f9_arg0 )].lootID
		end
		local f10_local0 = MenuBuilder.BuildRegisteredType( "CustomizeSortingPopup", {
			controllerIndex = f9_arg0,
			menu = f9_arg0,
			type = LOOT.itemTypes.PLAYERCARD
		} )
		LUI.FlowManager.RequestPopupMenu( nil, "FlyInPopup", true, f9_arg0, false, {
			flyInLeftNarrow = true,
			widget = f10_local0
		} )
		f10_local0:addEventHandler( "menu_close", function ( f11_arg0, f11_arg1 )
			f10_arg0._isComingFromFilterMenu = true
			f10_arg0( f10_arg0, f10_arg0 )
			f10_arg0:UpdateGrid()
		end )
	end )
end

local f0_local15 = function ( f4_arg0, f4_arg1, f4_arg2 )
	assert( f4_arg0.MenuTitle )
	assert( f4_arg0.PlayerCardGrid )
	ACTIONS.AnimateSequence( f4_arg0, "InitializeDetails" )
	local f4_local0 = CONDITIONS.IsMobileOrMobileSim()
	if not f4_local0 and f4_arg0.EquippedWidget then
		f4_arg0.EquippedWidget:InitializeText( Engine[0xED84C33EC5F01EA]( 0x3FDB70668AFDB5E ) )
	end
	f4_arg0.SetFavorite = f0_local0
	f4_arg0.EquipPlayerCard = f0_local0
	f4_arg0.UpdateGrid = f0_local0
	f4_arg0.FocusFunction = f0_local0
	f4_arg0.GetCurrentGridIndex = f0_local0
	f4_arg0.AddFilterPrompt = f0_local0
	f4_arg0._controllerIndex = f4_arg1
	f4_arg0._playerCardTable = {}
	f4_arg0._allPlayerCardsTable = CallingCardUtils.GetAllPlayerCards( f4_arg1, {
		unlockType = CallingCardUtils.Categories.CORE
	} )
	f4_arg0._favoritePlayerCards = LOOT.GetFavoritesForType( LOOT.itemTypes.PLAYERCARD )
	if f4_arg2 and f4_arg2.showcaseIndex then
		f4_arg0._showcaseIndex = f4_arg2.showcaseIndex
		f4_arg0._equippedPlayerCardIndex = f4_arg2.equipped
		if f4_arg0.SmallPlayerCard then
			f4_arg0.SmallPlayerCard._hideRank = true
			ACTIONS.AnimateSequence( f4_arg0.SmallPlayerCard, "HideEmblem" )
			ACTIONS.AnimateSequence( f4_arg0.SmallPlayerCard, "HideRank" )
		end
	else
		f4_arg0._equippedPlayerCardIndex = f0_local0:GetValue( f4_arg1 )
		Playercard[0x2BB8FABC0D5D042]( f4_arg1 )
	end
	f4_arg0._isComingFromFilterMenu = false
	f0_local0( f4_arg0, f4_arg1 )
	if not f4_local0 then
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x40B1DD44D0F9FC0 ) and CallingCardUtils.AreAllVictoryChallengesUnlocked( f4_arg1 ) then
			f0_local0( f4_arg0, f4_arg1 )
		else
			f4_arg0.Tabs:closeTree()
			f4_arg0.Tabs = nil
		end
	end
	LOOT.SetupSortingBehavior( f4_arg0, f4_arg1, LOOT.itemTypes.PLAYERCARD )
	f0_local0( f4_arg0, f4_arg1 )
	f4_arg0.PlayerCardGrid:MouseSetActiveToDefaultFocusMenuCreate( f4_arg1 )
	f4_arg0.PlayerCardGrid:SetRefreshChild( f0_local0( f4_arg0 ) )
	f4_arg0:addEventHandler( "restore_focus", f0_local0 )
	f4_arg0.PlayerCardGrid:SetSnapOnWrapEnabled( true )
	f4_arg0:UpdateGrid()
	f4_arg0:FocusFunction()
	FrontEndScene.HideAllCharacters()
	Engine[0x685AE31DEDA30A4]( "squad_lobby" )
	local f4_local1 = Engine[0x3B8CFB6758EF57C]()
	local f4_local2 = f0_local0( f4_arg0 )
	f4_arg0:addEventHandler( "menu_close", function ( f8_arg0, f8_arg1 )
		if f4_arg0._showcaseIndex then
			Social[0x6B83DE97344CD52]( f4_arg0 )
		else
			f4_arg0:SetValue( f4_arg0, f4_arg0._equippedPlayerCardIndex )
			Playercard[0xE7F7308D27872C9]( f4_arg0 )
			METRICS.IdentityUsageSendDLogEvent( f4_arg0, f4_arg0, f4_arg0, LOOT.itemTypes.PLAYERCARD, f4_arg0, f4_arg0( f4_arg0 ) )
		end
	end )
	if LOOT.IsFavoritesEnabled( f4_arg1 ) then
		f4_arg0.bindButton:addEventHandler( "button_right_trigger", function ( f7_arg0, f7_arg1 )
			f4_arg0:SetFavorite()
		end )
	end
	f4_arg0.bindButton:addEventHandler( "button_secondary", function ( f6_arg0, f6_arg1 )
		ACTIONS.LeaveMenu( f6_arg0 )
	end )
	f4_arg0:AddFilterPrompt( f4_arg1 )
	f4_arg0:addAndCallEventHandler( "onVideoChange", function ()
		if f4_arg0.TabBacker then
			if CoD.CurrentAspectRatioCompare( LUI.AspectRatio.standard ) == LUI.COMPARE.higher then
				f4_arg0.TabBacker:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * -192, _1080p * 192, 0, _1080p * 160 )
			else
				f4_arg0.TabBacker:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, 0, _1080p * 160 )
			end
		end
	end )
	if f4_arg0.Darken then
		ACTIONS.ScaleFullscreen( f4_arg0.Darken )
	end
	if not f4_local0 then
		if not IsLanguageArabic() and f4_arg0.NewItemPreviewNotification then
			f4_arg0.NewItemPreviewNotification:SetupLeftAlignment()
		end
		f4_arg0.MenuTitle:SetupBackButton( f4_arg1 )
	end
	if CONDITIONS.IsPC() then
		ACTIONS.ScaleFullscreen( f4_arg0 )
	end
end

local f0_local16 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.PostLoadShared = f0_local0
end

function PlayerCardSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "PlayerCardSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self.addButtonHelperFunction = function ( f2_arg0, f2_arg1 )
		f2_arg0:AddButtonHelperText( {
			side = "left",
			button_ref = "button_primary",
			priority = 1,
			helper_text = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 )
		} )
	end
	
	self:addEventHandler( "menu_create", self.addButtonHelperFunction )
	if not self.bindButton then
		local f1_local2 = LUI.UIBindButton.new()
		f1_local2.id = "selfBindButton"
		self:addElement( f1_local2 )
		self.bindButton = f1_local2
	end
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "PlayerCardSelectBase", PlayerCardSelectBase )
LockTable( _M )
