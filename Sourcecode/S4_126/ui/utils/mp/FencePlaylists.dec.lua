-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
FencePlaylists = LUI.Class( LUI.Fence )
FencePlaylists.state = {
	UP_TO_DATE = 2,
	NEED_UPDATE = 0,
	UPDATING = 1
}
FencePlaylists.init = function ( f8_arg0 )
	FencePlaylists.super.init( f8_arg0 )
end

FencePlaylists.Start = function ( f7_arg0 )
	DebugPrint( "FencePlaylists.Start" )
	f7_arg0._userCancelled = false
end

FencePlaylists.Stop = function ( f6_arg0 )
	DebugPrint( "FencePlaylists.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "UpdatingPlaylists", true )
	LUI.FlowManager.RequestLeaveMenuByName( "OutdatedPlaylists", true )
end

FencePlaylists.PostFail = function ( f5_arg0 )
	if f5_arg0._state == LUI.Fence.STATE.fail and not f5_arg0._userCancelled then
		local f5_local0 = Engine[0x45B054C920178E9]()
		if CONDITIONS.IsInGameBattlesMatch() then
			GAMEBATTLES.LeaveGameBattlesMenu( f5_local0 )
		end
		if CONDITIONS.IsInternalAlphaEnabled() then
			LUI.FlowManager.RequestRestoreMenu( "MainLockoutMenu", nil, f5_local0 )
		else
			LUI.FlowManager.RequestAddMenu( LUI.FlowManager.MainMenu, true, f5_local0 )
		end
		Matchmaking[0x7144680DB843A33]()
		if Engine[0x26F7462AEAB0A8F]() then
			Tournament[0xF8B2F41CC5CF158]()
		end
		Engine[0xB81A5136C5503E4]( "xstopparty 0" )
		LUI.FlowManager.RequestPopupMenu( nil, "MessagePopup", false, nil, false, {
			headerText = Engine[0xED84C33EC5F01EA]( "MPUI/DOWNLOADPLAYLISTHEADER" ),
			messageText = Engine[0xED84C33EC5F01EA]( "MPUI/DOWNLOADPLAYLIST" )
		}, nil, false, false )
	end
end

FencePlaylists.OpenUpdatingPopup = function ( f3_arg0 )
	f3_arg0._openedPopup = true
	local f3_local0 = f3_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "UpdatingPlaylists", false, nil, false, {
		onCancel = function ( f4_arg0, f4_arg1 )
			DebugPrint( "Cancelling FencePlaylists" )
			f3_arg0._state = LUI.Fence.STATE.fail
			f3_arg0._userCancelled = true
		end
	}, nil, true, true )
end

FencePlaylists.UpdateState = function ( f2_arg0 )
	assert( f2_arg0._state ~= LUI.Fence.STATE.fail )
	local f2_local0 = Fences[0x45374DA1AF97F29]()
	if f2_local0 == FencePlaylists.state.NEED_UPDATE then
		if not f2_arg0._passed then
			f2_arg0._state = LUI.Fence.STATE.block
		else
			f2_arg0._state = LUI.Fence.STATE.fail
		end
	elseif f2_local0 == FencePlaylists.state.UPDATING then
		f2_arg0._state = LUI.Fence.STATE.block
	elseif f2_local0 == FencePlaylists.state.UP_TO_DATE then
		f2_arg0._state = LUI.Fence.STATE.pass
		f2_arg0._passed = true
	else
		f2_arg0._state = LUI.Fence.STATE.fail
		assert( false, "Unexpected state for playlists fence" )
	end
	if f2_arg0._state == LUI.Fence.STATE.block and not f2_arg0._openedPopup then
		f2_arg0:OpenUpdatingPopup()
	end
end

MenuBuilder.registerType( "UpdatingPlaylists", function ( f1_arg0, f1_arg1 )
	local f1_local0 = assert
	local f1_local1
	if f1_arg1 then
		f1_local1 = f1_arg1
	else
		f1_local1 = f1_arg1.onCancel
	end
	f1_local0( f1_local1 )
	local f1_local2 = MenuBuilder.BuildRegisteredType( "LiveTextBoxWithCancelPopup", {
		message = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/UPDATING_PLAYLISTS" ),
		cancel_func = f1_arg1.onCancel
	} )
	f1_local2.id = "UpdatingPlaylists"
	return f1_local2
end )
LUI.Fence.Register( "playlists", FencePlaylists )
LockTable( _M )
