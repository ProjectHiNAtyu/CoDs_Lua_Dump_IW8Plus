-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
local f0_local0 = function ( f7_arg0, f7_arg1, f7_arg2, f7_arg3, f7_arg4, f7_arg5, f7_arg6 )
	if not MenuBuilder.IsTypeRegistered( f7_arg2 ) then
		DebugPrint( "ERROR: Attempting to use unknown accessory UI widget " .. f7_arg2 .. ". Ensure this widget is properly included for your game mode!" )
		return nil
	else
		local f7_local0 = MenuBuilder.BuildRegisteredType( f7_arg2, {
			controllerIndex = f7_arg1,
			watchRef = f7_arg6
		} )
		f7_local0.id = "Accessory"
		f7_local0:SetupRenderTarget( "$rtt_watchlcd", f7_arg3, f7_arg4, f7_arg5, 0, 0, 0, 0, f7_arg1 )
		f7_local0:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f7_arg3 * _1080p, 0, f7_arg4 * _1080p )
		f7_arg0:addElement( f7_local0 )
		return f7_local0
	end
end

function AccessoryManager()
	local self = LUI.UIElement.new()
	self.id = "AccessoryManager"
	local f1_local1 = self:getRootController()
	local f1_local2 = LUI.DataSourceInControllerModel.new( "cg.player.accessoryIndex" )
	f1_local2 = f1_local2:GetModel( f1_local1 )
	self.destructData = nil
	self:SubscribeToModel( f1_local2, function ( f3_arg0 )
		if self.accessoryUI then
			if self.accessoryUI.Destruct and not Engine[0x12586A3F4FB490E]() then
				self.destructData = self.accessoryUI:Destruct()
			end
			self.accessoryUI:closeTree()
			self.accessoryUI = nil
		end
		local f3_local0 = DataModel[0x614D394F6F9A18D]( f3_arg0 )
		if f3_local0 and 0 <= f3_local0 then
			local f3_local1 = Engine[0xAEB0BEE5B2817AC]( self, f3_local0 )
			local f3_local2 = Engine[0xEFE9AAED2236F21]( self, f3_local0 )
			local f3_local3 = Engine[0x426B8F76001A70]( self, f3_local0 )
			local f3_local4 = Engine[0xB06C4D5470883CE]( self, f3_local0 )
			if f3_local1 and 0 < #f3_local1 then
				local f3_local5 = WATCH.GetEquippedWatch( self )
				self.accessoryUI = self( self, self, f3_local1, f3_local2, f3_local3, f3_local4, f3_local5 )
				self.accessoryUI:registerEventHandler( "on_close", function ( self )
					self:ReleaseRenderTarget( f3_arg0 )
				end )
				if WATCH.IsPetWatch( f3_local5 ) then
					self:registerOmnvarHandler( "ui_pet_watch_bonus_earned_0", function ( f5_arg0, f5_arg1 )
						if 80000 < f5_arg1.value and f5_arg1.value < 90000 then
							local f5_local0 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f5_local0 = f5_local0.petWatchData.winGamesCharge:get() + f5_arg1.value - 80000
							local f5_local1 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f5_local1.petWatchData.winGamesCharge:set( f5_local0 )
							f5_local1 = (f5_arg1.value - 80000) * 20
							local f5_local2 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f5_local2 = math.max( -240, math.min( 240, f5_local2.petWatchData.dirtyDmg:get() + f5_local1 ) )
							local f5_local3 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f5_local3.petWatchData.dirtyDmg:set( f5_local2 )
						end
					end )
					self:registerOmnvarHandler( "ui_pet_watch_bonus_earned_1", function ( f4_arg0, f4_arg1 )
						if 90000 < f4_arg1.value and f4_arg1.value < 100000 then
							local f4_local0 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f4_local0 = f4_local0.petWatchData.winGamesTop3:get()
							local f4_local1 = f4_arg1.value - 90000
							local f4_local2 = PlayerData[0x8B73907B55C4D71]( f3_arg0, CoD.StatsGroup.Common )
							f4_local2.petWatchData.winGamesTop3:set( f4_local1 )
						end
					end )
					if not Engine[0x12586A3F4FB490E]() then
						if self.destructData and self.accessoryUI.Reconstruct then
							self.accessoryUI:Reconstruct( self.destructData )
						elseif self.accessoryUI.Construct then
							self.accessoryUI:Construct()
						end
					end
				end
			end
		end
	end )
	local f1_local3 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.inWorldAttachmentsAlpha" )
	self:BindAlphaToModel( f1_local3:GetModel( f1_local1 ) )
	self:SubscribeToModel( DataSources.inGame.player.affectedByEMP:GetModel( f1_local1 ), function ( f2_arg0 )
		if DataModel[0x614D394F6F9A18D]( f2_arg0 ) then
			self:SetGlitchAmount( 1 )
		else
			self:SetGlitchAmount( 0 )
		end
	end )
	return self
end

MenuBuilder.registerType( "AccessoryManager", AccessoryManager )
LockTable( _M )
