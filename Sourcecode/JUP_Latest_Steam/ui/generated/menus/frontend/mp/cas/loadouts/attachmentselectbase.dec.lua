-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
local f0_local0 = 6
local f0_local1 = "button_alt2"
local f0_local2 = "button_right_trigger"
local f0_local3 = {
	FILTER = 2,
	FAVORITE = 1
}
local f0_local4 = "button_left_trigger"
local f0_local5 = Engine[0xED84C33EC5F01EA]( 0xA4C706FC71E678F )
local f0_local6 = Engine[0xED84C33EC5F01EA]( 0x5C76D41878B3E0 )
local f0_local7 = 3
local f0_local8 = function ( f84_arg0, f84_arg1 )
	if f84_arg0.ArrowUp then
		f84_arg0.Attachments:AddArrow( f84_arg0.ArrowUp )
	end
	if f84_arg0.ArrowDown then
		f84_arg0.Attachments:AddArrow( f84_arg0.ArrowDown )
	end
	if f84_arg0.ListCount then
		f84_arg0.Attachments:AddItemNumbers( f84_arg0.ListCount )
	end
end

local f0_local9 = function ( f83_arg0, f83_arg1, f83_arg2, f83_arg3, f83_arg4, f83_arg5 )
	local f83_local0 = ATTACHMENT.GetTableWithCurrentAttachment
	local f83_local1
	if not f83_arg5 then
		f83_local1 = f83_arg5
	else
		f83_local1 = f83_arg0._weaponTable
	end
	return f83_local0( f83_local1, f83_arg1, f83_arg2, f83_arg3, f83_arg4 )
end

local f0_local10 = function ( f82_arg0, f82_arg1, f82_arg2 )
	if not Engine[0x12586A3F4FB490E]() or not f82_arg0._weaponModel then
		return 
	elseif f82_arg0._focusedAttachmentData and f82_arg0._focusedAttachmentData.isBlocked then
		WEAPON.LoadAndSetModel( f82_arg1, f82_arg0._weaponModel, f82_arg0._weaponTable, {
			forceOffsetsAndRotations = true
		} )
	else
		WEAPON.LoadAndSetModel( f82_arg1, f82_arg0._weaponModel, f82_arg2, {
			forceOffsetsAndRotations = true
		} )
		if f82_arg0._category == ATTACHMENT.undermountCategory then
			if not f82_arg0._areAllAttachmentsBlocked then
				ATTACHMENT.SendAttachmentTagDataToServer( f82_arg0, f82_arg1, f82_arg0._category )
			end
		elseif f82_arg0._category == ATTACHMENT.magazineCategory then
			local f82_local0 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.xOffset:GetValue( f82_arg1 ) or 0
			local f82_local1 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.yOffset:GetValue( f82_arg1 ) or 0
			local f82_local2 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.zOffset:GetValue( f82_arg1 ) or 0
			local f82_local3 = GUNSMITH.GetWeaponZOffset( f82_arg0, f82_arg1, f82_arg2.attachments )
			local f82_local4 = GUNSMITH.GetWeaponZOffset( f82_arg0, f82_arg1, f82_arg0._weaponTable.attachments )
			if f82_local4 < f82_local3 then
				f82_local2 = f82_local3 - f82_local4 - f82_local2
			end
			ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, f82_local0, f82_local1, f82_local2 )
		end
		WEAPON.SetGunsmithSceneForWeapon( WEAPON.GetWeaponClassWithAttachments( f82_arg2 ) )
	end
end

local f0_local11 = function ( f80_arg0, f80_arg1, f80_arg2, f80_arg3 )
	return function ()
		f80_arg0._weaponModel = WEAPON.GetWeaponModel( f80_arg0, FrontEndScene.ClientWeapons.Preview, WEAPON.OffsetFiles.AttachmentData )
		f80_arg0:addElement( f80_arg0._weaponModel )
		local f81_local0 = f80_arg0._currentTable
		if CONDITIONS.IsIW9BetaBuildEnabled() and f80_arg0._focusedAttachmentData and (not f80_arg0._focusedAttachmentData.unlocked or f80_arg0._focusedAttachmentData.isClassified) then
			f81_local0 = f80_arg0( f80_arg0, f80_arg0, nil, f80_arg0._equippedAttach, f80_arg0._equippedVariant )
		end
		f80_arg0( f80_arg0, f80_arg0, f81_local0 )
	end
	
end

local f0_local12 = function ( f79_arg0, f79_arg1 )
	if f79_arg0._filteredAttachmentsList == nil then
		return 
	end
	for f79_local3, f79_local4 in ipairs( f79_arg0._filteredAttachmentsList ) do
		if f79_local4.ref == f79_arg1 then
			return f79_local3
		end
	end
end

local f0_local13 = function ( f78_arg0, f78_arg1 )
	f78_arg0._weaponTable = WEAPON.GenerateWeaponTable( f78_arg0._weaponPlayerData )
	local f78_local0 = f78_arg0._weaponTable.attachments[f78_arg1]
	if f78_local0 then
		f78_local0 = f78_arg0._weaponTable.attachments[f78_arg1].ref
	end
	f78_arg0._equippedAttach = f78_local0
	f78_local0 = f78_arg0._weaponTable.attachments[f78_arg1]
	if f78_local0 then
		f78_local0 = f78_arg0._weaponTable.attachments[f78_arg1].variantID
	end
	f78_arg0._equippedVariant = f78_local0
	f78_arg0.Attachments:RefreshContent()
	f78_arg0:processEvent( {
		name = "update_showcase",
		attachmentData = f78_arg0._focusedAttachmentData
	} )
end

local f0_local14 = function ( f76_arg0, f76_arg1 )
	CLIENT_MODEL.ResetAmmoModelPosition( CLIENT_MODEL.GetClientModelIndex( CLIENT_MODEL.coreMPModels.AMMO_DISPLAY ) )
	local f76_local0 = f76_arg0.GunsmithDetails:Wait( 5 )
	f76_local0.onComplete = function ()
		GUNSMITH.UpdateAmmoModel( f76_arg0, f76_arg0, f76_arg0 )
	end
	
end

local f0_local15 = function ( f75_arg0, f75_arg1, f75_arg2 )
	local f75_local0 = {}
	for f75_local4, f75_local5 in ipairs( f75_arg0 ) do
		if not Restrictions.IsAttachmentRestricted( f75_local5.ref, f75_arg1 ) or f75_local5.ref == f75_arg2 then
			table.insert( f75_local0, f75_local5 )
		end
	end
	return f75_local0
end

local f0_local16 = function ( f70_arg0, f70_arg1, f70_arg2, f70_arg3 )
	local f70_local0 = function ( f74_arg0, f74_arg1 )
		if f74_arg0._category == ATTACHMENT.receiverCategory then
			if WEAPON.GetWeaponRefByRec( f74_arg1.attachmentData.ref ) ~= f70_arg0._weaponTable.weapon then
				f74_arg0._weaponCompareTable = GL_HACK.GetPreviewedAttachmentTable( f70_arg0, {
					receiverRef = f74_arg1.attachmentData.ref,
					weaponTable = f74_arg0._weaponTable,
					weaponPlayerData = f74_arg0._weaponPlayerData
				} )
				if f70_arg0.EquipIndicatorFrame then
					f70_arg0.EquipIndicatorFrame:SetAlpha( 1 )
					f70_arg0.EquipIndicatorFrame:SetupIndicators( f70_arg0, f74_arg0._weaponCompareTable, f70_arg0._weaponTable )
				end
			elseif f70_arg0.EquipIndicatorFrame then
				f70_arg0.EquipIndicatorFrame:SetAlpha( 0 )
				f70_arg0.EquipIndicatorFrame:DisableIndicatorFrames( f70_arg0 )
			end
		elseif f70_arg0.EquipIndicatorFrame then
			f70_arg0.EquipIndicatorFrame:DisableIndicatorFrames( f70_arg0 )
		end
	end
	
	f70_arg0:registerEventHandler( "update_showcase", function ( element, event )
		if event.attachmentData then
			local f71_local0 = event.attachmentData.ref == element._equippedAttach
			local f71_local1 = ATTACHMENT.GetRefWithClassifiedSupport( event.attachmentData )
			local f71_local2 = element._weaponTable.lootID
			local f71_local3 = LOOT.emptyID
			f71_local2 = REG27 and WEAPON.GetModificationAttachments( f70_arg0, element._weaponTable.weapon, element._weaponTable.lootID ) or nil
			if f71_local2 then
				f71_local3 = f71_local2[f71_local1]
				if not f71_local3 then
				
				else
					local f71_local4 = nil
					if not CONDITIONS.IsMobileOrMobileSim() then
						f71_local4 = element.GunsmithDetails._weaponAttributes == nil
					end
					local f71_local5 = ATTACHMENT.GetWeaponTableWithOnlyEquippedAttachmentRef( f70_arg0, element._weaponTable, event.attachmentData.ref, f70_arg0 )
					element._currentTable = f70_arg0( element, f70_arg0, event.attachmentData.blockedCategorySlot, f71_local1, f71_local3 )
					local f71_local6
					if f71_local0 and not f71_local5 then
						f71_local6 = f71_local5
					else
						f71_local6 = element._currentTable
					end
					element._noAttachmentWeaponAttributes = ClientWeapon[0x75228338D174290]( f70_arg0, Engine[0xD9887C00CF2B985]( GL_HACK.GetWeaponMPRef( element._currentTable.weapon ) ), true, false, false )
					local f71_local7 = ATTACHMENT.GetAttachmentFullDetails( f70_arg0, f70_arg0._weaponTable, event.attachmentData, f71_local6, {
						isSetup = f71_local4,
						isEquipped = f71_local0,
						weaponPlayerData = element._weaponPlayerData,
						weaponAttributes = element._weaponAttributes,
						defaultAttachmentData = element._defaultAttachmentData,
						variantID = f71_local3
					} )
					if Dvar[0x9E5BE3B4BBA4E0E]( 0x533CAEAC7D247E6 ) and f71_local0 and #f71_local7.modifiersValues < 1 then
						local f71_local8 = 2
						local f71_local9 = f71_local5.attachments[f71_local8]
						local f71_local10 = false
						for f71_local14, f71_local15 in pairs( element._weaponTable.attachments ) do
							if f71_local15.ref ~= f71_local1 and f71_local15.ref ~= ATTACHMENT.none then
								f71_local5.attachments[f71_local8] = f71_local15
								if string.find( WEAPON.GetWeaponModelName( element._weaponTable.weapon, f71_local5, {
									showSWhiskeyMag = true,
									includeAttachments = true,
									keepAkimbo = true
								} ), f71_local1 ) then
									f71_local7 = ATTACHMENT.GetAttachmentFullDetails( f70_arg0, element._weaponTable, attachmentData, f71_local6, attachmentDetailsOptions )
									f71_local10 = true
									break
								end
							end
						end
						if not f71_local10 then
							f71_local5.attachments[f71_local8] = f71_local9
						end
					end
					if element.UpdateDetailsDataSources then
						element:UpdateDetailsDataSources( f70_arg0, f71_local7 )
					else
						element.GunsmithDetails:Setup( element, f70_arg0, f71_local7 )
						if element.DetailedWeaponStats then
							local f71_local8 = WEAPON.GetWeaponModelName( element._currentTable.weapon, element._currentTable, {
								showSWhiskeyMag = true,
								includeAttachments = true,
								keepAkimbo = true
							} )
							local f71_local9
							if f71_local2 then
								f71_local9 = f71_local2[ATTACHMENT.none]
								if not f71_local9 then
								
								else
									local f71_local10 = f70_arg0( element, f70_arg0, event.attachmentData.blockedCategorySlot, ATTACHMENT.none, f71_local9 )
									local f71_local11 = WEAPON.GetWeaponModelName( f71_local10.weapon, f71_local10, {
										showSWhiskeyMag = true,
										includeAttachments = true,
										keepAkimbo = true
									} )
									local f71_local12 = WEAPON.GetWeaponClassWithAttachments( element._currentTable )
									element.DetailedWeaponStats:Setup( element, f70_arg0, f71_local7 )
									element.DetailedWeaponStats:SetupStats( f70_arg0, f71_local11, f71_local8, f71_local12, true )
								end
							end
							f71_local9 = ATTACHMENT.baseVariant
						end
					end
					element._focusedAttachmentData = event.attachmentData
					local f71_local8
					if f71_local0 then
						f71_local8 = f71_local0
					else
						f71_local8 = f71_local5
					end
					element._isEquippedTable = f71_local8
					f71_local8 = LUI.FlowManager.GetScopedData( LOADOUT.GetGunsmithTabsMenuRef() )
					f71_local8 = f71_local8.attachmentData[GL_HACK.GetWeaponMPRef( element._weaponTable.weapon )].attachments
					if element.GunsmithBlockRemoveGroup and ATTACHMENT.ShouldAllowBlockedRemoveWidgets() then
						element.GunsmithBlockRemoveGroup:Setup( f70_arg0, f70_arg0._weaponTable, element._equippedAttach, f71_local8, event.attachmentData, element._category, element._currentTable, event.attachmentData.ref )
					end
					local f71_local9 = ATTACHMENT.GetTableWithAttachmentEquipped( f70_arg0, f70_arg0._weaponTable, element._equippedAttach, event.attachmentData.ref, f71_local7.category, f71_local3, f70_arg0, f71_local7, f71_local8 )
					if CONDITIONS.IsIW9BetaBuildEnabled() and not element._focusedAttachmentData.unlocked then
						f71_local9 = f70_arg0( element, f70_arg0, nil, element._equippedAttach, element._equippedVariant )
					end
					local f71_local10 = ATTACHMENT.GetAltReceiverTable( f70_arg0, element._weaponTable, event.attachmentData )
					if f71_local0 and element._category == ATTACHMENT.receiverCategory then
						f71_local10 = element._weaponTable
					end
					local f71_local11 = f70_arg0
					local f71_local13 = element
					local f71_local14 = f70_arg0
					local f71_local15
					if not f71_local10 then
						f71_local15 = f71_local10
					else
						f71_local15 = f71_local9
					end
					f71_local11( f71_local13, f71_local14, f71_local15 )
					if CONDITIONS.InFrontend() and (element._category == ATTACHMENT.perkCategory or element._category == ATTACHMENT.boltCategory) then
						f71_local11 = f70_arg0.GunsmithDetails:Wait( 5 )
						f71_local11.onComplete = function ()
							GUNSMITH.UpdateAmmoModel( element, element )
						end
						
					end
					f70_arg0( element, event )
					if CONDITIONS.IsWaveGameType() then
						f71_local11 = tonumber( event.attachmentData.survivalCost )
						local f71_local12 = CP.CurrencyGet( f70_arg0 )
						if element.PurchaseWidget then
							element.PurchaseWidget.CostValue:setText( Engine[0xED84C33EC5F01EA]( 0xDCA9D5990998D52, tostring( f71_local11 ) ) )
							if f71_local11 <= f71_local12 then
								ACTIONS.AnimateSequence( element.PurchaseWidget, "CanBuy" )
							else
								ACTIONS.AnimateSequence( element.PurchaseWidget, "NoBuy" )
							end
						end
						element:registerOmnvarHandler( "cp_open_cac", function ( f72_arg0, f72_arg1 )
							if f72_arg1.value == -2 and CONDITIONS.IsWaveGameType() then
								LUI.FlowManager.RequestCloseAllMenus()
							end
						end )
					end
				end
			end
			f71_local3 = ATTACHMENT.baseVariant
		end
		return true
	end )
end

local f0_local17 = function ( f69_arg0, f69_arg1, f69_arg2, f69_arg3, f69_arg4 )
	local f69_local0 = {}
	for f69_local4, f69_local5 in ddlpairs( f69_arg0._weaponPlayerData.attachmentSetup ) do
		local f69_local6 = f69_local5.attachment:get()
		if f69_local6 ~= ATTACHMENT.none then
			f69_local0[f69_local6] = {
				f69_local5.customTune[0]:get(),
				[1] = f69_local5.customTune[1]:get()
			}
		end
	end
	f69_local2 = GL_HACK.RequestEquippingRecAttachment( f69_arg1, {
		receiverRef = f69_arg3.ref,
		weaponTable = f69_arg0._weaponTable,
		weaponPlayerData = f69_arg0._weaponPlayerData,
		preservedAttachmentTable = f69_arg4
	} )
	if 0 < #f69_local2 then
		f69_local4 = GL_HACK.GetAttachmentsAndBucketItems( f69_arg1, {
			weaponRef = GL_HACK.GetWeaponMPRef( f69_arg2 )
		} )
		f69_local5 = f69_arg0._weaponTable.weapon
		for f69_local21, f69_local22 in ipairs( f69_local2 ) do
			local f69_local23 = ATTACHMENT.GetCategory( f69_local22 )
			local f69_local24 = ATTACHMENT.GetBaseName( f69_local22, f69_local23, f69_local5, f69_arg1 )
			local f69_local25 = f69_local4[f69_local23]
			for f69_local18, f69_local19 in ipairs( f69_local25 ) do
				ATTACHMENT.SetBlockedAttachments( f69_arg1, GUNSMITH.FilterRestrictedAttachments( f69_local25, f69_arg2, f69_arg3 ), f69_arg0._weaponTable, f69_arg0._equippedAttach, f69_arg0._category, f69_arg0._weaponTable )
				if f69_local19.baseName and f69_local19.baseName == f69_local24 and not f69_local19.isBlocked then
					local f69_local9 = GUNSMITH.GetSelectedAttachIndexForCategory( f69_local19.category, f69_arg0._weaponTable )
					local f69_local10 = f69_arg0._weaponTable.attachments[f69_local9].variantID
					local f69_local11 = Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f69_arg2 ), f69_local19.ref )
					local f69_local12
					if f69_local11 and f69_local11[f69_local10] and not f69_local10 then
						f69_local12 = f69_local10
					else
						f69_local12 = ATTACHMENT.baseVariant
					end
					GUNSMITH.EquipAttachment( f69_arg0, f69_arg1, f69_local19.ref, f69_arg0._weaponPlayerData, {
						attachSlot = f69_local9,
						survivalCost = f69_local19.survivalCost,
						variantID = f69_local12
					} )
					for f69_local16, f69_local17 in ddlpairs( f69_arg0._weaponPlayerData.attachmentSetup ) do
						if f69_local17.attachment:get() == f69_local19.ref and f69_local0[f69_local22] then
							f69_local17.customTune[0]:set( f69_local0[f69_local22][1] )
							f69_local17.customTune[1]:set( f69_local0[f69_local22][2] )
						end
					end
				end
			end
		end
	end
end

MenuBuilder.registerType( "SwapReceiverWithTunedAttachmentPopup", function ( f66_arg0, f66_arg1 )
	local f66_local0 = MenuBuilder.BuildRegisteredType( "PopupYesNoCancel", {
		title = Engine[0xED84C33EC5F01EA]( 0x1CCA5C59ECE1EA6 ),
		message = Engine[0xED84C33EC5F01EA]( 0x1C77693614BEBEE ),
		yesLabel = Engine[0xED84C33EC5F01EA]( 0x528DB6E6541D3F1 ),
		yesAction = function ( f68_arg0, f68_arg1 )
			f66_arg0( f66_arg0.element, f68_arg1, f66_arg0.weaponRef, f66_arg0.attachmentData, f66_arg0.preservedAttachmentTable )
			if not CONDITIONS.IsMobileOrMobileSim() then
				ACTIONS.LeaveMenu( f66_arg0.element )
			end
		end,
		noLabel = Engine[0xED84C33EC5F01EA]( 0x58F06C41F11E416 ),
		noAction = function ( f67_arg0, f67_arg1 )
			f66_arg0( f66_arg0.element, f67_arg1, f66_arg0.weaponRef, f66_arg0.attachmentData, f66_arg0.preservedAttachmentTable )
			WEAPON.ClearWeaponAndAttachmentTuning( f66_arg0.element._weaponPlayerData )
			if not CONDITIONS.IsMobileOrMobileSim() then
				ACTIONS.LeaveMenu( f66_arg0.element )
			end
			LUI.ToastManager.CreateToast( f67_arg0._controllerIndex, LUI.ToastManager.StandardEmphasisToast( WEAPON.GetName( f66_arg0.element._weaponTable.weapon ), Engine[0xED84C33EC5F01EA]( 0x72D6D31E68021D5 ) ) )
		end,
		cancelLabel = Engine[0xED84C33EC5F01EA]( 0x78C2C5FE58603AC )
	} )
	f66_local0.id = "SwapReceiverWithTunedAttachmentPopup"
	return f66_local0
end )
local f0_local18 = function ( f59_arg0, f59_arg1, f59_arg2, f59_arg3 )
	local f59_local0 = function ( f65_arg0, f65_arg1 )
		GUNSMITH.TryEquipAttachment( f65_arg0, f65_arg1, f59_arg0 )
	end
	
	f59_arg0:registerEventHandler( "refresh_attachments", function ( element, event )
		f59_arg0( element, event.attachSlot )
	end )
	f59_arg0:registerEventHandler( "try_equip_attachment", function ( element, event )
		local f62_local0 = GUNSMITH.IsSwappingAttachmentRequired( element._weaponPlayerData, element._equippedAttach, event.attachmentData )
		local f62_local1 = event.attachmentData.ref ~= element._equippedAttach
		if f62_local1 and event.attachmentData.ref == ATTACHMENT.none then
			element._isInAttachmentSelect = true
			GUNSMITH.TryRemoveAttachment( element, event )
			local f62_local2 = true
		end
		if GUNSMITH.IsWeaponSetupBlueprintIntact( element._weaponPlayerData ) and not f62_local0 and f62_local1 then
			GUNSMITH.SetupGunsmithBlueprintPopup( f59_arg0, element, f62_local1, function ()
				element( element, element )
			end )
		else
			f59_arg0( element, event )
		end
	end )
	f59_arg0:registerEventHandler( "removed_attachment", function ( element, event )
		ACTIONS.LeaveMenu( f59_arg0 )
		return true
	end )
	f59_arg0:registerEventHandler( "equip_attachment", function ( element, event )
		GUNSMITH.EquipAttachmentEventHandler( element, event, {
			isInAttachmentSelect = true,
			parentMenu = f59_arg0,
			attachSlot = f59_arg0
		} )
	end )
end

local f0_local19 = function ( f58_arg0, f58_arg1, f58_arg2 )
	if not f58_arg2.weaponSlot then
		f58_arg2.weaponSlot = 0
	end
	if not f58_arg2.loadoutIndex then
		f58_arg2.loadoutIndex = 0
	end
	if not f58_arg2.category then
		f58_arg2.category = "rail"
	end
	if not f58_arg2.attachments then
		f58_arg2.attachments = CSV.ReadRow( CSV.attachments, 3 )
	end
end

local f0_local20 = function ( f57_arg0, f57_arg1 )
	f57_arg0.Attachments:SetMask( f57_arg0.GridMask )
	if CONDITIONS.InFrontend() then
		if f57_arg0.HelperBar then
			f57_arg0.HelperBar.Background:SetAlpha( 0 )
		end
		LUI.TextChat.SetupMenuForNoChat( f57_arg0 )
	end
	local f57_local0 = ACTIONS.AnimateSequence
	local f57_local1 = f57_arg0
	local f57_local2
	if CONDITIONS.IsSplitscreen() then
		f57_local2 = "Splitscreen"
	else
		f57_local2 = "Regular"
	end
	f57_local0( f57_local1, f57_local2 )
end

local f0_local21 = function ( f55_arg0, f55_arg1, f55_arg2 )
	if CONDITIONS.InGame() and not CONDITIONS.IsThirdGameMode() then
		if f55_arg0.HelperBar then
			f55_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
				clickable = true,
				priority = 5,
				ignoreTooltip = false,
				side = "left",
				kbmTooltipPromptOverload = "button_dismiss_pause_menu",
				button_ref = "button_start",
				helper_text = Engine[0xED84C33EC5F01EA]( 0xEF0F75B0AB08E35 )
			} )
		end
		f55_arg0:AddGamepadEventCallback( "button_start", function ( f56_arg0, f56_arg1 )
			LUI.FlowManager.RequestCloseAllMenus()
		end )
	end
end

local f0_local22 = function ( f54_arg0, f54_arg1, f54_arg2, f54_arg3, f54_arg4 )
	if CONDITIONS.InFrontend( f54_arg0 ) then
		if not f54_arg0._areAllAttachmentsBlocked then
			ATTACHMENT.SendAttachmentTagDataToServer( f54_arg0, f54_arg1, f54_arg0._category )
		end
		MenuUtils.SetupSceneChangeCallback( f54_arg0, f0_local0( f54_arg0, f54_arg1, f54_arg3, f54_arg2.category ) )
	end
end

local f0_local23 = function ( f53_arg0, f53_arg1, f53_arg2 )
	f53_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( f53_arg2 ) ) )
end

local f0_local24 = function ( f52_arg0 )
	for f52_local0 = 1, #f52_arg0, 1 do
		local f52_local3 = ATTACHMENT.GetBundleByRef( f52_arg0[f52_local0].ref )
		if f52_local3 then
			f52_arg0[f52_local0].isClassified = f52_local3[0x42299CD50F5386E]
		end
	end
end

local f0_local25 = function ( f51_arg0, f51_arg1 )
	if f51_arg1 == LOOT.FilterCategories.ATTACHMENT_STATS then
		return f51_arg0._attachmentFilteringType
	elseif f51_arg1 == LOOT.FilterCategories.UNLOCK then
		return f51_arg0._unlockFilteringType
	elseif f51_arg1 == LOOT.FilterCategories.SUBCATEGORIES then
		return f51_arg0._subcategoryFilteringType
	else
		
	end
end

local f0_local26 = function ( f50_arg0, f50_arg1 )
	return f50_arg0._filtersForFilterCategory[f50_arg1]
end

local f0_local27 = function ( f49_arg0, f49_arg1 )
	for f49_local3, f49_local4 in pairs( f0_local0( f49_arg0, f49_arg1 ) ) do
		if f49_local4 then
			return true
		end
	end
	return false
end

local f0_local28 = function ( f48_arg0 )
	if CONDITIONS.EnableFilterAttachmentImprovement() then
		if f0_local0( f48_arg0, LOOT.FilterCategories.ATTACHMENT_STATS ) or f0_local0( f48_arg0, LOOT.FilterCategories.SUBCATEGORIES ) then
			return true
		end
	else
		if f48_arg0._aftermarketPartsFiltering then
			return true
		end
		local f48_local0 = f0_local0( f48_arg0, LOOT.FilterCategories.UNLOCK )
		if f48_local0 then
			for f48_local4, f48_local5 in pairs( f48_local0 ) do
				if f48_local5 then
					return true
				end
			end
		end
		local f48_local1 = f0_local0( f48_arg0, LOOT.FilterCategories.ATTACHMENT_STATS )
		if f48_local1 then
			for f48_local5, f48_local6 in pairs( f48_local1 ) do
				if f48_local6 then
					return true
				end
			end
		end
	end
	return false
end

local f0_local29 = function ( f47_arg0, f47_arg1, f47_arg2, f47_arg3 )
	local f47_local0 = f47_arg2
	if f47_arg3 and f47_arg3 ~= ATTACHMENT.none then
		f47_local0 = f47_local0 .. "+" .. f47_arg3
	end
	local f47_local1 = ClientWeapon[0xFE24333F9BC2CAB]( f47_arg1, f47_local0, Engine[0x603B6AC5797050A]( f47_local0, f47_arg3 ) )
	local f47_local2 = 0
	for f47_local6, f47_local7 in pairs( f0_local0( f47_arg0, LOOT.FilterCategories.ATTACHMENT_STATS ) ) do
		if f47_local7 and 0 < f47_local1.unTunedStats[ToUpperCase( f47_local6 )] then
			f47_local2 = f47_local2 + 1
		end
	end
	return f47_local2
end

local f0_local30 = function ( f45_arg0, f45_arg1, f45_arg2, f45_arg3 )
	local f45_local0 = nil
	if CONDITIONS.EnableFilterAttachmentImprovement() then
		f45_local0 = f0_local0( f45_arg0, LOOT.FilterCategories.ATTACHMENT_STATS )
		if String.IsNilOrEmpty( f45_arg2 ) then
			local f45_local1 = GL_HACK.GetWeaponMPRef( f45_arg0._weaponTable.weapon )
			if not f45_local1 then
				f45_arg2 = f45_local1
			else
				
			end
		end
		if not f45_arg3 then
			f45_arg3 = {}
		end
	end
	local f45_local1 = f45_arg0._favoriteAttachments
	table.sort( f45_arg0._attachmentListData, function ( f46_arg0, f46_arg1 )
		local f46_local0 = f46_arg0.ref
		local f46_local1 = f46_arg1.ref
		if f46_local0 == ATTACHMENT.none or f46_local1 == ATTACHMENT.none then
			return f46_arg0.uiOrder < f46_arg1.uiOrder
		elseif f45_arg0 then
			local f46_local2 = f46_local0
			local f46_local3 = f46_local1
			if f46_local0 == f46_arg0.baseRef then
				local f46_local4 = ATTACHMENT.GetRefByID( f46_arg0.lootID )
				if not f46_local4 then
					f46_local2 = f46_local4
				else
					f46_local2 = f46_local0
				end
			end
			if f46_local1 == f46_arg1.baseRef then
				local f46_local4 = ATTACHMENT.GetRefByID( f46_arg1.lootID )
				if not f46_local4 then
					f46_local3 = f46_local4
				else
					f46_local3 = f46_local1
				end
			end
			if f45_arg0[f46_local2] ~= f45_arg0[f46_local3] then
				local f46_local4 = f45_arg0[f46_local2]
				if f46_local4 then
					f46_local4 = not f45_arg0[f46_local3]
				end
				return f46_local4
			end
		end
		if f46_arg0.isClassified ~= f46_arg1.isClassified then
			local f46_local2 = f46_arg1.isClassified
			if f46_local2 then
				f46_local2 = not f46_arg0.isClassified
			end
			return f46_local2
		elseif f46_arg0.isBlocked ~= f46_arg1.isBlocked then
			local f46_local2 = f46_arg1.isBlocked
			if f46_local2 then
				f46_local2 = not f46_arg0.isBlocked
			end
			return f46_local2
		elseif f46_arg0.unlocked ~= f46_arg1.unlocked then
			local f46_local2 = f46_arg0.unlocked
			if f46_local2 then
				f46_local2 = not f46_arg1.unlocked
			end
			return f46_local2
		elseif not f46_arg0.unlocked and not f46_arg1.unlocked then
			if f46_arg0.isAMP ~= f46_arg1.isAMP then
				local f46_local2 = f46_arg1.isAMP
				if f46_local2 then
					f46_local2 = not f46_arg0.isAMP
				end
				return f46_local2
			end
		elseif f46_arg0.isAMP ~= f46_arg1.isAMP then
			local f46_local2 = f46_arg0.isAMP
			if f46_local2 then
				f46_local2 = not f46_arg1.isAMP
			end
			return f46_local2
		end
		if f45_arg0 and not f46_arg0.isBlocked then
			local f46_local2 = f45_arg0
			local f46_local3 = f45_arg0[f46_local0]
			if not f46_local3 then
				f46_local3 = f45_arg0( f45_arg0, f45_arg0, f45_arg0, f46_local0 )
			end
			f46_local2[f46_local0] = f46_local3
			f46_local2 = f45_arg0
			f46_local3 = f45_arg0[f46_local1]
			if not f46_local3 then
				f46_local3 = f45_arg0( f45_arg0, f45_arg0, f45_arg0, f46_local1 )
			end
			f46_local2[f46_local1] = f46_local3
			if f45_arg0[f46_local0] ~= f45_arg0[f46_local1] then
				return f45_arg0[f46_local0] < f45_arg0[f46_local1]
			end
		end
		if f46_arg0.uiOrder ~= f46_arg1.uiOrder then
			return f46_arg0.uiOrder < f46_arg1.uiOrder
		end
	end )
end

local f0_local31 = function ( f44_arg0 )
	local f44_local0 = f44_arg0._filteredAttachmentsList and f44_arg0._filteredAttachmentsList or f44_arg0._attachmentListData
	if f44_local0[1].ref == ATTACHMENT.none and #f44_local0 ~= 1 then
		local f44_local1 = 1
	else
		local f44_local1 = 0
	end
	local f44_local1
	if f44_arg0._equippedAttach ~= nil then
		for f44_local5, f44_local6 in ipairs( f44_arg0._filteredAttachmentsList and f44_arg0._filteredAttachmentsList or f44_arg0._attachmentListData ) do
			if f44_local6.ref ~= ATTACHMENT.none and f44_arg0._equippedAttach == f44_local6.ref then
				f44_local1 = f44_local5 - 1
			end
		end
	else
		local f44_local7 = LUI.FlowManager.GetScopedData( LOADOUT.GetAttachmentSelectMenuRef() )
		if f44_local7.lastTargetPositionX then
			f44_local1 = f44_local7.lastTargetPositionX
			f44_local7.lastTargetPositionX = nil
		end
	end
	return f44_local1
end

local f0_local32 = function ( f42_arg0 )
	local f42_local0 = function ( f43_arg0, f43_arg1, f43_arg2 )
		local f43_local0 = f42_arg0( f42_arg0, f43_arg2 )
		local f43_local1 = f42_arg0( f42_arg0, f43_arg2 )
		for f43_local5, f43_local6 in pairs( f43_local0 ) do
			if f43_local6 then
				if #f43_arg0 < f42_arg0 then
					table.insert( f43_arg0, Engine[0xED84C33EC5F01EA]( f43_local1[ToUpperCase( f43_local5 )].name ) )
				else
					f43_arg0[f42_arg0] = Engine[0xED84C33EC5F01EA]( 0xCAEE1241FAD0782, f43_arg1 )
					f43_arg1 = f43_arg1 + 1
				end
			end
		end
		return f43_arg1
	end
	
	local f42_local1 = {}
	local f42_local2 = f42_local0( f42_local1, f42_local0( f42_local1, 2, LOOT.FilterCategories.ATTACHMENT_STATS ), LOOT.FilterCategories.SUBCATEGORIES )
	return f42_local1
end

local f0_local33 = function ( f41_arg0, f41_arg1, f41_arg2 )
	if f41_arg0.HelperBar then
		if f41_arg1 == f0_local0.FAVORITE then
			local f41_local0 = f41_arg0._favoriteAttachments and f41_arg0._favoriteAttachments.count or 0
			if f41_arg2 then
				f41_arg0.HelperBar.ButtonHelperText:UpdateHelperText( f41_arg0._controllerIndex, f0_local0, Engine[0xED84C33EC5F01EA]( 0x6B43378BB9CDB17, f41_local0, LOOT.maxAttachmentFavorites ) )
			elseif f41_local0 >= LOOT.maxAttachmentFavorites then
				f41_arg0.HelperBar.ButtonHelperText:UpdateHelperText( f41_arg0._controllerIndex, f0_local0, Engine[0xED84C33EC5F01EA]( 0x5BAA0A5BB4D289C, f41_local0, LOOT.maxAttachmentFavorites ) )
			else
				local f41_local1 = Engine[0xED84C33EC5F01EA]( 0xE8092A800DA432, f41_local0, LOOT.maxAttachmentFavorites )
				if f41_arg0.HelperBar.ButtonHelperText:GetPromptByButtonRef( f0_local0 ) then
					f41_arg0.HelperBar.ButtonHelperText:UpdateHelperText( f41_arg0._controllerIndex, f0_local0, f41_local1 )
				else
					f41_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
						side = "left",
						helper_text = f41_local1,
						button_ref = f0_local0,
						helper_definition = Engine[0xED84C33EC5F01EA]( 0x2DA4E221AFD8D2A )
					} )
				end
			end
		elseif f41_arg1 == f0_local0.FILTER then
			local f41_local0 = nil
			if CONDITIONS.EnableFilterAttachmentImprovement() then
				f41_local0 = Engine[0xED84C33EC5F01EA]( 0xF99334C014A82F9 )
				if f0_local0( f41_arg0 ) then
					local f41_local1 = f0_local0( f41_arg0 )
					local f41_local2 = nil
					for f41_local6, f41_local7 in ipairs( f41_local1 ) do
						if f0_local0 < f41_local6 then
							break
						elseif f41_local6 == 1 then
							f41_local2 = f41_local7
						else
							f41_local2 = Engine[0xED84C33EC5F01EA]( 0x77F573284F20E35, f41_local2, f41_local7 )
						end
					end
					f41_local0 = Engine[0xED84C33EC5F01EA]( 0x83ED1BD31427CB2, f41_local2 )
				end
			else
				local f41_local1 = f41_arg0._attachmentListData[1].ref
				local f41_local2 = ATTACHMENT.none
				f41_local1 = REG19 and #f41_arg0._attachmentListData - 1 or #f41_arg0._attachmentListData
				f41_local2 = f41_arg0._attachmentListData[1].ref
				local f41_local3 = ATTACHMENT.none
				f41_local0 = Engine[0xED84C33EC5F01EA]( 0xC2A47DA3633CA48, REG22 and f41_arg0._numAttachments - 1 or f41_arg0._numAttachments, f41_local1 )
			end
			f41_arg0.HelperBar.ButtonHelperText:UpdateHelperText( f41_arg0._controllerIndex, f0_local0, f41_local0 )
		end
	end
end

local f0_local34 = function ( f40_arg0, f40_arg1 )
	local f40_local0 = f0_local0( f40_arg0, LOOT.FilterCategories.ATTACHMENT_STATS )
	if CONDITIONS.EnableFilterAttachmentImprovement() then
		local f40_local1 = LUI.FlowManager.GetScopedData( f40_arg0 )
		if f40_local1 and f40_arg0._isComingFromFilterMenu then
			f40_local1.attachmentFilteringType = f40_arg0._attachmentFilteringType
			f40_local1.subcategoryFilteringType = f40_arg0._subcategoryFilteringType
		end
	else
		local f40_local1 = LOOT.GetPlayerPreferenceForLootType( f40_arg1, LOOT.itemTypes.ATTACHMENT )
		if f40_local1 and f40_arg0._isComingFromFilterMenu then
			local f40_local2 = f40_local1.attachmentStatsPreference
			for f40_local7, f40_local8 in pairs( f40_local0 ) do
				local f40_local9 = f40_local2[f40_local7]
				local f40_local10 = f40_local9
				f40_local9 = f40_local9.set
				local f40_local6
				if f40_local8 then
					f40_local6 = 1
				else
					f40_local6 = 0
				end
			end
			f40_local3 = f40_local1.unlockPreference
			f40_local4 = f40_local3.unlocked
			f40_local7 = f40_local4
			f40_local4 = f40_local4.set
			if f40_arg0._unlockFilteringType[LOOT.unlockFilters.UNLOCKED.ref] then
				f40_local8 = 1
			else
				f40_local8 = 0
			end
			f40_local4( f40_local7, f40_local8 )
			f40_local4 = f40_local3.locked
			f40_local7 = f40_local4
			f40_local4 = f40_local4.set
			if f40_arg0._unlockFilteringType[LOOT.unlockFilters.LOCKED.ref] then
				f40_local8 = 1
			else
				f40_local8 = 0
			end
			f40_local4( f40_local7, f40_local8 )
			if f40_local1.aftermarketParts then
				f40_local4 = f40_local1.aftermarketParts
				f40_local7 = f40_local4
				f40_local4 = f40_local4.set
				if f40_arg0._aftermarketPartsFiltering then
					f40_local8 = 1
				else
					f40_local8 = 0
				end
				f40_local4( f40_local7, f40_local8 )
			else
				if f40_arg0.CurrentlyFiltering then
					local f40_local1 = 0
					local f40_local2 = 0
					for f40_local7, f40_local8 in pairs( f40_local0 ) do
						f40_local2 = f40_local2 + 1
						if f40_local8 then
							f40_local1 = f40_local1 + 1
						end
					end
					if f40_local1 == 0 then
						f40_arg0.CurrentlyFiltering:SetVisible( false )
					end
					f40_arg0.CurrentlyFiltering:SetVisible( true )
					f40_arg0.CurrentlyFiltering:setText( Engine[0xED84C33EC5F01EA]( 0x65E9EE0149ED789, f40_local1, f40_local2 ) )
				end
				f0_local0( f40_arg0, f0_local0.FILTER )
			end
			f40_local9( f40_local10, f40_local6 )
		end
	end
	if f40_arg0.CurrentlyFiltering then
		local f40_local1 = 0
		local f40_local2 = 0
		for f40_local7, f40_local8 in pairs( f40_local0 ) do
			f40_local2 = f40_local2 + 1
			if f40_local8 then
				f40_local1 = f40_local1 + 1
			end
		end
		if f40_local1 == 0 then
			f40_arg0.CurrentlyFiltering:SetVisible( false )
		end
		f40_arg0.CurrentlyFiltering:SetVisible( true )
		f40_arg0.CurrentlyFiltering:setText( Engine[0xED84C33EC5F01EA]( 0x65E9EE0149ED789, f40_local1, f40_local2 ) )
	end
	f0_local0( f40_arg0, f0_local0.FILTER )
end

local f0_local35 = function ( f39_arg0, f39_arg1 )
	local f39_local0 = f0_local0( f39_arg0, LOOT.FilterCategories.UNLOCK )
	if f39_local0[LOOT.unlockFilters.UNLOCKED.ref] == f39_local0[LOOT.unlockFilters.LOCKED.ref] then
		return true
	elseif f39_arg1 and f39_local0[LOOT.unlockFilters.UNLOCKED.ref] then
		return true
	elseif not f39_arg1 and f39_local0[LOOT.unlockFilters.LOCKED.ref] then
		return true
	else
		return false
	end
end

local f0_local36 = function ( f38_arg0, f38_arg1, f38_arg2, f38_arg3 )
	if f38_arg3 == LOOT.FilterCategories.AMP then
		f38_arg0._aftermarketPartsFiltering = f38_arg2
	else
		local f38_local0 = f0_local0( f38_arg0, f38_arg3 )
		f38_local0[f38_arg1] = f38_arg2
	end
end

local f0_local37 = function ( f37_arg0, f37_arg1, f37_arg2 )
	if f37_arg2 == LOOT.FilterCategories.AMP then
		return f37_arg0._aftermarketPartsFiltering
	else
		local f37_local0 = f0_local0( f37_arg0, f37_arg2 )
		return f37_local0[f37_arg1]
	end
end

local f0_local38 = function ( f36_arg0, f36_arg1, f36_arg2, f36_arg3 )
	local f36_local0 = f0_local0( f36_arg0 )
	local f36_local1 = CONDITIONS.EnableFilterAttachmentImprovement()
	local f36_local2
	if f36_local1 then
		f36_local2 = f36_local1
	else
		f36_local2 = f0_local0( f36_arg0, LOOT.FilterCategories.ATTACHMENT_STATS )
	end
	local f36_local3
	if f36_local1 then
		f36_local3 = f36_local1
	else
		f36_local3 = f0_local0( f36_arg0, LOOT.FilterCategories.SUBCATEGORIES )
	end
	if f36_local0 then
		local f36_local4 = {}
		local f36_local5 = LUI.DeepCopy( f36_arg0._weaponTable )
		local f36_local6 = false
		if f36_local1 then
			if String.IsNilOrEmpty( f36_arg2 ) then
				local f36_local7 = GL_HACK.GetWeaponMPRef( f36_arg0._weaponTable.weapon )
				if not f36_local7 then
					f36_arg2 = f36_local7
				else
					
				end
			end
			if not f36_arg3 then
				f36_arg3 = {}
			end
		end
		for f36_local22, f36_local23 in ipairs( f36_arg0._attachmentListData ) do
			if f36_local23.ref == ATTACHMENT.none then
				table.insert( f36_local4, f36_local23 )
			end
			if f36_arg0._equippedAttach and f36_local23.ref == f36_arg0._equippedAttach then
				table.insert( f36_local4, f36_local23 )
			end
			if f36_local1 then
				local f36_local10 = true
				if f36_local2 then
					if not f36_arg3[f36_local23.ref] then
						local f36_local11 = f36_local23.ref
						local f36_local12
						if f36_local23.isBlocked then
							f36_local12 = 0
						else
							f36_local12 = f0_local0( f36_arg0, f36_arg1, f36_arg2, f36_local23.ref )
						end
						f36_arg3[f36_local11] = f36_local12
					end
					f36_local10 = 0 < f36_arg3[f36_local23.ref]
				end
				if f36_local10 and f36_local3 then
					local f36_local11 = nil
					if not Table.IsNilOrEmpty( f36_local23.subcategories ) then
						for f36_local15, f36_local16 in pairs( f36_local23.subcategories ) do
							local f36_local17 = f36_local16[0x835FE6A19A6DAC1]
							if not String.IsNilOrEmpty( f36_local17 ) then
								f36_local11 = f36_arg0._subcategoryFilteringType[f36_local17]
							else
								f36_local11 = false
							end
							if f36_local11 then
								break
							end
						end
					end
					f36_local10 = f36_local11
				end
				if f36_local10 then
					table.insert( f36_local4, f36_local23 )
				end
			end
			if f0_local0( f36_arg0, f36_local23.unlocked ) then
				f36_local5.attachments[GUNSMITH.GetSelectedAttachIndexForCategory( f36_local23.category, f36_local5 ) or 1] = f36_local23
				local f36_local11 = WEAPON.GetWeaponModelName( f36_arg0._weaponRef, f36_local5, {
					showSWhiskeyMag = true,
					includeAttachments = true,
					keepAkimbo = true
				} )
				local f36_local12 = Engine[0x603B6AC5797050A]( f36_local11, f36_local23.ref )
				local f36_local13 = ClientWeapon[0xA41C97AC6ADDC24]( f36_arg1, f36_local5.weapon .. "+" .. f36_local23.ref, 0 )
				local f36_local14 = ClientWeapon[0xFE24333F9BC2CAB]( f36_arg1, f36_local11, f36_local12 )
				local f36_local15 = true
				for f36_local20, f36_local21 in pairs( f0_local0( f36_arg0, LOOT.FilterCategories.ATTACHMENT_STATS ) ) do
					if f36_local21 and f36_local14.unTunedStats[ToUpperCase( f36_local20 )] <= 0 then
						f36_local15 = false
						break
					end
				end
				if f36_local15 and f36_arg0._aftermarketPartsFiltering then
					f36_local17 = ATTACHMENT.IsAMP( f36_local23.ref )
					if not f36_local17 then
						f36_local15 = f36_local17
					else
						f36_local15 = f36_local23.category == ATTACHMENT.conversionkit
					end
				end
				if f36_local15 then
					table.insert( f36_local4, f36_local23 )
				end
			end
		end
		f36_local7 = #f36_local4
		f36_arg0._filteredAttachmentsList = f36_local4
		if f36_arg0._numAttachments < f36_local7 then
			f36_arg0.Attachments:SetNumColumns( f36_local7 )
			f36_arg0.Attachments:SetNumChildren( f36_local7 )
		else
			f36_arg0.Attachments:SetNumChildren( f36_local7 )
			f36_arg0.Attachments:SetNumColumns( f36_local7 )
		end
		f36_arg0._numAttachments = f36_local7
	else
		f36_arg0.Attachments:SetNumColumns( #f36_arg0._attachmentListData )
		f36_arg0.Attachments:SetNumChildren( #f36_arg0._attachmentListData )
		f36_arg0._numAttachments = #f36_arg0._attachmentListData
		f36_arg0._filteredAttachmentsList = GL_HACK.CloneAttachmentsList( f36_arg0._attachmentListData )
	end
	f36_arg0.Attachments:SetDefaultFocus( {
		y = 0,
		x = f36_arg0:GetDefaultIndex()
	} )
	f36_arg0._originalRef = f36_arg0._focusedAttachmentData and f36_arg0._focusedAttachmentData.ref or nil
	if f36_arg0._originalRef == ATTACHMENT.none then
		f36_arg0._originalRef = nil
	end
	f36_arg0.Attachments:RefreshContent()
end

local f0_local39 = function ( f34_arg0, f34_arg1 )
	if not CONDITIONS.IsAttachmentFilteringEnabled() then
		
	else
		
	end
	f34_arg0:AddGamepadEventCallback( f0_local0, function ( f35_arg0, f35_arg1 )
		local f35_local0 = f35_arg1.controller or f34_arg0
		LUI.FlowManager.RequestPopupMenu( nil, "AttachmentFilterPopupLayout", true, f35_local0, false, {
			menu = f34_arg0,
			controllerIndex = f35_local0,
			subcategoryFilters = f34_arg0._subcategoryFilters
		} )
	end )
end

local f0_local40 = function ( f33_arg0, f33_arg1 )
	local f33_local0 = GL_HACK.GetWeaponMPRef( f33_arg0._weaponTable.weapon )
	local f33_local1 = {}
	f0_local0( f33_arg0, f33_arg1, f33_local0, f33_local1 )
	f0_local0( f33_arg0, f33_arg1, f33_local0, f33_local1 )
end

local f0_local41 = function ( f32_arg0, f32_arg1, f32_arg2 )
	if f32_arg0._unlockedBlueprintAttachmentRef == f32_arg2 then
		return true
	else
		return false
	end
end

local f0_local42 = function ( f29_arg0, f29_arg1, f29_arg2, f29_arg3 )
	if LOOT.IsFavoritesEnabled( f29_arg0._controllerIndex ) then
		local f29_local0 = {
			id = "attachmentAddToFavorite"
		}
		local f29_local1
		if f29_arg3 then
			f29_local1 = Engine[0xED84C33EC5F01EA]( 0xABD3010A9142AB9 )
			if not f29_local1 then
			
			else
				f29_local0.actionName = f29_local1
				f29_local0.actionFunction = function ()
					f29_arg0:SetFavorite()
				end
				
				f29_local0.button = f0_local0
				f29_arg1:AddContextualMenuAction( f29_local0 )
			end
		end
		f29_local1 = Engine[0xED84C33EC5F01EA]( 0xA483515816C5791 )
	end
	if CONDITIONS.DvarBoolExistsAndIsEnabled( 0x480DE163111E9F4 ) and not CONDITIONS.IsSplitscreen() then
		f29_arg1:AddContextualMenuAction( {
			id = "attachmentShowDetailedStat",
			actionName = f29_arg0._detailsStatsVisible and f0_local0 or f0_local0,
			actionFunction = function ()
				f29_arg0:ContextualMenuSwapWeaponDetailStats()
			end
		} )
	end
end

local f0_local43 = function ( f28_arg0 )
	if not LOOT.IsFavoritesEnabled( f28_arg0._controllerIndex ) then
		return 
	end
	local f28_local0 = f28_arg0.Attachments:GetActiveElement() and f28_arg0.Attachments:GetActiveElement() or f28_arg0.Attachments._childInFocus
	local f28_local1 = f28_local0._data
	if f28_local1.ref == ATTACHMENT.none or not f28_local0 then
		return 
	elseif not f28_local1.unlocked then
		return 
	end
	local f28_local2 = false
	local f28_local3 = false
	local f28_local4 = ATTACHMENT.GetRefByID( f28_local1.lootID )
	if f28_arg0._favoriteAttachments[f28_local1.ref] then
		f28_local2 = LOOT.RemoveFavoriteForType( LOOT.itemTypes.ATTACHMENT, f28_local1.ref )
	elseif f28_arg0._favoriteAttachments[f28_local4] then
		f28_local2 = LOOT.RemoveFavoriteForType( LOOT.itemTypes.ATTACHMENT, f28_local4 )
	else
		if f28_arg0._favoriteAttachments.count >= LOOT.maxAttachmentFavorites then
			f0_local0( f28_arg0, f0_local0.FAVORITE, f28_local3 )
			return 
		end
		f28_local2 = LOOT.AddFavoriteForType( LOOT.itemTypes.ATTACHMENT, f28_local1.ref )
		f28_local3 = true
	end
	if f28_local2 then
		Engine[0xC4146BA76D0F982]( SOUND_SETS.default.selectAlt )
		f28_local0:SetFavoriteAttachment( f28_local1, f28_local3 )
		f0_local0( f28_arg0, f28_local0, f28_local0._data.name, f28_local3 )
		f28_arg0._favoriteAttachments, f28_arg0._favoriteLootIDs = LOOT.GetFavoritesForType( LOOT.itemTypes.ATTACHMENT )
		f0_local0( f28_arg0, f0_local0.FAVORITE, f28_local3 )
		f28_arg0.Attachments:RefreshContent()
	end
end

local f0_local44 = function ( f27_arg0, f27_arg1 )
	LUI.FlowManager.RequestAddMenu( "AttachmentAppearanceSelect", true, f27_arg0._controllerIndex, false, {
		variantData = f27_arg0._focusedAttachmentData.variantData,
		weaponSlot = f27_arg1.weaponSlot,
		loadoutIndex = f27_arg1.loadoutIndex,
		attachSlot = f27_arg0._attachSlot and f27_arg0._attachSlot or f27_arg0._focusedAttachmentData.blockedCategorySlot,
		attachmentRef = f27_arg0._focusedAttachmentData.ref,
		blockedCategorySlot = f27_arg0._focusedAttachmentData.blockedCategorySlot,
		category = f27_arg1.category,
		forShowcase = f27_arg1.forShowcase,
		attachmentData = f27_arg0._focusedAttachmentData
	} )
end

local f0_local45 = function ( f26_arg0 )
	if f26_arg0.ExtraHelperBar then
		if f26_arg0.ExtraHelperBar.ButtonHelperText:GetPromptByButtonRef( f0_local0 ) then
			f26_arg0.ExtraHelperBar.ButtonHelperText:RemoveButtonPrompt( f0_local0 )
		end
		f26_arg0.ExtraHelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			ignoreTooltipPrompt = true,
			isIconEnabledForKBM = true,
			helper_text = f26_arg0._detailsStatsVisible and f0_local0 or f0_local0,
			button_ref = f0_local0,
			callback = f26_arg0.SwapWeaponDetailStats,
			callbackOptions = {
				menu = f26_arg0
			}
		} )
	end
end

local f0_local46 = function ( f25_arg0 )
	local f25_local0 = f25_arg0.menu
	local f25_local1 = f25_arg0.event
	local f25_local2
	if f25_local1 then
		f25_local2 = f25_local1.down
		if not f25_local2 then
			f25_local2 = f25_local1.mouse
			if not f25_local2 then
				f25_local2 = f25_arg0.contextualMenuAction
			end
		end
	else
		f25_local2 = f25_arg0.contextualMenuAction
	end
	if f25_local0 and f25_local2 and CONDITIONS.DvarBoolExistsAndIsEnabled( 0x480DE163111E9F4 ) and not CONDITIONS.IsSplitscreen() then
		local f25_local3 = f25_local0.GunsmithDetails:IsVisible()
		f25_local0.DetailedWeaponStats:SetVisible( f25_local3 )
		f25_local0.GunsmithDetails:SetVisible( not f25_local3 )
		f25_local0._detailsStatsVisible = f25_local3
		if f25_local3 then
			ACTIONS.AnimateSequence( f25_local0, "DetailedWeaponStatsOpening" )
		end
		f0_local0( f25_local0 )
		f25_local0.Attachments:RefreshContent()
		if f25_local1 and CONDITIONS.ButtonLeftTrigger( f25_local0, f25_local1 ) then
			Engine[0xC4146BA76D0F982]( f25_arg0.element.actionSFX )
		end
	end
end

local f0_local47 = function ( f24_arg0 )
	f24_arg0.SwapWeaponDetailStats( {
		contextualMenuAction = true,
		menu = f24_arg0
	} )
end

local f0_local48 = function ( f23_arg0, f23_arg1 )
	f23_arg0._attachmentVariants = {}
	local f23_local0 = GL_HACK.GetWeaponMPRef( f23_arg0._weaponRef )
	for f23_local11, f23_local12 in ipairs( f23_arg0._attachmentListData ) do
		for f23_local8, f23_local9 in ipairs( Engine[0xD3946E1B3E34A42]( f23_local0, f23_local12.ref ) ) do
			if not f23_local9[0x4FDAECD20551368] then
				local f23_local4
				if f23_local9[0x55F116BF695C8F6] then
					f23_local4 = f23_local9[0xAE1E225E2DD2DF4]( f23_local9 )
					if not f23_local4 then
					
					else
						local f23_local5 = ATTACHMENT.GetBundleByBlueprintRefXhash( f23_local4 )
						if f23_local5 and f23_local5[0x28887F70BF5EBA] then
							local f23_local6 = LOOT.IsUnlockedWithID( f23_arg1, f23_local5[0x28887F70BF5EBA], {
								notCDLUnlocked = true
							} )
							local f23_local7 = f23_local5[0xAED63DFE5400760]
							if not f23_local7 then
								f23_local7 = LOOT.IsItemBanned( f23_local5[0x28887F70BF5EBA] )
							end
							if f23_local6 and Engine[0x69703F35FE390E2]( f23_local0, f23_local12.ref, f23_local8 ) and not f23_local7 then
								if f23_arg0._attachmentVariants[f23_local12.ref] == nil then
									f23_arg0._attachmentVariants[f23_local12.ref] = {}
								end
								table.insert( f23_arg0._attachmentVariants[f23_local12.ref], f23_local8 )
							end
						end
					end
				end
				f23_local4 = 0x0
			end
		end
	end
end

local f0_local49 = function ( f22_arg0, f22_arg1, f22_arg2 )
	if not Table.IsNilOrEmpty( f22_arg2 ) and f22_arg2.query ~= nil then
		local f22_local0 = LUI.FlowManager.GetMenuStack()
		local f22_local1 = f22_local0[#f22_local0 - 1].scopedData
		f22_arg2.weaponSlot = f22_local1.weaponSlot or 0
		f22_arg2.loadoutIndex = f22_local1.loadoutIndex or 0
		f22_arg2.category = f22_arg2.query.category or "optic"
		local f22_local2, f22_local3, f22_local4 = pairs( f22_local1.attachmentData )
		local f22_local5, f22_local6 = f22_local2( f22_local3, f22_local4 )
		if f22_local5 ~= nil then
			f22_local4 = f22_local5
			f22_arg2.attachments = f22_local6.attachments[f22_arg2.category]
		else
			
		end
	end
end

local f0_local50 = function ( f3_arg0, f3_arg1, f3_arg2 )
	if f3_arg0.CurrentlyFiltering and f3_arg0.HelperBar then
		f3_arg0.AddFilterPrompt = f0_local0
		f3_arg0.SelectFilter = f0_local0
		f3_arg0.IsFilterSelected = f0_local0
		f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 9,
			helper_text = Engine[0xED84C33EC5F01EA]( 0x7B935D636CE4D03 ) .. " " .. Engine[0xED84C33EC5F01EA]( 0xF8403BB2DC0C28D, 0, 0 ),
			button_ref = f0_local0,
			helper_definition = Engine[0xED84C33EC5F01EA]( 0xD391099870007CF )
		} )
	end
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.GetDefaultIndex = f0_local0
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0.OpenAppearanceSelect = f0_local0
	f3_arg0.SwapWeaponDetailStats = f0_local0
	f3_arg0.ContextualMenuSwapWeaponDetailStats = f0_local0
	f3_arg0.SwapReceiverAttachment = f0_local0
	f3_arg0.RefreshMenu = f0_local0
	ATTACHMENT.SetupAttachmentSelectMenu( f3_arg0, f3_arg1, f3_arg2 )
	if Engine[0x2DA54CF5D6B7F02]() then
		f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	end
	f0_local0( f3_arg0, f3_arg1 )
	f0_local0( f3_arg0, f3_arg1 )
	local f3_local0 = LOADOUT.GetFrontendLoadoutWithShowcase( f3_arg1, f3_arg2.loadoutIndex, f3_arg2.forShowcase )
	if CONDITIONS.IsWaveGameType() then
		local f3_local1 = PLAYER_DATA.IO( f3_arg1, LOADOUT.GetLoadoutStatsGroup() )
		f3_local0 = f3_local1.squadMembers.loadoutWaveMode
	end
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0._category = f3_arg2.category
	f3_arg0._weaponPlayerData = f3_local0.weaponSetups[f3_arg2.weaponSlot]
	f3_arg0._weaponTable = WEAPON.GenerateWeaponTable( f3_arg0._weaponPlayerData )
	f3_arg0._weaponRef = f3_arg0._weaponTable.weapon
	local f3_local1 = f3_arg2.attachSlot
	if f3_local1 == nil then
		f3_local1 = ATTACHMENT.GetAvailableAttachSlot( f3_arg1, f3_arg2.weaponSlot, f3_arg0._category, f3_arg2.forShowcase )
	end
	f3_arg0._attachSlot = f3_local1
	local f3_local2 = f3_arg0._weaponTable.attachments[f3_local1]
	if f3_local2 then
		f3_local2 = f3_arg0._weaponTable.attachments[f3_local1].ref
	end
	f3_arg0._equippedAttach = f3_local2
	f3_local2 = f3_arg0._weaponTable.attachments[f3_local1]
	if f3_local2 then
		f3_local2 = f3_arg0._weaponTable.attachments[f3_local1].variantID
	end
	f3_arg0._equippedVariant = f3_local2
	if LOOT.IsFavoritesEnabled( f3_arg0._controllerIndex ) then
		f3_arg0._favoriteAttachments, f3_arg0._favoriteLootIDs = LOOT.GetFavoritesForType( LOOT.itemTypes.ATTACHMENT )
		f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 8,
			helper_text = Engine[0xED84C33EC5F01EA]( 0xABD3010A9142AB9 ) .. " " .. Engine[0xED84C33EC5F01EA]( 0xF8403BB2DC0C28D, 0, LOOT.maxAttachmentFavorites ),
			button_ref = f0_local0
		} )
	end
	if CONDITIONS.IsAttachmentFilteringEnabled() then
		f3_arg0.FilterAttachments = f0_local0
		f3_arg0.SortAttachmentTable = f0_local0
		f3_arg0.SortAndFilterAttachmentTable = f0_local0
		f3_arg0.UpdateCurrentlyFiltering = f0_local0
		f3_arg0._updateFilterTable = {}
		f3_arg0._attachmentFilteringType = {
			[LOOT.attachmentFilters.RANGE.ref] = false,
			[LOOT.attachmentFilters.ACCURACY.ref] = false,
			[LOOT.attachmentFilters.RECOIL.ref] = false,
			[LOOT.attachmentFilters.MOBILITY.ref] = false,
			[LOOT.attachmentFilters.HANDLING.ref] = false,
			[LOOT.attachmentFilters.DAMAGE.ref] = false,
			[LOOT.attachmentFilters.FIRE_RATE.ref] = false
		}
		if CONDITIONS.EnableFilterAttachmentImprovement() then
			f3_local2 = LUI.FlowManager.GetScopedData( f3_arg0 )
			if f3_local2 then
				f3_arg0._attachmentFilteringType = f3_local2.attachmentFilteringType or f3_arg0._attachmentFilteringType
				f3_arg0._subcategoryFilteringType = f3_local2.subcategoryFilteringType or f3_arg0._subcategoryFilteringType
			end
		else
			f3_arg0._unlockFilteringType = {
				[LOOT.unlockFilters.UNLOCKED.ref] = false,
				[LOOT.unlockFilters.LOCKED.ref] = false
			}
			f3_local2 = LOOT.GetPlayerPreferenceForLootType( f3_arg1, LOOT.itemTypes.ATTACHMENT )
			if f3_local2 then
				if f3_local2.attachmentStatsPreference then
					for f3_local6, f3_local7 in pairs( f3_arg0._attachmentFilteringType ) do
						if f3_local2.attachmentStatsPreference[f3_local6] then
							f3_arg0._attachmentFilteringType[f3_local6] = f3_local2.attachmentStatsPreference[f3_local6]:get() == 1
						end
					end
				end
				if f3_local2.unlockPreference then
					f3_arg0._unlockFilteringType[LOOT.unlockFilters.UNLOCKED.ref] = f3_local2.unlockPreference.unlocked:get() == 1
					f3_arg0._unlockFilteringType[LOOT.unlockFilters.LOCKED.ref] = f3_local2.unlockPreference.locked:get() == 1
				end
				if f3_local2.aftermarketParts then
					f3_arg0._aftermarketPartsFiltering = f3_local2.aftermarketParts:get() == 1
				end
			end
		end
	end
	f3_arg0._unlockedBlueprintAttachmentRef = f3_arg2.unlockedBlueprintAttachmentRef
	if f3_arg2.returnFromBundle then
		f3_arg2.returnFromBundle = false
		local f3_local3, f3_local4 = GL_HACK.GetAttachmentsAndBucketItems( f3_arg1, {
			isWeaponParts = true,
			isForceRequestingAttachmentData = true,
			weaponRef = GL_HACK.GetWeaponMPRef( f3_arg0._weaponRef ),
			blueprintID = f3_arg0._weaponTable.lootID
		} )
		local f3_local5 = f3_local3[f3_arg2.category]
		if f3_local5 then
			f3_arg2.attachments = f3_local5
		end
	end
	f3_arg2.attachments = ATTACHMENT.GetCompleteAttachmentsListData( f3_arg2.attachments, f3_arg0._category )
	f0_local0( f3_arg2.attachments )
	if CONDITIONS.InGame() then
		f3_local2 = {}
		for f3_local3 = 1, #f3_arg2.attachments, 1 do
			if f0_local0( f3_arg0, f3_arg1, f3_arg2.attachments[f3_local3].baseRef ) then
				f3_arg2.attachments[f3_local3].unlocked = true
			end
			local f3_local7 = f3_arg0._equippedAttach
			if f3_local7 then
				f3_local7 = f3_arg0._equippedAttach == f3_arg2.attachments[f3_local3].ref
			end
			if not (f3_arg2.attachments[f3_local3].unlocked ~= true or f3_arg2.attachments.isClassified) or f3_local7 then
				table.insert( f3_local2, f3_arg2.attachments[f3_local3] )
			end
		end
		f3_arg2.attachments = f3_local2
	end
	f3_arg0._attachmentListData = f3_arg2.attachments
	if CONDITIONS.IsAttachmentFilteringEnabled() then
		f3_arg0:registerEventHandler( "restore_focus", function ( element, event )
			if element._isComingFromFilterMenu then
				local f21_local0 = f3_arg0( element, element._originalRef )
				if f21_local0 == nil then
					if element._equippedAttach ~= ATTACHMENT.none and element._equippedAttach ~= nil then
						f21_local0 = f3_arg0( element, element._equippedAttach ) - 1
					else
						local f21_local1 = element.Attachments:GetDefaultFocus()
						f21_local0 = f21_local1.x
					end
				else
					f21_local0 = f21_local0 - 1
				end
				if LUI.IsLastInputMouseNavigation( event.controller ) then
					if event.data then
						if 0 < f21_local0 + event.data.targetPosition.x - event.data.targetColumn then
							event.data.targetColumn = f21_local0
						end
						event.data.targetPosition.x = f21_local0
					end
					local f21_local1 = element.Attachments:GetBuiltChildren()
					local f21_local2 = false
					for f21_local6, f21_local7 in ipairs( f21_local1 ) do
						if f21_local7._data and f21_local7._data.ref ~= ATTACHMENT.none and element._filteredAttachmentsList[f21_local0 + 1] and (f21_local7._data.ref == element._filteredAttachmentsList[f21_local0 + 1].ref or f21_local7._data.ref == element._equippedAttach) then
							f21_local7:GainFocus( {
								controller = event.controller,
								focusType = FocusType.MouseOver
							} )
							f21_local2 = true
						end
					end
					if not f21_local2 then
						f21_local1[1]:GainFocus( {
							controller = event.controller,
							focusType = FocusType.MouseOver
						} )
					end
				end
				element._isComingFromFilterMenu = false
				element.Attachments:restoreFocus( event )
				element.Attachments:SetFocusedPosition( {
					y = 0,
					x = f21_local0
				}, true, true, true )
			elseif not LUI.IsLastInputMouseNavigation( event.controller ) then
				element.Attachments:restoreFocus( event )
			end
			return true
		end )
	end
	f3_arg0._attachmentListData = f3_arg2.attachments
	for f3_local2 = 1, #f3_arg0._attachmentListData, 1 do
		if f0_local0( f3_arg0, f3_arg1, f3_arg0._attachmentListData[f3_local2].baseRef ) then
			f3_arg0._attachmentListData[f3_local2].unlocked = true
			break
		end
	end
	f3_arg0._attachmentVariants = {}
	if ATTACHMENT.AreVariantsEnabled() then
		for f3_local5, f3_local6 in ipairs( f3_arg0._attachmentListData ) do
			for f3_local14, f3_local15 in ipairs( Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f3_arg0._weaponRef ), f3_local6.ref ) ) do
				local f3_local8 = nil
				if f3_local15[0x6DB25C2B8532150] then
					f3_local8 = ATTACHMENT.GetBundleByRef( f3_local15[0x6DB25C2B8532150] )
				end
				if f3_local8 then
					local f3_local9 = GL_HACK.GetWeaponMPRef( f3_arg0._weaponRef )
					local f3_local10 = f3_local8[0x28887F70BF5EBA]
					local f3_local11 = f3_local8[0x28887F70BF5EBA]
					if f3_local11 then
						f3_local11 = LOOT.IsUnlockedWithID( f3_arg1, f3_local8[0x28887F70BF5EBA], {
							notCDLUnlocked = true
						} )
					end
					local f3_local12 = Engine[0x69703F35FE390E2]( f3_local9, f3_local6.ref, f3_local14 )
					if not f3_local12 then
						f3_local12 = 0 < f3_local14
					end
					local f3_local13 = f3_local15[0x4FDAECD20551368]
					if not f3_local13 then
						f3_local13 = f3_local8[0xAED63DFE5400760]
						if not f3_local13 then
							f3_local13 = LOOT.IsItemBanned( f3_local8[0x28887F70BF5EBA] )
						end
					end
					if f3_local11 and f3_local12 and not f3_local13 then
						if f3_arg0._attachmentVariants[f3_local6.ref] == nil then
							f3_arg0._attachmentVariants[f3_local6.ref] = {}
						end
						table.insert( f3_arg0._attachmentVariants[f3_local6.ref], f3_local14 )
					end
				end
			end
		end
	end
	f3_arg0._attachmentListData = GUNSMITH.FilterRestrictedAttachments( f3_arg0._attachmentListData, f3_arg0._weaponRef, f3_arg0._equippedAttach )
	f3_arg0._areAllAttachmentsBlocked = ATTACHMENT.SetBlockedAttachments( f3_arg1, f3_arg0._attachmentListData, f3_arg0._weaponTable, f3_arg0._equippedAttach, f3_arg0._category ) == #f3_arg0._attachmentListData - 1
	f3_local3, f3_local4 = nil
	if CONDITIONS.EnableFilterAttachmentImprovement() then
		f3_arg0._subcategoryFilters = LOOT.GenerateSubcategoryFilters( f3_arg0._attachmentListData )
		if not f3_arg0._subcategoryFilteringType then
			f3_arg0._subcategoryFilteringType = {}
			for f3_local17, f3_local18 in pairs( f3_arg0._subcategoryFilters ) do
				f3_arg0._subcategoryFilteringType[f3_local18.ref] = false
			end
		end
		f3_arg0._filtersForFilterCategory = {
			[LOOT.FilterCategories.ATTACHMENT_STATS] = LOOT.attachmentFilters,
			[LOOT.FilterCategories.SUBCATEGORIES] = f3_arg0._subcategoryFilters
		}
		f3_local3 = GL_HACK.GetWeaponMPRef( f3_arg0._weaponTable.weapon )
		f3_local4 = {}
	end
	f0_local0( f3_arg0, f3_arg1, f3_local3, f3_local4 )
	f0_local0( f3_arg0, f0_local0.FAVORITE, false )
	local f3_local5 = function ()
		local f20_local0 = f3_arg0._attachmentListData
		for f20_local1 = 1, #f20_local0, 1 do
			if 1 < #f20_local0[f20_local1].variants then
				return true
			end
		end
		return false
	end
	
	if Engine[0x12586A3F4FB490E]() and f3_local5() and not Onboarding.GunsmithCustoms.WasCompleted( f3_arg0, f3_arg1 ) then
		LUI.FlowManager.RequestPopupMenu( f3_arg0, "onboardingpopup", true, f3_arg1, false, ONBOARDING_DATA.GetOnboardingGunsmithCustomsData() )
		Onboarding.GunsmithCustoms.MarkCompleted( f3_arg0, f3_arg1 )
	end
	f3_arg0:AddGamepadEventCallback( "button_alt1", function ( f19_arg0, f19_arg1 )
		if GUNSMITH.IsGunsmithCustomsAvailable( f19_arg1.controller or f3_arg0, f19_arg0._focusedAttachmentData.unlocked, f19_arg0._focusedAttachmentData.variantData, f19_arg0._weaponRef, f3_arg0.category, f19_arg0._focusedAttachmentData.isBlocked ) then
			f19_arg0:OpenAppearanceSelect( f3_arg0 )
		end
	end )
	if f3_arg0.SkinsButton then
		f3_arg0.SkinsButton:addEventHandler( "button_action", function ( f18_arg0, f18_arg1 )
			openAppearanceSelect()
		end )
	end
	f3_arg0._numAttachments = #f3_arg2.attachments
	f3_arg0.SetFavorite = f0_local0
	if LOOT.IsFavoritesEnabled( f3_arg0._controllerIndex ) then
		f3_arg0:AddGamepadEventCallback( f0_local0, function ( f17_arg0, f17_arg1 )
			f17_arg0:SetFavorite()
		end )
	end
	if CONDITIONS.IsAttachmentFilteringEnabled() then
		f3_arg0:FilterAttachments( f3_arg1, f3_local3, f3_local4 )
		f0_local0( f3_arg0, f3_arg1 )
		f3_arg0:UpdateCurrentlyFiltering( f3_arg1 )
	else
		f3_arg0.Attachments:SetNumChildren( f3_arg0._numAttachments )
	end
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.Attachments:SetActiveOnTouchEndBehavior( f3_arg1 )
	end
	f3_arg0.Attachments:NotifyWhenPositionIsVisible( f3_arg0:GetDefaultIndex(), 0 )
	f3_arg0.Attachments:SetRefreshChild( function ( f11_arg0, f11_arg1, f11_arg2 )
		local f11_local0 = f3_arg0.Attachments:GetContentIndex( f11_arg1, f11_arg2 )
		local f11_local1 = f3_arg0._filteredAttachmentsList and f3_arg0._filteredAttachmentsList[f11_local0 + 1] or f3_arg0._attachmentListData[f11_local0 + 1]
		Engine[0xD75F5E555D60E1]( "Attachments:SetRefreshChild" )
		if f11_local1.baseRef then
			f11_local1.variantData = {}
			f11_local1.variantData[ATTACHMENT.baseVariant + 1] = {
				ref = f11_local1.baseRef,
				variantID = ATTACHMENT.baseVariant,
				name = f11_local1.name,
				lootImage = f11_local1.image,
				uiImage = f11_local1.image
			}
			local f11_local2 = Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f3_arg0._weaponRef ), f11_local1.ref )
			if f3_arg0._attachmentVariants[f11_local1.ref] then
				for f11_local14, f11_local15 in ipairs( f3_arg0._attachmentVariants[f11_local1.ref] ) do
					for f11_local11, f11_local12 in ipairs( f11_local2 ) do
						if f11_local15 == f11_local11 and f11_local15 ~= ATTACHMENT.baseVariant and f11_local1.variantData[f11_local14 + 1] == nil then
							local f11_local6 = nil
							if f11_local12[0x6DB25C2B8532150] then
								f11_local6 = ATTACHMENT.GetBundleByRef( f11_local12[0x6DB25C2B8532150] )
							end
							local f11_local7 = f11_local1.variantData
							local f11_local8 = f11_local14 + 1
							local f11_local9 = {
								ref = f11_local1.ref,
								variantID = f11_local15
							}
							local f11_local10
							if not LUI.StringIsNilOrEmpty( f11_local12[0x55F116BF695C8F6] ) then
								f11_local10 = f11_local12[0x55F116BF695C8F6]
								if not f11_local10 then
								
								else
									f11_local9.name = f11_local10
									f11_local9.lootImage = f11_local1.image
									f11_local9.uiImage = f11_local1.image
									f11_local9.desc = f11_local1.desc
									f11_local7[f11_local8] = f11_local9
								end
							end
							f11_local10 = f11_local1.name
						end
					end
				end
			end
		end
		Engine[0x4D47DEF7D5ED4B9]()
		local f11_local2 = Restrictions.IsAttachmentRestricted( f11_local1.ref, f3_arg0._weaponRef )
		if CONDITIONS.AreRestrictionsActive() and f11_local1.category == ATTACHMENT.receiverCategory then
			local f11_local3 = WEAPON.GetWeaponRefByRec( f11_local1.ref )
			local f11_local4 = WEAPON.GetWeaponClass( f11_local3 )
			if not f11_local2 then
				local f11_local5 = MatchRules[0x966A6F3A93A1200]( f11_local3 )
				if not f11_local5 then
					f11_local2 = f11_local5
				else
					f11_local2 = MatchRules[0xB0FA3D79A09CF96]( f11_local4 )
				end
			end
		end
		local f11_local3 = f11_local1.ref == f3_arg0._equippedAttach
		f11_arg0:SetupContextualMenu()
		if LOOT.IsFavoritesEnabled( f3_arg0._controllerIndex ) then
			local f11_local4
			if f3_arg0._favoriteAttachments[f11_local1.ref] == nil then
				f11_local4 = f11_local1.__bundleData
				if f11_local4 then
					if f3_arg0._favoriteLootIDs[f11_local1.__bundleData[0x28887F70BF5EBA]] == nil then
						f11_local4 = false
					else
						f11_local4 = true
					end
				end
			else
				f11_local4 = true
			end
			f3_arg0.isFavorite = f11_local4
			f11_arg0:RemoveContextualMenuFromElement()
			if f11_local1.ref ~= ATTACHMENT.none and f11_local1.unlocked then
				f3_arg0( f3_arg0, f11_arg0, f11_local1.name, f11_local4 )
			end
		end
		f11_arg0:Setup( f3_arg0, f11_local1, f11_local3, f3_arg0._weaponTable, f11_local2, f3_arg0, f3_arg0 )
		f11_arg0:AddContextualMenuAction( {
			id = "chooseAppearance",
			actionName = Engine[0xED84C33EC5F01EA]( 0x894F428657B5CDD ),
			conditionFunction = function ()
				return GUNSMITH.IsGunsmithCustomsAvailable( f11_arg0, f11_arg0._focusedAttachmentData.unlocked, f11_arg0._focusedAttachmentData.variants, f11_arg0._weaponRef, f11_arg0.category, f11_arg0._focusedAttachmentData.isBlocked )
			end,
			actionFunction = function ()
				f11_arg0:OpenAppearanceSelect()
			end
		} )
		if not f11_arg0._addedFocusUpdate and LOOT.IsFavoritesEnabled( f3_arg0._controllerIndex ) then
			f11_arg0:addEventHandler( "gain_focus", function ( f14_arg0, f14_arg1 )
				if f14_arg0._data.unlocked and f14_arg0._data.ref ~= ATTACHMENT.none then
					local f14_local0
					if f11_arg0._favoriteAttachments[f14_arg0._data.ref] == nil and f11_arg0._favoriteAttachments[ATTACHMENT.GetRefByID( f14_arg0._data.__bundleData[0x28887F70BF5EBA] )] == nil then
						f14_local0 = false
					else
						f14_local0 = true
					end
					f11_arg0( f11_arg0, f11_arg0.FAVORITE, f14_local0 )
				elseif f11_arg0.HelperBar then
					f11_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
						button_ref = f11_arg0
					} )
				end
			end )
			f11_arg0._addedFocusUpdate = true
		end
		if not f11_arg0._parentHandlersAdded and CONDITIONS.IsDvarBoolEnabled( 0x8D8731B81911DA8 ) then
			local f11_local5 = function ( f12_arg0, f12_arg1 )
				if CONDITIONS.InFrontend() and CONDITIONS.IsWeaponPreviewEnabled() then
					if f11_arg0.HelperBar then
						if f11_arg0._data.isClassified then
							f11_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
								button_ref = "button_r3"
							} )
						else
							f11_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
								side = "left",
								priority = 10,
								button_ref = "button_r3",
								helper_text = Engine[0xED84C33EC5F01EA]( 0xCBEAF62674E5E75 ),
								helper_definition = Engine[0xED84C33EC5F01EA]( 0xF2D581450245105 )
							} )
						end
					end
					f11_arg0:AddGamepadEventCallback( "button_right_stick", function ( f13_arg0, f13_arg1 )
						if f12_arg0._data.isClassified then
							return 
						end
						local f13_local0 = f13_arg1.controller or f12_arg0
						f12_arg0.weaponTable = f13_arg0._currentTable
						LUI.FlowManager.RequestAddMenu( "WeaponPreview", true, f13_local0, false, f12_arg0, true )
						if f13_arg1.qualifier then
							Engine[0xC4146BA76D0F982]( CoD.SFX.MouseClick )
						end
					end )
				end
			end
			
			f11_arg0:addEventHandler( "button_over", f11_local5 )
			f11_arg0:addEventHandler( "button_over_disable", f11_local5 )
		end
		local f11_local5 = GUNSMITH.AttachmentTypeSFX[f11_local1.category]
		if f11_arg0.id ~= "GunsmithAttachmentButton0" and not LUI.StringIsNilOrEmpty( f11_local5 ) then
			f11_arg0:setActionSFX( f11_local5 )
		end
		f11_arg0._handlersAdded = true
		MenuUtils.SetupItemButtonTags( f3_arg0, f11_arg0, f11_local1.lootID )
	end )
	if not CONDITIONS.IsAttachmentFilteringEnabled() then
		f3_arg0.Attachments:SetNumColumns( f3_arg0._numAttachments )
	end
	f3_arg0.Attachments:SetNumRows( 1 )
	f3_arg0.Attachments:RefreshContent()
	f3_arg0.Attachments:addEventHandler( "position_visible", function ( f10_arg0, f10_arg1 )
		f10_arg0:UpdateScrolling()
	end )
	if Challenge.IsWinChallengesUnlocked( f3_arg1 ) and not Challenge.IsMenuChallengeCompleteCallbackRegistered( f3_arg0 ) then
		Challenge.RegisterMenuChallengeCompleteCallback( f3_arg0, function ( f9_arg0, f9_arg1 )
			f9_arg0.Attachments:RefreshContent()
			f9_arg0.GunsmithDetails.UnlockCriteriaWidget:UpdateFromDataSources( f3_arg0 )
		end )
	end
	f3_arg0:SubscribeToInputTypeModel( f3_arg1, function ( f8_arg0, f8_arg1 )
		if CONDITIONS.IsGamepad( f8_arg1._controllerIndex ) and 0 < f8_arg1._numAttachments then
			local f8_local0 = f8_arg1.Attachments:GetFocusPositionIndex()
			if not f8_local0 then
				return 
			end
			local f8_local1 = f8_arg1.Attachments:GetPositionForIndex( f8_local0 )
			local f8_local2 = f8_arg1.Attachments:GetElementAtPosition( f8_local1.x, f8_local1.y - 1 )
			if f8_local2 then
				f8_local2:processEvent( {
					immediate = true,
					name = "gain_focus"
				} )
			end
		end
	end, true )
	f3_arg0:addEventHandler( "menu_create", function ( f7_arg0, f7_arg1 )
		f7_arg0.Attachments:RefreshContent()
		local f7_local0 = f7_arg0:GetDefaultIndex()
		f3_arg0.Attachments:SetDefaultFocus( f3_arg0.Attachments:GetPositionForIndex( f7_local0, {
			relativePosition = false
		} ) )
		if not f3_arg0.Attachments:GetFocusPositionIndex() then
			f3_arg0.Attachments:SetFocusedPosition( {
				y = 0,
				x = f7_local0
			}, true, true, true )
		end
		f7_arg0:processEvent( {
			name = "update_showcase",
			attachmentData = f3_arg0._filteredAttachmentsList and f3_arg0._filteredAttachmentsList[f7_local0 + 1] or f3_arg0._attachmentListData[f7_local0 + 1]
		} )
	end )
	local f3_local6 = {}
	if f3_arg0._weaponTable.lootID ~= LOOT.emptyID then
		f3_local6 = WEAPON.GetModificationAttachments( f3_arg1, f3_arg0._weaponTable.weapon, f3_arg0._weaponTable.lootID )
	end
	f0_local0( f3_arg0, f3_arg1, f3_local1 )
	f0_local0( f3_arg0, f3_arg1, f3_local1, f3_local6 )
	f3_arg0._currentTable = f0_local0( f3_arg0, f3_local1 )
	f0_local0( f3_arg0, f3_arg1, f3_arg0._category )
	f0_local0( f3_arg0, f3_arg1, f3_arg2, f3_local1, f3_arg0._weaponRef )
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	local f3_local7 = f3_arg0.Attachments
	local f3_local17 = f3_arg0.MouseArea
	if f3_local7 and f3_local17 then
		f3_local7:SetSnapOnScrollBarMouseDrag( true )
		local f3_local18 = {
			step = f0_local0
		}
		f3_local17:addEventHandler( "gamepad_button", function ( f6_arg0, f6_arg1 )
			if CONDITIONS.IsMouseWheelEvent( f6_arg1 ) and f6_arg1.down then
				f6_arg1.forceScrollMove = true
				f3_arg0:processEvent( f6_arg1 )
			end
		end )
	end
	if f3_arg0._category == ATTACHMENT.receiverCategory and not Onboarding.Receiver.WasCompleted( f3_arg0, f3_arg1 ) then
		TIP.CreateTips( Onboarding.Tips.RECEIVER( f3_arg1, f3_arg0 ) )
		Onboarding.Receiver.MarkCompleted( f3_arg0, f3_arg1 )
	end
	f3_arg0:SubscribeToInputTypeModel( f3_arg1, function ( f5_arg0, f5_arg1 )
		if not LUI.IsLastInputMouseNavigation( f5_arg1._controllerIndex ) and f5_arg1.GLAttachmentsFrontend then
			ACTIONS.GainFocus( f5_arg1, f5_arg1.Attachments.id, f5_arg1._controllerIndex )
		end
	end, true )
	f3_arg0:addEventHandler( "gamepad_button", function ( f4_arg0, f4_arg1 )
		if f4_arg1.down and CONDITIONS.ButtonSecondary( f4_arg0, f4_arg1 ) then
			ACTIONS.LeaveMenu( f3_arg0 )
		end
	end )
	f0_local0( f3_arg0 )
	if CONDITIONS.ShouldCheckForMissingReticlePreviews() and f3_arg0._category == ATTACHMENT.opticCategory then
		local f3_local16 = {}
		for f3_local9, f3_local10 in ipairs( f3_arg0._attachmentListData ) do
			if not String.IsNilOrEmpty( f3_local10.ref ) and f3_local10.ref ~= ATTACHMENT.none then
				local f3_local11 = WEAPON.GenerateWeaponTableFromRef( f3_arg0._weaponTable.weapon )
				local f3_local12 = WEAPON.GetWeaponModelName( f3_local11.weapon, f3_local11 )
				local f3_local13 = ATTACHMENT.GetDefaultAttachmentRefForSlotIndex( GL_HACK.GetWeaponMPRef( f3_arg0._weaponTable.weapon ), Enum[0x540F63FFAF44174][0x4D4BF1F5D4F4EBA] )
				if f3_local10.variantData and 0 < #f3_local10.variantData then
					for f3_local23, f3_local24 in ipairs( f3_local10.variantData ) do
						local f3_local22 = nil
						if String.IsNilOrEmpty( f3_local13 ) then
							f3_local22 = f3_local12 .. "+" .. f3_local10.ref .. "|" .. tostring( f3_local24.variantID )
						else
							f3_local22 = string.gsub( f3_local12, f3_local13, f3_local10.ref .. "|" .. tostring( f3_local24.variantID ) )
						end
						if String.IsNilOrEmpty( Reticle[0x15C60EB1A12545F]( f3_arg1, f3_local22, false ) ) then
							f3_local16[f3_local10.ref] = true
						end
					end
				end
				local f3_local19 = nil
				if String.IsNilOrEmpty( f3_local13 ) then
					f3_local19 = f3_local12 .. "+" .. f3_local10.ref
				else
					f3_local19 = string.gsub( f3_local12, f3_local13, f3_local10.ref )
				end
				if String.IsNilOrEmpty( Reticle[0x15C60EB1A12545F]( f3_arg1, f3_local19, false ) ) then
					f3_local16[f3_local10.ref] = true
				end
			end
		end
		if not Table.IsEmpty( f3_local16 ) then
			f3_local14 = "The following optics are missing reticle previews:"
			for f3_local10, f3_local11 in pairs( f3_local16 ) do
				f3_local14 = f3_local14 .. "\t" .. f3_local10 .. "\n"
			end
		end
	end
end

local f0_local51 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function AttachmentSelectBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIMenu.new()
	f1_local1.id = "AttachmentSelectBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f1_local2 = f1_local0.ValidateControllerIndex( f1_local1, f1_local2 )
	local f1_local3 = f1_local1
	f0_local0( f1_local1, f1_local2, f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0xAAE34303F8EE685, AttachmentSelectBase )
LockTable( _M )
