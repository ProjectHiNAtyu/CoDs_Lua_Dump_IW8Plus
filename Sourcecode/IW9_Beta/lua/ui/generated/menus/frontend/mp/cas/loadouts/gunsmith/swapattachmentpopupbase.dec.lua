-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:01
module( ..., package.seeall )
local f0_local0 = 99 * _1080p
local f0_local1 = 512
local f0_local2 = function ( f11_arg0, f11_arg1, f11_arg2 )
	local f11_local0 = false
	for f11_local1 = 1, #f11_arg1, 1 do
		if f11_arg1[f11_local1].value ~= 0 then
			f11_local0 = true
			break
		end
	end
	local f11_local1 = ACTIONS.AnimateSequence
	local f11_local3 = f11_arg0
	local f11_local4
	if f11_local0 then
		f11_local4 = "Show"
	else
		f11_local4 = "Hide"
	end
	local f11_local5
	if f11_arg2 then
		f11_local5 = "SwapModifiers"
	else
		f11_local5 = "EquipModifiers"
	end
	f11_local1( f11_local3, f11_local4 .. f11_local5 )
end

local f0_local3 = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3, f10_arg4 )
	local f10_local0 = ATTACHMENT.GetTableWithCurrentAttachment( f10_arg4, f10_arg3, nil, f10_arg2, nil )
	local f10_local1 = ClientWeapon[0xA41C97AC6ADDC24]( f10_arg1, WEAPON.GetWeaponModelName( f10_local0.weapon, f10_local0, {
		includeAttachments = true
	} ), f10_arg3 )
	if f10_local1 then
		f10_arg0.ModifiersList:SetupMods( f10_local1 )
		f0_local0( f10_arg0, f10_local1, true )
	end
	local f10_local2 = WEAPON.GetWeaponModelName( f10_arg4.weapon, f10_arg4, {
		includeAttachments = true
	} )
	local f10_local3 = ClientWeapon[0x75228338D174290]( f10_arg1, f10_local2, false, true, true )
	local f10_local4 = ClientWeapon[0x75228338D174290]( f10_arg1, f10_local2, true )
	local f10_local5 = ClientWeapon[0xFE24333F9BC2CAB]( f10_arg1, f10_local2, f10_arg3 )
	if f10_local3 and f10_local4 then
		f10_arg0._weaponAttributes = {}
		for f10_local9, f10_local10 in pairs( f10_local3 ) do
			local f10_local11 = f10_local5.tunedStats and f10_local5.tunedStats[f10_local9] or f10_local5.unTunedStats[f10_local9]
			f10_arg0._weaponAttributes[f10_local9] = {
				total = f10_local10 - f10_local11,
				weapon = f10_local10 - f10_local11,
				attachment = f10_local11
			}
		end
		f10_arg0.StatsWithDetails.WeaponAttributes:Setup( f10_arg0._weaponAttributes, true, false )
	end
end

local f0_local4 = function ( f9_arg0, f9_arg1, f9_arg2, f9_arg3, f9_arg4 )
	local f9_local0 = WEAPON.GetWeaponModelName( f9_arg4.weapon, ATTACHMENT.GetTableWithCurrentAttachment( f9_arg4, f9_arg3, nil, f9_arg2, nil ), {
		includeAttachments = true
	} )
	local f9_local1 = ClientWeapon[0xA41C97AC6ADDC24]( f9_arg1, f9_local0, f9_arg3 )
	if f9_local1 then
		f9_arg0.EquippedModifiersList:SetupMods( f9_local1 )
		f0_local0( f9_arg0, f9_local1, false )
	end
	if f9_arg0._weaponAttributes then
		local f9_local2 = ClientWeapon[0xFE24333F9BC2CAB]( f9_arg1, f9_local0, f9_arg3 )
		for f9_local6, f9_local7 in pairs( f9_arg0._weaponAttributes ) do
			f9_local7.attachment = f9_local2.tunedStats and f9_local2.tunedStats[f9_local6] or f9_local2.unTunedStats[f9_local6]
		end
		f9_arg0.StatsWithDetails.WeaponAttributes:Update( f9_arg0._weaponAttributes )
	end
end

local f0_local5 = function ( f8_arg0, f8_arg1 )
	local f8_local0 = nil
	for f8_local4, f8_local5 in ddlpairs( f8_arg0.attachmentSetup ) do
		if ATTACHMENT.GetRefFromSetup( f8_local5 ) == f8_arg1 then
			f8_local0 = f8_local4 + 1
			break
		end
	end
	return f8_local0
end

local f0_local6 = function ( f7_arg0, f7_arg1 )
	local f7_local0 = 20 * _1080p
	local f7_local1 = f7_arg0:GetAnchorsAndPosition()
	local f7_local2 = f7_arg1:GetAnchorsAndPosition()
	local f7_local3 = LAYOUT.GetTextWidth( f7_arg0 )
	local f7_local4 = LAYOUT.GetTextWidth( f7_arg1 )
	if f7_local2.right < f7_local1.left + f7_local3 + f7_local4 then
		f7_arg1:SetLeft( f7_local2.right - f7_local4 )
		f7_arg0:SetRight( f7_local2.right - f7_local4 - f7_local0 )
	else
		f7_arg0:SetRight( f7_local1.left + f7_local3 )
		f7_arg1:SetLeft( f7_local1.left + f7_local3 + f7_local0 )
	end
end

local f0_local7 = function ( f3_arg0, f3_arg1, f3_arg2 )
	assert( f3_arg2.weaponPlayerData )
	assert( f3_arg2.attachToReplaceWith )
	assert( f3_arg0.SwapAttachButtons )
	assert( f3_arg0.Instructions )
	assert( f3_arg0.ChosenAttachment.Image )
	assert( f3_arg0.ChosenAttachment.Category )
	assert( f3_arg0.ChosenAttachment.Name )
	local f3_local0 = f3_arg2.weaponPlayerData.weapon:get()
	local f3_local1 = ATTACHMENT.GetRef( f3_arg2.attachToReplaceWith, f3_local0 )
	local f3_local2 = ATTACHMENT.GetName( f3_local1 )
	local f3_local3 = RegisterMaterial( ATTACHMENT.GetImage( f3_local1 ) )
	local f3_local4 = ATTACHMENT.GetCategory( f3_local1 )
	local f3_local5 = Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( f3_local4 ) )
	local f3_local6 = Engine[0x603B6AC5797050A]( WEAPON.GetWeaponModelNameFromPlayerData( f3_local0, f3_arg2.weaponPlayerData, {
		includeAttachments = true
	} ), f3_local1 )
	local f3_local7 = WEAPON.GenerateWeaponTable( f3_arg2.weaponPlayerData )
	local f3_local8 = 5
	if CONDITIONS.IsGLGunsmithEnabled() then
		local f3_local9 = GUNSMITH.GetEquipCounts( f3_local0, f3_local7, f3_local7.attachments )
		f3_local8 = f3_local9.attachmentCount
	end
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.Instructions:setText( Engine[0xED84C33EC5F01EA]( 0xFA63CD09DCC9DC7, f3_local8 ), ToUpperCase( ATTACHMENT.GetName( f3_local1 ) ) )
	end
	f3_arg0.ChosenAttachment:UpdateContent( f3_local1, f3_local0 )
	f3_arg0.SwapModIcon:setImage( f3_local3 )
	ACTIONS.AnimateSequence( f3_arg0.ChosenAttachment, "Swap" )
	f3_arg0.ChosenCategory:setText( f3_local5 )
	f3_arg0.ChosenName:setText( ToUpperCase( f3_local2 ) )
	f0_local0( f3_arg0.ChosenName, f3_arg0.ChosenCategory )
	f0_local0( f3_arg0, f3_arg1, f3_local1, f3_local6, f3_local7 )
	if f3_arg0.StatsWithDetails then
		local f3_local9 = GL_HACK.GetWeaponMPRef( f3_local0 )
		f3_arg0.StatsWithDetails:Setup( f3_arg1, WEAPON.GetAmmoData( f3_arg1, f3_local7 ) )
	end
	local f3_local9 = LAYOUT.GetElementWidth( f3_arg0.ChosenAttachment )
	local f3_local10 = GUNSMITH.GetAttachmentRefsByType( f3_local4, f3_arg2.weaponPlayerData )
	f3_arg0.SwapAttachButtons:SetNumChildren( #f3_local10 )
	f3_arg0.SwapAttachButtons:SetDefaultFocus( {
		x = 0,
		y = 0
	} )
	f3_arg0.SwapAttachButtons:MouseSetActiveToDefaultFocusMenuCreate( f3_arg1 )
	f3_arg0.SwapAttachButtons:SetRefreshChild( function ( f6_arg0, f6_arg1, f6_arg2 )
		f6_arg0:Setup( f3_arg0[f3_arg0.SwapAttachButtons:GetContentIndex( f6_arg1, f6_arg2 ) + 1], f3_arg0 )
	end )
	f3_arg0.SwapAttachButtons:RefreshContent()
	f3_arg0:registerEventHandler( "equip_attachment", function ( element, event )
		local f5_local0 = f3_arg0( f3_arg0.weaponPlayerData, event.ref )
		assert( f5_local0 )
		DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f3_arg0, DYN_ATTACHMENT.StreamedImageAction.REMOVE )
		local f5_local1 = f3_arg0.attachments[f5_local0]
		if f5_local1 then
			f5_local1 = f3_arg0.attachments[f5_local0].ref
		end
		local f5_local2 = f3_arg0.attachments[f5_local0]
		if f5_local2 then
			f5_local2 = f3_arg0.attachments[f5_local0].variantID
		end
		table.insert( f3_arg0.menusToLeave, element.id )
		local f5_local3 = GUNSMITH.EquipAttachment
		local f5_local4 = element
		local f5_local5 = f3_arg0
		local f5_local6 = f3_arg0.attachToReplaceWith
		local f5_local7 = f3_arg0.weaponPlayerData
		local f5_local8 = {
			menusToLeave = f3_arg0.menusToLeave,
			attachSlot = f5_local0,
			isNewAttachment = f3_arg0.attachToReplaceWith ~= f5_local1,
			variantID = f3_arg0.variantID,
			lootID = f3_arg0.lootID
		}
		local f5_local9
		if f3_arg0.variantID == f5_local2 and f3_arg0.attachToReplaceWith == f5_local1 then
			f5_local9 = false
		else
			f5_local9 = true
		end
		f5_local8.isNewVariantID = f5_local9
		f5_local3( f5_local4, f5_local5, f5_local6, f5_local7, f5_local8 )
		if CONDITIONS.IsWaveGameType() then
			Engine[0xC4146BA76D0F982]( 0x7AA312B9A84F375 )
			CP.CurrencySubtract( f3_arg0, f3_arg0.survivalCost )
			Engine[0x6055C55456F05DF]( "attachment_purchased", f3_arg0.survivalCost )
		end
		DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f3_arg0, DYN_ATTACHMENT.StreamedImageAction.ADD )
		return true
	end )
	local f3_local11 = function ( f4_arg0, f4_arg1 )
		local f4_local0 = f3_arg0.SwapAttachButtons:GetFocusPositionIndex()
		local f4_local1 = f3_arg0 * _1080p
		local f4_local2
		if f4_local0 and not f4_local0 then
			f4_local2 = f4_local0
		else
			f4_local2 = 0
		end
		f4_local1 = f4_local1 + f4_local2 * (f3_arg0 + f3_arg0)
		f4_local2 = f4_local1 + f3_arg0
		if CONDITIONS.IsSplitscreen( f3_arg0 ) and CONDITIONS.InGame( f3_arg0 ) then
			f3_arg0.ChosenAttachment:SetAnchorsAndPosition( 0, 1, 0, 1, f4_local1, f4_local2, _1080p * 300, _1080p * 400 )
		else
			f3_arg0.ChosenAttachment:SetAnchorsAndPosition( 0, 1, 0, 1, f4_local1, f4_local2, _1080p * 516, _1080p * 616 )
		end
		local f4_local3 = LUI.DeepCopy( f3_arg0 )
		local f4_local4 = f4_local3.attachments
		local f4_local5 = f4_arg1.ref
		local f4_local6 = f3_arg0( f3_arg0.weaponPlayerData, f4_arg1.ref )
		for f4_local10, f4_local11 in ipairs( f4_local4 ) do
			if f4_local11.ref == f4_local5 then
				f4_local11.ref = f3_arg0
			end
		end
		f4_local3.attachments = f4_local4
		if f3_arg0.StatsWithDetails then
			f4_local7 = f3_arg0.attachments[f4_local6].ref
			f4_local8 = ATTACHMENT.GetName( f4_local7 )
			f4_local10 = Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( ATTACHMENT.GetCategory( f4_local7 ) ) )
			f3_arg0.EquippedName:setText( Engine[0xEB2A2834B76AEA4]( f4_local8 ) )
			f3_arg0.EquippedCategory:setText( f4_local10 )
			f3_arg0.EquippedModIcon:setImage( RegisterMaterial( ATTACHMENT.GetImage( f4_local7 ) ) )
			f3_arg0( f3_arg0.EquippedName, f3_arg0.EquippedCategory )
			f3_arg0( f3_arg0, f3_arg0, f4_local5, Engine[0x603B6AC5797050A]( WEAPON.GetWeaponModelNameFromPlayerData( f3_arg0, f3_arg0.weaponPlayerData, {
				includeAttachments = true
			} ), f4_local7 ), f4_local3 )
		else
			f3_arg0.WeaponAttributes:Setup( f4_local3 )
		end
	end
	
	f3_local11( f3_arg0, {
		ref = f3_local10[1]
	} )
	f3_arg0:registerEventHandler( "preview_attachment", f3_local11 )
	if IsLanguageJapanese() then
		ACTIONS.AnimateSequence( f3_arg0, "JP" )
	end
	ACTIONS.ScaleStretchAnchorFullscreen( f3_arg0.Darkener )
	if CONDITIONS.IsSplitscreen( f3_arg0 ) and CONDITIONS.InGame( f3_arg0 ) then
		ACTIONS.AnimateSequence( f3_arg0, "Splitscreen" )
	end
end

local f0_local8 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function SwapAttachmentPopupBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "SwapAttachmentPopupBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "SwapAttachmentPopupBase", SwapAttachmentPopupBase )
LockTable( _M )
