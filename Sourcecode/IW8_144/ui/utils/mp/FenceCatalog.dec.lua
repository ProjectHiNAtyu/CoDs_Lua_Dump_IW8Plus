-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 27-09-2025 22:41
module( ..., package.seeall )
FenceCatalog = LUI.Class( LUI.Fence )
FenceCatalog.init = function ( f5_arg0, f5_arg1, f5_arg2 )
	f5_arg0.super:init( f5_arg1, f5_arg2 )
	f5_arg0._controllerIndex = f5_arg2
	assert( f5_arg0._controllerIndex )
end

FenceCatalog.Start = function ( f4_arg0 )
	DebugPrint( "FenceCatalog.Start" )
	if Dvar.IBEGCHEFE( "online_store_catalog_fence_enabled" ) then
		f4_arg0._timeoutSeconds = Dvar.CFHDGABACF( "NLLTLPKNTP" ) / 1000
		f4_arg0._startTime = tostring( Engine.DEIDGHDBHD() )
		InGameStore.FetchCatalog( f4_arg0._controllerIndex, false, true )
	else
		f4_arg0._state = LUI.Fence.STATE.pass
	end
end

FenceCatalog.Stop = function ( f3_arg0 )
	DebugPrint( "FenceCatalog.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "store_inprogress_popup", true )
	f3_arg0._openedPopup = false
end

FenceCatalog.UpdateState = function ( f2_arg0 )
	if f2_arg0._state == LUI.Fence.STATE.pass then
		return 
	end
	if f2_arg0._startTime and f2_arg0._timeoutSeconds <= math.abs( Engine.CCEJJCCDEG( f2_arg0._startTime ) ) then
		DebugPrint( "FenceCatalog: timed out" )
		f2_arg0._state = LUI.Fence.STATE.pass
		return 
	end
	local f2_local0 = InGameStore.GetCatalogStatus( f2_arg0._controllerIndex )
	if f2_local0 == InGameStoreCatalogStatus.FETCHING then
		f2_arg0._state = LUI.Fence.STATE.block
	elseif f2_local0 == InGameStoreCatalogStatus.READY then
		f2_arg0._state = LUI.Fence.STATE.pass
	else
		DebugPrint( "FenceCatalog: an error occured" )
		f2_arg0._state = LUI.Fence.STATE.pass
	end
	if f2_arg0._state == LUI.Fence.STATE.block and not f2_arg0._openedPopup then
		f2_arg0:ShowInProgressPopup()
	end
end

FenceCatalog.ShowInProgressPopup = function ( f1_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "store_inprogress_popup", false, f1_arg0._controllerIndex, false, {
		message = Engine.CBBHFCGDIC( "MENU/FETCHING_STORE_INFO" ),
		displayWZWipSetup = true
	}, nil, true, true )
	f1_arg0._openedPopup = true
end

LUI.Fence.Register( "catalog", FenceCatalog )
LockTable( _M )
