-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 17-11-2025 01:22
QUARTERMASTER = QUARTERMASTER or {}
QUARTERMASTER.storeSession = {}
QUARTERMASTER.itemData = {}
QUARTERMASTER.dlogEnabled = Dvar.IBEGCHEFE( "LQTMQOTTTQ" )
QUARTERMASTER.GetMenuSource = function ( f10_arg0 )
	if f10_arg0 == "BladeMenu" then
		return f10_arg0
	elseif LUI.FlowManager.IsMenuOnTop( "BRMainMenu" ) then
		return "BRStore"
	else
		local f10_local0
		if Engine.EAIICIFIFA() then
			f10_local0 = "CPStore"
		else
			f10_local0 = "MPStore"
		end
	end
	return f10_local0
end

QUARTERMASTER.RefreshStoreSession = function ( f9_arg0, f9_arg1 )
	if Engine.CFHBIHABCB( f9_arg0 ) then
		QUARTERMASTER.storeSession.storeName = Dvar.DHEEJCCJBH( "MKMMQLLLSN" )
	else
		QUARTERMASTER.storeSession.storeName = Dvar.DHEEJCCJBH( "LSOQLQTOTK" )
	end
	QUARTERMASTER.storeSession.storeRegion = Engine.CEAEFCAGJG()
	QUARTERMASTER.storeSession.storeLayout = f9_arg1.storeLayout
	local f9_local0 = QUARTERMASTER.storeSession
	local f9_local1 = f9_arg1.recommendationData
	if f9_local1 then
		f9_local1 = f9_arg1.recommendationData.isEnabled
	end
	f9_local0.recommendationsEnabled = f9_local1
	QUARTERMASTER.storeSession.recommendedItems = f9_arg1.recommendationData and f9_arg1.recommendationData.items or "none"
end

QUARTERMASTER.RecordStoreEnterEvent = function ( f7_arg0, f7_arg1, f7_arg2, f7_arg3, f7_arg4 )
	local f7_local0 = function ( f8_arg0 )
		local f8_local0 = ""
		if f8_arg0 == nil then
			return f8_local0
		end
		for f8_local1 = 1, #f8_arg0, 1 do
			local f8_local4 = f8_arg0[f8_local1]
			if f8_local4.id ~= nil then
				if string.len( f8_local0 ) == 0 then
					f8_local0 = f8_local4.id
				else
					f8_local0 = f8_local0 .. "," .. f8_local4.id
				end
			end
		end
		return f8_local0
	end
	
	if QUARTERMASTER.dlogEnabled and f7_arg2 then
		QUARTERMASTER.storeSession = {}
		QUARTERMASTER.storeSession.id = Engine.BCDHJIHBAA()
		local f7_local1 = QUARTERMASTER.GetMenuSource( f7_arg3 )
		local f7_local2 = {
			storeLayout = f7_arg1,
			recommendationData = f7_arg2
		}
		local f7_local3 = f7_local0( f7_arg4 )
		local f7_local4 = {}
		local f7_local5 = Engine.CFHBIHABCB( f7_arg0 ) or false
		QUARTERMASTER.RefreshStoreSession( f7_arg0, f7_local2 )
		local f7_local6 = QUARTERMASTER.storeSession
		local f7_local7 = Engine.CEJJDJJHIJ
		local f7_local8 = f7_arg0
		local f7_local9 = "dlog_event_store_qm_entry"
		local f7_local10 = {
			store_name = f7_local6.storeName,
			store_session_id = f7_local6.id,
			source = f7_local1,
			region = f7_local6.storeRegion,
			store_layout = f7_local6.storeLayout,
			recommendations_enabled = f7_local6.recommendationsEnabled,
			recommended_items = f7_local6.recommendedItems
		}
		local f7_local11
		if not f7_local3 then
			f7_local11 = f7_local3
		else
			f7_local11 = ""
		end
		f7_local10.categories = f7_local11
		f7_local10.is_premium = f7_local5
		f7_local7( f7_local8, f7_local9, f7_local10 )
		QUARTERMASTER.storeSession = f7_local6
	end
end

QUARTERMASTER.BeginItemBrowseEvent = function ( f6_arg0, f6_arg1, f6_arg2, f6_arg3 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f6_arg0, {
			storeLayout = f6_arg2,
			recommendationData = f6_arg3
		} )
		local f6_local0 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f6_local0.id
		QUARTERMASTER.itemData.start_time = os.time()
		QUARTERMASTER.itemData.item_id = f6_arg1.id or 0
		QUARTERMASTER.itemData.item_name = f6_arg1.name
		QUARTERMASTER.itemData.bundle_id = f6_arg1.bundleID
		QUARTERMASTER.itemData.position_in_grid = f6_arg1.positionInGrid or 0
	end
end

QUARTERMASTER.RecordItemBrowseEvent = function ( f5_arg0, f5_arg1, f5_arg2 )
	if QUARTERMASTER.dlogEnabled then
		local f5_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f5_local0.id == QUARTERMASTER.itemData.sessionId then
			local f5_local1 = QUARTERMASTER.GetMenuSource( f5_arg2 )
			local f5_local2 = QUARTERMASTER.itemData
			Engine.CEJJDJJHIJ( f5_arg0, "dlog_event_store_qm_item_browse", {
				store_name = f5_local0.storeName,
				store_session_id = f5_local0.id,
				source = f5_local1,
				region = f5_local0.storeRegion,
				store_layout = f5_local0.storeLayout,
				item_id = f5_local2.item_id,
				item_name = f5_local2.item_name,
				bundle_id = f5_local2.bundle_id,
				start_time = f5_local2.start_time,
				end_time = os.time(),
				interacted = f5_arg1,
				item_slot_in_category = f5_local2.position_in_grid
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.BeginMenuBrowseEvent = function ( f4_arg0, f4_arg1, f4_arg2, f4_arg3, f4_arg4 )
	if QUARTERMASTER.dlogEnabled then
		local f4_local0 = ""
		local f4_local1 = {}
		if f4_arg1.idPubVar then
			local f4_local2 = Dvar.DHEEJCCJBH( f4_arg1.idPubVar )
			if not string.match( f4_local2, tostring( f4_arg2.id ) ) then
				if string.len( f4_local2 ) == 0 then
					f4_local2 = tostring( f4_arg2.id )
				else
					f4_local2 = tostring( f4_arg2.id ) .. "," .. f4_local2
				end
			end
			if f4_arg1.commsLocationId then
				f4_local2 = STORE.FormatRecommendationItems( Store.JGBAJAECG( f4_arg1.commsLocationId ) .. "," .. f4_local2 )
			end
			local f4_local3 = split( f4_local2, "," )
			for f4_local4 = 1, #f4_local3, 1 do
				local f4_local7 = f4_local3[f4_local4]
				if STORE.BundleAvailable( f4_arg0, f4_local7 ) then
					if string.len( f4_local0 ) == 0 then
						f4_local0 = f4_local7
					else
						f4_local0 = f4_local0 .. "," .. f4_local7
					end
					if #f4_local1 < f4_arg1.numItemsShown then
						table.insert( f4_local1, f4_local7 )
					end
				end
			end
		end
		local f4_local2 = ""
		for f4_local3 = 1, #f4_local1, 1 do
			if string.len( f4_local2 ) == 0 then
				f4_local2 = f4_local1[f4_local3]
			else
				f4_local2 = f4_local2 .. "," .. f4_local1[f4_local3]
			end
		end
		QUARTERMASTER.RefreshStoreSession( f4_arg0, {
			storeLayout = f4_arg3,
			recommendationData = f4_arg4
		} )
		local f4_local4 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f4_local4.id
		QUARTERMASTER.itemData.start_time = os.time()
		QUARTERMASTER.itemData.category_index = f4_arg1.categoryIndex
		QUARTERMASTER.itemData.category_name = f4_arg1.name
		QUARTERMASTER.itemData.category_id = f4_arg1.id or ""
		QUARTERMASTER.itemData.item_id = f4_arg2.id or 0
		QUARTERMASTER.itemData.item_name = f4_arg2.name
		QUARTERMASTER.itemData.position_in_grid = f4_arg2.positionInGrid or 0
		local f4_local5 = QUARTERMASTER.itemData
		local f4_local6
		if not f4_local2 then
			f4_local6 = f4_local2
		else
			f4_local6 = ""
		end
		f4_local5.visible_items_in_row = f4_local6
		f4_local5 = QUARTERMASTER.itemData
		if not f4_local0 then
			f4_local6 = f4_local0
		else
			f4_local6 = ""
		end
		f4_local5.all_items_in_row = f4_local6
	end
end

QUARTERMASTER.RecordMenuBrowseEvent = function ( f3_arg0, f3_arg1, f3_arg2 )
	if QUARTERMASTER.dlogEnabled then
		local f3_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f3_local0.id == QUARTERMASTER.itemData.sessionId then
			local f3_local1 = QUARTERMASTER.GetMenuSource( f3_arg2 )
			local f3_local2 = QUARTERMASTER.itemData
			Engine.CEJJDJJHIJ( f3_arg0, "dlog_event_store_qm_row_revealed", {
				store_name = f3_local0.storeName,
				store_session_id = f3_local0.id,
				source = f3_local1,
				region = f3_local0.storeRegion,
				store_layout = f3_local0.storeLayout,
				category_index = f3_local2.category_index,
				category_name = f3_local2.category_name,
				category_id = f3_local2.category_id,
				item_id = f3_local2.item_id,
				item_name = f3_local2.item_name,
				start_time = f3_local2.start_time,
				end_time = os.time(),
				interacted = f3_arg1,
				item_slot_in_category = f3_local2.position_in_grid,
				visible_items_in_row = f3_local2.visible_items_in_row,
				available_items_in_row = f3_local2.all_items_in_row
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.RecordPurchaseConfirmEvent = function ( f2_arg0, f2_arg1, f2_arg2, f2_arg3, f2_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f2_arg0, f2_arg4 )
		local f2_local0 = QUARTERMASTER.storeSession
		local f2_local1 = false
		local f2_local2 = {
			store_name = f2_local0.storeName,
			store_session_id = f2_local0.id,
			source = QUARTERMASTER.GetMenuSource( f2_arg4.source ),
			region = f2_local0.storeRegion,
			store_layout = f2_local0.storeLayout,
			category_index = f2_arg4.categoryIndex,
			category_name = f2_arg4.categoryName,
			item_id = f2_arg4.itemID,
			item_name = f2_arg4.itemName,
			current_menu = LUI.FlowManager.GetMenuNameAtIndex( -1 ),
			previous_menu = f2_arg1,
			purchased = f2_arg2
		}
		local f2_local3
		if not f2_local1 then
			f2_local3 = f2_local1
		else
			f2_local3 = f2_arg3
		end
		f2_local2.err = f2_local3
		f2_local2.item_slot_in_category = f2_arg4.positionInGrid
		Engine.CEJJDJJHIJ( f2_arg0, "dlog_event_store_qm_item_purchase", f2_local2 )
	end
end

QUARTERMASTER.FlushData = function ( f1_arg0 )
	QUARTERMASTER.RecordMenuBrowseEvent( f1_arg0, false )
end

