-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
local f0_local0 = function ( f5_arg0, f5_arg1, f5_arg2, f5_arg3 )
	local f5_local0 = function ()
		local f6_local0 = f5_arg0:GetDataSource()
		local f6_local1 = f6_local0.weaponRef:GetValue( f5_arg0 )
		local f6_local2 = {
			f6_local0.attachmentOneRef,
			f6_local0.attachmentTwoRef,
			f6_local0.attachmentThreeRef
		}
		if Engine.EAAHGICFBD() then
			table.insert( f6_local2, f6_local0.attachmentFourRef )
			table.insert( f6_local2, f6_local0.attachmentFiveRef )
			if f6_local0.attachmentSixRef then
				table.insert( f6_local2, f6_local0.attachmentSixRef )
			end
		end
		local f6_local3 = 0
		local f6_local4 = 0
		if f6_local1 and f6_local1 ~= "none" then
			if Engine.EAIICIFIFA() and WEAPON.GetWeaponClass( f6_local1 ) == "weapon_classic_s" then
				local f6_local5 = "weapon_classic_p"
			end
		end
		local f6_local5 = {
			accuracy = ATTACHMENT.GetStatAccuracy,
			damage = ATTACHMENT.GetStatDamage,
			range = ATTACHMENT.GetStatRange,
			fireRate = ATTACHMENT.GetStatFireRate,
			mobility = ATTACHMENT.GetStatMobility,
			control = ATTACHMENT.GetStatControl
		}
		for f6_local6 = 1, #f6_local2, 1 do
			if f6_local2[f6_local6] then
				local f6_local9 = f6_local5[f5_arg0]
				assert( f6_local9 )
				local f6_local10 = f6_local9( ATTACHMENT.GetRef( f6_local2[f6_local6]:GetValue( f5_arg0 ), f6_local1 ) )
				if f6_local10 then
					f6_local4 = f6_local4 + f6_local10
					local f6_local11 = ATTACHMENT.GetBaseRef( f6_local2[f6_local6]:GetValue( f5_arg0 ) )
					for f6_local12 = f6_local6 + 1, #f6_local2, 1 do
						if f6_local11 == ATTACHMENT.GetBaseRef( f6_local2[f6_local12]:GetValue( f5_arg0 ) ) then
							f6_local4 = f6_local4 - f6_local10
						end
					end
				end
			end
		end
		f6_local3 = NormalizeNumber( f6_local3, 0, Cac.MaxStatValue )
		if f6_local3 == f5_arg0.lastBaseValue and f6_local4 == f5_arg0.lastAttachmentsValue then
			return 
		end
		f5_arg0.lastBaseValue = f6_local3
		f5_arg0.lastAttachmentsValue = f6_local4
		local f6_local6 = f6_local3 / Cac.MaxStatValue
		local f6_local7 = f6_local4 / Cac.MaxStatValue
		local f6_local8 = SWATCHES.CAC.weaponMeterMain
		if 0 < f6_local7 then
			f6_local8 = SWATCHES.CAC.weaponMeterBetter
		elseif f6_local7 < 0 then
			f6_local8 = SWATCHES.CAC.weaponMeterWorse
		end
		local f6_local15 = -1
		local f6_local9 = 1
		f6_local6 = NormalizeNumber( f6_local6, f6_local15, f6_local9 )
		f6_local7 = NormalizeNumber( f6_local6 + f6_local7, f6_local15, f6_local9 ) - f6_local6
		local f6_local11 = NormalizeNumber( (f6_local3 + f6_local4) / Cac.MaxStatValue, f6_local15, f6_local9 )
		f5_arg0.ProgressBar.BaseFill:SetRightAnchor( 1 - f6_local6, 250 )
		f5_arg0.ProgressBar.ArrowStub:SetRightAnchor( 1 - f6_local11, 250 )
		f5_arg0.ProgressBar.ArrowStub:SetLeftAnchor( f6_local11, 250 )
		f5_arg0.ProgressBar.AttachmentsFill:SetRightAnchor( 1 - f6_local6 - f6_local7, 250 )
		f5_arg0.ProgressBar.AttachmentsFill:SetLeftAnchor( f6_local6, 250 )
		f5_arg0.ProgressBar.AttachmentsFill:SetRGBFromTable( f6_local8, 0 )
		f5_arg0.BaseValue:setText( f6_local3 )
		local f6_local12 = f5_arg0.AttachmentValue
		local f6_local14 = f6_local12
		f6_local12 = f6_local12.setText
		local f6_local16
		if f6_local4 ~= 0 and not f6_local4 then
			f6_local16 = f6_local4
		else
			f6_local16 = ""
		end
		f6_local12( f6_local14, f6_local16 )
		f5_arg0.AttachmentValue:SetRGBFromTable( f6_local8, 0 )
	end
	
	f5_arg2:SubscribeToModelThroughElement( f5_arg1, "weaponRef", f5_local0 )
	if Engine.EAAHGICFBD() then
		f5_arg2:SubscribeToModelThroughElement( f5_arg1, "weaponLootID", f5_local0 )
	end
	f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentOneRef", f5_local0 )
	f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentTwoRef", f5_local0 )
	f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentThreeRef", f5_local0 )
	if Engine.EAAHGICFBD() then
		f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentFourRef", f5_local0 )
		f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentFiveRef", f5_local0 )
		local f5_local1 = f5_arg1:GetDataSource()
		if f5_local1.attachmentSixRef then
			f5_arg2:SubscribeToModelThroughElement( f5_arg1, "attachmentSixRef", f5_local0 )
		end
	end
end

function NormalizeNumber( f4_arg0, f4_arg1, f4_arg2 )
	if f4_arg0 < f4_arg1 then
		return f4_arg1
	elseif f4_arg2 < f4_arg0 then
		return f4_arg2
	else
		return f4_arg0
	end
end

local f0_local1 = function ( f2_arg0, f2_arg1 )
	f2_arg0:SubscribeToDataSourceThroughElement( f2_arg0, nil, function ()
		if not f2_arg0.setupStatsBars then
			f2_arg0( f2_arg0, f2_arg0, f2_arg0.accuracyBar, "accuracy" )
			f2_arg0( f2_arg0, f2_arg0, f2_arg0.damageBar, "damage" )
			f2_arg0( f2_arg0, f2_arg0, f2_arg0.rangeBar, "range" )
			f2_arg0( f2_arg0, f2_arg0, f2_arg0.fireRateBar, "fireRate" )
			f2_arg0( f2_arg0, f2_arg0, f2_arg0.mobilityBar, "mobility" )
			f2_arg0.setupStatsBars = true
		end
	end )
end

function WeaponStatsPanel( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 500 * _1080p, 0, 86 * _1080p )
	self.id = "WeaponStatsPanel"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	local mobilityBar = nil
	
	mobilityBar = MenuBuilder.BuildRegisteredType( "WeaponStatsBar", {
		controllerIndex = f1_local1
	} )
	mobilityBar.id = "mobilityBar"
	mobilityBar.StatName:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU/WEAPSTATS_MOBILITY" ) ), 0 )
	mobilityBar.BaseValue:setText( "999", 0 )
	mobilityBar.AttachmentValue:setText( "999", 0 )
	mobilityBar:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 16, 0, _1080p * 68, _1080p * 88 )
	self:addElement( mobilityBar )
	self.mobilityBar = mobilityBar
	
	local fireRateBar = nil
	
	fireRateBar = MenuBuilder.BuildRegisteredType( "WeaponStatsBar", {
		controllerIndex = f1_local1
	} )
	fireRateBar.id = "fireRateBar"
	fireRateBar.StatName:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU/WEAPSTATS_ROF" ) ), 0 )
	fireRateBar.BaseValue:setText( "999", 0 )
	fireRateBar.AttachmentValue:setText( "999", 0 )
	fireRateBar:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 16, 0, _1080p * 51, _1080p * 71 )
	self:addElement( fireRateBar )
	self.fireRateBar = fireRateBar
	
	local rangeBar = nil
	
	rangeBar = MenuBuilder.BuildRegisteredType( "WeaponStatsBar", {
		controllerIndex = f1_local1
	} )
	rangeBar.id = "rangeBar"
	rangeBar.StatName:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU/WEAPSTATS_RANGE" ) ), 0 )
	rangeBar.BaseValue:setText( "999", 0 )
	rangeBar.AttachmentValue:setText( "999", 0 )
	rangeBar:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 16, 0, _1080p * 34, _1080p * 54 )
	self:addElement( rangeBar )
	self.rangeBar = rangeBar
	
	local damageBar = nil
	
	damageBar = MenuBuilder.BuildRegisteredType( "WeaponStatsBar", {
		controllerIndex = f1_local1
	} )
	damageBar.id = "damageBar"
	damageBar.StatName:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU/WEAPSTATS_DAMAGE" ) ), 0 )
	damageBar.BaseValue:setText( "999", 0 )
	damageBar.AttachmentValue:setText( "999", 0 )
	damageBar:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 16, 0, _1080p * 17, _1080p * 37 )
	self:addElement( damageBar )
	self.damageBar = damageBar
	
	local accuracyBar = nil
	
	accuracyBar = MenuBuilder.BuildRegisteredType( "WeaponStatsBar", {
		controllerIndex = f1_local1
	} )
	accuracyBar.id = "accuracyBar"
	accuracyBar.StatName:setText( ToUpperCase( Engine.CBBHFCGDIC( "LUA_MENU/WEAPSTATS_ACCURACY" ) ), 0 )
	accuracyBar.BaseValue:setText( "999", 0 )
	accuracyBar.AttachmentValue:setText( "999", 0 )
	accuracyBar:SetAnchorsAndPosition( 0, 0, 0, 1, _1080p * 16, 0, 0, _1080p * 20 )
	self:addElement( accuracyBar )
	self.accuracyBar = accuracyBar
	
	local VerticalBar = nil
	
	VerticalBar = LUI.UIImage.new()
	VerticalBar.id = "VerticalBar"
	VerticalBar:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 5, 0, 0, _1080p * 86 )
	self:addElement( VerticalBar )
	self.VerticalBar = VerticalBar
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "WeaponStatsPanel", WeaponStatsPanel )
LockTable( _M )
