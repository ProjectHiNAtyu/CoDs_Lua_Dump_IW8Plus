-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:52
module( ..., package.seeall )
local f0_local0 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._timerList = {}
	local f2_local0 = 1500
	local f2_local1 = function ( f15_arg0 )
		if f15_arg0.elem then
			f15_arg0.elem:closeTree()
			f15_arg0.elem = nil
		end
	end
	
	local f2_local2 = function ( f13_arg0, f13_arg1 )
		f13_arg0._visible = false
		if f13_arg0._progressBarSubscription ~= nil then
			f13_arg0:UnsubscribeFromModel( f13_arg0._progressBarSubscription )
		end
		if f13_arg1 and f13_arg1 == true then
			f2_arg0( f13_arg0 )
		elseif f13_arg0.elem then
			local f13_local0 = f13_arg0.elem:Wait( f2_arg0 )
			f13_local0.onComplete = function ()
				if not f13_arg0._visible then
					f13_arg0( f13_arg0 )
				end
			end
			
		end
	end
	
	local f2_local3 = function ( f10_arg0 )
		if f10_arg0 ~= nil then
			local f10_local0 = f10_arg0._brPlayerModel
			local f10_local1 = f10_local0.isDowned:GetValue( f2_arg0 ) or false
			local f10_local2 = f10_local0.isBeingRevived:GetValue( f2_arg0 ) or false
			local f10_local3 = f10_local0.isSelfReviving:GetValue( f2_arg0 ) or false
			local f10_local4 = f10_local0.isDead:GetValue( f2_arg0 ) or false
			local f10_local5 = DataSources.inGame.player.BRData.PlayerStatusIsInGulag:GetValue( f2_arg0 ) or false
			local f10_local6
			if not (f10_local1 == true or f10_local2 == true or f10_local3 == true) or f10_local4 ~= false or f10_local5 ~= false or CONDITIONS.IsPlayerAZombie( f2_arg0 ) ~= false then
				f10_local6 = false
			else
				f10_local6 = true
			end
			if not f10_arg0._visible then
				if not f10_local6 then
					
				else
					
				end
				f10_arg0._visible = true
				if not f10_arg0.elem then
					f10_arg0.elem = MenuBuilder.BuildRegisteredType( "BRLastStandTimer", {} )
					f2_arg0:addElement( f10_arg0.elem )
				end
				f10_arg0.elem:SetupAnchoredElement( {
					maxScale = 5.29462817E-315,
					naturalDistance = 750,
					snapToScreenEdges = true,
					worldOffsetZ = 36,
					minScale = 5.29462817E-315,
					onObstruction = LUI.UIAnchoredElement.ON_OBSTRUCTION.ignore,
					screenCenterFadeRadius = ScreenCenterFadeRadius.ON,
					entityNum = f10_local0.clientNum:GetValue( f2_arg0 )
				} )
			end
			if f10_local6 then
				if f10_arg0._progressBarSubscription ~= nil then
					f10_arg0:UnsubscribeFromModel( f10_arg0._progressBarSubscription )
				end
				if f10_local2 == true or f10_local3 == true then
					f10_arg0._progressBarSubscription = f10_arg0:SubscribeToModel( DataSources.inGame.player.BRData.squadReviveStatusPacked:GetModel( f2_arg0 ), function ( f12_arg0 )
						if f10_arg0.elem.ProgressBar and f10_arg0.reviveStatusDataSource and f10_arg0.reviveStatusDataSource.reviveProgress then
							f10_arg0.elem.ProgressBar:SetProgress( f10_arg0.reviveStatusDataSource.reviveProgress:GetValue( f10_arg0 ) )
						end
					end )
					local f10_local7
					if f10_local3 == true and f10_local2 == false then
						f10_local7 = "SelfRevivePulse"
					else
						f10_local7 = "HealingPulse"
					end
					ACTIONS.AnimateSequence( f10_arg0.elem, f10_local7 )
				else
					f10_arg0._progressBarSubscription = f10_arg0:SubscribeToModel( f10_local0.healthRatio:GetModel( f2_arg0 ), function ( f11_arg0 )
						f10_arg0.elem.ProgressBar:SetProgress( DataModel.JJEHAEBDF( f11_arg0 ) )
					end )
					ACTIONS.AnimateSequence( f10_arg0.elem, "BleedingPulse" )
				end
			else
				local f10_local7 = nil
				if f10_local5 then
					f10_local7 = "Hide"
				elseif f10_local4 then
					f10_local7 = "DeathTrans"
				else
					f10_local7 = "HealUpTrans"
				end
				ACTIONS.AnimateSequence( f10_arg0.elem, f10_local7 )
				f2_arg0( f10_arg0 )
			end
		end
	end
	
	local f2_local4 = function ( f9_arg0 )
		local f9_local0 = f9_arg0._brPlayerModel.squadIndex:GetValue( f2_arg0 )
		if f9_local0 ~= nil then
			local f9_local1 = DataSources.inGame.player.BRData.squadReviveStatusList
			if f9_local1 then
				local f9_local2 = f9_local1:GetDataSourceAtIndex( f9_local0, f2_arg0 )
				if f9_local2 then
					f9_arg0.reviveStatusDataSource = f9_local2
				end
			end
		end
	end
	
	local f2_local5 = function ( f8_arg0 )
		if f2_arg0._timerList ~= nil then
			for f8_local0 = 0, #f2_arg0._timerList, 1 do
				f2_arg0( f2_arg0._timerList[f8_local0], true )
				local f8_local3 = f2_arg0._timerList[f8_local0]._brPlayerModel
				if f8_local3 then
					local f8_local4 = DataSources.inGame.currentPlayerStateClientNum:GetValue( f2_arg0 ) or -1
					local f8_local5 = f8_local3.clientNum:GetValue( f2_arg0 ) or -1
					if -1 < f8_local4 and -1 < f8_local5 then
						local f8_local6 = Game.DHEDEIHGF( f8_local5 )
						local f8_local7 = Game.DHEDEIHGF( f8_local4 )
						if f8_local7 and f8_local6 and f8_local7 == f8_local6 then
							f2_arg0( f2_arg0._timerList[f8_local0] )
						end
					end
				end
			end
		end
	end
	
	for f2_local6 = 0, MP.BRTeamMaxSize - 1, 1 do
		local f2_local9 = LUI.Class( LUI.UIElement )
		f2_local2( f2_local9, true )
		local f2_local10 = DataSources.inGame.player.BRData.teamList:GetDataSourceAtIndex( f2_local6, f2_arg1 )
		f2_local9._brPlayerModel = f2_local10
		f2_arg0:SubscribeToModel( f2_local10.isDowned:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0 )
		end )
		f2_arg0:SubscribeToModel( f2_local10.isBeingRevived:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0 )
		end )
		f2_arg0:SubscribeToModel( f2_local10.isSelfReviving:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0 )
		end )
		f2_arg0:SubscribeToModel( f2_local10.squadIndex:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0 )
		end )
		f2_arg0:SubscribeToModel( f2_local10.clientNum:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0 )
			f2_arg0( f2_arg0 )
		end )
		f2_arg0._timerList[f2_local6] = f2_local9
	end
	f2_arg0:SubscribeToModel( DataSources.inGame.currentPlayerStateClientNum:GetModel( f2_arg1 ), f2_local5 )
	if CONDITIONS.IsBRZombies() then
		local f2_local6 = LUI.GetDataSourceWithAppendPath( DataSources.inGame, "player.BRData.PlayerStatusIsZombie" )
		if f2_local6 then
			f2_arg0:SubscribeToModel( f2_local6:GetModel( f2_arg1 ), f2_local5 )
		end
	end
end

function BRLastStandTimerManager( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 400 * _1080p, 0, 50 * _1080p )
	self.id = "BRLastStandTimerManager"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "BRLastStandTimerManager", BRLastStandTimerManager )
LockTable( _M )
