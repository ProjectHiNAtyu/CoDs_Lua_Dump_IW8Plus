-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
LUI.Fence = LUI.Class()
LUI.Fence.fenceTypes = {}
LUI.Fence.STATE = {
	block = 1,
	pass = 0,
	fail = 2
}
LUI.Fence.Register = function ( f17_arg0, f17_arg1 )
	assert( type( f17_arg1.UpdateState ) == "function" )
	assert( not LUI.Fence.fenceTypes[f17_arg0] )
	LUI.Fence.fenceTypes[f17_arg0] = f17_arg1
end

LUI.Fence.Instantiate = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3 )
	local f16_local0 = LUI.Fence.fenceTypes[f16_arg0]
	assert( f16_local0 )
	return f16_local0.new( f16_arg1, f16_arg2, f16_arg3 )
end

LUI.Fence.init = function ( f15_arg0 )
	f15_arg0._state = LUI.Fence.STATE.block
end

LUI.Fence.Start = function ( f14_arg0 )
	
end

LUI.Fence.Frame = function ( f13_arg0 )
	
end

LUI.Fence.Stop = function ( f12_arg0 )
	
end

LUI.Fence.State = function ( f11_arg0 )
	assert( f11_arg0._state )
	return f11_arg0._state
end

LUI.FenceGroup = LUI.Class()
LUI.FenceGroup.STATE = {
	block = 1,
	pass = 0,
	fail = 2,
	abort = 3
}
LUI.FenceGroup.init = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	assert( 0 < #f10_arg1 )
	f10_arg0._fences = {}
	f10_arg0._state = nil
	for f10_local3, f10_local4 in ipairs( f10_arg1 ) do
		table.insert( f10_arg0._fences, LUI.Fence.Instantiate( f10_local4, f10_arg0, f10_arg2, f10_arg3 ) )
	end
	f10_arg0._activeFenceIndex = 0
end

LUI.FenceGroup.Reset = function ( f9_arg0 )
	local f9_local0 = f9_arg0._fences[f9_arg0._activeFenceIndex]
	if f9_local0 then
		f9_local0:Stop()
	end
	f9_arg0._state = nil
	f9_arg0._activeFenceIndex = 0
end

LUI.FenceGroup.Frame = function ( f8_arg0 )
	if f8_arg0._busy then
		return 
	end
	f8_arg0._busy = true
	assert( f8_arg0._state ~= LUI.FenceGroup.STATE.fail )
	assert( f8_arg0._state ~= LUI.FenceGroup.STATE.abort )
	assert( f8_arg0._activeFenceIndex )
	if f8_arg0._activeFenceIndex < 1 then
		f8_arg0._activeFenceIndex = 1
		f8_arg0._fences[f8_arg0._activeFenceIndex]:Start()
	end
	local f8_local0 = f8_arg0._state
	local f8_local1 = LUI.FenceGroup.STATE.pass
	for f8_local5, f8_local6 in ipairs( f8_arg0._fences ) do
		if f8_local6:State() == LUI.Fence.STATE.fail then
			f8_local1 = LUI.FenceGroup.STATE.fail
			break
		elseif f8_arg0._activeFenceIndex <= f8_local5 then
			break
		end
	end
	if f8_local1 ~= LUI.FenceGroup.STATE.fail then
		for f8_local5, f8_local6 in ipairs( f8_arg0._fences ) do
			assert( f8_local5 <= f8_arg0._activeFenceIndex )
			local f8_local7 = f8_local6:State()
			if f8_local7 ~= LUI.Fence.STATE.fail then
				f8_local6:UpdateState()
				f8_local6:Frame()
				f8_local7 = f8_local6:State()
			end
			if f8_local7 == LUI.Fence.STATE.pass then
				if f8_local5 == f8_arg0._activeFenceIndex then
					f8_arg0._fences[f8_arg0._activeFenceIndex]:Stop()
					f8_arg0._activeFenceIndex = f8_arg0._activeFenceIndex + 1
					if f8_arg0._activeFenceIndex <= #f8_arg0._fences then
						f8_arg0._fences[f8_arg0._activeFenceIndex]:Start()
					end
				end
			end
			if f8_local7 == LUI.Fence.STATE.block then
				f8_local1 = LUI.FenceGroup.STATE.block
				if f8_local5 < f8_arg0._activeFenceIndex then
					if f8_arg0._activeFenceIndex <= #f8_arg0._fences then
					
					else
						f8_arg0._activeFenceIndex = f8_local5
						f8_arg0._fences[f8_arg0._activeFenceIndex]:Start()
						break
					end
					f8_arg0._fences[f8_arg0._activeFenceIndex]:Stop()
				end
			elseif f8_local7 == LUI.Fence.STATE.fail then
				if f8_local5 == f8_arg0._activeFenceIndex then
				
				else
					f8_local1 = LUI.FenceGroup.STATE.fail
					break
				end
				f8_arg0._fences[f8_arg0._activeFenceIndex]:Stop()
				f8_arg0._activeFenceIndex = nil
			end
			assert( false, "Unexpected fence state" )
		end
	end
	assert( f8_arg0._state == f8_local0 )
	if f8_local1 ~= f8_arg0._state then
		f8_arg0._state = f8_local1
		if f8_arg0._state == LUI.FenceGroup.STATE.pass then
			f8_arg0:OnPass()
		elseif f8_arg0._state == LUI.FenceGroup.STATE.block then
			f8_arg0:OnBlock()
		elseif f8_arg0._state == LUI.FenceGroup.STATE.fail then
			f8_arg0:BackOut()
			f8_arg0:Fail()
		end
	end
	f8_arg0._busy = false
end

LUI.FenceGroup.Abort = function ( f7_arg0 )
	if f7_arg0._fences[f7_arg0._activeFenceIndex] then
		f7_arg0._fences[f7_arg0._activeFenceIndex]:Stop()
	end
	f7_arg0._state = LUI.FenceGroup.STATE.abort
	f7_arg0._activeFenceIndex = nil
end

LUI.FenceGroup.BackOut = function ( f6_arg0 )
	for f6_local0 = #f6_arg0._fences, 1, -1 do
		local f6_local3 = f6_arg0._fences[f6_local0]
		if f6_local3.OnBackOut then
			f6_local3:OnBackOut()
		end
	end
end

LUI.FenceGroup.Fail = function ( f5_arg0 )
	f5_arg0:OnFail()
	for f5_local0 = 1, #f5_arg0._fences, 1 do
		local f5_local3 = f5_arg0._fences[#f5_arg0._fences - f5_local0 + 1]
		if f5_local3.PostFail then
			f5_local3:PostFail()
		end
	end
end

LUI.FenceGroup.OnPass = function ( f4_arg0 )
	DebugPrint( "Fence passes" )
end

LUI.FenceGroup.OnBlock = function ( f3_arg0 )
	DebugPrint( "Fence blocks" )
end

LUI.FenceGroup.OnFail = function ( f2_arg0 )
	DebugPrint( "Fence failed" )
end

LUI.FenceGroup.Passes = function ( f1_arg0 )
	return f1_arg0._state == LUI.FenceGroup.STATE.pass
end

