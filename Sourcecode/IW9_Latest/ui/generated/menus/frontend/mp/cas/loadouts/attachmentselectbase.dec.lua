-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
local f0_local0 = 6
local f0_local1 = function ( f64_arg0, f64_arg1 )
	if f64_arg0.ArrowUp then
		f64_arg0.Attachments:AddArrow( f64_arg0.ArrowUp )
	end
	if f64_arg0.ArrowDown then
		f64_arg0.Attachments:AddArrow( f64_arg0.ArrowDown )
	end
	if f64_arg0.ListCount then
		f64_arg0.Attachments:AddItemNumbers( f64_arg0.ListCount )
	end
end

local f0_local2 = function ( f63_arg0, f63_arg1, f63_arg2 )
	if not Engine[0x12586A3F4FB490E]() or not f63_arg0._weaponModel then
		return 
	elseif f63_arg0._focusedAttachmentData and f63_arg0._focusedAttachmentData.isBlocked then
		WEAPON.LoadAndSetModel( f63_arg1, f63_arg0._weaponModel, f63_arg0._weaponTable, {
			forceOffsetsAndRotations = true
		} )
	else
		WEAPON.LoadAndSetModel( f63_arg1, f63_arg0._weaponModel, f63_arg2, {
			forceOffsetsAndRotations = true
		} )
		if f63_arg0._category == ATTACHMENT.undermountCategory then
			if not f63_arg0._areAllAttachmentsBlocked then
				ATTACHMENT.SendAttachmentTagDataToServer( f63_arg0, f63_arg1, f63_arg0._category )
			end
		elseif f63_arg0._category == ATTACHMENT.magazineCategory then
			local f63_local0 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.xOffset:GetValue( f63_arg1 ) or 0
			local f63_local1 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.yOffset:GetValue( f63_arg1 ) or 0
			local f63_local2 = DataSources.frontEnd.MP.CAC.gunsmithWeaponOffsets.offsetsData.zOffset:GetValue( f63_arg1 ) or 0
			local f63_local3 = GUNSMITH.GetWeaponZOffset( f63_arg0, f63_arg1, f63_arg2.attachments )
			local f63_local4 = GUNSMITH.GetWeaponZOffset( f63_arg0, f63_arg1, f63_arg0._weaponTable.attachments )
			if f63_local4 < f63_local3 then
				f63_local2 = f63_local3 - f63_local4 - f63_local2
			end
			ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, f63_local0, f63_local1, f63_local2 )
		end
	end
end

local f0_local3 = function ( f61_arg0, f61_arg1, f61_arg2 )
	return function ()
		local f62_local0 = f61_arg0._attachSlot
		local f62_local1 = ATTACHMENT.perkCategory
		f62_local0 = REG9 and CSV.weaponOffsets.previewFile or CSV.weaponOffsets.attachmentFile
		FrontEndScene.HideWeaponModels()
		f61_arg0._weaponModel = WEAPON.GetWeaponModel( f61_arg0, FrontEndScene.ClientWeapons.Preview, CSV.weaponOffsets.attachmentFile )
		f61_arg0:addElement( f61_arg0._weaponModel )
		f62_local1 = f61_arg0._currentTable
		if CONDITIONS.IsIW9BetaBuildEnabled() and f61_arg0._focusedAttachmentData and (not f61_arg0._focusedAttachmentData.unlocked or f61_arg0._focusedAttachmentData.isClassified) then
			f62_local1 = ATTACHMENT.GetTableWithCurrentAttachment( f61_arg0._weaponTable, f61_arg0._attachSlot, nil, f61_arg0._equippedAttach, f61_arg0._equippedVariant )
		end
		f61_arg0( f61_arg0, f61_arg0, f62_local1 )
	end
	
end

local f0_local4 = function ( f59_arg0, f59_arg1 )
	f59_arg0._weaponTable = WEAPON.GenerateWeaponTable( f59_arg0._weaponPlayerData )
	local f59_local0 = f59_arg0._weaponTable.attachments[f59_arg1]
	if f59_local0 then
		f59_local0 = f59_arg0._weaponTable.attachments[f59_arg1].ref
	end
	f59_arg0._equippedAttach = f59_local0
	f59_local0 = f59_arg0._weaponTable.attachments[f59_arg1]
	if f59_local0 then
		f59_local0 = f59_arg0._weaponTable.attachments[f59_arg1].variantID
	end
	f59_arg0._equippedVariant = f59_local0
	f59_arg0.Attachments:RefreshContent()
	f59_local0 = function ()
		return f59_arg0.Attachments:GetVisibleChildInFocus()
	end
	
	local f59_local1 = f59_arg0
	local f59_local2 = f59_arg0.processEvent
	local f59_local3 = {
		name = "update_showcase"
	}
	local f59_local4 = f59_local0()
	f59_local3.attachmentData = f59_local4:GetData()
	f59_local2( f59_local1, f59_local3 )
end

local f0_local5 = function ( f54_arg0, f54_arg1, f54_arg2 )
	local f54_local0 = function ( f58_arg0, f58_arg1 )
		if f58_arg0._category == ATTACHMENT.receiverCategory then
			local f58_local0 = f58_arg1.attachmentData.ref
			if StringTable[0x2DCF0973239E909]( CSV.receiverTable.file, CSV.receiverTable.cols.receiverRef, f58_local0, CSV.receiverTable.cols.weaponRef ) ~= f54_arg0._weaponTable.weapon then
				f58_arg0._weaponCompareTable = GL_HACK.GetPreviewedAttachmentTable( f54_arg0, {
					receiverRef = f58_local0,
					weaponTable = f58_arg0._weaponTable,
					weaponPlayerData = f58_arg0._weaponPlayerData
				} )
				if f54_arg0.EquipIndicatorFrame then
					f54_arg0.EquipIndicatorFrame:SetAlpha( 1 )
					f54_arg0.EquipIndicatorFrame:SetupIndicators( f54_arg0, f58_arg0._weaponCompareTable, f54_arg0._weaponTable )
				end
			elseif f54_arg0.EquipIndicatorFrame then
				f54_arg0.EquipIndicatorFrame:SetAlpha( 0 )
				f54_arg0.EquipIndicatorFrame:DisableIndicatorFrames( f54_arg0 )
			end
		elseif f54_arg0.EquipIndicatorFrame then
			f54_arg0.EquipIndicatorFrame:DisableIndicatorFrames( f54_arg0 )
		end
	end
	
	f54_arg0:registerEventHandler( "update_showcase", function ( element, event )
		local f55_local0 = event.attachmentData
		if f55_local0 then
			local f55_local1 = f55_local0.ref == element._equippedAttach
			local f55_local2 = ATTACHMENT.GetRefWithClassifiedSupport( f55_local0 )
			local f55_local3 = ATTACHMENT.GetVariantIDFromWeaponTableAndRef( f54_arg0, f54_arg0._weaponTable, f55_local2 )
			local f55_local4 = f54_arg0.GunsmithDetails._weaponAttributes == nil
			local f55_local5 = ATTACHMENT.GetWeaponTableWithOnlyEquippedAttachmentRef( f54_arg0, f54_arg0._weaponTable, f55_local0.ref, f54_arg0 )
			local f55_local6 = LUI.FlowManager.GetScopedData( LOADOUT.GetGunsmithTabsMenuRef() )
			local f55_local7 = GL_HACK.GetWeaponMPRef( f54_arg0._weaponTable.weapon )
			local f55_local8 = Engine[0xBB4B8F084905458]( f55_local7, f54_arg0._weaponTable.variantID, Engine[0x45258A710ADDE0D]( element._category ), f55_local2 )
			if f55_local8.visualLockExists == true then
				f55_local2 = f55_local8.visualLockAttachment
				f55_local3 = f55_local8.visualLockVariationIndex
			end
			element._currentTable = ATTACHMENT.GetTableWithAttachmentEquipped( f54_arg0, element._weaponTable, element._equippedAttach, f55_local2, element._category, f55_local3, element._attachSlot, f55_local0, f55_local6.attachmentData[f55_local7].attachments )
			local f55_local9
			if f55_local1 and not f55_local5 then
				f55_local9 = f55_local5
			else
				f55_local9 = element._currentTable
			end
			local f55_local10 = {
				isSetup = f55_local4,
				weaponPlayerData = f54_arg0._weaponPlayerData,
				weaponAttributes = f54_arg0._weaponAttributes,
				defaultAttachmentData = f54_arg0._defaultAttachmentData
			}
			local f55_local11 = ATTACHMENT.GetAttachmentFullDetails( f54_arg0, element._weaponTable, f55_local0, f55_local9, f55_local10 )
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x533CAEAC7D247E6 ) and f55_local1 and #f55_local11.modifiersValues < 1 then
				local f55_local12 = 2
				local f55_local13 = f55_local5.attachments[f55_local12]
				local f55_local14 = false
				for f55_local18, f55_local19 in pairs( element._weaponTable.attachments ) do
					if f55_local19.ref ~= f55_local2 and f55_local19.ref ~= ATTACHMENT.none then
						f55_local5.attachments[f55_local12] = f55_local19
						if string.find( WEAPON.GetWeaponModelName( element._weaponTable.weapon, f55_local5, {
							showSWhiskeyMag = true,
							includeAttachments = true,
							keepAkimbo = true
						} ), f55_local2 ) then
							f55_local11 = ATTACHMENT.GetAttachmentFullDetails( f54_arg0, element._weaponTable, f55_local0, f55_local9, f55_local10 )
							f55_local14 = true
							break
						end
					end
				end
				if not f55_local14 then
					f55_local5.attachments[f55_local12] = f55_local13
				end
			end
			f54_arg0.GunsmithDetails:Setup( f54_arg0, f54_arg0, f55_local11 )
			element._focusedAttachmentData = f55_local0
			local f55_local12
			if f55_local1 then
				f55_local12 = f55_local1
			else
				f55_local12 = f55_local5
			end
			element._isEquippedTable = f55_local12
			if element.GunsmithBlockRemoveGroup and ATTACHMENT.ShouldAllowBlockedRemoveWidgets() then
				f55_local12 = LUI.FlowManager.GetScopedData( LOADOUT.GetGunsmithTabsMenuRef() )
				element.GunsmithBlockRemoveGroup.Setup( f54_arg0, element._weaponTable, f54_arg0._equippedAttach, f55_local12.attachmentData[GL_HACK.GetWeaponMPRef( element._weaponTable.weapon )].attachments, f55_local0, element._category, element._currentTable, f55_local0.ref )
			end
			f55_local12 = f54_arg0._currentTable
			if CONDITIONS.IsIW9BetaBuildEnabled() and not f54_arg0._focusedAttachmentData.unlocked then
				f55_local12 = ATTACHMENT.GetTableWithCurrentAttachment( f54_arg0._weaponTable, f54_arg0._attachSlot, nil, f54_arg0._equippedAttach, f54_arg0._equippedVariant )
			end
			local f55_local13 = ATTACHMENT.GetAltReceiverTable( f54_arg0, f54_arg0._weaponTable, f55_local0 )
			if f55_local1 and element._category == ATTACHMENT.receiverCategory then
				f55_local13 = element._weaponTable
			end
			local f55_local14 = f54_arg0
			local f55_local16 = element
			local f55_local17 = f54_arg0
			local f55_local18
			if not f55_local13 then
				f55_local18 = f55_local13
			else
				f55_local18 = f55_local12
			end
			f55_local14( f55_local16, f55_local17, f55_local18 )
			if CONDITIONS.InFrontend() and (element._category == "gunperk" or element._category == "bolts") then
				f55_local14 = f54_arg0.GunsmithDetails:Wait( 5 )
				f55_local14.onComplete = function ()
					GUNSMITH.UpdateAmmoModel( element, element )
				end
				
			end
			f54_arg0( element, event )
			if CONDITIONS.IsWaveGameType() then
				f55_local14 = tonumber( f55_local0.survivalCost )
				local f55_local15 = CP.CurrencyGet( f54_arg0 )
				if f54_arg0.PurchaseWidget then
					f54_arg0.PurchaseWidget.CostValue:setText( Engine[0xED84C33EC5F01EA]( 0xDCA9D5990998D52, tostring( f55_local14 ) ) )
					if f55_local14 <= f55_local15 then
						ACTIONS.AnimateSequence( f54_arg0.PurchaseWidget, "CanBuy" )
					else
						ACTIONS.AnimateSequence( f54_arg0.PurchaseWidget, "NoBuy" )
					end
				end
				f54_arg0:registerOmnvarHandler( "cp_open_cac", function ( f56_arg0, f56_arg1 )
					if f56_arg1.value == -2 and CONDITIONS.IsWaveGameType() then
						LUI.FlowManager.RequestCloseAllMenus()
					end
				end )
			end
		end
		return true
	end )
end

local f0_local6 = function ( f53_arg0, f53_arg1, f53_arg2, f53_arg3, f53_arg4 )
	local f53_local0 = {}
	for f53_local4, f53_local5 in ddlpairs( f53_arg0._weaponPlayerData.attachmentSetup ) do
		local f53_local6 = f53_local5.attachment:get()
		if f53_local6 ~= ATTACHMENT.none then
			f53_local0[f53_local6] = {
				f53_local5.customTune[0]:get(),
				[1] = f53_local5.customTune[1]:get()
			}
		end
	end
	f53_local2 = GL_HACK.RequestEquippingRecAttachment( f53_arg1, {
		receiverRef = f53_arg3.ref,
		weaponTable = f53_arg0._weaponTable,
		weaponPlayerData = f53_arg0._weaponPlayerData,
		preservedAttachmentTable = f53_arg4
	} )
	if 0 < #f53_local2 then
		f53_local4 = GL_HACK.GetAttachmentsAndBucketItems( f53_arg1, {
			weaponRef = GL_HACK.GetWeaponMPRef( f53_arg2 )
		} )
		f53_local5 = f53_arg0._weaponTable.weapon
		for f53_local21, f53_local22 in ipairs( f53_local2 ) do
			local f53_local23 = ATTACHMENT.GetCategory( f53_local22 )
			local f53_local24 = ATTACHMENT.GetBaseName( f53_local22, f53_local23, f53_local5, f53_arg1 )
			local f53_local25 = f53_local4[f53_local23]
			for f53_local18, f53_local19 in ipairs( f53_local25 ) do
				ATTACHMENT.SetBlockedAttachments( f53_arg1, GUNSMITH.FilterRestrictedAttachments( f53_local25, f53_arg2, f53_arg3 ), f53_arg0._weaponTable, f53_arg0._equippedAttach, f53_arg0._category, f53_arg0._weaponTable )
				if f53_local19.baseName and f53_local19.baseName == f53_local24 and not f53_local19.isBlocked then
					local f53_local9 = GUNSMITH.GetSelectedAttachIndexForCategory( f53_local19.category, f53_arg0._weaponTable )
					local f53_local10 = f53_arg0._weaponTable.attachments[f53_local9].variantID
					local f53_local11 = Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f53_arg2 ), f53_local19.ref )
					local f53_local12
					if f53_local11 and f53_local11[f53_local10] and not f53_local10 then
						f53_local12 = f53_local10
					else
						f53_local12 = ATTACHMENT.baseVariant
					end
					GUNSMITH.EquipAttachment( f53_arg0, f53_arg1, f53_local19.ref, f53_arg0._weaponPlayerData, {
						attachSlot = f53_local9,
						survivalCost = f53_local19.survivalCost,
						variantID = f53_local12
					} )
					for f53_local16, f53_local17 in ddlpairs( f53_arg0._weaponPlayerData.attachmentSetup ) do
						if f53_local17.attachment:get() == f53_local19.ref and f53_local0[f53_local22] then
							f53_local17.customTune[0]:set( f53_local0[f53_local22][1] )
							f53_local17.customTune[1]:set( f53_local0[f53_local22][2] )
						end
					end
				end
			end
		end
	end
end

MenuBuilder.registerType( "SwapReceiverWithTunedAttachmentPopup", function ( f50_arg0, f50_arg1 )
	local f50_local0 = MenuBuilder.BuildRegisteredType( "PopupYesNoCancel", {
		title = Engine[0xED84C33EC5F01EA]( 0x1CCA5C59ECE1EA6 ),
		message = Engine[0xED84C33EC5F01EA]( 0x1C77693614BEBEE ),
		yesLabel = Engine[0xED84C33EC5F01EA]( 0x528DB6E6541D3F1 ),
		noLabel = Engine[0xED84C33EC5F01EA]( 0x58F06C41F11E416 ),
		cancelLabel = Engine[0xED84C33EC5F01EA]( 0x78C2C5FE58603AC ),
		yesAction = function ( f52_arg0, f52_arg1 )
			f50_arg0( f50_arg0.element, f52_arg1, f50_arg0.weaponRef, f50_arg0.attachmentData, f50_arg0.preservedAttachmentTable )
			ACTIONS.LeaveMenu( f50_arg0.element )
		end,
		noAction = function ( f51_arg0, f51_arg1 )
			f50_arg0( f50_arg0.element, f51_arg1, f50_arg0.weaponRef, f50_arg0.attachmentData, f50_arg0.preservedAttachmentTable )
			WEAPON.ClearWeaponAndAttachmentTuning( f50_arg0.element._weaponPlayerData )
			ACTIONS.LeaveMenu( f50_arg0.element )
			LUI.ToastManager.CreateToast( f51_arg1, LUI.ToastManager.StandardEmphasisToast( WEAPON.GetName( f50_arg0.element._weaponTable.weapon ), Engine[0xED84C33EC5F01EA]( 0x72D6D31E68021D5 ) ) )
		end
	} )
	f50_local0.id = "SwapReceiverWithTunedAttachmentPopup"
	return f50_local0
end )
local f0_local7 = function ( f49_arg0, f49_arg1 )
	if not f49_arg1 then
		f49_arg1 = {}
	end
	f49_arg0:dispatchEventToCurrentMenu( {
		name = "equip_attachment",
		attachmentData = f49_arg1.attachmentData,
		substituteSiblingAttachmentsToEquip = f49_arg1.substituteSiblingAttachmentsToEquip,
		regetAttachSlotIfNil = f49_arg1.regetAttachSlotIfNil
	} )
	for f49_local3, f49_local4 in ipairs( f49_arg1.attachmentsToEquip ) do
		GUNSMITH.EquipAttachment( f49_arg0, f49_arg0._controllerIndex, f49_local4.ref, f49_arg0._weaponPlayerData, {
			attachSlot = GUNSMITH.GetSelectedAttachIndexForCategory( f49_local4.category, f49_arg0._weaponTable ),
			survivalCost = f49_local4.survivalCost
		} )
	end
end

local f0_local8 = function ( f47_arg0, f47_arg1 )
	local f47_local0 = f47_arg1.blockedEquippedAttachments
	local f47_local1 = f47_arg1.attachmentData
	if 0 < #f47_local0 then
		local f47_local2 = ATTACHMENT.GetName
		local f47_local3 = f47_local1.ref
		local f47_local4 = ATTACHMENT.none
		f47_local2 = f47_local2( REG19 and f47_local1.ref or f47_arg0._equippedAttach )
		local f47_local5 = f47_local1.ref
		f47_local3 = ATTACHMENT.none
		LUI.FlowManager.RequestPopupMenu( nil, "PopupYesNo", false, nil, false, {
			title = Engine[0xED84C33EC5F01EA]( 0xF22B2F336C8A05C ),
			message = ATTACHMENT.AddListToBlockedMessage( Engine[0xED84C33EC5F01EA]( REG22 and 0xA6B88FD8F6E0ED1 or 0xF4F6E7738091702, #f47_local0, f47_local2 ), f47_local0 ),
			yesLabel = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 ),
			noLabel = Engine[0xED84C33EC5F01EA]( 0xDF4B921D6190715 ),
			yesAction = function ()
				for f48_local0 = 1, #f47_arg0, 1 do
					GUNSMITH.EquipAttachment( f47_arg0, f47_arg0._controllerIndex, ATTACHMENT.none, f47_arg0._weaponPlayerData, {
						isNewAttachment = true,
						attachSlot = GUNSMITH.GetSelectedAttachIndexForCategory( f47_arg0[f48_local0].category, f47_arg0._weaponTable )
					} )
				end
				f47_arg0.regetAttachSlotIfNil = true
				f47_arg0( f47_arg0, f47_arg0 )
				ACTIONS.LeaveMenu( f47_arg0 )
			end
		}, nil, false, true )
	else
		f0_local0( f47_arg0, f47_arg1 )
	end
end

local f0_local9 = function ( f45_arg0, f45_arg1, f45_arg2 )
	local f45_local0 = f45_arg0._equippedAttach and f45_arg0._equippedAttach or ATTACHMENT.none
	local f45_local1 = f45_arg1.attachmentData
	local f45_local2 = f45_local1.ref
	local f45_local3 = ATTACHMENT.none
	f45_local2 = REG34 and f45_local1.ref or f45_local0
	f45_local3 = LUI.FlowManager.GetScopedData( LOADOUT.GetGunsmithTabsMenuRef() )
	local f45_local4 = f45_local3.attachmentData[GL_HACK.GetWeaponMPRef( f45_arg0._weaponTable.weapon )].attachments
	local f45_local5 = f45_local2 == f45_local0
	local f45_local6 = ATTACHMENT.baseVariant
	local f45_local7 = nil
	if f45_local5 then
		f45_local6 = f45_arg0._equippedVariant
		f45_local7 = ATTACHMENT.GetTableWithCurrentAttachment( f45_arg0._weaponTable, f45_arg0._attachSlot, f45_local1.blockedCategorySlot, f45_local1.ref, nil )
	else
		f45_local7 = ATTACHMENT.GetTableWithCurrentAttachment( f45_arg0._weaponTable, f45_arg0._attachSlot, f45_local1.blockedCategorySlot, f45_local2, f45_local6 )
		if f45_arg2[f45_local2] then
			f45_local6 = f45_arg2[f45_local2]
		end
	end
	local f45_local8, f45_local9, f45_local10 = GUNSMITH.CheckBlockedEquippedAttachmentLogic( f45_arg0._controllerIndex, f45_arg0._weaponTable, f45_arg0._equippedAttach, f45_local7, f45_local2, f45_arg0._category, f45_local1, f45_local4 )
	local f45_local11 = {
		attachmentData = f45_local1,
		blockedEquippedAttachments = f45_local8,
		attachmentsToEquip = f45_local9,
		substituteSiblingAttachmentsToEquip = f45_local10
	}
	if f45_local1.category == ATTACHMENT.receiverCategory then
		local f45_local12 = false
		local f45_local13 = WEAPON.GetWeaponModelName( f45_arg0._weaponTable.weapon, f45_arg0._weaponTable, {
			includeAttachments = true
		} )
		for f45_local14 = 1, #f45_arg0._weaponTable.attachments, 1 do
			local f45_local17 = ClientWeapon[0xFE24333F9BC2CAB]( f45_arg0._controllerIndex, f45_local13, Engine[0x603B6AC5797050A]( f45_local13, f45_arg0._weaponTable.attachments[f45_local14].ref ) )
			if f45_local17.tunedStats then
				f45_local12 = true
				break
			end
		end
		if f45_local12 and not GUNSMITH.IsTuningUnlocked( WEAPON.GetWeaponRefByRec( f45_local1.ref ), f45_arg0._controllerIndex ) then
			LUI.FlowManager.RequestPopupMenu( nil, "PopupYesNo", false, nil, false, {
				title = Engine[0xED84C33EC5F01EA]( 0x73D2A4024411940 ),
				message = Engine[0xED84C33EC5F01EA]( 0x60092DE0936C08D ),
				yesLabel = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 ),
				noLabel = Engine[0xED84C33EC5F01EA]( 0xDF4B921D6190715 ),
				yesAction = function ( f46_arg0, f46_arg1 )
					ACTIONS.LeaveMenu( f46_arg0 )
					f45_arg0( f46_arg0, f45_arg0 )
				end
			}, nil, false, true )
			return 
		end
	end
	f0_local0( f45_arg0, f45_local11 )
end

local f0_local10 = function ( f41_arg0, f41_arg1, f41_arg2 )
	local f41_local0 = f41_arg0._attachSlot
	f41_arg0:registerEventHandler( "try_equip_attachment", function ( element, event )
		local f43_local0 = event.attachmentData
		local f43_local1 = GUNSMITH.IsSwappingAttachmentRequired( element._weaponPlayerData, element._equippedAttach, f43_local0 )
		local f43_local2 = f43_local0.ref ~= element._equippedAttach
		if GUNSMITH.IsWeaponSetupBlueprintIntact( element._weaponPlayerData ) and not f43_local1 and f43_local2 then
			local f43_local3 = GUNSMITH.BlueprintEditStatus.EditBlueprint
			if GUNSMITH.DoesWeaponTableContainProtunedAttachment( element._weaponTable ) then
				local f43_local4 = nil
				for f43_local5 = 1, #element._weaponTable.attachments, 1 do
					if element._weaponTable.attachments[f43_local5].ref == element._equippedAttach then
						f43_local4 = element._weaponTable.attachments[f43_local5]
						break
					end
				end
				local f43_local5 = nil
				local f43_local6 = GUNSMITH.IsAttachmentProtuned( element._weaponTable, f43_local4 )
				if f43_local2 and element._equippedAttach == ATTACHMENT.none then
					f43_local5 = GUNSMITH.BlueprintEditStatus.AddNewAttachment
				elseif f43_local6 then
					f43_local5 = GUNSMITH.BlueprintEditStatus.ChangeProTunedAttachment
				elseif not f43_local6 then
					f43_local5 = GUNSMITH.BlueprintEditStatus.ChangeNonProTunedAttachment
				end
			end
			GUNSMITH.SetupCallbackFuncForBlueprintEdit( f41_arg0, element._weaponPlayerData, f43_local3, function ()
				local f44_local0 = LUI.FlowManager.GetScopedData( LOADOUT.GetAttachmentSelectMenuRef() )
				local f44_local1 = element.AttachmentGrid
				if f44_local1 then
					f44_local1 = element.AttachmentGrid._targetPosition
				end
				local f44_local2
				if f44_local1 then
					f44_local2 = f44_local1
				else
					f44_local2 = f44_local1.x
				end
				f44_local0.lastTargetPositionX = f44_local2
				element( element, element, element )
			end )
		else
			f41_arg0( element, event, f41_arg0 )
		end
	end )
	f41_arg0:registerEventHandler( "equip_attachment", function ( element, event )
		local f42_local0 = LUI.FlowManager.GetScopedData( f41_arg0 )
		local f42_local1 = event.attachmentData
		if event.regetAttachSlotIfNil and not f41_arg0 then
			f41_arg0 = ATTACHMENT.GetAvailableAttachSlot( f41_arg0, f42_local0.weaponSlot, element._category )
		end
		if element._category == ATTACHMENT.receiverCategory then
			local f42_local2 = true
			local f42_local3 = WEAPON.GetWeaponRefByRec( f42_local1.ref )
			local f42_local4 = LOADOUT.GetLoadoutSquadMember( f41_arg0 )
			LOOT.SendDlogLootEquipped( f41_arg0, LOOT.itemTypes.WEAPON, nil, nil, f42_local4.loadouts[f42_local0.loadoutIndex].weaponSetups[f42_local0.weaponSlot].weapon:get(), f42_local3 )
			if f42_local3 ~= element._weaponTable.weapon then
				local f42_local5 = {}
				for f42_local6 = 1, #element._weaponCompareTable, 1 do
					if element._weaponCompareTable[f42_local6].compareState == GUNSMITH.WEAPON_PART_COMPARE_STATE.PRESERVED then
						table.insert( f42_local5, element._weaponCompareTable[f42_local6].ref )
					end
				end
				if WEAPON.DoesWeaponHaveAnyTunedAttachment( element._weaponTable ) then
					f42_local2 = false
					LUI.FlowManager.RequestPopupMenu( f41_arg0, "SwapReceiverWithTunedAttachmentPopup", true, event.controller, false, {
						element = element,
						weaponRef = f42_local3,
						attachmentData = f42_local1,
						preservedAttachmentTable = f42_local5
					} )
				end
				f41_arg0( element, f41_arg0, f42_local3, f42_local1, f42_local5 )
			end
			if f42_local2 then
				ACTIONS.LeaveMenu( element )
			end
			return 
		elseif CONDITIONS.IsWaveGameType() then
			local f42_local2 = CP.CurrencyGet( f41_arg0 )
			local f42_local3 = tonumber( f42_local1.survivalCost )
			if f42_local1.ref == element._equippedAttach then
				Engine[0xC4146BA76D0F982]( 0xC434AA96E20B199 )
			elseif f42_local3 <= f42_local2 then
				if f41_arg0 ~= nil then
					f42_local2 = f42_local2 - f42_local3
					Engine[0xC4146BA76D0F982]( 0x7AA312B9A84F375 )
					CP.CurrencySubtract( f41_arg0, f42_local3 )
					Engine[0x6055C55456F05DF]( "attachment_purchased", f42_local3 )
				end
			else
				Engine[0xC4146BA76D0F982]( 0xC434AA96E20B199 )
			end
		end
		DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f41_arg0, DYN_ATTACHMENT.StreamedImageAction.REMOVE )
		local f42_local2 = f42_local1.ref
		local f42_local3 = GUNSMITH.IsSwappingAttachmentRequired( element._weaponPlayerData, element._equippedAttach, f42_local1 )
		local f42_local4 = f42_local2 ~= element._equippedAttach
		local f42_local9 = true
		local f42_local10 = {
			LOADOUT.GetAttachmentSelectMenuRef()
		}
		if f42_local4 then
			local f42_local5 = LUI.FlowManager.GetScopedData( LOADOUT.GetGunsmithTabsMenuRef() )
			local f42_local7 = f42_local5.attachmentData[GL_HACK.GetWeaponMPRef( element._weaponTable.weapon )].attachments
			local f42_local8 = GUNSMITH.EquipAttachment
			local f42_local11 = element
			local f42_local12 = f41_arg0
			local f42_local13 = f42_local2
			local f42_local14 = element._weaponPlayerData
			local f42_local15 = {
				menusToLeave = f42_local10
			}
			local f42_local16
			if f42_local3 then
				f42_local16 = f42_local1.blockedCategorySlot
				if not f42_local16 then
				
				else
					f42_local15.attachSlot = f42_local16
					f42_local15.isNewAttachment = f42_local4
					f42_local15.survivalCost = f42_local1.survivalCost
					f42_local15.allAttachments = f42_local7
					f42_local9 = f42_local8( f42_local11, f42_local12, f42_local13, f42_local14, f42_local15 )
					if not f42_local3 and f41_arg0 and event.substituteSiblingAttachmentsToEquip then
						for f42_local12, f42_local13 in ipairs( event.substituteSiblingAttachmentsToEquip ) do
							GUNSMITH.EquipAttachment( element, f41_arg0, f42_local13.ref, element._weaponPlayerData, {
								attachSlot = GUNSMITH.GetSelectedAttachIndexForCategory( f42_local13.category, element._weaponTable ),
								survivalCost = f42_local13.survivalCost
							} )
						end
					end
					if CONDITIONS.InGame() then
						Engine[0x6055C55456F05DF]( "equip_item_ingame", 1 )
					end
					DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f41_arg0, DYN_ATTACHMENT.StreamedImageAction.ADD )
				end
			end
			f42_local16 = f41_arg0
		else
			if f42_local1.category ~= ATTACHMENT.receiverCategory then
				local f42_local5 = LUI.FlowManager.GetScopedData( f41_arg0 )
				local f42_local6 = LOADOUT.GetLoadoutSquadMember( f41_arg0 )
				local f42_local7 = f42_local6.loadouts[f42_local5.loadoutIndex].weaponSetups[f42_local5.weaponSlot]
				local f42_local8 = {
					attachmentRef = ATTACHMENT.GetRefFromSetup( f42_local7.attachmentSetup[f41_arg0 - 1] )
				}
				local f42_local17 = f42_local7.attachmentSetup[f41_arg0 - 1].variantID:get()
				if not f42_local17 then
					f42_local17 = ATTACHMENT.baseVariant
				end
				f42_local8.variantID = f42_local17
				f42_local8.weaponRef = f42_local7.weapon:get()
				LOOT.SendDlogLootEquipped( f41_arg0, LOOT.itemTypes.ATTACHMENT, f42_local8, f42_local8 )
			end
			LUI.FlowManager.RequestLeaveMenuByName( LOADOUT.GetAttachmentSelectMenuRef() )
		end
		if not f42_local9 then
			local f42_local5 = LUI.FlowManager.GetScopedData( LOADOUT.GetAttachmentSelectMenuRef() )
			local f42_local6 = f41_arg0.Attachments._targetPosition
			if f42_local6 then
				f42_local6 = f41_arg0.Attachments._targetPosition.x
			end
			f42_local5.lastTargetPositionX = f42_local6
			f41_arg0( element, f41_arg0 )
		end
		return true
	end )
end

local f0_local11 = function ( f40_arg0, f40_arg1, f40_arg2 )
	if not f40_arg2.weaponSlot then
		DebugPrint( "WARNING: Missing \"weaponSlot\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f40_arg2.weaponSlot = 0
	end
	if not f40_arg2.loadoutIndex then
		DebugPrint( "WARNING: Missing \"loadoutIndex\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f40_arg2.loadoutIndex = 0
	end
	if not f40_arg2.category then
		DebugPrint( "WARNING: Missing \"category\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f40_arg2.category = "rail"
	end
	if not f40_arg2.attachments then
		DebugPrint( "WARNING: Missing \"attachSlot\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f40_arg2.attachments = CSV.ReadRow( CSV.attachments, 3 )
	end
end

local f0_local12 = function ( f39_arg0, f39_arg1 )
	f39_arg0.Attachments:SetMask( f39_arg0.GridMask )
	if CONDITIONS.InFrontend() then
		f39_arg0.HelperBar.Background:SetAlpha( 0 )
		LUI.TextChat.SetupMenuForNoChat( f39_arg0 )
	end
	local f39_local0 = ACTIONS.AnimateSequence
	local f39_local1 = f39_arg0
	local f39_local2
	if CONDITIONS.IsSplitscreen() then
		f39_local2 = "Splitscreen"
	else
		f39_local2 = "Regular"
	end
	f39_local0( f39_local1, f39_local2 )
end

local f0_local13 = function ( f37_arg0, f37_arg1, f37_arg2 )
	if CONDITIONS.InGame() and not CONDITIONS.IsThirdGameMode() then
		f37_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			clickable = true,
			priority = 5,
			ignoreTooltip = false,
			side = "left",
			kbmTooltipPromptOverload = "button_dismiss_pause_menu",
			button_ref = "button_start",
			helper_text = Engine[0xED84C33EC5F01EA]( 0xEF0F75B0AB08E35 )
		} )
		f37_arg0:AddGamepadEventCallback( "button_start", function ( f38_arg0, f38_arg1 )
			LUI.FlowManager.RequestCloseAllMenus()
		end )
	end
end

local f0_local14 = function ( f36_arg0 )
	if f36_arg0.InGameMenuBackground then
		ACTIONS.ScaleFullscreen( f36_arg0.InGameMenuBackground )
	end
	if f36_arg0.Vignette then
		ACTIONS.ScaleFullscreen( f36_arg0.Vignette )
	end
	if f36_arg0.Gradient then
		ACTIONS.ScaleFullscreen( f36_arg0.Gradient )
	end
end

local f0_local15 = function ( f35_arg0, f35_arg1, f35_arg2 )
	if CONDITIONS.InFrontend( f35_arg0 ) then
		if not f35_arg0._areAllAttachmentsBlocked then
			ATTACHMENT.SendAttachmentTagDataToServer( f35_arg0, f35_arg1, f35_arg0._category )
		end
		ClientWeapon[0x59B77D6F41ED417]( FrontEndScene.ClientWeapons.Preview, false )
		MenuUtils.SetupSceneChangeCallback( f35_arg0, f0_local0( f35_arg0, f35_arg1, f35_arg0._attachSlot, f35_arg2.category ) )
	end
end

local f0_local16 = function ( f34_arg0, f34_arg1, f34_arg2 )
	f34_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( f34_arg0._category ) ) )
	f34_arg0.MenuTitle:SetupBackButton( f34_arg1 )
end

local f0_local17 = function ( f33_arg0 )
	for f33_local0 = 1, #f33_arg0, 1 do
		local f33_local3 = ATTACHMENT.GetBundleByRef( f33_arg0[f33_local0].ref )
		if f33_local3 then
			f33_arg0[f33_local0].isClassified = f33_local3[0x42299CD50F5386E]
		end
	end
end

local f0_local18 = function ( f31_arg0 )
	table.sort( f31_arg0, function ( f32_arg0, f32_arg1 )
		if f32_arg0.ref == ATTACHMENT.none then
			return true
		elseif f32_arg0.isClassified ~= f32_arg1.isClassified then
			local f32_local0 = f32_arg1.isClassified
			if f32_local0 then
				f32_local0 = not f32_arg0.isClassified
			end
			return f32_local0
		elseif f32_arg0.isBlocked ~= f32_arg1.isBlocked then
			local f32_local0 = f32_arg1.isBlocked
			if f32_local0 then
				f32_local0 = not f32_arg0.isBlocked
			end
			return f32_local0
		elseif f32_arg0.unlocked ~= f32_arg1.unlocked then
			local f32_local0 = f32_arg0.unlocked
			if f32_local0 then
				f32_local0 = not f32_arg1.unlocked
			end
			return f32_local0
		elseif f32_arg0.uiOrder ~= f32_arg1.uiOrder then
			return f32_arg0.uiOrder < f32_arg1.uiOrder
		else
			
		end
	end )
end

local f0_local19 = function ( f30_arg0, f30_arg1, f30_arg2 )
	if f30_arg0._unlockedBlueprintAttachmentRef == f30_arg2 then
		return true
	else
		return false
	end
end

local f0_local20 = function ( f29_arg0, f29_arg1 )
	LUI.FlowManager.RequestAddMenu( "AttachmentAppearanceSelect", true, f29_arg0._controllerIndex, false, {
		variantData = f29_arg0._focusedAttachmentData.variantData,
		weaponSlot = f29_arg1.weaponSlot,
		loadoutIndex = f29_arg1.loadoutIndex,
		attachSlot = f29_arg0._attachSlot and f29_arg0._attachSlot or f29_arg0._focusedAttachmentData.blockedCategorySlot,
		attachmentRef = f29_arg0._focusedAttachmentData.ref,
		blockedCategorySlot = f29_arg0._focusedAttachmentData.blockedCategorySlot,
		category = f29_arg1.category,
		forShowcase = f29_arg1.forShowcase,
		attachmentData = f29_arg0._focusedAttachmentData
	} )
end

local f0_local21 = function ( f28_arg0, f28_arg1, f28_arg2 )
	assert( f28_arg2.weaponSlot )
	assert( f28_arg2.loadoutIndex )
	assert( f28_arg2.category )
	assert( f28_arg2.attachments )
	local f28_local0 = LOADOUT.GetFrontendLoadoutWithShowcase( f28_arg1, f28_arg2.loadoutIndex, f28_arg2.forShowcase )
	if CONDITIONS.IsWaveGameType() then
		local f28_local1 = PLAYER_DATA.IO( f28_arg1, LOADOUT.GetLoadoutStatsGroup() )
		f28_local0 = f28_local1.squadMembers.loadoutWaveMode
	end
	f28_arg0._controllerIndex = f28_arg1
	f28_arg0._category = f28_arg2.category
	f28_arg0._weaponPlayerData = f28_local0.weaponSetups[f28_arg2.weaponSlot]
	f28_arg0._weaponTable = WEAPON.GenerateWeaponTable( f28_arg0._weaponPlayerData )
	f28_arg0._weaponRef = f28_arg0._weaponTable.weapon
	f28_arg0._unlockedBlueprintAttachmentRef = f28_arg2.unlockedBlueprintAttachmentRef
	f28_arg2.attachments = ATTACHMENT.GetCompleteAttachmentsListData( f28_arg2.attachments, f28_arg0._category )
end

local f0_local22 = function ( f27_arg0, f27_arg1, f27_arg2 )
	local f27_local0 = {}
	for f27_local1 = 1, #f27_arg2.attachments, 1 do
		if f0_local0( f27_arg0, f27_arg1, f27_arg2.attachments[f27_local1].baseRef ) then
			f27_arg2.attachments[f27_local1].unlocked = true
		end
		if f27_arg2.attachments[f27_local1].unlocked == true and not f27_arg2.attachments.isClassified then
			table.insert( f27_local0, f27_arg2.attachments[f27_local1] )
		end
	end
	f27_arg2.attachments = f27_local0
end

local f0_local23 = function ( f26_arg0, f26_arg1, f26_arg2 )
	local f26_local0 = f26_arg2.attachSlot
	if f26_local0 == nil then
		f26_local0 = ATTACHMENT.GetAvailableAttachSlot( f26_arg1, f26_arg2.weaponSlot, f26_arg0._category, f26_arg2.forShowcase )
	end
	f26_arg0._attachSlot = f26_local0
end

local f0_local24 = function ( f25_arg0, f25_arg1 )
	f25_arg0._attachmentVariants = {}
	local f25_local0 = GL_HACK.GetWeaponMPRef( f25_arg0._weaponRef )
	for f25_local9, f25_local10 in ipairs( f25_arg0._attachmentListData ) do
		for f25_local6, f25_local7 in ipairs( Engine[0xD3946E1B3E34A42]( f25_local0, f25_local10.ref ) ) do
			if not f25_local7[0x4FDAECD20551368] then
				local f25_local4
				if f25_local7[0x55F116BF695C8F6] then
					f25_local4 = f25_local7[0xAE1E225E2DD2DF4]( f25_local7 )
					if not f25_local4 then
					
					else
						local f25_local5 = ATTACHMENT.GetBundleByBlueprintRefXhash( f25_local4 )
						if f25_local5 and f25_local5[0x28887F70BF5EBA] then
							if LOOT.IsUnlockedWithID( f25_arg1, f25_local5[0x28887F70BF5EBA], {
								notCDLUnlocked = true
							} ) and Engine[0x69703F35FE390E2]( f25_local0, f25_local10.ref, f25_local6 ) then
								if f25_arg0._attachmentVariants[f25_local10.ref] == nil then
									f25_arg0._attachmentVariants[f25_local10.ref] = {}
								end
								table.insert( f25_arg0._attachmentVariants[f25_local10.ref], f25_local6 )
							end
						end
					end
				end
				f25_local4 = 0x0
			end
		end
	end
end

local f0_local25 = function ( f24_arg0, f24_arg1 )
	local f24_local0 = f24_arg0._attachSlot
	local f24_local1 = f24_arg0._weaponTable.attachments[f24_local0]
	if f24_local1 then
		f24_local1 = f24_arg0._weaponTable.attachments[f24_local0].ref
	end
	f24_arg0._equippedAttach = f24_local1
	f24_local1 = f24_arg0._weaponTable.attachments[f24_local0]
	if f24_local1 then
		f24_local1 = f24_arg0._weaponTable.attachments[f24_local0].variantID
	end
	f24_arg0._equippedVariant = f24_local1
	f24_arg0._attachmentListData = GUNSMITH.FilterRestrictedAttachments( f24_arg0._attachmentListData, f24_arg0._weaponRef, f24_arg0._equippedAttach )
	f24_arg0._areAllAttachmentsBlocked = ATTACHMENT.SetBlockedAttachments( f24_arg1, f24_arg0._attachmentListData, f24_arg0._weaponTable, f24_arg0._equippedAttach, f24_arg0._category ) == #f24_arg0._attachmentListData - 1
	f0_local0( f24_arg0._attachmentListData )
end

local f0_local26 = function ( f23_arg0 )
	local f23_local0 = 0
	if f23_arg0._equippedAttach ~= nil then
		for f23_local4, f23_local5 in ipairs( f23_arg0._attachmentListData ) do
			if f23_local5.ref ~= ATTACHMENT.none and f23_arg0._equippedAttach == f23_local5.ref then
				f23_local0 = f23_local4 - 1
			end
		end
	else
		local f23_local1 = LUI.FlowManager.GetScopedData( LOADOUT.GetAttachmentSelectMenuRef() )
		if f23_local1.lastTargetPositionX then
			f23_local0 = f23_local1.lastTargetPositionX
			f23_local1.lastTargetPositionX = nil
		end
	end
	return f23_local0
end

local f0_local27 = function ( f22_arg0 )
	local f22_local0 = f22_arg0._attachmentListData
	for f22_local1 = 1, #f22_local0, 1 do
		if 1 < #f22_local0[f22_local1].variants then
			return true
		end
	end
	return false
end

local f0_local28 = function ( f21_arg0, f21_arg1 )
	if Engine[0x12586A3F4FB490E]() and f0_local0( f21_arg0 ) and not Onboarding.GunsmithCustoms.WasCompleted( f21_arg0, f21_arg1 ) then
		LUI.FlowManager.RequestPopupMenu( f21_arg0, "onboardingpopup", true, f21_arg1, false, ONBOARDING_DATA.GetOnboardingGunsmithCustomsData() )
		Onboarding.GunsmithCustoms.MarkCompleted( f21_arg0, f21_arg1 )
	end
end

local f0_local29 = function ( f20_arg0, f20_arg1 )
	Engine[0xD344B7DE66AFA81]( "Attachments:SetRefreshChild" )
	if f20_arg1.baseRef then
		f20_arg1.variantData = {}
		f20_arg1.variantData[ATTACHMENT.baseVariant + 1] = {
			ref = f20_arg1.baseRef,
			variantID = ATTACHMENT.baseVariant,
			name = f20_arg1.name,
			lootImage = f20_arg1.image,
			uiImage = f20_arg1.image
		}
		local f20_local0 = Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f20_arg0._weaponRef ), f20_arg1.ref )
		if f20_arg0._attachmentVariants[f20_arg1.ref] then
			for f20_local13, f20_local14 in ipairs( f20_arg0._attachmentVariants[f20_arg1.ref] ) do
				for f20_local10, f20_local11 in ipairs( f20_local0 ) do
					if f20_local14 == f20_local10 and f20_local14 ~= ATTACHMENT.baseVariant and f20_arg1.variantData[f20_local13 + 1] == nil then
						local f20_local4
						if f20_local11[0x55F116BF695C8F6] then
							f20_local4 = f20_local11[0xAE1E225E2DD2DF4]( f20_local11 )
							if not f20_local4 then
							
							else
								local f20_local5 = ATTACHMENT.GetBundleByBlueprintRefXhash( f20_local4 )
								local f20_local6 = f20_arg1.variantData
								local f20_local7 = f20_local13 + 1
								local f20_local8 = {
									ref = f20_arg1.ref,
									variantID = f20_local14
								}
								local f20_local9
								if not LUI.StringIsNilOrEmpty( f20_local11[0x55F116BF695C8F6] ) then
									f20_local9 = f20_local11[0x55F116BF695C8F6]
									if not f20_local9 then
									
									else
										f20_local8.name = f20_local9
										f20_local8.lootImage = f20_arg1.image
										f20_local8.uiImage = f20_arg1.image
										f20_local8.desc = f20_arg1.desc
										f20_local6[f20_local7] = f20_local8
									end
								end
								f20_local9 = f20_arg1.name
							end
						end
						f20_local4 = 0x0
					end
				end
			end
		end
	end
	Engine[0xC99CAB76F12E539]()
end

local f0_local30 = function ( f17_arg0, f17_arg1, f17_arg2, f17_arg3 )
	f17_arg2:SetupContextualMenu()
	f17_arg2:AddContextualMenuAction( {
		id = "chooseAppearance",
		actionName = Engine[0xED84C33EC5F01EA]( 0x894F428657B5CDD ),
		conditionFunction = function ()
			return GUNSMITH.IsGunsmithCustomsAvailable( f17_arg0, f17_arg0._focusedAttachmentData.unlocked, f17_arg0._focusedAttachmentData.variants, f17_arg0._weaponRef, f17_arg0.category, f17_arg0._focusedAttachmentData.isBlocked )
		end,
		actionFunction = function ()
			f17_arg0( f17_arg0, f17_arg0 )
		end
	} )
end

local f0_local31 = function ( f14_arg0, f14_arg1, f14_arg2, f14_arg3, f14_arg4 )
	local f14_local0 = f14_arg0._attachmentListData[f14_arg3 + 1]
	f0_local0( f14_arg0, f14_local0 )
	local f14_local1 = MatchRules[0x722F56788C744E9]( f14_local0.ref, f14_arg0._weaponRef )
	if CONDITIONS.AreRestrictionsActive() and f14_local0.category == ATTACHMENT.receiverCategory then
		local f14_local2 = WEAPON.GetWeaponRefByRec( f14_local0.ref )
		local f14_local3 = WEAPON.GetWeaponClass( f14_local2 )
		if not f14_local1 then
			local f14_local4 = MatchRules[0x966A6F3A93A1200]( f14_local2 )
			if not f14_local4 then
				f14_local1 = f14_local4
			else
				f14_local1 = MatchRules[0xB0FA3D79A09CF96]( f14_local3 )
			end
		end
	end
	f14_arg2:Setup( f14_arg1, f14_local0, f14_local0.ref == f14_arg0._equippedAttach, f14_arg0._weaponTable, f14_local1, f14_arg0._attachSlot, f14_arg4 )
	f0_local0( f14_arg0, f14_arg1, f14_arg2, f14_arg4.category )
	if not f14_arg2._parentHandlersAdded and CONDITIONS.IsDvarBoolEnabled( 0x8D8731B81911DA8 ) then
		local f14_local3 = function ( f15_arg0, f15_arg1 )
			if CONDITIONS.InFrontend() and CONDITIONS.IsWeaponPreviewEnabled() then
				if f14_arg0._data.isClassified then
					f14_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
						button_ref = "button_r3"
					} )
				else
					f14_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
						side = "left",
						button_ref = "button_r3",
						priority = 10,
						helper_text = Engine[0xED84C33EC5F01EA]( 0xCBEAF62674E5E75 )
					} )
				end
				f14_arg0:AddGamepadEventCallback( "button_right_stick", function ( f16_arg0, f16_arg1 )
					if f15_arg0._data.isClassified then
						return 
					end
					local f16_local0 = f16_arg1.controller or f15_arg0
					f15_arg0.weaponTable = f16_arg0._currentTable
					LUI.FlowManager.RequestAddMenu( "WeaponPreview", true, f16_local0, false, f15_arg0, true )
					if f16_arg1.qualifier then
						Engine[0xC4146BA76D0F982]( CoD.SFX.MouseClick )
					end
				end )
			end
		end
		
		f14_arg2:addEventHandler( "button_over", f14_local3 )
		f14_arg2:addEventHandler( "button_over_disable", f14_local3 )
		local f14_local4 = GUNSMITH.AttachmentTypeSFX[f14_local0.category]
		if not LUI.StringIsNilOrEmpty( f14_local4 ) then
			f14_arg2:setActionSFX( f14_local4 )
		end
		f14_arg2._handlersAdded = true
	end
end

local f0_local32 = function ( f12_arg0, f12_arg1, f12_arg2 )
	f12_arg0.Attachments:SetNumChildren( #f12_arg0._attachmentListData )
	f12_arg0.Attachments:TouchMouseSetActiveToDefaultFocusMenuCreate( f12_arg1 )
	f12_arg0.Attachments:SetRefreshChild( function ( f13_arg0, f13_arg1, f13_arg2 )
		f12_arg0( f12_arg0, f12_arg0, f13_arg0, f12_arg0.Attachments:GetContentIndex( f13_arg1, f13_arg2 ), f12_arg0 )
	end )
	f12_arg0.Attachments:SetNumColumns( #f12_arg0._attachmentListData )
	f12_arg0.Attachments:SetNumRows( 1 )
	f12_arg0.Attachments:RefreshContent()
end

local f0_local33 = function ( f8_arg0, f8_arg1, f8_arg2 )
	f8_arg0:AddGamepadEventCallback( "button_alt1", function ( f11_arg0, f11_arg1 )
		if GUNSMITH.IsGunsmithCustomsAvailable( f11_arg1.controller or f8_arg0, f11_arg0._focusedAttachmentData.unlocked, f11_arg0._focusedAttachmentData.variantData, f11_arg0._weaponRef, f8_arg0.category, f11_arg0._focusedAttachmentData.isBlocked ) then
			f8_arg0( f11_arg0, f8_arg0 )
		end
	end )
	f8_arg0:addEventHandler( "update_input_type", function ( f10_arg0, f10_arg1 )
		if LUI.IsLastInputGamepad( f10_arg1.controllerIndex ) and 0 < #f8_arg0.attachments then
			f10_arg0.Attachments:processEvent( {
				name = "gain_focus"
			} )
		end
	end )
	f8_arg0:addEventHandler( "menu_create", function ( f9_arg0, f9_arg1 )
		local f9_local0 = f8_arg0( f8_arg0 )
		f9_arg0.Attachments:RefreshContent()
		if not f9_arg0.Attachments:GetFocusPositionIndex() then
			f9_arg0.Attachments:SetFocusedPosition( {
				y = 0,
				x = f9_local0
			}, true )
		end
		if LUI.IsLastInputMouseNavigation( f8_arg0 ) then
			f9_arg0:processEvent( {
				name = "update_showcase",
				attachmentData = f8_arg0.attachments[f9_local0 + 1]
			} )
		end
	end )
end

local f0_local34 = function ( f7_arg0 )
	MenuUtils.SetupSideArrows( f7_arg0, f7_arg0.Attachments, true, {
		step = f0_local0,
		mouseArea = f7_arg0.MouseArea
	} )
end

local f0_local35 = function ( f6_arg0, f6_arg1 )
	if f6_arg0._category == ATTACHMENT.receiverCategory and not Onboarding.Receiver.WasCompleted( f6_arg0, f6_arg1 ) then
		TIP.CreateTips( Onboarding.Tips.RECEIVER( f6_arg1, f6_arg0 ) )
		Onboarding.Receiver.MarkCompleted( f6_arg0, f6_arg1 )
	end
end

local f0_local36 = function ( f5_arg0, f5_arg1 )
	if not LUI.IsLastInputMouseNavigation( f5_arg1._controllerIndex ) then
		ACTIONS.GainFocus( f5_arg1, f5_arg1.Attachments.id, f5_arg1._controllerIndex )
	end
end

local f0_local37 = function ( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	if Engine[0x2DA54CF5D6B7F02]() then
		f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	end
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg2.attachments )
	if CONDITIONS.InGame() then
		f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	end
	f4_arg0._attachmentListData = f4_arg2.attachments
	for f4_local0 = 1, #f4_arg0._attachmentListData, 1 do
		if f0_local0( f4_arg0, f4_arg1, f4_arg0._attachmentListData[f4_local0].ref ) then
			f4_arg0._attachmentListData[f4_local0].unlocked = true
			break
		end
	end
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	local f4_local0 = {}
	if f4_arg0._weaponTable.lootID ~= LOOT.emptyID then
		f4_local0 = WEAPON.GetModificationAttachments( f4_arg1, f4_arg0._weaponTable.weapon, f4_arg0._weaponTable.lootID )
	end
	f0_local0( f4_arg0, f4_arg1, f4_arg2.forShowcase )
	f0_local0( f4_arg0, f4_arg1, f4_local0 )
	f4_arg0._currentTable = ATTACHMENT.GetTableWithCurrentAttachment( f4_arg0._weaponTable, f4_arg0._attachSlot )
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0 )
	f0_local0( f4_arg0 )
	f0_local0( f4_arg0, f4_arg1 )
	f4_arg0:SubscribeToInputTypeModel( f4_arg1, f0_local0, true )
	if CONDITIONS.ShouldCheckForMissingReticlePreviews() and f4_arg0._category == ATTACHMENT.opticCategory then
		local f4_local1 = {}
		for f4_local14, f4_local15 in ipairs( f4_arg0._attachmentListData ) do
			if not String.IsNilOrEmpty( f4_local15.ref ) and f4_local15.ref ~= ATTACHMENT.none then
				local f4_local5 = WEAPON.GenerateWeaponTableFromRef( f4_arg0._weaponTable.weapon )
				local f4_local6 = WEAPON.GetWeaponModelName( f4_local5.weapon, f4_local5 )
				local f4_local7 = ATTACHMENT.GetDefaultAttachmentRefForSlotIndex( GL_HACK.GetWeaponMPRef( f4_arg0._weaponTable.weapon ), Enum[0x540F63FFAF44174][0x4D4BF1F5D4F4EBA] )
				if f4_local15.variantData and 0 < #f4_local15.variantData then
					for f4_local12, f4_local13 in ipairs( f4_local15.variantData ) do
						local f4_local11 = nil
						if String.IsNilOrEmpty( f4_local7 ) then
							f4_local11 = f4_local6 .. "+" .. f4_local15.ref .. "|" .. tostring( f4_local13.variantID )
						else
							f4_local11 = string.gsub( f4_local6, f4_local7, f4_local15.ref .. "|" .. tostring( f4_local13.variantID ) )
						end
						if String.IsNilOrEmpty( Reticle[0x15C60EB1A12545F]( f4_arg1, f4_local11, false ) ) then
							f4_local1[f4_local15.ref] = true
						end
					end
				end
				local f4_local8 = nil
				if String.IsNilOrEmpty( f4_local7 ) then
					f4_local8 = f4_local6 .. "+" .. f4_local15.ref
				else
					f4_local8 = string.gsub( f4_local6, f4_local7, f4_local15.ref )
				end
				if String.IsNilOrEmpty( Reticle[0x15C60EB1A12545F]( f4_arg1, f4_local8, false ) ) then
					f4_local1[f4_local15.ref] = true
				end
			end
		end
		if not Table.IsEmpty( f4_local1 ) then
			f4_local2 = "The following optics are missing reticle previews:"
			for f4_local15, f4_local5 in pairs( f4_local1 ) do
				f4_local2 = f4_local2 .. "\t" .. f4_local15 .. "\n"
			end
			assert( false, f4_local2 )
		end
	end
end

local f0_local38 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.PostLoadShared = f0_local0
end

function AttachmentSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "AttachmentSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local f1_local3 = self
	ATTACHMENT.SetupAttachmentSelectMenu( self, f1_local1, controller )
	self:AddGamepadEventCallback( "button_secondary", function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or menu
		ACTIONS.LeaveMenu( menu )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "AttachmentSelectBase", AttachmentSelectBase )
LockTable( _M )
