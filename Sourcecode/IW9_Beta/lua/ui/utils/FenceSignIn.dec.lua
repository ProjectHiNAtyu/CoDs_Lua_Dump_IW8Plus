-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
FenceSignIn = LUI.Class( LUI.Fence )
FenceSignIn.ACCOUNT_PICKER_STATE = {
	picking = 2,
	inactive = 1
}
FenceSignIn.init = function ( f17_arg0 )
	LUI.Fence.init( f17_arg0 )
	f17_arg0._smsChallengePassed = false
	f17_arg0._smsScreenOpened = false
	f17_arg0._smsUrl = ""
	f17_arg0._mobilePhoneRequiredPassed = false
	f17_arg0._perController = {}
	for f17_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		f17_arg0._perController[f17_local0] = {
			accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
		}
	end
end

FenceSignIn.Start = function ( f16_arg0 )
	DebugPrint( "FenceSignIn.Start" )
end

FenceSignIn.Stop = function ( f15_arg0 )
	DebugPrint( "FenceSignIn.Stop" )
end

FenceSignIn.PostFail = function ( f14_arg0 )
	if f14_arg0._state == LUI.Fence.STATE.fail then
		LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_error", false, nil, false, {}, nil, false, true )
	end
end

function PopupSignInQueue( f12_arg0, f12_arg1 )
	assert( f12_arg1 )
	local f12_local0 = {
		message = Engine[0xED84C33EC5F01EA]( 0xA479AD2705AC200 ),
		description = Engine[0xED84C33EC5F01EA]( 0x62EA86FE707A789 ),
		buttons = {
			label = Engine[0xED84C33EC5F01EA]( Engine[0x575E9C5B9AAB6F4]() and 0x4E76830223A336F or 0x3956F54E845F7DE ),
			alignment = LUI.Alignment.Center,
			action = function ()
				if Engine[0x575E9C5B9AAB6F4]() then
					Engine[0xDEE6107B26F8BB6]()
				else
					LUI.FlowManager.RequestLeaveMenu()
				end
			end
		}
	}
	local f12_local1 = f12_arg1.controllerIndex
	if not f12_local1 then
		f12_local1 = Engine[0x45B054C920178E9]()
	end
	f12_local0.controllerIndex = f12_local1
	f12_local1 = MenuBuilder.BuildRegisteredType( "FenceSigninQueueDialogPopup", f12_local0 )
	f12_local1.id = "popup_signin_queue"
	return f12_local1
end

FenceSignIn.OpenSignInQueuedPopup = function ( f10_arg0 )
	local f10_local0 = f10_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_queue", false, nil, false, {
		onCancel = function ( f11_arg0, f11_arg1 )
			f10_arg0._perController[f11_arg1].isCancelling = true
		end
	}, nil, true, true )
	f10_arg0._openedWaitPopup = "popup_signin_queue"
end

FenceSignIn.ProcessingMobilePhoneRequired = function ( f9_arg0, f9_arg1 )
	if not Dvar[0x9E5BE3B4BBA4E0E]( 0x30CEDD72C7F6D84 ) then
		f9_arg0._mobilePhoneRequiredPassed = true
		return false
	elseif f9_arg0._mobilePhoneRequiredPassed then
		return false
	elseif not f9_arg0._smsScreenOpened then
		if Engine[0xCA36DB078B71EED]() and not Dvar[0x9E5BE3B4BBA4E0E]( 0x1C1821DAFC21DF7 ) then
			f9_arg0._mobilePhoneRequiredPassed = true
			return false
		else
			f9_arg0._state = LUI.Fence.STATE.block
			f9_arg0._smsScreenOpened = true
			LUI.FlowManager.RequestPopupMenu( nil, "SMSVerificationMenu", false, f9_arg1, false, {
				mobilePhoneRequired = true
			}, nil, true, true )
			return true
		end
	elseif f9_arg0._smsScreenOpened and not LUI.FlowManager.IsInStack( "SMSVerificationMenu" ) then
		f9_arg0._mobilePhoneRequiredPassed = true
		f9_arg0._smsScreenOpened = false
		return false
	else
		f9_arg0._state = LUI.Fence.STATE.block
		return true
	end
end

FenceSignIn.ProcessingSMSChallenge = function ( f8_arg0, f8_arg1 )
	if not Dvar[0x9E5BE3B4BBA4E0E]( 0x50135C96D3D25D8 ) then
		f8_arg0._smsChallengePassed = false
		return false
	end
	local f8_local0 = Engine[0xAD8AB19E87265C6]( f8_arg1 )
	local f8_local1 = Dvar[0x9E5BE3B4BBA4E0E]( 0xBE001FF2852B443 )
	if not f8_local0 and not f8_local1 then
		return false
	elseif f8_arg0._smsChallengePassed then
		return false
	elseif not f8_arg0._smsChallengePassed and not f8_arg0._smsScreenOpened then
		if f8_local1 or f8_local0 then
			f8_arg0._smsChallengePassed = false
		else
			f8_arg0._smsChallengePassed = true
		end
		if f8_arg0._smsChallengePassed then
			return false
		end
	end
	if not f8_arg0._smsChallengePassed or f8_local0 or f8_local1 then
		if not f8_arg0._smsScreenOpened then
			if f8_local1 then
				f8_arg0._smsUrl = "https://www.smsTestUrl.com"
			else
				local f8_local2 = Engine[0x214330D651CD9C1]( f8_arg1 )
				if not f8_local2.isCompleted and f8_local2.mechanism == "sms" then
					f8_arg0._smsUrl = f8_local2.url
				end
			end
			f8_arg0._state = LUI.Fence.STATE.block
			f8_arg0._smsScreenOpened = true
			LUI.FlowManager.RequestPopupMenu( nil, "SMSVerificationMenu", false, f8_arg1, false, {
				url = f8_arg0._smsUrl
			}, nil, true, true )
			return true
		elseif f8_arg0._smsScreenOpened and not LUI.FlowManager.IsInStack( "SMSVerificationMenu" ) then
			f8_arg0._state = LUI.Fence.STATE.pass
			f8_arg0._smsChallengePassed = true
			return false
		end
		f8_arg0._state = LUI.Fence.STATE.block
		return true
	elseif f8_arg0._smsScreenOpened and not f8_arg0._smsChallengePassed then
		f8_arg0._state = LUI.Fence.STATE.block
		return true
	end
	f8_arg0._smsChallengePassed = true
	return false
end

FenceSignIn.UpdateState = function ( f6_arg0 )
	assert( f6_arg0._state ~= LUI.Fence.STATE.fail )
	f6_arg0._state = LUI.Fence.STATE.pass
	if Engine[0x21103F2ABD5B496]() then
		f6_arg0._state = LUI.Fence.STATE.pass
	end
	if Engine[0x5575DCFF312365A]() then
		local f6_local0 = 0
		if not Engine[0xD2813B521711C11]( f6_local0 ) then
			local f6_local1 = Engine[0x170DF85DCE182E7]()
			local f6_local2 = function ( f7_arg0 )
				if f6_arg0._openedWaitPopup ~= nil and f6_arg0._openedWaitPopup ~= f7_arg0 then
					LUI.FlowManager.RequestLeaveMenuByName( f6_arg0._openedWaitPopup, true )
					f6_arg0._openedWaitPopup = nil
					return true
				elseif f6_arg0._openedWaitPopup == nil then
					return true
				else
					return false
				end
			end
			
			if f6_local1 then
				if f6_local2( "popup_signin_queue" ) then
					f6_arg0:OpenSignInQueuedPopup()
				end
			elseif f6_arg0._openedWaitPopup then
				LUI.FlowManager.RequestLeaveMenuByName( f6_arg0._openedWaitPopup, true )
				f6_arg0._openedWaitPopup = nil
			end
			local f6_local3 = Engine[0x2D5DC5650ED3A1E]( f6_local0 )
			if f6_local3 == BattleNetAuthState.NOT_SIGNED_IN and Engine[0xAF7EC673FFF4FE4]() ~= nil then
				f6_arg0._state = LUI.Fence.STATE.fail
			elseif f6_local3 ~= BattleNetAuthState.SIGNED_IN then
				f6_arg0._state = LUI.Fence.STATE.block
			end
		elseif f6_arg0:ProcessingSMSChallenge( f6_local0 ) then
			return 
		elseif f6_arg0._openedWaitPopup then
			LUI.FlowManager.RequestLeaveMenuByName( f6_arg0._openedWaitPopup, true )
			f6_arg0._openedWaitPopup = nil
		end
		return 
	elseif Engine[0x9DD5167C6D720F1]() then
		local f6_local0 = 0
		if Engine[0xD2813B521711C11]( f6_local0 ) then
			if f6_arg0:ProcessingMobilePhoneRequired( f6_local0 ) then
				return 
			elseif f6_arg0:ProcessingSMSChallenge( f6_local0 ) then
				return 
			end
		end
	end
	if Engine[0xE457944EE65BCA1]() then
		f6_arg0._state = LUI.Fence.STATE.block
		return 
	end
	for f6_local4 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f6_local4 ) and not Engine[0xD2813B521711C11]( f6_local4 ) then
			local f6_local5 = assert
			local f6_local6 = Engine[0x688D9FAA39ECE94]()
			if not f6_local6 then
				f6_local6 = Engine[0x688D8FAA39ECCE1]()
				if not f6_local6 then
					f6_local6 = Engine[0x2BFF02F7B2CDB47]()
				end
			end
			f6_local5( f6_local6 )
			if f6_arg0._perController[f6_local4].accountPickerState == FenceSignIn.ACCOUNT_PICKER_STATE.inactive then
				f6_arg0._state = LUI.Fence.STATE.block
				f6_arg0._perController[f6_local4].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.picking
				Engine[0x4DECC2B7654EAB1]( f6_local4, false )
				return 
			end
		end
	end
	local f6_local4 = 0
	local f6_local1 = 0
	for f6_local2 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f6_local2 ) and Engine[0xD2813B521711C11]( f6_local2 ) then
			f6_local4 = f6_local4 + 1
			if not Engine[0x757E77CA15D6B8F]( f6_local2 ) then
				f6_local1 = f6_local1 + 1
			end
		end
	end
	local f6_local2 = false
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x3DDB961100B5F47 ) and Engine[0x1DCFAFA7CE6F8D0]() and 0 < f6_local4 then
		f6_local2 = true
	end
	if 0 < f6_local4 and 0 < f6_local1 then
		f6_local2 = true
	end
	if f6_local2 then
		for f6_local3 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			if Engine[0x10A5732AB1DAE9F]( f6_local3 ) and not Engine[0xD2813B521711C11]( f6_local3 ) then
				Engine[0x54DE5FB69D3BA90]( f6_local3 )
				f6_arg0._perController[f6_local3].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
			end
		end
	else
		f6_arg0._state = LUI.Fence.STATE.fail
	end
end

function PopupSignInError( f1_arg0, f1_arg1 )
	local f1_local0 = 0xD1ED4A270AD4A2F
	if Engine[0x1DCFAFA7CE6F8D0]() then
		f1_local0 = 0xC6EFCA78C461C6
	end
	if Engine[0x9258F49F515F97B]() then
		f1_local0 = 0x91298E49D2B36AC
	end
	local f1_local1 = {
		controllerIndex = f1_arg1.controllerIndex,
		title = Engine[0xED84C33EC5F01EA]( 0xBDAA9535F4F682B ),
		message = Engine[0xED84C33EC5F01EA]( f1_local0 ),
		buttons = {
			{
				label = Engine[0xED84C33EC5F01EA]( 0x5C33DA8F6CE65B0 )
			}
		}
	}
	if Engine[0x5575DCFF312365A]() then
		f1_local1.message = Engine[0xAF7EC673FFF4FE4]()
		f1_local1.buttons[1].label = Engine[0xED84C33EC5F01EA]( 0x4E76830223A336F )
		f1_local1.buttons[1].action = function ()
			Engine[0xDEE6107B26F8BB6]()
		end
		
		if Engine[0xE46B11F69B0F4D5]() then
			table.insert( f1_local1.buttons, 1, {
				label = Engine[0xED84C33EC5F01EA]( 0xCEEE7DB3E04E2C1 ),
				action = function ()
					Engine[0xA265A859B7C189E]( f1_arg0.controllerIndex, 0, "https://account.blizzard.com/details#phone-number" )
				end
			} )
		end
		if Engine[0x6983E9F2847EAED]() then
			table.insert( f1_local1.buttons, {
				label = Engine[0xED84C33EC5F01EA]( 0x8010973A5846CDA ),
				action = function ( f3_arg0, f3_arg1 )
					Engine[0x34C623E28A1C5E7]( "" )
				end
			} )
		end
		if Engine[0xD87B38D9E227ECC]() then
			f1_local1.title = Engine[0xED84C33EC5F01EA]( 0xD5DFD124B6C28D2 )
		end
	end
	local f1_local2 = MenuBuilder.BuildRegisteredType( "GenericImagePopup", f1_local1 )
	f1_local2.id = "popup_signin_error"
	f1_local2:registerEventHandler( "not_below_blocking_fence", function ( element, event )
		if Engine[0x688D9FAA39ECE94]() then
			Engine[0xE49CE4BCE0701D5]( "Sign in fence failed" )
			Dvar[0x8EA06EEDB58D872]( 0xD360034020A5D7A, false )
		end
	end )
	return f1_local2
end

MenuBuilder.registerType( "popup_signin_queue", PopupSignInQueue )
MenuBuilder.registerType( "popup_signin_error", PopupSignInError )
LUI.Fence.Register( "signIn", FenceSignIn )
LockTable( _M )
