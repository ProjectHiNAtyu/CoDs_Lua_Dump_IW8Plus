-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
PostGameFanfare = {
	states = {
		AAR_SUMMARY = 0,
		AAR_CP_POINTS = 1,
		AAR_START = 4294967295
	}
}
local f0_local0 = function ( f5_arg0, f5_arg1 )
	f5_arg0._state = f5_arg1
	if f5_arg0._state == PostGameFanfare.states.AAR_SUMMARY then
		Lobby.OpenAfterActionReport( f5_arg0._controllerIndex, false, true )
	end
	if f5_arg0._state == PostGameFanfare.states.AAR_CP_POINTS then
		Lobby.OpenAfterActionReport( f5_arg0._controllerIndex, false, false, true )
	end
end

local f0_local1 = function ( f4_arg0, f4_arg1 )
	if f4_arg0._state == f4_arg1 then
		LUI.FlowManager.RequestLeaveMenuByName( "AARContainer", true )
		if CONDITIONS.InFrontendLP() then
			ACTIONS.OpenAnimationFlow( f4_arg0, "LPEndOfGame", f4_arg0._controllerIndex )
		end
	end
	f4_arg0._state = nil
end

local f0_local2 = function ( f3_arg0, f3_arg1 )
	if f3_arg1 == nil then
		f0_local0( f3_arg0, f3_arg0._state )
	end
	f0_local0( f3_arg0, f3_arg1 )
end

PostGameFanfare.start = function ( f2_arg0 )
	f0_local0( f2_arg0, PostGameFanfare.states.AAR_START )
	f2_arg0._controllerIndex = Engine[0x45B054C920178E9]()
	InitAARDataSources( f2_arg0._controllerIndex )
	f2_arg0:advance()
end

PostGameFanfare.advance = function ( f1_arg0 )
	if f1_arg0._state == nil then
		LUI.FlowManager.RequestLeaveMenuByName( "AARContainer", true )
		return 
	end
	assert( f1_arg0._controllerIndex )
	local f1_local0 = f1_arg0._controllerIndex == Engine[0x45B054C920178E9]()
	if f1_arg0._state < PostGameFanfare.states.AAR_SUMMARY and not CONDITIONS.IsInternalAlphaEnabled() then
		f0_local0( f1_arg0, PostGameFanfare.states.AAR_SUMMARY )
		return 
	elseif f1_arg0._state < PostGameFanfare.states.AAR_CP_POINTS and not CONDITIONS.IsInternalAlphaEnabled() and Dvar[0x54084D7CA2317BB]( "#x3a30c33efc8281eb1" ) == CP.SPEC_OPS and Dvar[0x9E5BE3B4BBA4E0E]( "#x3c18f0ff0e34a61b" ) then
		f0_local0( f1_arg0, PostGameFanfare.states.AAR_CP_POINTS )
		return 
	end
	local f1_local1 = f1_arg0._controllerIndex
	local f1_local2 = Engine[0xB686A0A723E6442]() - 1
	for f1_local3 = f1_arg0._controllerIndex + 1, f1_local2, 1 do
		if Engine[0x10A5732AB1DAE9F]( f1_local3 ) then
			f1_arg0._controllerIndex = f1_local3
			break
		end
	end
	f0_local0( f1_arg0, nil )
	if f1_arg0._controllerIndex ~= f1_local1 then
		f1_arg0._state = PostGameFanfare.states.AAR_START
		return f1_arg0:advance()
	end
	local f1_local3 = Engine[0x45B054C920178E9]()
	if Engine[0x220CB915CEFC1FE]() and not Engine[0x8B495DC361731F7]( f1_local3 ) and CONDITIONS.IsMagmaEnabled() then
		if Dvar[0x9E5BE3B4BBA4E0E]( "#x33121ee43e1b085ed" ) and Dvar[0x9E5BE3B4BBA4E0E]( "#x38994c70bce46b610" ) and Dvar[0x54084D7CA2317BB]( "#x3a30c33efc8281eb1" ) ~= "br" then
			LUI.FlowManager.RequestPopupMenu( element, "MagmaUpsellPopup", true, f1_local3, false, nil )
			Dvar[0x8EA06EEDB58D872]( "#x33121ee43e1b085ed", false )
		end
	end
end

