-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
local f0_local0 = 6
local f0_local1 = 150
local f0_local2 = 24
local f0_local3 = 10000
local f0_local4 = "leftgame"
local f0_local5 = function ( f20_arg0 )
	f20_arg0._timeOnScreenType = Engine.CDHBFIFCEA( f20_arg0._controllerIndex )
	if f20_arg0._timeOnScreenType == ObituaryTimeOnScreen.OFF then
		DebugPrint( "Obituary is off. Will not show message" )
		return false
	else
		return true
	end
end

local f0_local6 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = StringTable.DIFCHIGDFB( CSV.BRObituary.file, CSV.BRObituary.cols.index, f19_arg1, CSV.BRObituary.cols.displayTimeMs )
	if f19_local0 and f19_local0 ~= "" then
		return f19_local0
	elseif Engine.BHICADFIHA() then
		LUI.FlowManager.RequestPopupMenu( f19_arg0, "PopupOK", true, f19_arg0._controllerIndex, false, {
			message = "Couldn't find killfeed display time for index: " .. f19_arg1 .. ", in: " .. CSV.BRObituary.file
		} )
	end
	return f0_local0
end

local f0_local7 = function ( f18_arg0, f18_arg1 )
	if f18_arg1._subType == f0_local0 then
		return f0_local0
	else
		return f0_local0( f18_arg0, f18_arg0._timeOnScreenType )
	end
end

local f0_local8 = function ( f17_arg0, f17_arg1 )
	if f17_arg1.type == "kill" then
		DebugPrint( "Removing kill message" )
		f17_arg0._killMessagePool:DeallocateElement( f17_arg1 )
	elseif f17_arg1.type == "text" then
		DebugPrint( "Removing text message" )
		f17_arg0._textMessagePool:DeallocateElement( f17_arg1 )
	elseif CONDITIONS.IsBRGameType( f17_arg0 ) and f17_arg1.type == "PingLoot" then
		DebugPrint( "Remvoing ping loot message" )
		f17_arg0._PingMessageLootPool:DeallocateElement( f17_arg1 )
	elseif CONDITIONS.IsBRGameType( f17_arg0 ) and f17_arg1.type == "highlightedText" then
		DebugPrint( "Removing highlighted text message" )
		f17_arg0._highlightedTextMessagePool:DeallocateElement( f17_arg1 )
	end
	f17_arg1:RemoveFromParent()
end

local f0_local9 = function ( f14_arg0, f14_arg1 )
	if not f14_arg0.invertFeedOrder then
		local f14_local0 = f14_arg0:getFirstChild()
		if f14_local0 then
			f14_local0:SetBottom( f14_arg1.height )
			f14_arg1:addElementBefore( f14_local0 )
		else
			f14_arg0:addElement( f14_arg1 )
		end
		f14_arg1:SetTop( 0 )
		f14_arg1:SetBottom( 0 )
		assert( f14_arg1.height )
		f14_arg1:SetBottom( f14_arg1.height, f0_local0, LUI.EASING.inOutQuadratic )
	else
		local f14_local0 = f14_arg0:getHeight()
		local f14_local1 = f14_arg0:getLastChild()
		if f14_local1 then
			f14_local1:SetTop( f14_local0 - f14_arg1.height )
			f14_arg1:addElementAfter( f14_local1 )
		else
			f14_arg0:addElement( f14_arg1 )
		end
		f14_arg1:SetTop( f14_local0 )
		f14_arg1:SetBottom( f14_local0 )
		assert( f14_arg1.height )
		f14_arg1:SetTop( f14_local0 - f14_arg1.height, f0_local0, LUI.EASING.inOutQuadratic )
	end
	f14_arg1:SetAlpha( 1 )
	if not CODCASTER.IsCODCaster() then
		f14_arg1:SetAlpha( 0.5, 2000 )
	end
	local f14_local1 = f14_arg1:Wait( f0_local0( f14_arg0, f14_arg1 ), true )
	f14_local1.onComplete = function ()
		local f15_local0 = f14_arg0:SetAlpha( 0, 1000 )
		f15_local0.onComplete = function ()
			DebugPrint( "Removing message" )
			f15_local0( f15_local0, f15_local0 )
		end
		
	end
	
	if f0_local0 < f14_arg0:getNumChildren() then
		
	else
		
	end
end

local f0_local10 = function ( f13_arg0, f13_arg1 )
	if f13_arg1.bold then
		return 
	end
	local f13_local0 = string.find( f13_arg1.message, string.gsub( Engine.CBBHFCGDIC( "EXE/LEFTGAME" ), "", "" ) )
	if CONDITIONS.IsMagmaGameMode() and not CONDITIONS.IsBloodMoney() and not CONDITIONS.IsRiskGametype() and not CONDITIONS.IsBRKingSlayer() and not CONDITIONS.IsWZRatRace() and f13_local0 then
		return false
	elseif not f0_local0( f13_arg0 ) then
		return 
	end
	local f13_local1 = f13_arg0._textMessagePool:AllocateElement()
	if f13_local0 then
		f13_local1._subType = f0_local0
	end
	DebugPrint( "Adding text message that says " .. f13_arg1.message )
	f0_local0( f13_arg0, f13_local1 )
	f13_local1:Update( f13_arg1 )
end

local f0_local11 = function ( f12_arg0, f12_arg1 )
	if not f0_local0( f12_arg0 ) then
		return 
	elseif CONDITIONS.IsBRGameType( f12_arg0 ) and f12_arg1.isMod and f12_arg1.modIndex == f0_local0 then
		DebugPrint( "Adding Team Wiped Obit Msg" )
		local f12_local0 = Engine.CBBHFCGDIC( "MP_BR_INGAME/TEAM_WIPED" )
		if CONDITIONS.IsRebirthSoloGametype() or CONDITIONS.IsBRResurgenceTrialsSoloGametype() then
			f12_local0 = Engine.CBBHFCGDIC( "MP_BR_INGAME/ENEMY_WIPED" )
		end
		local f12_local1 = f12_arg0._highlightedTextMessagePool:AllocateElement()
		f0_local0( f12_arg0, f12_local1 )
		f12_local1:Update( f12_local0 )
	else
		if f12_arg1.modIndex then
			DebugPrint( "Adding kill message with mod index " .. f12_arg1.modIndex )
		else
			DebugPrint( "Adding kill message" )
		end
		local f12_local0 = f12_arg0._killMessagePool:AllocateElement()
		f0_local0( f12_arg0, f12_local0 )
		f12_local0:Update( f12_arg1 )
	end
end

local f0_local12 = 12
local f0_local13 = 13
local f0_local14 = function ( f7_arg0, f7_arg1 )
	local f7_local0 = function ( f11_arg0, f11_arg1 )
		if not f7_arg0( f11_arg0 ) then
			return 
		else
			local f11_local0 = f11_arg0._PingMessageLootPool:AllocateElement()
			f7_arg0( f11_arg0, f11_local0 )
			f11_local0:Update( f11_arg1 )
		end
	end
	
	local f7_local1 = function ( f10_arg0, f10_arg1 )
		local f10_local0 = f10_arg1.value
		local f10_local1 = BitwiseOperators.band( f10_local0, 15 )
		f10_local0 = BitwiseOperators.rshift( f10_local0, 4 )
		local f10_local2 = BitwiseOperators.band( f10_local0, 255 )
		f10_local0 = BitwiseOperators.rshift( f10_local0, 8 )
		local f10_local3 = BitwiseOperators.band( f10_local0, 1048575 )
		if f10_local1 == f7_arg0 and Dvar.IBEGCHEFE( "lui_enable_vengeance_list_in_obit" ) then
			f10_local3 = BitwiseOperators.band( f10_local0, 65535 )
			f10_local0 = BitwiseOperators.rshift( f10_local0, 16 )
			local f10_local4 = Game.GCGJJCEJH( f7_arg0 )
			for f10_local5 = 1, 4, 1 do
				local f10_local8 = Game.CHFDEDBIH( f10_local4, f10_local5 )
				if f10_local8 ~= -1 then
					local f10_local9 = BitwiseOperators.band( f10_local0, 1 )
					if f10_local9 and f10_local9 == 1 and f10_local8 ~= f10_local2 then
						f7_arg0( f10_arg0, {
							state = f7_arg0,
							param1 = f10_local8,
							param2 = f10_local8,
							string = f10_arg1.string,
							icon = f10_arg1.icon
						} )
					end
				end
				f10_local0 = BitwiseOperators.rshift( f10_local0, 1 )
			end
		end
		local f10_local4 = {
			state = f10_local1,
			param1 = f10_local2,
			param2 = f10_local3,
			string = f10_arg1.string,
			icon = f10_arg1.icon
		}
		DebugPrint( "Adding squad message with " .. f10_local1 .. " state" )
		f7_arg0( f10_arg0, f10_local4 )
	end
	
	local f7_local2 = function ( f9_arg0, f9_arg1 )
		if not f7_arg0( f9_arg0 ) then
			return 
		else
			local f9_local0 = {
				state = f9_arg1.messageType,
				param1 = f9_arg1.client,
				param2 = f9_arg1.messageParam,
				ownerClientNum = f9_arg1.owner,
				string = f9_arg1.string,
				icon = f9_arg1.icon
			}
			DebugPrint( "Adding squad message with " .. f9_arg1.messageType .. " state" )
			f7_arg0( f9_arg0, f9_local0 )
		end
	end
	
	local f7_local3 = function ( f8_arg0, f8_arg1 )
		if not f7_arg0( f8_arg0 ) then
			return 
		elseif f8_arg1.value == 0 then
			return 
		else
			f7_arg0( f8_arg0, f8_arg1 )
		end
	end
	
	f7_arg0:registerEventHandler( "br_squad_message", f7_local1 )
	f7_arg0:registerEventHandler( "br_ping_ack", f7_local2 )
	f7_arg0:registerOmnvarHandler( "ui_br_expanded_obit_message", f7_local3 )
end

local f0_local15 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.invertFeedOrder = false
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0._killMessagePool = LUI.LUIElementPool.new( {
		maxPoolSize = 5,
		initialPoolSize = 5,
		buildElement = function ()
			local f6_local0
			if CODCASTER.IsCODCaster() then
				f6_local0 = "CodCasterObituaryKill"
			else
				f6_local0 = "ObituaryKill"
			end
			local f6_local1 = MenuBuilder.BuildRegisteredType( f6_local0 )
			local f6_local2, f6_local3, f6_local4, f6_local5 = f6_local1:getLocalRect()
			f6_local1.height = f6_local5 - f6_local3
			f6_local1.type = "kill"
			assert( 0 < f6_local1.height )
			return f6_local1
		end
	} )
	f2_arg0._textMessagePool = LUI.LUIElementPool.new( {
		maxPoolSize = 2,
		initialPoolSize = 2,
		buildElement = function ()
			local f5_local0 = MenuBuilder.BuildRegisteredType( "ObituaryMessage" )
			local f5_local1, f5_local2, f5_local3, f5_local4 = f5_local0:getLocalRect()
			f5_local0.height = f5_local4 - f5_local2
			f5_local0.type = "text"
			assert( 0 < f5_local0.height )
			return f5_local0
		end
	} )
	if CONDITIONS.IsBRGameType( f2_arg0 ) then
		local f2_local0 = Dvar.CFHDGABACF( "scr_br_teamsize" ) or 0
		local f2_local1
		if CONDITIONS.IsBRTruckWar() then
			f2_local1 = 2
		elseif 4 <= f2_local0 then
			f2_local1 = 4
		else
			f2_local1 = 5
		end
		f0_local0 = f2_local1
		f2_arg0._PingMessageLootPool = LUI.LUIElementPool.new( {
			maxPoolSize = 5,
			initialPoolSize = 5,
			buildElement = function ()
				local f4_local0 = MenuBuilder.BuildRegisteredType( "SquadMessage" )
				local f4_local1, f4_local2, f4_local3, f4_local4 = f4_local0:getLocalRect()
				f4_local0.height = f4_local4 - f4_local2
				f4_local0.type = "PingLoot"
				assert( 0 < f4_local0.height )
				return f4_local0
			end
		} )
		f0_local0( f2_arg0, f2_arg1 )
		f2_arg0._highlightedTextMessagePool = LUI.LUIElementPool.new( {
			maxPoolSize = 2,
			initialPoolSize = 2,
			buildElement = function ()
				local f3_local0 = MenuBuilder.BuildRegisteredType( "ObituaryHighlightedMessage" )
				local f3_local1, f3_local2, f3_local3, f3_local4 = f3_local0:getLocalRect()
				f3_local0.height = f3_local4 - f3_local2
				f3_local0.type = "highlightedText"
				assert( 0 < f3_local0.height )
				return f3_local0
			end
		} )
	end
	f2_arg0:registerEventHandler( "obituary", f0_local0 )
	if not CODCASTER.IsCODCaster() then
		f2_arg0:registerEventHandler( "game_message", f0_local0 )
	else
		f2_arg0.invertFeedOrder = true
	end
	if f2_arg0.invertFeedOrder then
		f2_arg0:SetVerticalAlignment( LUI.Alignment.Bottom )
	end
end

function Obituary( menu, controller )
	local self = LUI.UIVerticalStackedLayout.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 600 * _1080p, 0, 144 * _1080p )
	self.id = "Obituary"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	self:setUseStencil( true )
	self:SetSpacing( 6 * _1080p )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "Obituary", Obituary )
LockTable( _M )
