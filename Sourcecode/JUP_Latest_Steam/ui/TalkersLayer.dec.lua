-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
LUI.TalkersLayer = LUI.Class( LUI.UIElement )
local f0_local0 = {
	RIGHT = 1,
	MIDDLE = 0
}
local f0_local1 = {
	TOP = 0,
	MIDDLE = 1
}
LUI.TalkersLayer.CHANNEL_DISPLAY_TYPE = {
	CURRENT_VOICE = 0,
	SPECIFIC_CHANNEL = 2,
	GAME_PARTY = 1
}
LUI.TalkersLayer.SetHorizontalPosition = function ( f15_arg0, f15_arg1 )
	if f15_arg0.talkersLayout then
		if f15_arg1 == f0_local0.MIDDLE then
			ACTIONS.AnimateSequence( f15_arg0.talkersLayout, "PositionHorizontal_Middle" )
		elseif f15_arg1 == f0_local0.RIGHT then
			ACTIONS.AnimateSequence( f15_arg0.talkersLayout, "PositionHorizontal_Right" )
		end
	end
end

LUI.TalkersLayer.SetVerticalPosition = function ( f14_arg0, f14_arg1 )
	if f14_arg0.talkersLayout then
		if f14_arg1 == f0_local0.TOP then
			ACTIONS.AnimateSequence( f14_arg0.talkersLayout, "PositionVertical_Top" )
		elseif f14_arg1 == f0_local0.MIDDLE then
			ACTIONS.AnimateSequence( f14_arg0.talkersLayout, "PositionVertical_Middle" )
		end
	end
end

LUI.TalkersLayer.UpdatePosition = function ( f13_arg0, f13_arg1 )
	if (f13_arg1._globalPanelBaseDatasource and f13_arg1._globalPanelBaseDatasource:GetValue( f13_arg1._controllerIndex ) or false) or (f13_arg1._globalPanelOptionsSearchOpenDatasource and f13_arg1._globalPanelOptionsSearchOpenDatasource:GetValue( f13_arg1._controllerIndex ) or false) or (f13_arg1._channelPanelBaseDatasource and f13_arg1._channelPanelBaseDatasource:GetValue( f13_arg1._controllerIndex ) or false) or LUI.FlowManager.IsFlyInPopupMenuOnTop() then
		LUI.TalkersLayer.SetHorizontalPosition( f13_arg1, f0_local0.MIDDLE )
	else
		LUI.TalkersLayer.SetHorizontalPosition( f13_arg1, f0_local0.RIGHT )
	end
end

LUI.TalkersLayer.init = function ( f12_arg0, f12_arg1 )
	LUI.UIElement.init( f12_arg0 )
	f12_arg0.id = "TalkersLayer"
	local f12_local0
	if not f12_arg1 then
		f12_local0 = f12_arg1
	else
		f12_local0 = Engine[0x45B054C920178E9]()
	end
	f12_arg0._controllerIndex = f12_local0
	f12_arg0._visible = true
end

LUI.TalkersLayer.InitLayer = function ( f11_arg0 )
	f11_arg0.talkersLayout = MenuBuilder.BuildRegisteredType( "TalkersLayout", {
		controllerIndex = f11_arg0._controllerIndex
	} )
	LUI.TalkersLayer.SetHorizontalPosition( f11_arg0, f0_local0.RIGHT )
	LUI.TalkersLayer.SetVerticalPosition( f11_arg0, f0_local0.MIDDLE )
	f11_arg0._globalPanelBaseDatasource = DataSources.alwaysLoaded.uri.menusOpened.GlobalPanelBase
	f11_arg0._globalPanelOptionsSearchOpenDatasource = DataSources.alwaysLoaded.uri.menusOpened.GlobalPanelOptionsSearch
	f11_arg0._channelPanelBaseDatasource = DataSources.alwaysLoaded.uri.menusOpened.ChannelPanelBase
	f11_arg0._menuOnTopDatasource = DataSources.alwaysLoaded.uri.menuOnTop
	if f11_arg0._menuOnTopDatasource then
		f11_arg0:SubscribeToModel( f11_arg0._menuOnTopDatasource:GetModel( f11_arg0._controllerIndex ), LUI.TalkersLayer.UpdatePosition )
	end
	f11_arg0:addElement( f11_arg0.talkersLayout )
end

LUI.TalkersLayer.ClearLayer = function ( f10_arg0, f10_arg1 )
	f10_arg0:closeChildren()
	f10_arg0.talkersLayout = nil
end

LUI.TalkersLayer.GetLayer = function ()
	local f9_local0 = Engine[0xEE6F69FEA944B13]()
	return f9_local0.talkersLayer
end

LUI.TalkersLayer.ShouldBeVisible = function ( f8_arg0 )
	if CONDITIONS.IsSingleplayer() or not CHANNELS.GetVoiceChatEnabledProfileData( f8_arg0._controllerIndex ) then
		return false
	elseif not f8_arg0._flowManager then
		local f8_local0 = Engine[0xEE6F69FEA944B13]()
		f8_arg0._flowManager = f8_local0.flowManager
	end
	local f8_local0 = false
	local f8_local1 = f8_arg0._flowManager:GetMenuStack()
	if 0 < f8_arg0._flowManager._menuStackCount then
		for f8_local2 = 1, f8_arg0._flowManager._menuStackCount, 1 do
			local f8_local5 = f8_local1[f8_local2].menu
			if f8_local5 and LUI.TalkersLayer.IsHiddenInMenu( f8_local5 ) then
				f8_local0 = true
				break
			end
		end
	end
	local f8_local2 = f8_arg0._visible
	if f8_local2 then
		f8_local2 = not f8_local0
	end
	return f8_local2
end

local f0_local2 = function ()
	local f7_local0 = LUI.FlowManager.GetMenuStack()
	if 0 < #f7_local0 then
		for f7_local1 = 1, #f7_local0, 1 do
			local f7_local4 = f7_local0[f7_local1].menu
			if f7_local4 and LUI.TalkersLayer.IsHiddenInMenu( f7_local4 ) then
				return true
			end
		end
	end
	return false
end

LUI.TalkersLayer.RegisterTalkerDisplayingMenu = function ( f6_arg0, f6_arg1, f6_arg2, f6_arg3 )
	local f6_local0 = LUI.TalkersLayer.GetLayer()
	if not f6_local0 then
		return 
	elseif not f6_local0._talkerDisplayingMenus then
		f6_local0._talkerDisplayingMenus = {}
	end
	if not f6_local0._talkerDisplayingMenus[f6_arg0] then
		f6_local0._talkerDisplayingMenus[f6_arg0] = {
			visibleFunction = f6_arg1,
			channelDisplayType = f6_arg2,
			channelId = f6_arg3
		}
	else
		f6_local0._talkerDisplayingMenus[f6_arg0].visibleFunction = f6_arg1
		f6_local0._talkerDisplayingMenus[f6_arg0].channelDisplayType = f6_arg2
		f6_local0._talkerDisplayingMenus[f6_arg0].channelId = f6_arg3
	end
end

local f0_local3 = function ( f5_arg0 )
	local f5_local0 = LUI.TalkersLayer.GetLayer()
	if not f5_local0 then
		return false
	elseif not f5_local0._talkerDisplayingMenus then
		return false
	end
	for f5_local5, f5_local6 in pairs( f5_local0._talkerDisplayingMenus ) do
		if f5_local6.visibleFunction( f5_local5 ) then
			if f5_local6.channelDisplayType == LUI.TalkersLayer.CHANNEL_DISPLAY_TYPE.CURRENT_VOICE then
				return true
			elseif f5_local6.channelDisplayType == LUI.TalkersLayer.CHANNEL_DISPLAY_TYPE.GAME_PARTY then
				if CHANNELS.IsConnectedToGameChannel( f5_arg0 ) then
					return true
				end
			end
			if f5_local6.channelDisplayType == LUI.TalkersLayer.CHANNEL_DISPLAY_TYPE.SPECIFIC_CHANNEL then
				local f5_local4 = Social[0xF12FC4AFD7A2A6D]( f5_arg0 )
				if CHANNELS.IsValidPartyID( f5_local4 ) and f5_local6.channelId == f5_local4 then
					return true
				end
			end
		end
		f5_local0._talkerDisplayingMenus[f5_local5] = nil
	end
	return false
end

LUI.TalkersLayer.ShouldBeVisible = function ( f4_arg0 )
	if CONDITIONS.IsSingleplayer() or not CHANNELS.GetVoiceChatEnabledProfileData( f4_arg0._controllerIndex ) then
		return false
	end
	local f4_local0 = f0_local0()
	local f4_local1 = f0_local0( f4_arg0._controllerIndex )
	local f4_local2 = f4_arg0._visible
	if f4_local2 then
		if not f4_local0 then
			f4_local2 = not f4_local1
		else
			f4_local2 = false
		end
	end
	return f4_local2
end

LUI.TalkersLayer.SetVisible = function ( f3_arg0 )
	local f3_local0 = LUI.TalkersLayer.GetLayer()
	if f3_local0 then
		f3_local0._visible = f3_arg0
	end
end

LUI.TalkersLayer.SetHiddenOnMenu = function ( f2_arg0 )
	if f2_arg0 then
		f2_arg0._talkersLayerHidden = true
	end
end

LUI.TalkersLayer.IsHiddenInMenu = function ( f1_arg0 )
	local f1_local0
	if f1_arg0 then
		f1_local0 = f1_arg0
	else
		f1_local0 = f1_arg0._talkersLayerHidden
	end
	return f1_local0
end

