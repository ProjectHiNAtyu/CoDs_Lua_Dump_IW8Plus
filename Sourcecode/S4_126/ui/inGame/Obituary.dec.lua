-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
local f0_local0 = 6
local f0_local1 = 5
local f0_local2 = 150
local f0_local3 = function ( f16_arg0, f16_arg1 )
	if f16_arg1.type == "kill" then
		f16_arg0._killMessagePool:DeallocateElement( f16_arg1 )
	elseif f16_arg1.type == "text" then
		f16_arg0._textMessagePool:DeallocateElement( f16_arg1 )
	elseif CONDITIONS.IsBRGameType( f16_arg0 ) and f16_arg1.type == "PingLoot" then
		f16_arg0._PingMessageLootPool:DeallocateElement( f16_arg1 )
	end
	f16_arg1:RemoveFromParent()
end

local f0_local4 = function ( f13_arg0, f13_arg1 )
	if not f13_arg0.invertFeedOrder then
		local f13_local0 = f13_arg0:getFirstChild()
		if f13_local0 then
			f13_local0:SetBottom( f13_arg1.height )
			f13_arg1:addElementBefore( f13_local0 )
		else
			f13_arg0:addElement( f13_arg1 )
		end
		f13_arg1:SetTop( 0 )
		f13_arg1:SetBottom( 0 )
		assert( f13_arg1.height )
		f13_arg1:SetBottom( f13_arg1.height, f0_local0, LUI.EASING.inOutQuadratic )
	else
		local f13_local0 = f13_arg0:getHeight()
		local f13_local1 = f13_arg0:getLastChild()
		if f13_local1 then
			f13_local1:SetTop( f13_local0 - f13_arg1.height )
			f13_arg1:addElementAfter( f13_local1 )
		else
			f13_arg0:addElement( f13_arg1 )
		end
		f13_arg1:SetTop( f13_local0 )
		f13_arg1:SetBottom( f13_local0 )
		assert( f13_arg1.height )
		f13_arg1:SetTop( f13_local0 - f13_arg1.height, f0_local0, LUI.EASING.inOutQuadratic )
	end
	f13_arg1:SetAlpha( 1 )
	if not IsCodcaster() then
		f13_arg1:SetAlpha( 0.5, 2000 )
	end
	local f13_local0 = 10000
	if IsCodcaster() then
		f13_local0 = Dvar[0x22EAAB59AA27E9B]( "#x314a1d1865bacbce7" )
	end
	local f13_local1 = f13_arg1:Wait( f13_local0, true )
	f13_local1.onComplete = function ()
		local f14_local0 = f13_arg0:SetAlpha( 0, 1000 )
		f14_local0.onComplete = function ()
			f14_local0( f14_local0, f14_local0 )
		end
		
	end
	
	if (CONDITIONS.IsArmsRaceGameType() and f0_local0 or f0_local0) < f13_arg0:getNumChildren() then
		
	else
		
	end
end

local f0_local5 = function ( f12_arg0, f12_arg1 )
	if f12_arg1.bold then
		return 
	else
		local f12_local0 = f12_arg0._textMessagePool:AllocateElement()
		f0_local0( f12_arg0, f12_local0 )
		f12_local0:Update( f12_arg1 )
	end
end

local f0_local6 = function ( f11_arg0, f11_arg1 )
	local f11_local0 = f11_arg0._killMessagePool:AllocateElement()
	f0_local0( f11_arg0, f11_local0 )
	f11_local0:Update( f11_arg1 )
end

local f0_local7 = function ( f6_arg0, f6_arg1 )
	local f6_local0 = function ( f10_arg0, f10_arg1 )
		local f10_local0 = f10_arg0._PingMessageLootPool:AllocateElement()
		f6_arg0( f10_arg0, f10_local0 )
		f10_local0:Update( f10_arg1 )
	end
	
	local f6_local1 = function ( f9_arg0, f9_arg1 )
		local f9_local0 = f9_arg1.value
		local f9_local1 = BitwiseOperators.band( f9_local0, 15 )
		f9_local0 = BitwiseOperators.rshift( f9_local0, 4 )
		f6_arg0( f9_arg0, {
			state = f9_local1,
			param1 = BitwiseOperators.band( f9_local0, 255 ),
			param2 = BitwiseOperators.band( BitwiseOperators.rshift( f9_local0, 8 ), 1048575 ),
			string = f9_arg1.string,
			icon = f9_arg1.icon
		} )
	end
	
	local f6_local2 = function ( f8_arg0, f8_arg1 )
		f6_arg0( f8_arg0, {
			state = f8_arg1.messageType,
			param1 = f8_arg1.client,
			param2 = f8_arg1.messageParam,
			ownerClientNum = f8_arg1.owner,
			string = f8_arg1.string,
			icon = f8_arg1.icon
		} )
	end
	
	local f6_local3 = function ( f7_arg0, f7_arg1 )
		if f7_arg1.value == 0 then
			return 
		else
			f6_arg0( f7_arg0, f7_arg1 )
		end
	end
	
	f6_arg0:registerEventHandler( "br_squad_message", f6_local1 )
	f6_arg0:registerEventHandler( "br_ping_ack", f6_local2 )
	f6_arg0:registerOmnvarHandler( "ui_br_expanded_obit_message", f6_local3 )
end

local f0_local8 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.invertFeedOrder = false
	f2_arg0._killMessagePool = LUI.LUIElementPool.new( {
		maxPoolSize = 5,
		initialPoolSize = 5,
		buildElement = function ()
			local f5_local0
			if IsCodcaster() then
				f5_local0 = "CodCasterObituaryKill"
			else
				f5_local0 = "ObituaryKill"
			end
			local f5_local1 = MenuBuilder.BuildRegisteredType( f5_local0, {
				controllerIndex = f2_arg0
			} )
			local f5_local2, f5_local3, f5_local4, f5_local5 = f5_local1:getLocalRect()
			f5_local1.height = f5_local5 - f5_local3
			f5_local1.type = "kill"
			assert( 0 < f5_local1.height )
			return f5_local1
		end
	} )
	f2_arg0._textMessagePool = LUI.LUIElementPool.new( {
		maxPoolSize = 2,
		initialPoolSize = 2,
		buildElement = function ()
			local f4_local0 = MenuBuilder.BuildRegisteredType( "ObituaryMessage", {
				controllerIndex = f2_arg0
			} )
			local f4_local1, f4_local2, f4_local3, f4_local4 = f4_local0:getLocalRect()
			f4_local0.height = f4_local4 - f4_local2
			f4_local0.type = "text"
			assert( 0 < f4_local0.height )
			return f4_local0
		end
	} )
	if CONDITIONS.IsBRGameType( f2_arg0 ) then
		local f2_local0
		if 4 <= (Dvar[0x22EAAB59AA27E9B]( "#x36c4921a3177c4f06" ) or 0) then
			f2_local0 = 3
		else
			f2_local0 = 5
		end
		f0_local0 = f2_local0
		f2_arg0._PingMessageLootPool = LUI.LUIElementPool.new( {
			maxPoolSize = 5,
			initialPoolSize = 5,
			buildElement = function ()
				local f3_local0 = MenuBuilder.BuildRegisteredType( "SquadMessage", {
					controllerIndex = f2_arg0
				} )
				local f3_local1, f3_local2, f3_local3, f3_local4 = f3_local0:getLocalRect()
				f3_local0.height = f3_local4 - f3_local2
				f3_local0.type = "PingLoot"
				assert( 0 < f3_local0.height )
				return f3_local0
			end
		} )
		f0_local0( f2_arg0, f2_arg1 )
	end
	f2_arg0:registerEventHandler( "obituary", f0_local0 )
	if not IsCodcaster() then
		f2_arg0:registerEventHandler( "game_message", f0_local0 )
	else
		f2_arg0.invertFeedOrder = true
	end
	if f2_arg0.invertFeedOrder then
		f2_arg0:SetVerticalAlignment( LUI.Alignment.Bottom )
	end
end

function Obituary( menu, controller )
	local self = LUI.UIVerticalStackedLayout.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 600 * _1080p, 0, 200 * _1080p )
	self.id = "Obituary"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	self:setUseStencil( true )
	self:SetSpacing( 6 * _1080p )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "Obituary", Obituary )
LockTable( _M )
