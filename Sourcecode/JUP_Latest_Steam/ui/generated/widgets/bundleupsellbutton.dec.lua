-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
require( "ui.generated.widgets.bundleupselltype" )
require( "ui.generated.widgets.store.storetagsale" )
local f0_local0 = 0x2EA8180311F4199
local f0_local1 = function ( f40_arg0 )
	local f40_local0 = f40_arg0._canShow
	if f40_local0 then
		f40_local0 = f40_arg0._storeReady
		if f40_local0 then
			f40_local0 = not f40_arg0._isUnlocked
		end
	end
	return f40_local0
end

local f0_local2 = function ( f39_arg0 )
	f39_arg0._canShow = false
	f39_arg0:SetVisible( f0_local0( f39_arg0 ) )
	f39_arg0:SetMouseFocusBlocker( not f0_local0( f39_arg0 ) )
end

local f0_local3 = function ( f38_arg0, f38_arg1 )
	f38_arg0._label = f38_arg1
end

local f0_local4 = function ( f37_arg0 )
	if f37_arg0._label then
		f37_arg0.ViewBundleLabel:setText( UNLOCK_CRITERIA.GetPromptWithText( f37_arg0._unlockActionButtonID, Engine[0xED84C33EC5F01EA]( f37_arg0._label ) ) )
		f37_arg0._label = nil
	elseif f37_arg0._isBattlePassRedirect then
		f37_arg0.ViewBundleLabel:setText( UNLOCK_CRITERIA.GetPromptWithText( f37_arg0._unlockActionButtonID, Engine[0xED84C33EC5F01EA]( 0xD8EF460B8E47825 ) ) )
	elseif f37_arg0._isDirectPurchase then
		f37_arg0.ViewBundleLabel:setText( UNLOCK_CRITERIA.GetPromptWithText( f37_arg0._unlockActionButtonID, Engine[0xED84C33EC5F01EA]( 0x80C7B4A09F274B3 ) ) )
	else
		f37_arg0.ViewBundleLabel:setText( UNLOCK_CRITERIA.GetPromptWithText( f37_arg0._unlockActionButtonID, Engine[0xED84C33EC5F01EA]( 0xC5039C1061CBDE7 ) ) )
	end
end

local f0_local5 = function ( f36_arg0 )
	f36_arg0._canShow = true
	f0_local0( f36_arg0 )
	f36_arg0:SetVisible( f0_local0( f36_arg0 ) )
	f36_arg0:SetMouseFocusBlocker( not f0_local0( f36_arg0 ) )
end

local f0_local6 = function ( f35_arg0, f35_arg1, f35_arg2, f35_arg3 )
	f35_arg0._bundle = f35_arg2
	if f35_arg2 then
		WEAPON.StreamStoreBundleWeapons( f35_arg2, f35_arg1 )
		if f35_arg0.DiscountPercentText then
			local f35_local0 = STORE.Bundles.IsDiscounted( f35_arg2 )
			f35_arg0.DiscountPercentText:SetVisible( f35_local0 )
			if f35_local0 then
				f35_arg0.DiscountPercentText.Text:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( 0x80B52A25515CD0B, STORE.Bundles.DiscountedPercentageString( f35_arg1, f35_arg2 ) ) ) )
			end
		end
		local f35_local0 = f35_arg0.BundleType
		local f35_local1 = f35_local0
		f35_local0 = f35_local0.UpdateType
		local f35_local2
		if not f35_arg3 then
			f35_local2 = f35_arg3
		else
			f35_local2 = STORE.Bundles.GetName( f35_arg2 )
		end
		f35_local0( f35_local1, f35_local2 )
		f35_arg0.BundleType:SetTextAlignment( LUI.Alignment.Left )
		f35_arg0.BundleImage:setImage( RegisterMaterial( f35_arg0._isBattlePassBundle and f0_local0 or STORE.Bundles.GetBackgroundImage( f35_arg2 ) ) )
		f0_local0( f35_arg0 )
	else
		f35_arg0:HideButton()
	end
end

local f0_local7 = function ( f34_arg0, f34_arg1 )
	if f34_arg0._isBattlePassRedirect then
		f34_arg0.BundleType:UpdateType( 0x5F0123BD4A835B2 )
		f34_arg0.BundleType:SetTextAlignment( LUI.Alignment.Left )
		f0_local0( f34_arg0 )
	else
		f34_arg0:HideButton()
	end
end

local f0_local8 = function ( f32_arg0, f32_arg1, f32_arg2 )
	if Dvar[0x9E5BE3B4BBA4E0E]( 0xBBF84FBDC361CAF ) and CONDITIONS.IsUserSignedInDemonware( f32_arg1 ) then
		f32_arg0._lootID = f32_arg2
		f32_arg0._isUnlocked = ITEM_UTILS.IsUnlockedWithID( f32_arg1, f32_arg2 )
		f32_arg0._isBattlePassBundle = false
		local f32_local0 = STORE.Bundles.GetFirstBundleWithLootId( f32_arg1, f32_arg2 )
		if f32_local0 then
			f0_local0( f32_arg0, f32_arg1, f32_local0 )
		end
		local f32_local1 = function ( f33_arg0 )
			local f33_local0, f33_local1 = nil
			if BATTLEMAP.IsRewardBlackCellExclusive( f32_arg0, f33_arg0, BATTLEMAP.LootIdToSectorIndex[f32_arg0], f32_arg0 ) then
				f33_local0 = STORE.UI.GetBlackCellBundle( f32_arg0 )
			else
				local f33_local2 = BATTLEPASS.GetBattlepassIDBundleForRef( BATTLEPASS.GetPurchaseRef() )
				if not Table.IsNilOrEmpty( f33_local2 ) then
					f33_local1 = Engine[0xED84C33EC5F01EA]( 0xBCA4AA91AEF522C )
					if f33_local2[0xF4F13D3AC438B16] == BATTLEPASS.ITEM_TYPES.PASS then
						f33_local0 = STORE.UI.GetBlackCellBundle( f32_arg0 )
						f32_arg0._isBattlePassBundle = true
					end
				end
			end
			if f33_local0 then
				f32_arg0( f32_arg0, 0xC5039C1061CBDE7 )
				f32_arg0( f32_arg0, f32_arg0, f33_local0, f33_local1 )
				return true
			else
				return false
			end
		end
		
		local f32_local2 = SEASON.GetCurrentSeason()
		if BATTLEMAP.IsReward( f32_arg2 ) and not BATTLEPASS.IsOwned( f32_arg1, f32_local2 ) then
			if not f32_local1( f32_local2 ) then
				f32_arg0:HideButton()
			end
			return 
		end
		local f32_local3 = BATTLEPASS.GetUnownedBlackCellLootSeason( f32_arg1, f32_arg2 )
		if f32_local3 and f32_local3 == f32_local2 then
			if not f32_local1( f32_local2 ) then
				f32_arg0:HideButton()
			end
			return 
		end
	end
	f32_arg0:HideButton()
end

local f0_local9 = function ( f31_arg0, f31_arg1 )
	f31_arg0._preOpenBundleCallbackFunc = f31_arg1
end

local f0_local10 = function ( f30_arg0, f30_arg1 )
	f30_arg0._isDirectPurchase = f30_arg1
end

local f0_local11 = function ( f29_arg0, f29_arg1 )
	f29_arg0._optionalDisableOpenBundlePreview = f29_arg1
end

local f0_local12 = function ( f28_arg0, f28_arg1, f28_arg2 )
	if f28_arg0:IsVisible() then
		if f28_arg0._preOpenBundleCallbackFunc then
			f28_arg0._preOpenBundleCallbackFunc()
		end
		if f28_arg0._optionalDisableOpenBundlePreview then
			return 
		elseif f28_arg0._isBattlePassRedirect then
			
		elseif f28_arg0._bundle == STORE.UI.GetBlackCellBundle( f28_arg1 ) then
			QUARTERMASTER.RecordEnterDirectPurchase( f28_arg1, f28_arg0._bundle )
			local f28_local0 = LUI.FlowManager.RequestAddMenu
			local f28_local1
			if BATTLEMAP.UseJUPBattleMapDesign() then
				f28_local1 = "JupBattlePassPurchasePopup"
			else
				f28_local1 = "BattlePassPurchasePopup"
			end
			f28_local0( f28_local1, true, f28_arg1, false, {
				fromStore = false,
				fromBundleUpsell = true
			}, true )
		elseif f28_arg0._bundle then
			QUARTERMASTER.RecordEnterDirectPurchase( f28_arg1, f28_arg0._bundle )
			if CONDITIONS.IsMiniStoreBundleUpsellEnabled() then
				MINI_STORE.OpenBundlePreview( f28_arg1, f28_arg0._bundle, false, true )
			else
				STORE.OpenProductPreviewMenu( f28_arg1, f28_arg0._bundle, false, f28_arg2 )
			end
		end
	end
end

local f0_local13 = function ( f24_arg0, f24_arg1 )
	f24_arg0:AddGamepadEventCallback( f24_arg0._unlockActionButtonID, function ( f27_arg0, f27_arg1 )
		if f24_arg0:IsVisible() then
			if not UNLOCK_CRITERIA.LockRedirectToUnlockSource( f24_arg0 ) then
				return 
			end
			f27_arg0:OpenBundle( f27_arg1.controllerIndex or f24_arg0, f27_arg0._isDirectPurchase )
		end
	end )
	f24_arg0:addEventHandler( "button_action", function ( f26_arg0, f26_arg1 )
		f26_arg0:OpenBundle( f26_arg1.controllerIndex or f24_arg0, f26_arg0._isDirectPurchase )
	end )
	f24_arg0:SubscribeToInputTypeModel( f24_arg1, function ( f25_arg0, f25_arg1 )
		if CONDITIONS.IsKbm( f25_arg1._controllerIndex ) then
			f25_arg1:SetFocusable( true )
		else
			f25_arg1:SetFocusable( false )
			f25_arg1:processEvent( {
				name = "lose_focus"
			} )
		end
	end )
end

local f0_local14 = function ( f18_arg0, f18_arg1, f18_arg2 )
	f18_arg0.SetupBundleWithData = f0_local0
	f18_arg0.SetupUpsellButtonWithLootID = f0_local0
	f18_arg0.SetPreOpenBundleCallbackFunc = f0_local0
	f18_arg0.HideButton = f0_local0
	f18_arg0.OpenBundle = f0_local0
	f18_arg0.AssignBundleLabel = f0_local0
	f18_arg0.EnableDirectPurchase = f0_local0
	f18_arg0.SetDisableOpenBundlePreview = f0_local0
	f18_arg0._bundle = {}
	f18_arg0._isBattlePassRedirect = false
	f18_arg0._lootID = nil
	f18_arg0._storeReady = false
	f18_arg0._controllerIndex = f18_arg1
	f18_arg0.m_requireFocusType = FocusType.MouseOver
	f18_arg0._unlockActionButtonID = UNLOCK_CRITERIA.GetUnlockActionButtonID( f18_arg1 )
	f0_local0( f18_arg0, f18_arg1 )
	f18_arg0:HideButton()
	if not f18_arg0._fenceAttached then
		LUI.DeferredFence.Attach( f18_arg0, f18_arg1, "STORE", LUI.DeferredFence.Criticality.LOW, LUI.DeferredFence.BackOutMethod.NONE, function ( f20_arg0, f20_arg1 )
			if f20_arg1.fenceState ~= LUI.Fence.FenceObjectState.PASSING then
				
			else
				
			end
			local f20_local0 = function ( f23_arg0, f23_arg1 )
				if f20_arg0( f23_arg1 ) then
					f20_arg0( f23_arg1 )
				elseif f23_arg1._lootID then
					f23_arg1:SetupUpsellButtonWithLootID( f23_arg0, f23_arg1._lootID )
				else
					f20_arg0( f23_arg1 )
				end
			end
			
			STORE.AsyncFetchCatalogue( f18_arg0, f18_arg0, {
				useCache = true,
				showEmptyStoreDialog = true,
				onFetchSuccess = function ( f22_arg0 )
					f22_arg0._storeReady = true
					f20_arg0( f20_arg0, f22_arg0 )
				end,
				onFetchError = function ( f21_arg0, f21_arg1 )
					f21_arg0._storeReady = true
					f20_arg0( f20_arg0, f21_arg0 )
				end
			} )
		end )
		f18_arg0._fenceAttached = true
	end
	if IsLanguageGerman() then
		ACTIONS.AnimateSequence( f18_arg0, "DE" )
	end
	local f18_local0
	if f18_arg2 then
		f18_local0 = f18_arg2.dataContext
		if not f18_local0 then
		
		else
			if f18_local0 then
				f18_arg0:SubscribeToModel( f18_local0:GetModel( f18_arg1 ), function ( f19_arg0 )
					local f19_local0 = f18_arg0:GetValue( f18_arg0 )
					if type( f19_local0 ) == "number" then
						f18_arg0:SetupUpsellButtonWithLootID( f18_arg0, f19_local0 )
					elseif type( f19_local0 ) == "table" then
						f18_arg0:SetupBundleWithData( f18_arg0, f19_local0 )
					end
				end )
			end
		end
	end
	f18_local0 = nil
end

States = {
	[0xAD14C6E7156B923] = function ( f9_arg0, f9_arg1 )
		local f9_local0 = function ( f17_arg0, f17_arg1 )
			
		end
		
		f9_arg0[0x3D2CAC33220AA82]:RegisterAnimationSequence( 0x622F81FDFFA8D73, {
			nil,
			nil,
			nil,
			200,
			[1] = TWEEN_PROPERTY.RGB,
			[2] = SWATCHES[0xEAF2060ABE5269B][0x64467864DDD0654]
		} )
		local f9_local1 = function ( f16_arg0, f16_arg1 )
			f16_arg0[0x3D2CAC33220AA82]:AnimateSequence( 0x622F81FDFFA8D73 )
		end
		
		f9_arg0[0x3D2CAC33220AA82]:RegisterAnimationSequence( 0x4E5BBD657F95C74, {
			nil,
			nil,
			nil,
			200,
			[1] = TWEEN_PROPERTY.RGB,
			[2] = SWATCHES[0x3BA59C00BAB023A][0x73CFD4C7E22B766]
		} )
		local f9_local2 = function ( f15_arg0, f15_arg1 )
			f15_arg0[0x3D2CAC33220AA82]:AnimateSequence( 0x4E5BBD657F95C74 )
		end
		
		local f9_local3 = function ( f14_arg0, f14_arg1 )
			
		end
		
		local f9_local4 = function ( f13_arg0, f13_arg1 )
			
		end
		
		local f9_local5 = function ( f12_arg0, f12_arg1 )
			
		end
		
		f9_arg0[0xD5BC1226A78C2CE]:RegisterAnimationSequence( 0x4B5EB7823313FFE, {
			nil,
			nil,
			0,
			0,
			[1] = TWEEN_PROPERTY.Alpha
		} )
		local f9_local6 = function ( f11_arg0, f11_arg1 )
			f11_arg0[0xD5BC1226A78C2CE]:AnimateSequence( 0x4B5EB7823313FFE )
		end
		
		f9_arg0[0xD5BC1226A78C2CE]:RegisterAnimationSequence( 0x8915307B53BAA62, {
			nil,
			nil,
			nil,
			0,
			nil,
			4294967295,
			0,
			[1] = TWEEN_PROPERTY.Text_Size,
			[2] = 16 * _PT,
			[4] = TWEEN_PROPERTY.Tracking
		} )
		f9_arg0[0x49D85F0EF1CEC84] = {
			[0xEF6C3AB55C07BEF] = f9_local0,
			[0x622F81FDFFA8D73] = f9_local1,
			[0x4E5BBD657F95C74] = f9_local2,
			[0xB5FCD8BDE3CD7A5] = f9_local3,
			[0x5FAC1B3BA8D32D2] = f9_local4,
			[0x175528D4DBD72C4] = f9_local5,
			[0x4B5EB7823313FFE] = f9_local6,
			[0x8915307B53BAA62] = function ( f10_arg0, f10_arg1 )
				f10_arg0[0xD5BC1226A78C2CE]:AnimateSequence( 0x8915307B53BAA62 )
				f10_arg0[0xD5BC1226A78C2CE]:SetMinFontSize( 16 * _PT )
			end
		}
		f9_arg0[0xD97E59A206E4A54] = {
			[0xB5FCD8BDE3CD7A5] = 0,
			[0x5FAC1B3BA8D32D2] = 0,
			[0x4E5BBD657F95C74] = 200,
			[0x175528D4DBD72C4] = 0,
			[0x622F81FDFFA8D73] = 200,
			[0x4B5EB7823313FFE] = 0,
			[0x8915307B53BAA62] = 0,
			[0xEF6C3AB55C07BEF] = 0
		}
	end,
	[0x5FAC1B3BA8D32D2] = function ( f4_arg0, f4_arg1 )
		local f4_local0 = function ( f8_arg0, f8_arg1 )
			
		end
		
		f4_arg0[0x3D2CAC33220AA82]:RegisterAnimationSequence( 0x622F81FDFFA8D73, {
			nil,
			nil,
			nil,
			200,
			[1] = TWEEN_PROPERTY.RGB,
			[2] = SWATCHES[0xEAF2060ABE5269B][0x64467864DDD0654]
		} )
		local f4_local1 = function ( f7_arg0, f7_arg1 )
			f7_arg0[0x3D2CAC33220AA82]:AnimateSequence( 0x622F81FDFFA8D73 )
		end
		
		f4_arg0[0x3D2CAC33220AA82]:RegisterAnimationSequence( 0x4E5BBD657F95C74, {
			nil,
			nil,
			nil,
			200,
			[1] = TWEEN_PROPERTY.RGB,
			[2] = SWATCHES[0x3BA59C00BAB023A][0x73CFD4C7E22B766]
		} )
		local f4_local2 = function ( f6_arg0, f6_arg1 )
			f6_arg0[0x3D2CAC33220AA82]:AnimateSequence( 0x4E5BBD657F95C74 )
		end
		
		f4_arg0[0x9CA75A371F265ED]:RegisterAnimationSequence( 0xB5FCD8BDE3CD7A5, {
			nil,
			nil,
			5.33653885E-315,
			0,
			nil,
			5.334980606E-315,
			0,
			nil,
			5.334980606E-315,
			200,
			[1] = TWEEN_PROPERTY.Bottom,
			[4] = TWEEN_PROPERTY.Top,
			[7] = TWEEN_PROPERTY.Bottom
		} )
		f4_arg0[0x49D85F0EF1CEC84] = {
			[0xEF6C3AB55C07BEF] = f4_local0,
			[0x622F81FDFFA8D73] = f4_local1,
			[0x4E5BBD657F95C74] = f4_local2,
			[0xB5FCD8BDE3CD7A5] = function ( f5_arg0, f5_arg1 )
				f5_arg0[0x9CA75A371F265ED]:AnimateSequence( 0xB5FCD8BDE3CD7A5 )
			end
		}
		f4_arg0[0xD97E59A206E4A54] = {
			[0x622F81FDFFA8D73] = 200,
			[0xB5FCD8BDE3CD7A5] = 200,
			[0x4E5BBD657F95C74] = 200,
			[0xEF6C3AB55C07BEF] = 0
		}
	end
}
function BundleUpsellButton( f1_arg0, f1_arg1 )
	local f1_local0 = ACTIONS
	local f1_local1 = LUI
	local f1_local2 = MenuBuilder
	local f1_local3 = TWEEN_PROPERTY
	local f1_local4 = f1_local1.UIButton.new()
	f1_local4:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 351, 0, 147 )
	f1_local4.id = "BundleUpsellButton"
	f1_local4[0xBD5D934D3CD91E5] = States
	local f1_local5
	if f1_arg1 then
		f1_local5 = f1_arg1
	else
		f1_local5 = f1_arg1.controllerIndex
	end
	f1_local5 = f1_local1.ValidateControllerIndex( f1_local4, f1_local5 )
	local f1_local6 = nil
	f1_local6 = f1_local1.UIImage.new()
	f1_local6[0x8B72E07B55C3AC0] = "Mask"
	f1_local6:SetAnchorsAndPosition( 0, 1, 0, 1, 4, 346, 4, 139 )
	f1_local4:addElement( f1_local6 )
	f1_local4[0xF375FA2CE7B1849] = f1_local6
	local f1_local7 = nil
	f1_local7 = f1_local1.UIImage.new()
	f1_local7[0x8B72E07B55C3AC0] = "BackgroundImage"
	f1_local7:SetRGB( SWATCHES[0x2B125210C0B2BB1][0x85BDB34EB15445F], 0 )
	f1_local7:setImage( RegisterMaterial( 0x2621A5AB6CAE293 ), 0 )
	f1_local7:Setup9SliceImage( 8, 8, 0.25, 0.25 )
	f1_local7:SetAnchorsAndPosition( 0, 1, 0, 1, 3, 347, 3, 140 )
	f1_local4:addElement( f1_local7 )
	f1_local4[0x3D2CAC33220AA82] = f1_local7
	local f1_local8 = nil
	f1_local8 = f1_local1.UIImage.new()
	f1_local8[0x8B72E07B55C3AC0] = "BundleImage"
	f1_local8:SetScale( 0, 0 )
	f1_local8:setImage( RegisterMaterial( 0x7F3F9EF24126DDA ), 0 )
	f1_local8:SetMask( f1_local4[0xF375FA2CE7B1849] )
	f1_local8:setUseStencil( true )
	f1_local8:SetAnchorsAndPosition( 0, 1, 0, 1, 4, 346, 4, 197 )
	f1_local4:addElement( f1_local8 )
	f1_local4[0x7C5C54E8E516C5A] = f1_local8
	local f1_local9 = nil
	f1_local9 = f1_local2.BuildRegisteredType( 0xC7037232B0F56F4, {
		controllerIndex = f1_local5
	} )
	f1_local9[0x8B72E07B55C3AC0] = "BundleType"
	f1_local9:SetAnchorsAndPosition( 0, 1, 0, 1, 4, 346, 109, 139 )
	f1_local4:addElement( f1_local9 )
	f1_local4[0x9CA75A371F265ED] = f1_local9
	local f1_local10 = nil
	f1_local10 = f1_local1.UIText.new()
	f1_local10[0x8B72E07B55C3AC0] = "ViewBundleLabel"
	f1_local10:SetRGB( SWATCHES[0x2B125210C0B2BB1][0xF5C0139BA6F896C], 0 )
	f1_local10:setText( Engine[0xED84C33EC5F01EA]( 0xCA4644856E4CF60 ), 0 )
	f1_local10:setCaseStyle( f1_local1.CaseStyle.Uppercase )
	f1_local10:SetFont( FONTS.GetFont( FONTS.SecondaryRegular.File ) )
	f1_local10:SetFontSize( 18 * _PT )
	f1_local10:SetMinFontSize( 18 * _PT )
	f1_local10:SetWordWrap( true )
	f1_local10:SetAlignment( f1_local1.Alignment.Center )
	f1_local10:SetVerticalAlignment( f1_local1.Alignment.Middle )
	f1_local10:SetTintFontIcons( true )
	f1_local10:SetAnchorsAndPosition( 0, 0, 0, 1, 162.5, 27.5, 110, 139 )
	f1_local4:addElement( f1_local10 )
	f1_local4[0xD5BC1226A78C2CE] = f1_local10
	local f1_local11 = nil
	f1_local11 = f1_local2.BuildRegisteredType( 0xD707AEFC7D99A6D, {
		controllerIndex = f1_local5
	} )
	f1_local11[0x8B72E07B55C3AC0] = "DiscountPercentText"
	f1_local11:SetAnchorsAndPosition( 1, 0, 0, 1, -112, -4, 2, 34 )
	f1_local4:addElement( f1_local11 )
	f1_local4[0x98E42B55754C470] = f1_local11
	f1_local4:addEventHandler( 0x1573F49A6333A48, function ( f3_arg0, f3_arg1 )
		local f3_local0 = f3_arg1.controller or f1_arg0
		f1_arg0.AnimateSequence( f3_arg0, "ButtonOver" )
	end )
	f1_local4:addEventHandler( 0x872FD384B8E9347, function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or f1_arg0
		f1_arg0.AnimateSequence( f2_arg0, "ButtonUp" )
	end )
	f0_local0( f1_local4, f1_local5, f1_arg1 )
	return f1_local4
end

MenuBuilder.registerType( 0x51AD7B779BDD318, BundleUpsellButton )
LockTable( _M )
