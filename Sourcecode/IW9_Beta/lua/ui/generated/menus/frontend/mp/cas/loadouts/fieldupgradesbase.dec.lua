-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
if Engine[0x12586A3F4FB490E]() then
	LUI.FlowManager.RegisterFenceGroup( "FieldUpgrades", {
		nil,
		"StatsGroup"
	} )
end
local f0_local0 = 150
local f0_local1 = f0_local0 + 50
local f0_local2 = 64
local f0_local3 = function ( f43_arg0 )
	local f43_local0 = f43_arg0.upgrades[SUPER.Slot.LEFT]
	f43_arg0.upgrades[SUPER.Slot.LEFT] = f43_arg0.upgrades[SUPER.Slot.RIGHT]
	f43_arg0.upgrades[SUPER.Slot.RIGHT] = f43_local0
end

local f0_local4 = function ( f42_arg0, f42_arg1 )
	for f42_local3, f42_local4 in pairs( f42_arg0.upgrades ) do
		if f42_local4.ref == f42_arg1 then
			return f42_local4.isActive
		end
	end
	return false
end

local f0_local5 = function ( f41_arg0, f41_arg1 )
	local f41_local0 = false
	local f41_local1 = false
	for f41_local5, f41_local6 in ipairs( f41_arg0.upgrades ) do
		if f41_arg1 == f41_local6.ref then
			f41_local0 = true
			if f41_local6.isActive then
				f41_local1 = true
				break
			end
		end
	end
	return f41_local0, f41_local1
end

local f0_local6 = function ( f40_arg0, f40_arg1, f40_arg2 )
	for f40_local3, f40_local4 in ipairs( f40_arg0.upgrades ) do
		if f40_arg1 == f40_local4.ref then
			f40_local4.isActive = f40_arg2
			break
		end
	end
end

local f0_local7 = function ( f39_arg0 )
	if not f39_arg0.upgrades[SUPER.Slot.LEFT].isActive then
		return SUPER.Slot.LEFT
	elseif not f39_arg0.upgrades[SUPER.Slot.RIGHT].isActive then
		return SUPER.Slot.RIGHT
	else
		
	end
end

local f0_local8 = function ( f38_arg0, f38_arg1, f38_arg2 )
	local f38_local0 = ONBOARDING_DATA.GetOnboardingProFieldUpgradeData()
	local f38_local1
	if f38_arg2 then
		f38_local1 = 0
	else
		f38_local1 = f38_local0.waitTime
	end
	f38_local0.waitTime = f38_local1
	LUI.FlowManager.RequestPopupMenu( f38_arg0, "onboardingfeaturepopup", true, f38_arg1, false, f38_local0 )
end

local f0_local9 = function ( f37_arg0 )
	local f37_local0 = f37_arg0._currentRef
	f37_arg0.Grid:RefreshContent()
	if Engine[0x12586A3F4FB490E]() and not Onboarding.FieldUpgrade.WasCompleted( f37_arg0, f37_arg0._controllerIndex ) then
		LUI.FlowManager.RequestPopupMenu( f37_arg0, "onboardingpopup", true, f37_arg0._controllerIndex, false, ONBOARDING_DATA.GetOnboardingFieldUpgradeData() )
		Onboarding.FieldUpgrade.MarkCompleted( f37_arg0, f37_arg0._controllerIndex )
	end
end

local f0_local10 = function ( f36_arg0, f36_arg1, f36_arg2, f36_arg3, f36_arg4 )
	local f36_local0 = {
		displayTime = 2000,
		icon = f36_arg2,
		header = f36_arg3
	}
	local f36_local1
	if f36_arg4 then
		f36_local1 = Engine[0xED84C33EC5F01EA]( f36_arg4 )
		if not f36_local1 then
		
		else
			f36_local0.description = f36_local1
			f36_local0.type = LUI.ToastManager.NotificationType.FieldUpgradeMenu
			f36_local0.controllerIndex = f36_arg1
			f36_arg0:dispatchEventToRoot( {
				name = "send_toast_notification",
				immediate = true,
				options = f36_local0
			} )
		end
	end
	f36_local1 = nil
end

local f0_local11 = function ( f35_arg0, f35_arg1 )
	if f35_arg0.upgrades[SUPER.Slot.LEFT].ref == Cac.superNoneValue then
		f0_local0( f35_arg0 )
	end
	if not CoD.IsDMZMatch() then
		assert( f35_arg0.upgrades[SUPER.Slot.LEFT].ref ~= Cac.superNoneValue )
	end
	f35_arg0._loadoutData.fieldUpgrades[0]:set( f35_arg0.upgrades[SUPER.Slot.LEFT].ref )
	f35_arg0._loadoutData.fieldUpgrades[1]:set( f35_arg0.upgrades[SUPER.Slot.RIGHT].ref )
	ACTIONS.UploadStats( f35_arg0, f35_arg1 )
	local f35_local0 = LUI.DataSourceInControllerModel.new( "cg.players.selectedLoadout" )
	if not Engine[0x12586A3F4FB490E]() and f35_local0:GetValue( f35_arg1 ) then
		Engine[0x6055C55456F05DF]( "class_edit", f35_local0:GetValue( f35_arg1 ) )
	end
end

local f0_local12 = function ( f33_arg0, f33_arg1, f33_arg2 )
	local f33_local0, f33_local1 = f0_local0( f33_arg0, f33_arg0._currentRef )
	local f33_local2 = function ( f34_arg0 )
		f33_arg0.upgrades[f34_arg0].ref = f33_arg0
		f33_arg0.upgrades[f34_arg0].isActive = true
		f33_arg0.upgrades[f34_arg0].button = f33_arg0
		f33_arg0( f33_arg0, f33_arg0, SUPER.GetImage( f33_arg0 ), Engine[0xED84C33EC5F01EA]( 0xA6801A3F9D49BD6 ), SUPER.GetNameUnlocalized( f33_arg0 ) )
		local f34_local0 = nil
		if f34_arg0 == SUPER.Slot.LEFT then
			f34_local0 = f33_arg0.FieldUpgrade1
		else
			f34_local0 = f33_arg0.FieldUpgrade2
			f33_arg0.FieldUpgrade2:SetEmpty( false )
		end
		f34_local0:SetImage( SUPER.GetImage( f33_arg0 ) )
		f34_local0:SetHeaderText( SUPER.GetName( f33_arg0 ) )
		ACTIONS.AnimateSequence( f33_arg0, "HideGrid" )
		ACTIONS.AnimateSequence( f33_arg0, "AllFUFocused" )
		f33_arg0.Grid:processEvent( {
			name = "lose_focus"
		} )
		f34_local0:processEvent( {
			name = "gain_focus"
		} )
		f33_arg0.Grid:SetMouseFocusBlocker( true )
		f33_arg0._gridOpen = false
	end
	
	f33_local2( f33_arg0._slotInUse )
	f33_local2 = LUI.FlowManager.GetScopedData( f33_arg0 )
	if CoD.IsDMZMatch() or f33_local2.openedFromScriptRequest and f33_arg0.proMode ~= SUPER.ProMode.ENABLED then
		ACTIONS.LeaveMenu()
	end
	f0_local0( f33_arg0 )
end

local f0_local13 = function ( f31_arg0, f31_arg1 )
	assert( f31_arg0.FadeCover )
	local f31_local0 = f0_local0
	if not f31_arg0._prevImage then
		f31_local0 = 0
	end
	f31_arg0.FadeCover:SetAlpha( 1, f31_local0, LUI.EASING.inQuadratic )
	local f31_local1 = f31_arg0.FadeCover:Wait( f31_local0, true )
	f31_local1.onComplete = function ()
		if f31_arg0 ~= Cac.superNoneValue then
			assert( f31_arg0.Showcase )
			f31_arg0.Showcase:setImage( RegisterMaterial( SUPER.GetFullImage( f31_arg0 ) ) )
			f31_arg0.FadeCover:SetAlpha( 0, f31_arg0, LUI.EASING.outQuadratic )
			f31_arg0.Showcase:SetScale( f31_arg0.Showcase.aspectRatioScaleAdjust or 0, 0 )
			f31_arg0.Showcase:SetScale( (f31_arg0.Showcase.aspectRatioScaleAdjust or 0) + 0.015, 2500, LUI.EASING.outQuadratic )
			f31_arg0._prevImage = SUPER.GetFullImage( f31_arg0 )
		end
	end
	
end

local f0_local14 = function ( f30_arg0, f30_arg1 )
	local f30_local0 = f30_arg0._currentRef
	local f30_local1 = Loot[0xB853FAE9166621]( f30_arg1, LOOT.GetItemID( LOOT.itemTypes.SUPER, f30_local0 ) )
	local f30_local2, f30_local3 = f0_local0( f30_arg0, f30_local0 )
	if MLG.IsCDLActive( f30_arg1 ) and MatchRules[0xFB2C9897F2DED4D]( f30_local0 ) then
		f30_arg0.CDLRestricted:SetAlpha( 1 )
	else
		f30_arg0.CDLRestricted:SetAlpha( 0 )
	end
	local f30_local4 = {
		name = SUPER.GetNameUnlocalized( f30_local0 ),
		desc = SUPER.GetDesc( f30_local0 ),
		isUnlocked = PROGRESSION.IsUnlocked( f30_arg1, LOOT.itemTypes.SUPER, f30_local0 ),
		unlockCriteria = PROGRESSION.GetUnlockText( LOOT.itemTypes.SUPER, f30_local0 ),
		rechargeText = SUPER.GetRechargeLabel( f30_local0 ),
		rechargeRate = SUPER.GetRechargeSpeed( f30_local0 ),
		infoMessage = f30_local0 == "super_tac_insert",
		isEquipped = f30_local2
	}
	if LUI.IsLastInputGamepad( f30_arg1 ) then
		if f30_local0 == "super_deployed_decoy" then
			f30_local4.desc = 0x9CCCEBC6FC6BBCE
		elseif f30_local0 == "super_tac_camera" then
			f30_local4.desc = 0x28CBD733B529687
		end
	end
	f30_arg0.ItemDetails:UpdateDetails( f30_local4 )
	if Engine[0x12586A3F4FB490E]() then
		f0_local0( f30_arg0, f30_local0 )
	end
	f0_local0( f30_arg0 )
end

local f0_local15 = function ( f29_arg0, f29_arg1 )
	local f29_local0 = f29_arg0._currentRef
	local f29_local1 = SUPER.GetName( f29_local0 )
	Engine[0xFCF332AA8AC9B0F]( SUPER.GetTutorialVideo( f29_local0 ), VideoPlaybackFlags.LOOP + VideoPlaybackFlags.MUTE )
	LUI.FlowManager.RequestPopupMenu( nil, "TutorialVideoMaximized", true, f29_arg1, false, {
		title = f29_local1,
		videoRef = SUPER.GetTutorialVideo( f29_local0 ),
		videoFlags = VideoPlaybackFlags.LOOP + VideoPlaybackFlags.MUTE
	} )
end

local f0_local16 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = function ( f25_arg0, f25_arg1, f25_arg2 )
		local f25_local0 = f25_arg1 + f25_arg2 * f19_arg0.Grid:GetNumColumns()
		f25_arg0.ref = f19_arg0._allFieldUpgrades[f25_local0 + 1].ref
		f25_arg0:SetDisabled( false )
		f25_arg0:registerEventHandler( "button_action", function ( element, event )
			if not f25_arg0._disabled then
				f25_arg0( f25_arg0, f25_arg0, f25_arg0 )
			end
		end )
		f25_arg0:registerEventHandler( "button_over", function ( element, event )
			f25_arg0._currentRef = element.Button.data.ref
			if f25_arg0._currentRef then
				f25_arg0( f25_arg0, f25_arg0 )
			end
		end )
		f25_arg0:registerEventHandler( "button_disable", function ( element, event )
			f25_arg0._currentRef = element.Button.data.ref
			if f25_arg0._currentRef then
				f25_arg0( f25_arg0, f25_arg0 )
			end
		end )
		local f25_local1 = MatchRules[0xFB2C9897F2DED4D]( f25_arg0.ref )
		if f25_local1 then
			f25_local1 = not CONDITIONS.IsMagmaGameMode()
		end
		local f25_local2 = PROGRESSION.IsUnlocked( f19_arg0, LOOT.itemTypes.SUPER, f25_arg0.ref ) and not f25_local1
		local f25_local3 = f19_arg0( f19_arg0, f25_arg0.ref )
		local f25_local4 = {
			removeTextBacker = true,
			imageSize = "1x1",
			smallerFontForGamepad = true,
			buttonData = f19_arg0._allFieldUpgrades[f25_local0 + 1]
		}
		f25_local4.buttonData.image = f19_arg0._allFieldUpgrades[f25_local0 + 1].superBundle[0xAB612888528489A]
		f25_local4.buttonData.header = f19_arg0._allFieldUpgrades[f25_local0 + 1].superBundle[0x4BCADBA8E631B86]
		f25_local4.buttonData.isUnlocked = f25_local2
		f25_arg0.Button:SetupButton( f25_local4 )
		f25_arg0.Button:SetEquipped( f25_local3 )
		f25_arg0:SetDisabled( not f25_local2 )
		f25_arg0.Button:SetPrimaryPromptText( 0xCA07A93FADF9E95 )
		if f25_local3 and f25_arg0.ref == f19_arg0.upgrades[SUPER.Slot.LEFT].ref then
			f19_arg0.upgrades[SUPER.Slot.LEFT].button = f25_arg0
			if f19_arg0._slotInUse ~= SUPER.Slot.LEFT then
				f25_arg0:SetDisabled( true )
				f25_arg0.Button:SetPrimaryPromptText( 0xC9E9B620BF2E623 )
			end
		elseif f25_local3 then
			f19_arg0.upgrades[SUPER.Slot.RIGHT].button = f25_arg0
			if f19_arg0._slotInUse ~= SUPER.Slot.RIGHT then
				f25_arg0:SetDisabled( true )
				f25_arg0.Button:SetPrimaryPromptText( 0xC9E9C620BF2E7D6 )
			end
		end
		if f25_arg0.InventoryQuantity then
			f25_arg0.InventoryQuantity:Setup( f19_arg0._allFieldUpgrades[f25_local0 + 1].quantity )
		end
	end
	
	local f19_local1 = function ()
		local f24_local0 = 1
		for f24_local4, f24_local5 in ipairs( f19_arg0._allFieldUpgrades ) do
			local f24_local6 = f24_local5.ref
			local f24_local7 = f19_arg0.upgrades
			local f24_local8 = f19_arg0._slotInUse
			local f24_local9 = f19_arg0._slotInUse
			if f24_local6 == f24_local7[f24_local8 and f19_arg0._slotInUse or SUPER.Slot.LEFT].ref then
				f24_local0 = f24_local4
				break
			end
		end
		return f19_arg0.Grid:GetPositionForIndex( f24_local0 - 1, {
			relativePosition = false
		} )
	end
	
	local f19_local2 = math.min( #f19_arg0._allFieldUpgrades, f19_arg0._defaultMaxVisibleColumns )
	local f19_local3 = f19_arg0.Grid
	local f19_local4 = #f19_arg0._allFieldUpgrades
	f19_local3:SetMaxVisibleColumns( f19_local2 )
	f19_local3:SetNumChildren( f19_local4 )
	f19_local3:SetDefaultFocus( f19_local1 )
	f19_local3:MouseSetActiveToDefaultFocusMenuCreate( f19_arg1 )
	f19_local3:SetRefreshChild( f19_local0 )
	f19_arg0:addEventHandler( "menu_create", function ()
		f19_arg0:RefreshContent()
		f19_arg0:processEvent( {
			name = "lose_focus"
		} )
		f19_arg0.FieldUpgrade1:processEvent( {
			name = "gain_focus"
		} )
	end )
	f19_local3:processEvent( {
		name = "lose_focus"
	} )
	f19_arg0.FieldUpgrade1:processEvent( {
		name = "gain_focus"
	} )
	f19_local3:SetSnapOnScrollBarMouseDrag( true )
	local f19_local5 = f19_arg0.SideArrows
	local f19_local6 = f19_arg0.MouseArea
	if f19_local3 and f19_local5 and f19_local6 then
		f19_local5:SetupSideButtons( f19_local3, f19_local4 )
		f19_local5:UpdateSideButtons()
		f19_local3:addEventHandler( "gamepad_button", function ( f22_arg0, f22_arg1 )
			if f19_arg0 and CONDITIONS.IsMouseWheelEvent( f22_arg1 ) and f22_arg1.down then
				return f19_arg0:ExternalScroll( f22_arg1 )
			else
				
			end
		end )
		f19_local3._onNewTargetFocusPosition = function ( f21_arg0, f21_arg1 )
			if f19_arg0 then
				f19_arg0:AddScrollWatch()
			end
		end
		
		f19_local6:addEventHandler( "gamepad_button", function ( f20_arg0, f20_arg1 )
			if CONDITIONS.IsMouseWheelEvent( f20_arg1 ) and f20_arg1.down then
				f20_arg1.forceScrollMove = true
				f19_arg0:processEvent( f20_arg1 )
			end
		end )
	end
end

local f0_local17 = function ( f15_arg0, f15_arg1 )
	local f15_local0 = PROGRESSION.GetPlayerRank( f15_arg1 )
	local f15_local1 = false
	f15_arg0.proMode = SUPER.ProMode.DISABLED
	if CONDITIONS.AreRestrictionsActive( f15_arg1 ) or CoD.IsDMZMatch() then
		f15_arg0._proModeAvailable = false
	else
		local f15_local2 = PROGRESSION.IsUnlocked( f15_arg1, LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef )
		if not f15_local2 then
			f15_local2 = CONDITIONS.IsDevelopmentBuild()
		end
		f15_arg0._proModeAvailable = f15_local2
	end
	f15_arg0._proModeUnlockText = PROGRESSION.GetUnlockText( LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef )
	local f15_local2 = function ()
		f15_arg0.upgrades[SUPER.Slot.RIGHT].ref = Cac.superNoneValue
		f15_arg0.FieldUpgrade2:SetHeaderText( SUPER.GetName( f15_arg0.upgrades[SUPER.Slot.RIGHT].ref ) )
		f15_arg0.FieldUpgrade2:SetImage( SUPER.GetImage( f15_arg0.upgrades[SUPER.Slot.RIGHT].ref ) )
		f15_arg0.FieldUpgrade2:SetEmpty( true )
		f15_arg0.ItemDetails:UpdateDetails( {
			name = 0xFABCF9C0148EA59,
			desc = 0x78473AD0E7AE5DC,
			isUnlocked = PROGRESSION.IsUnlocked( f15_arg0, LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef ),
			unlockCriteria = PROGRESSION.GetUnlockText( LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef )
		} )
	end
	
	if not f15_arg0.bindButton then
		f15_arg0.bindButton = LUI.UIBindButton.new()
		f15_arg0.bindButton.id = "selfBindButton"
		f15_arg0:addElement( f15_arg0.bindButton )
	end
	f15_arg0.bindButton:registerEventHandler( "button_alt1", function ()
		if f15_arg0.FieldUpgrade2._isFocused then
			f15_arg0()
		end
	end )
	local f15_local3 = {
		removeTextBacker = true,
		hasEmptyState = true,
		removeEquipBanner = true,
		buttonSize = "LargeTall",
		imageSize = "1x1",
		buttonData = {
			image = SUPER.GetImage( f15_arg0.upgrades[SUPER.Slot.RIGHT].ref )
		},
		doubleAction = {
			text = 0xF45C394F4B8A31F,
			prompt = 0x21E44BE45534168,
			callback = function ()
				return f15_arg0()
			end
		}
	}
	if f15_arg0._proModeAvailable then
		f15_arg0.proMode = SUPER.ProMode.ENABLED
		f15_local1 = true
		f15_arg0.FieldUpgrade2:SetDisabled( false )
		f15_local3.buttonData.header = SUPER.GetNameUnlocalized( f15_arg0.upgrades[SUPER.Slot.RIGHT].ref )
		f15_arg0.FieldUpgrade2:SetEmpty( f15_arg0.upgrades[SUPER.Slot.RIGHT].ref == Cac.superNoneValue )
	else
		f15_arg0.upgrades[SUPER.Slot.RIGHT].ref = Cac.superNoneValue
		f15_arg0.FieldUpgrade2:SetDisabled( true )
		f15_arg0.FieldUpgrade2:SetEmpty( true )
		f15_local3.buttonData.header = f15_arg0._proModeUnlockText
		f15_local3.localizeHeader = false
	end
	f15_arg0.FieldUpgrade2:SetupButton( f15_local3 )
	f15_arg0.FieldUpgrade2:SetPrimaryPromptText( 0x1C3B0AAFBF200F )
end

local f0_local18 = function ( f3_arg0, f3_arg1, f3_arg2 )
	assert( f3_arg2.loadoutIndex, "The Field Upgrades menu requires a loadout index passed into options, otherwise it cannot grab the correct data!" )
	f3_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( 0x3DE7DE0C6E455AF ) )
	f3_arg0.ItemDetails:SetupForFieldUpgrades()
	f3_arg0.ButtonAction = f0_local0
	f3_arg0.ButtonOver = f0_local0
	f3_arg0._allFieldUpgrades = SUPER.GetAllFieldUpgrades( f3_arg1 )
	f3_arg0._currentRef = f3_arg0._allFieldUpgrades[1].ref
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0._defaultMaxVisibleColumns = f3_arg0.Grid:GetMaxVisibleColumns()
	local f3_local0 = LOADOUT.GetLoadoutSquadMember( f3_arg1 )
	f3_arg0._loadoutData = f3_local0.loadouts[f3_arg2.loadoutIndex]
	f3_arg0._prevImage = nil
	assert( f3_arg0.ItemDetails )
	f3_arg0.upgrades = {
		[SUPER.Slot.LEFT] = {
			isActive = true,
			ref = f3_arg0._loadoutData.fieldUpgrades[0]:get()
		},
		[SUPER.Slot.RIGHT] = {
			isActive = true,
			ref = f3_arg0._loadoutData.fieldUpgrades[1]:get()
		}
	}
	f3_arg0.FieldUpgrade1:SetupButton( {
		removeTextBacker = true,
		removeEquipBanner = true,
		buttonSize = "LargeTall",
		imageSize = "1x1",
		buttonData = {
			image = SUPER.GetImage( f3_arg0.upgrades[SUPER.Slot.LEFT].ref ),
			header = SUPER.GetNameUnlocalized( f3_arg0.upgrades[SUPER.Slot.LEFT].ref )
		}
	} )
	f3_arg0.FieldUpgrade1:SetPrimaryPromptText( 0x1C3B0AAFBF200F )
	f3_arg0.FieldUpgrade1.navigation = {
		right = f3_arg0.FieldUpgrade2
	}
	f3_arg0.FieldUpgrade2.navigation = {
		left = f3_arg0.FieldUpgrade1
	}
	local f3_local1 = function ( f14_arg0 )
		ACTIONS.AnimateSequence( f3_arg0, "ShowGrid" )
		f14_arg0:processEvent( {
			name = "lose_focus"
		} )
		f3_arg0.Grid:processEvent( {
			name = "gain_focus"
		} )
		f3_arg0.Grid:SetMouseFocusBlocker( false )
		f3_arg0._gridOpen = true
	end
	
	f3_arg0.Grid:SetMouseFocusBlocker( true )
	f3_arg0.FieldUpgrade1:addEventHandler( "button_action", function ( f13_arg0, f13_arg1 )
		f3_arg0._slotInUse = SUPER.Slot.LEFT
		ACTIONS.AnimateSequence( f3_arg0, "FU2Unfocused" )
		f3_arg0.Grid:RefreshContent()
		f3_arg0( f13_arg0 )
	end )
	f3_arg0.FieldUpgrade1:addEventHandler( "button_over", function ( f12_arg0, f12_arg1 )
		f3_arg0._currentRef = f3_arg0.upgrades[SUPER.Slot.LEFT].ref
		f3_arg0( f3_arg0, f3_arg0 )
	end )
	f3_arg0.FieldUpgrade2:addEventHandler( "button_action", function ( f11_arg0, f11_arg1 )
		f3_arg0._slotInUse = SUPER.Slot.RIGHT
		ACTIONS.AnimateSequence( f3_arg0, "FU1Unfocused" )
		f3_arg0.Grid:RefreshContent()
		f3_arg0( f11_arg0 )
	end )
	f3_arg0.FieldUpgrade2:addEventHandler( "button_over", function ( f10_arg0, f10_arg1 )
		f3_arg0._isFocused = true
		if f3_arg0.upgrades[SUPER.Slot.RIGHT].ref ~= Cac.superNoneValue then
			f3_arg0._currentRef = f3_arg0.upgrades[SUPER.Slot.RIGHT].ref
			f3_arg0( f3_arg0, f3_arg0 )
		else
			f3_arg0.ItemDetails:UpdateDetails( {
				name = 0xFABCF9C0148EA59,
				desc = 0x78473AD0E7AE5DC,
				isUnlocked = PROGRESSION.IsUnlocked( f3_arg0, LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef ),
				unlockCriteria = PROGRESSION.GetUnlockText( LOOT.itemTypes.FEATURE, LOOT.fieldUpgradeProRef )
			} )
		end
	end )
	f3_arg0.FieldUpgrade2:addEventHandler( "button_up", function ( f9_arg0, f9_arg1 )
		f3_arg0._isFocused = false
	end )
	if not f3_arg0.bindButton then
		local self = LUI.UIBindButton.new()
		self.id = "selfBindButton"
		f3_arg0:addElement( self )
		f3_arg0.bindButton = self
	end
	f0_local0( f3_arg0, f3_arg1 )
	f0_local0( f3_arg0, f3_arg1 )
	f3_arg0:addEventHandler( "menu_close", function ( f8_arg0, f8_arg1 )
		f3_arg0( f3_arg0, f3_arg0 )
		if Engine[0x12586A3F4FB490E]() then
			Engine[0x3DACD106DDC0D71]()
		end
	end )
	if not Engine[0x12586A3F4FB490E]() then
		f3_arg0.bindButton:addEventHandler( "button_start", function ( f7_arg0, f7_arg1 )
			LUI.FlowManager.RequestCloseAllMenus( f3_arg0.id, false, f7_arg1.controller )
			return true
		end )
		MenuUtils.AddDismissPauseMenuKBMHandler( f3_arg0 )
	end
	if Engine[0x12586A3F4FB490E]() then
		local self = function ( f6_arg0, f6_arg1 )
			if not Onboarding.ProFieldUpgrade.WasCompleted( f6_arg0, f6_arg1 ) then
				f3_arg0( f6_arg0, f6_arg1 )
				Onboarding.ProFieldUpgrade.MarkCompleted( f6_arg0, f6_arg1 )
			end
		end
		
		if not Onboarding.FieldUpgrade.WasCompleted( f3_arg0, f3_arg1 ) then
			local f3_local3 = ONBOARDING_DATA.GetOnboardingFieldUpgradeData()
			if f3_arg0._proModeAvailable then
				f3_local3.confirmButton.action = function ( f5_arg0, f5_arg1 )
					ACTIONS.LeaveMenu( f5_arg0 )
					f3_arg0( f5_arg0, f5_arg1 )
				end
				
			end
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "onboardingpopup", true, f3_arg1, false, f3_local3 )
			Onboarding.FieldUpgrade.MarkCompleted( f3_arg0, f3_arg0._controllerIndex )
		elseif f3_arg0._proModeAvailable then
			self( f3_arg0, f3_arg1 )
		end
	end
	if not CONDITIONS.IsMobileOrMobileSim() and f3_arg0.MenuTitle then
		f3_arg0.MenuTitle:SetupBackButton( f3_arg1 )
	end
	f3_arg0.bindButton:addEventHandler( "button_secondary", function ( f4_arg0, f4_arg1 )
		if f3_arg0._gridOpen and not f4_arg1.fromMenuTitle then
			ACTIONS.AnimateSequence( f3_arg0, "HideGrid" )
			ACTIONS.AnimateSequence( f3_arg0, "AllFUFocused" )
			f3_arg0.Grid:processEvent( {
				name = "lose_focus"
			} )
			local f4_local0 = nil
			if f3_arg0._slotInUse == SUPER.Slot.LEFT then
				f4_local0 = f3_arg0.FieldUpgrade1
			else
				f4_local0 = f3_arg0.FieldUpgrade2
			end
			f4_local0:processEvent( {
				name = "gain_focus"
			} )
			f3_arg0.Grid:SetMouseFocusBlocker( true )
			f3_arg0._gridOpen = false
		else
			ACTIONS.LeaveMenu( f4_arg0 )
		end
	end )
end

local f0_local19 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function FieldUpgradesBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "FieldUpgradesBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "FieldUpgradesBase", FieldUpgradesBase )
LockTable( _M )
