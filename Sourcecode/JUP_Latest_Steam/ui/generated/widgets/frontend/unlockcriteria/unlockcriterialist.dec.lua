-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
require( "ui.generated.widgets.dynamiclist" )
local f0_local0 = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
	local f13_local0 = true
	if f13_arg3 and f13_arg3.useBaseAsDefault ~= nil then
		f13_local0 = f13_arg3.useBaseAsDefault
	end
	local f13_local1
	if f13_arg3 then
		f13_local1 = f13_arg3.customBinding
		if not f13_local1 then
		
		else
			local f13_local2 = function ( f14_arg0, f14_arg1 )
				local f14_local0
				if not f14_arg1 then
					f14_local0 = f14_arg1
				else
					f14_local0 = f13_arg0
				end
				local f14_local1 = UNLOCK_CRITERIA.MakeWidgetName( f14_local0, {
					projectSpecific = true
				} )
				if not MenuBuilder.IsTypeAvailable( 0x0 .. f14_local1 ) then
					f14_local1 = UNLOCK_CRITERIA.MakeWidgetName( f14_local0 )
				end
				local f14_local2 = MenuBuilder.IsTypeAvailable( 0x0 .. f14_local1 ) or nil
				f13_arg0:RegisterWidgetType( f13_arg0, function ()
					local f16_local0 = f14_arg0:GetDataSource()
					return MenuBuilder.BuildRegisteredType( 0x0 .. f14_arg0, {
						controllerIndex = f14_arg0,
						dataContext = f16_local0[0x82E6CA8B0D19235][0x647A56602C06E54][0xEB72F3D9E8EC417]:GetDataSourceAtIndex( f14_arg0:GetNumChildren() - 1, f14_arg0 )
					} )
				end, function ( f15_arg0, f15_arg1, f15_arg2 )
					f15_arg0:SetDataSource( f15_arg2.dataSource, f14_arg0 )
					if f15_arg0.UpdateWithOptions then
						f15_arg0:UpdateWithOptions( f14_arg0, f15_arg2 )
					end
				end )
				return f14_local1
			end
			
			local f13_local3 = f13_local2( f13_arg2, f13_local1 )
			if not f13_local3 and f13_local0 then
				f13_local3 = f13_local2( f13_arg2, UNLOCK_CRITERIA.CriteriaWidgets.Base.name )
				if not f13_local3 then
					
				else
					
				end
			end
			return f13_local3
		end
	end
	f13_local1 = nil
end

local f0_local1 = function ( f12_arg0, f12_arg1, f12_arg2, f12_arg3 )
	if f12_arg0._childrenToInitialize[f12_arg1] ~= nil then
		f12_arg0._childrenToInitialize[f12_arg1] = nil
		if #Table.GetKeys( f12_arg0._childrenToInitialize ) == 0 then
			f12_arg0:OnAllChildrenInitialized( f12_arg2, f12_arg3 )
		end
	end
end

local f0_local2 = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3, f10_arg4 )
	f10_arg0:RemoveAllWidgets()
	f10_arg0._childrenToInitialize = {}
	local f10_local0 = f10_arg0:GetDataSource()
	local f10_local1 = f10_local0[0x82E6CA8B0D19235][0x647A56602C06E54][0xEB72F3D9E8EC417]
	local f10_local2
	if not f10_arg4 then
		f10_local2 = f10_arg4
	else
		f10_local2 = UNLOCK_CRITERIA.GetCriteriaElementListData( f10_arg1, f10_arg2 )
	end
	for f10_local12, f10_local13 in ipairs( f10_local2 ) do
		local f10_local14 = f10_local13.type.name
		if f10_local14 and UNLOCK_CRITERIA.CriteriaWidgets[f10_local14] then
			local f10_local6 = f10_local1:GetDataSourceAtIndex( f10_local12 - 1, f10_arg1 )
			f10_local6[0x79439EF7BFA9C2D]:SetValue( f10_arg1, f10_local14 )
			local f10_local7
			if not f10_arg3 then
				f10_local7 = f10_arg3
			elseif f10_local12 - 1 >= f10_arg0._compactCount then
				f10_local7 = UNLOCK_CRITERIA.ShouldDisableActions()
			else
				f10_local7 = true
			end
			f10_local13.weaponRef = f10_arg0._weaponRef
			f10_local13.type.InitDataSource( f10_arg1, f10_local6, f10_local13 )
			local f10_local8 = f10_arg0
			local f10_local9 = f10_arg0.AddWidget
			local f10_local10 = f10_local14
			local f10_local11
			if f10_local7 then
				f10_local11 = UNLOCK_CRITERIA.UnlockCriteriaCompactWidgetPostfix
				if not f10_local11 then
				
				else
					f10_local9( f10_local8, f10_local10 .. f10_local11, {
						widgetOptions = Table.Merge( f10_local13.options or {}, {
							dataSource = f10_local6
						} )
					} )
					f10_local9 = f10_arg0:GetWidgetAtIndex( f10_local12 - 1 )
					if f10_local9 and LAYOUT.GetElementHeight( f10_local9 ) == 0 then
						f10_arg0._childrenToInitialize[f10_local9] = true
						f10_local9:SetNotifyOnLayoutInit( true )
						f10_local9:registerEventHandler( "layout_initialized", function ( element, event )
							f10_arg0( f10_arg0, element, f10_arg0, f10_arg0 )
						end )
					end
				end
			end
			f10_local11 = ""
		end
	end
	if #Table.GetKeys( f10_arg0._childrenToInitialize ) == 0 then
		f10_arg0:OnAllChildrenInitialized( f10_arg1, f10_arg2 )
	end
end

local f0_local3 = function ( f9_arg0, f9_arg1 )
	for f9_local5, f9_local6 in ipairs( f9_arg1 ) do
		if not (f9_local5 - 1 < f9_arg0._compactCount) then
			local f9_local3 = f9_local6.type.name
			local f9_local4 = UNLOCK_CRITERIA.MakeWidgetName( f9_local3 .. UNLOCK_CRITERIA.UnlockCriteriaCompactWidgetPostfix )
			if MenuBuilder.IsTypeAvailable( 0x0 .. f9_local4 ) then
				return f9_local3, f9_local4
			end
		end
	end
end

local f0_local4 = function ( f7_arg0, f7_arg1, f7_arg2 )
	local f7_local0 = UNLOCK_CRITERIA.GetCriteriaElementListData( f7_arg1, f7_arg2 )
	local f7_local1 = function ()
		for f8_local3, f8_local4 in ipairs( f7_arg0 ) do
			local f8_local5 = f7_arg0:GetWidgetAtIndex( f8_local3 - 1 )
			if f8_local5 and f7_arg0._listItemOnLoadSequence then
				ACTIONS.AnimateSequence( f8_local5, f7_arg0._listItemOnLoadSequence )
			end
		end
	end
	
	local f7_local2 = LAYOUT.GetElementHeight( f7_arg0 )
	local f7_local3 = 0
	local f7_local4 = false
	local f7_local5 = false
	for f7_local12, f7_local13 in ipairs( f7_local0 ) do
		local f7_local14 = f7_local13.type.name
		if f7_local14 and UNLOCK_CRITERIA.CriteriaWidgets[f7_local14] then
			if f7_local14 == UNLOCK_CRITERIA.CriteriaWidgets.Challenges.name then
				f7_local4 = true
			end
			if f7_local14 == UNLOCK_CRITERIA.CriteriaWidgets.ActionPrompt.name then
				f7_local5 = true
			end
			local f7_local9 = f7_local12 - 1 < f7_arg0._compactCount
			local f7_local10 = f7_arg0:GetWidgetAtIndex( f7_local12 - 1 )
			if f7_local10 then
				f7_local3 = f7_local3 + LAYOUT.GetElementHeight( f7_local10 )
			end
			if not f7_local9 and f7_local2 < f7_local3 then
				local f7_local11 = f0_local0( f7_arg0, f7_local0 )
				f7_arg0._compactCount = f7_arg0._compactCount + 1
				if f7_local11 ~= nil then
					f0_local0( f7_arg0, f7_arg1, f7_arg2 )
					return 
				end
			end
		end
	end
	if f7_local2 < f7_local3 then
		if f7_local4 and not UNLOCK_CRITERIA.CriteriaWidgets.Challenges.IsUnused( f7_arg0 ) then
			UNLOCK_CRITERIA.CriteriaWidgets.Challenges.Ignore( f7_arg0 )
			f7_arg0._ignoredWidgets[UNLOCK_CRITERIA.CriteriaWidgets.Challenges.name] = {}
			f0_local0( f7_arg0, f7_arg1, f7_arg2 )
			return 
		elseif f7_local5 and not UNLOCK_CRITERIA.CriteriaWidgets.ActionPrompt.IsUnused( f7_arg0 ) then
			UNLOCK_CRITERIA.CriteriaWidgets.ActionPrompt.Ignore( f7_arg0 )
			f7_arg0._ignoredWidgets[UNLOCK_CRITERIA.CriteriaWidgets.ActionPrompt.name] = {}
			f0_local0( f7_arg0, f7_arg1, f7_arg2 )
			return 
		end
	end
	f7_local1()
end

local f0_local5 = function ( f6_arg0, f6_arg1, f6_arg2 )
	local f6_local0 = f6_arg0:GetDataSource()
	if not f6_local0 then
		return 
	end
	local f6_local1 = f6_local0[0xE7FD06D864FBD56]:GetValue( f6_arg1 )
	local f6_local2 = ITEM_UTILS.CacheEntry( f6_arg1, f6_local1 )
	local f6_local3 = UNLOCK_CRITERIA.GetCriteriaElementListData( f6_arg1, f6_local1, f6_arg2 )
	local f6_local4 = f6_local2:GetOptions()
	if f6_local4 and f6_local4.comingSoonSeason then
		f6_local3 = {
			{
				type = UNLOCK_CRITERIA.CriteriaWidgets.Base,
				text = Engine[0xED84C33EC5F01EA]( 0x6A9AE0E5B90A481, f6_local4.comingSoonSeason )
			}
		}
	end
	if not f6_local3 then
		return 
	end
	local f6_local5 = #f6_local3
	local f6_local6 = f6_local0[0x82E6CA8B0D19235][0x647A56602C06E54][0xEB72F3D9E8EC417]:GetCountModel( f6_arg1 )
	f6_local6[0x23B87195CE20E23]( f6_local6, f6_local5 )
	f6_arg0._compactCount = 0
	for f6_local10, f6_local11 in pairs( f6_arg0._ignoredWidgets ) do
		UNLOCK_CRITERIA.CriteriaWidgets[f6_local10].Unignore( f6_arg0 )
	end
	f6_arg0._ignoredWidgets = {}
	if f6_local2 then
		f6_local7 = f6_local2
	else
		f6_local7 = f6_local2._options
		if f6_local7 then
			f6_local7 = f6_local2._options.forceCompact
		end
	end
	f0_local0( f6_arg0, f6_arg1, f6_local1, f6_local7, f6_local3 )
end

local f0_local6 = function ( f5_arg0, f5_arg1 )
	f5_arg0._listItemOnLoadSequence = f5_arg1
end

local f0_local7 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.SetListItemOnLoadSequence = f0_local0
	f2_arg0._childrenToInitialize = {}
	f2_arg0._compactCount = 0
	f2_arg0._ignoredWidgets = {}
	local f2_local0 = f2_arg0.SetDataSource
	f2_arg0.OnAllChildrenInitialized = f0_local0
	f2_arg0.SetDataSource = function ( f4_arg0, f4_arg1, f4_arg2 )
		f2_arg0( f4_arg0, f4_arg1, f4_arg2 )
		f2_arg0( f4_arg0, f4_arg2, f2_arg0 )
	end
	
	f2_arg0:SetupList( {
		maxVisibleColumns = 1,
		maxVisibleRows = 20,
		wrapY = false,
		spacingY = 0,
		alignment = LUI.Alignment.Top
	}, f2_arg0.VerticalMinimalScrollbar )
	for f2_local4, f2_local5 in pairs( UNLOCK_CRITERIA.CriteriaWidgets ) do
		if not f0_local0( f2_arg0, f2_arg1, f2_local4 ) then
			LUI.FlowManager.RequestDevErrorPopup( "ERROR", "Can't find a widget for unlock type '" .. f2_local4 .. "'" )
		end
		if not f0_local0( f2_arg0, f2_arg1, f2_local4 .. UNLOCK_CRITERIA.UnlockCriteriaCompactWidgetPostfix, {
			useBaseAsDefault = false
		} ) and not f0_local0( f2_arg0, f2_arg1, f2_local4 .. UNLOCK_CRITERIA.UnlockCriteriaCompactWidgetPostfix, {
			customBinding = f2_local4
		} ) then
			LUI.FlowManager.RequestDevErrorPopup( "ERROR", "Can't find a widget for unlock type '" .. f2_local4 .. UNLOCK_CRITERIA.UnlockCriteriaCompactWidgetPostfix .. "'" )
		end
	end
	f2_arg0:registerEventHandler( "unlock_criteria_widget_layout_initialized", function ( element, event )
		f2_arg0( element, f2_arg0 )
	end )
end

function UnlockCriteriaList( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = MenuBuilder.BuildRegisteredType( 0xE912B67EAB866DA, f1_arg1 )
	f1_local1:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 600, 0, 400 )
	f1_local1.id = "UnlockCriteriaList"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f0_local0( f1_local1, f1_local0.ValidateControllerIndex( f1_local1, f1_local2 ), f1_arg1 )
	f1_local0.UIElement.ValidateAnimationState( f1_local1 )
	return f1_local1
end

MenuBuilder.registerType( 0x9DF6FE4CD2E2E74, UnlockCriteriaList )
LockTable( _M )
