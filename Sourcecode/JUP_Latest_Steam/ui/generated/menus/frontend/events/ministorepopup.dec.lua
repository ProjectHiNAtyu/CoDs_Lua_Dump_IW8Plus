-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
require( "ui.generated.widgets.buttons.mousebuttonarea" )
require( "ui.generated.widgets.frontend.events.ministorecontainer" )
local f0_local0 = InGameStoreStoreIconPosition.CENTER
local f0_local1 = function ()
	InGameStore.ShowStoreIcon( false )
end

local f0_local2 = function ( f25_arg0 )
	if not Engine[0x836C8AD984F14F6]() then
		return 
	end
	local f25_local0 = false
	if LUI.FlowManager.IsMenuOnTop( MINI_STORE.MENU_NAME ) then
		if f25_arg0._codPointsPurchase then
			
		elseif f25_arg0._bundlePreview then
			if STORE.Bundles.IsFirstParty( f25_arg0._bundlePreview:GetBundle() ) then
				f25_local0 = true
			end
		elseif f25_arg0._bundleList then
			for f25_local4, f25_local5 in ipairs( f25_arg0._bundleList:GetAllBundles() ) do
				if STORE.Bundles.IsFirstParty( f25_local5 ) then
					f25_local0 = true
					break
				end
			end
		end
	end
	if f25_local0 then
		InGameStore.ShowStoreIcon( true, f0_local0 )
	else
		InGameStore.ShowStoreIcon( false )
	end
end

local f0_local3 = function ( f24_arg0, f24_arg1, f24_arg2 )
	if not f24_arg0._skipBundleList then
		f24_arg0._bundleList = MenuBuilder.BuildRegisteredType( "PurchaseBundlesPopup", {
			controllerIndex = f24_arg0._controllerIndex,
			startEmpty = f24_arg1.hideBundleList,
			hideBattlepass = f24_arg1.hideBattlepass,
			getBundlesFunc = f24_arg1.getBundlesFunc,
			title = f24_arg1.title,
			description = f24_arg1.description
		} )
		f24_arg0._bundleList.MenuTitle:DisableGlobalWidgets()
		f24_arg0.MiniStoreContainer:addElement( f24_arg0._bundleList )
		if not f24_arg2 then
			f0_local0( f24_arg0 )
		end
	end
end

local f0_local4 = function ( f23_arg0, f23_arg1, f23_arg2, f23_arg3, f23_arg4 )
	if f23_arg0._bundlePreview then
		return 
	elseif f23_arg3 ~= nil then
		f23_arg0._hideBundleList = f23_arg3
	end
	if f23_arg0._bundleList then
		f23_arg0._bundleList:RemoveFromParent()
	else
		f23_arg0._skipBundleList = true
	end
	if f23_arg0._codPointsPurchase then
		f23_arg0._codPointsPurchase:closeTree()
		f23_arg0._codPointsPurchase = nil
	end
	f23_arg0._bundlePreview = MenuBuilder.BuildRegisteredType( "StoreBundlePreviewWidget", {
		controllerIndex = f23_arg0._controllerIndex,
		bundle = f23_arg1,
		openPurchaseConfirmation = f23_arg2
	} )
	f23_arg0.MiniStoreContainer:addElement( f23_arg0._bundlePreview )
	f23_arg0._bundlePreview:SetFocusedItem( f23_arg1, 1 )
	if not f23_arg4 then
		f0_local0( f23_arg0 )
	end
end

local f0_local5 = function ( f21_arg0, f21_arg1, f21_arg2 )
	if f21_arg0._codPointsPurchase then
		
	else
		
	end
	f21_arg0._bundleList:RemoveFromParent()
	if f21_arg0._bundlePreview then
		if f21_arg0._bundlePreview:IsPurchaseOverlayOpened() then
			f21_arg0._bundlePreview:HidePurchaseOverlay( true )
		end
		f21_arg0._bundlePreview:RemoveFromParent()
	end
	f21_arg0._codPointsPurchase = MenuBuilder.BuildRegisteredType( "PurchaseCPPopup", {
		showBalance = true,
		removeTitleUnderline = true,
		currencyAmount = 0,
		controllerIndex = f21_arg0._controllerIndex,
		currencyID = LOOT.CurrencyIDs.COD_POINTS,
		storeIconPosition = f0_local0,
		completionCallback = function ( f22_arg0, f22_arg1 )
			if f21_arg0._codPointsPurchase and f22_arg1.transactionResult == STORE.TransactionResult.TRANSACTION_SUCCEEDED then
				f21_arg0:NavigateBack()
			end
		end
	} )
	f21_arg0._codPointsPurchase.MenuTitle:DisableGlobalWidgets()
	f21_arg0.MiniStoreContainer:addElement( f21_arg0._codPointsPurchase )
	local f21_local0 = f21_arg0.id
	local f21_local1
	if f21_arg1 then
		f21_local1 = f21_arg1.id
		if not f21_local1 then
		
		else
			Engine[0x779B78D51A8ED4F]( f21_arg0._controllerIndex, f21_local0, f21_local1 )
			if not f21_arg2 then
				f0_local0( f21_arg0 )
			end
		end
	end
	f21_local1 = f21_arg0.id
end

local f0_local6 = function ( f17_arg0, f17_arg1, f17_arg2 )
	f17_arg0._hideBundleList = f17_arg2.hideBundleList
	if f17_arg0._codPointsPurchase then
		f17_arg0._codPointsPurchase:closeTree()
		f17_arg0._codPointsPurchase = nil
	end
	if f17_arg0._bundlePreview then
		f17_arg0._bundlePreview:closeTree()
		f17_arg0._bundlePreview = nil
	end
	if f17_arg0._bundleList then
		f17_arg0._bundleList:closeTree()
		f17_arg0._bundleList = nil
	end
	local f17_local0 = function ()
		f17_arg0( f17_arg0, f17_arg0, true )
		if f17_arg0.bundle then
			f17_arg0( f17_arg0, f17_arg0.bundle, f17_arg0.openPurchaseConfirmation, nil, true )
		end
		if f17_arg0.openCODPointsPurchase then
			f17_arg0( f17_arg0, f17_arg0.fromButton, true )
		end
		f17_arg0( f17_arg0 )
	end
	
	if STORE.IsCatalogReady( f17_arg1 ) then
		f17_local0()
	else
		f17_arg0.MiniStoreContainer:ShowFetchingPrompt( true )
		f0_local0( f17_arg0 )
		STORE.AsyncFetchCatalogue( f17_arg0, f17_arg1, {
			useCache = true,
			showEmptyStoreDialog = false,
			onFetchSuccess = function ()
				f17_arg0.MiniStoreContainer:ShowFetchingPrompt( false )
				f17_arg0()
			end,
			onFetchError = function ( f18_arg0, f18_arg1 )
				LUI.FlowManager.RequestDevErrorPopup( "Failed to fetch store catalogue", f18_arg1.message or "unknown error" )
				f18_arg0.MiniStoreContainer:ShowFetchingPrompt( false )
				f17_arg0()
			end
		} )
	end
end

local f0_local7 = function ( f16_arg0, f16_arg1 )
	if f16_arg0._codPointsPurchase then
		f16_arg0._codPointsPurchase:closeTree()
		f16_arg0._codPointsPurchase = nil
		if f16_arg0._bundlePreview then
			f16_arg0.MiniStoreContainer:addElement( f16_arg0._bundlePreview )
		else
			f16_arg0.MiniStoreContainer:addElement( f16_arg0._bundleList )
			f16_arg0:RefreshBundleList()
			f16_arg0:processEvent( {
				name = "gain_focus"
			} )
		end
	elseif f16_arg0._bundlePreview then
		if f16_arg0._bundlePreview:IsPurchaseOverlayOpened() then
			f16_arg0._bundlePreview:HidePurchaseOverlay()
		else
			f16_arg0._bundlePreview:closeTree()
			f16_arg0._bundlePreview = nil
			if f16_arg0._skipBundleList then
				MINI_STORE.CloseMiniStore()
			elseif f16_arg0._hideBundleList then
				f16_arg0._bundleList:closeTree()
				f16_arg0._bundleList = nil
				MINI_STORE.CloseMiniStore()
			else
				f16_arg0.MiniStoreContainer:addElement( f16_arg0._bundleList )
				f16_arg0:RefreshBundleList()
				f16_arg0:processEvent( {
					name = "gain_focus"
				} )
			end
		end
	else
		MINI_STORE.CloseMiniStore()
	end
	f0_local0( f16_arg0 )
end

local f0_local8 = function ( f15_arg0 )
	if f15_arg0._bundleList and f15_arg0._bundleList:getParent() then
		return f15_arg0._bundleList
	else
		return nil
	end
end

local f0_local9 = function ( f14_arg0 )
	if f14_arg0._refreshBundles then
		if f14_arg0._bundleList then
			f14_arg0._bundleList:Refresh()
		end
		f14_arg0._refreshBundles = false
	end
end

local f0_local10 = function ( f6_arg0, f6_arg1, f6_arg2 )
	f6_arg0.OpenWithOptions = f0_local0
	f6_arg0.OpenBundlePreview = f0_local0
	f6_arg0.OpenCODPointsPurchase = f0_local0
	f6_arg0.NavigateBack = f0_local0
	f6_arg0.GetBundleList = f0_local0
	f6_arg0.RefreshBundleList = f0_local0
	f6_arg0._controllerIndex = f6_arg1
	f6_arg0._isFlyInPopup = true
	f6_arg0.saveState = function ( f13_arg0 )
		local f13_local0 = LUI.FlowManager.GetScopedData( f13_arg0 )
		if f13_arg0._bundlePreview then
			f13_local0.bundle = f13_arg0._bundlePreview._bundle
			f13_local0.openPurchaseConfirmation = f13_arg0._bundlePreview:IsPurchaseOverlayOpened()
		else
			f13_local0.bundle = nil
			f13_local0.openPurchaseConfirmation = nil
		end
		if f13_arg0._codPointsPurchase then
			f13_local0.openCODPointsPurchase = true
		else
			f13_local0.openCODPointsPurchase = nil
		end
	end
	
	f6_arg0.MouseButtonArea:addEventHandler( "button_action", function ( f12_arg0, f12_arg1 )
		f12_arg0:SetHandleMouse( false )
		MINI_STORE.CloseMiniStore()
	end )
	f6_arg0:AddGamepadEventCallback( "button_secondary", f0_local0 )
	f6_arg0:addEventHandler( "opening_quick_access_menu", function ( f11_arg0, f11_arg1 )
		MINI_STORE.CloseMiniStore( true )
	end )
	f6_arg0:addEventHandler( "global_panel_created", function ( f10_arg0, f10_arg1 )
		MINI_STORE.CloseMiniStore( true )
	end )
	f6_arg0:addEventHandler( "gain_focus", function ( f9_arg0, f9_arg1 )
		f6_arg0( f6_arg0 )
	end )
	f6_arg0:addEventHandler( "menu_close", function ( f8_arg0, f8_arg1 )
		f6_arg0( f6_arg0 )
		UNLOCK_CRITERIA.UnlockRedirectToUnlockSource()
	end )
	local f6_local0 = function ( f7_arg0, f7_arg1 )
		f6_arg0._refreshBundles = true
	end
	
	f6_arg0:addEventHandler( "ingamestore_purchased_product", f6_local0 )
	f6_arg0:addEventHandler( "loot_item_transaction_complete", f6_local0 )
	f6_arg0:OpenWithOptions( f6_arg1, f6_arg2 )
end

States = {
	[0xAD14C6E7156B923] = function ( f2_arg0, f2_arg1 )
		local f2_local0 = function ( f5_arg0, f5_arg1 )
			
		end
		
		if f2_arg0[0x67F203F7FCD6A7D] then
			f2_arg0[0x67F203F7FCD6A7D]:RegisterAnimationSequence( 0xAB7F38F4347BA71, {
				nil,
				nil,
				0,
				0,
				nil,
				-2.3534382792352958E-185,
				150,
				[1] = TWEEN_PROPERTY.Alpha,
				[4] = TWEEN_PROPERTY.Alpha
			} )
		end
		f2_arg0[0x88BB8FF30534CD6]:RegisterAnimationSequence( 0xAB7F38F4347BA71, {
			nil,
			nil,
			4294966746,
			0,
			nil,
			50,
			0,
			nil,
			5.29462817E-315,
			0,
			nil,
			4294966656,
			150,
			nil,
			4294967256,
			150,
			nil,
			1,
			150,
			[1] = TWEEN_PROPERTY.Left,
			[4] = TWEEN_PROPERTY.Right,
			[7] = TWEEN_PROPERTY.Alpha,
			[10] = TWEEN_PROPERTY.Left,
			[13] = TWEEN_PROPERTY.Right,
			[16] = TWEEN_PROPERTY.Alpha
		} )
		local f2_local1 = function ( f4_arg0, f4_arg1 )
			if f4_arg0[0x67F203F7FCD6A7D] then
				f4_arg0[0x67F203F7FCD6A7D]:AnimateSequence( 0xAB7F38F4347BA71 )
			end
			f4_arg0[0x88BB8FF30534CD6]:AnimateSequence( 0xAB7F38F4347BA71 )
		end
		
		if f2_arg0[0x67F203F7FCD6A7D] then
			f2_arg0[0x67F203F7FCD6A7D]:RegisterAnimationSequence( 0xBAF2678F38E968, {
				nil,
				nil,
				-2.3534382792352958E-185,
				0,
				nil,
				0,
				150,
				[1] = TWEEN_PROPERTY.Alpha,
				[4] = TWEEN_PROPERTY.Alpha
			} )
		end
		f2_arg0[0x88BB8FF30534CD6]:RegisterAnimationSequence( 0xBAF2678F38E968, {
			nil,
			nil,
			1,
			0,
			nil,
			4294966656,
			0,
			nil,
			4294967256,
			0,
			nil,
			5.29462817E-315,
			150,
			nil,
			4294966746,
			150,
			nil,
			50,
			150,
			[1] = TWEEN_PROPERTY.Alpha,
			[4] = TWEEN_PROPERTY.Left,
			[7] = TWEEN_PROPERTY.Right,
			[10] = TWEEN_PROPERTY.Alpha,
			[13] = TWEEN_PROPERTY.Left,
			[16] = TWEEN_PROPERTY.Right
		} )
		f2_arg0[0x49D85F0EF1CEC84] = {
			[0xEF6C3AB55C07BEF] = f2_local0,
			[0xAB7F38F4347BA71] = f2_local1,
			[0xBAF2678F38E968] = function ( f3_arg0, f3_arg1 )
				if f3_arg0[0x67F203F7FCD6A7D] then
					f3_arg0[0x67F203F7FCD6A7D]:AnimateSequence( 0xBAF2678F38E968 )
				end
				f3_arg0[0x88BB8FF30534CD6]:AnimateSequence( 0xBAF2678F38E968 )
			end
		}
		f2_arg0[0xD97E59A206E4A54] = {
			[0xAB7F38F4347BA71] = 150,
			[0xBAF2678F38E968] = 150,
			[0xEF6C3AB55C07BEF] = 0
		}
	end
}
function MiniStorePopup( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = MenuBuilder
	local f1_local2 = TWEEN_PROPERTY
	local f1_local3 = f1_local0.UIMenu.new()
	f1_local3.id = "MiniStorePopup"
	f1_local3[0xBD5D934D3CD91E5] = States
	local f1_local4
	if f1_arg1 then
		f1_local4 = f1_arg1
	else
		f1_local4 = f1_arg1.controllerIndex
	end
	f1_local4 = f1_local0.ValidateControllerIndex( f1_local3, f1_local4 )
	local f1_local5 = f1_local3
	local f1_local6 = nil
	if Engine[0x12586A3F4FB490E]() then
		f1_local6 = f1_local0.UIImage.new()
		f1_local6[0x8B72E07B55C3AC0] = "Darkener"
		ACTIONS.ScaleFullscreen( f1_local6 )
		f1_local6:SetRGB( 0, 0 )
		f1_local6:SetAlpha( 0.4, 0 )
		f1_local3:addElement( f1_local6 )
		f1_local3[0x67F203F7FCD6A7D] = f1_local6
	end
	local f1_local7 = nil
	f1_local7 = f1_local1.BuildRegisteredType( 0x57C019E9FCB4F59, {
		controllerIndex = f1_local4
	} )
	f1_local7[0x8B72E07B55C3AC0] = "MouseButtonArea"
	ACTIONS.ScaleFullscreen( f1_local7 )
	f1_local7:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, 0, 0 )
	f1_local3:addElement( f1_local7 )
	f1_local3[0x57C019E9FCB4F59] = f1_local7
	local f1_local8 = nil
	f1_local8 = f1_local1.BuildRegisteredType( 0x88BB8FF30534CD6, {
		controllerIndex = f1_local4
	} )
	f1_local8[0x8B72E07B55C3AC0] = "MiniStoreContainer"
	f1_local8:SetAnchorsAndPosition( 1, 0, 0, 0, -640, -40, 0, 0 )
	f1_local3:addElement( f1_local8 )
	f1_local3[0x88BB8FF30534CD6] = f1_local8
	f0_local0( f1_local3, f1_local4, f1_arg1 )
	return f1_local3
end

MenuBuilder.registerType( 0x82ED3AC494D2D3, MiniStorePopup )
LUI.FlowManager.RegisterStackPopBehaviour( 0x82ED3AC494D2D3, f0_local1 )
LockTable( _M )
