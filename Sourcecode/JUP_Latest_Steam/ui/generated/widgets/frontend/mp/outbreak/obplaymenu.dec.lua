-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
require( "ui.generated.widgets.frontend.mp.outbreak.obmissionsbutton" )
require( "ui.generated.widgets.frontend.zm.obplaymenubutton" )
require( "ui.generated.widgets.frontend.lobby.lobbytokensbutton" )
require( "ui.generated.widgets.frontend.challengeplaylistcontainer" )
require( "ui.generated.widgets.frontend.mp.outbreak.obfrontendexfilstreakdisplay" )
require( "ui.generated.widgets.frontend.freetrialupsell" )
local f0_local0 = function ( f14_arg0, f14_arg1 )
	local f14_local0 = PlaylistUtils.GetPublicPlaylistDatasources()
	local f14_local1 = f14_local0:GetCountValue( f14_arg1 ) - 1
	for f14_local2 = 0, f14_local1, 1 do
		local f14_local5 = f14_local0:GetDataSourceAtIndex( f14_local2 )
		if f14_local5.type:GetValue( f14_arg1 ) == PlaylistUtils.CategoryClass.DMZ then
			f14_arg0._categoryDataSource = f14_local5
			return 
		end
	end
end

local f0_local1 = function ( f13_arg0 )
	f13_arg0.PlayButton.navigation = {}
	f13_arg0.QuestButton.navigation = {}
	f13_arg0.PlayButton.navigation.right = f13_arg0.QuestButton
	f13_arg0.QuestButton.navigation.left = f13_arg0.PlayButton
end

local f0_local2 = function ( f12_arg0, f12_arg1 )
	f12_arg0.NewMissionsText:SetVisible( false )
	local f12_local0 = PLAYER_DATA.IO( f12_arg1, CoD.StatsGroup.Outbreak )
	local f12_local1 = f12_local0.highestSeenMissionAct
	local f12_local2 = f12_local0.highestSeenMissionTier
	local f12_local3 = f12_local0.highestSeenFinalActMissionCount
	OB.DebugResetSeenAct4Missions( f12_local3 )
	local f12_local4 = DMZ.GetFactionMissionDataTable()
	local f12_local5 = false
	for f12_local6 = 1, #f12_local4, 1 do
		if f12_local4[f12_local6] ~= nil then
			local f12_local9 = DMZ.GetFactionMissionCompletionProgress( f12_arg1, f12_local4[f12_local6][0x9E9C01960F4C582] )
			local f12_local10 = DMZ.GetCurrentFactionMissionTier( f12_arg1, f12_local4[f12_local6][0x9E9C01960F4C582] )
			local f12_local11 = DMZ.GetFactionMissionData( f12_local4[f12_local6][0x9E9C01960F4C582] )
			if f12_local4[f12_local6][0x79E207D02E93EC1] then
				if f12_local3 ~= nil and f12_local3:get() < f12_local11[0xBB7B7C9EEE3946B] then
					f12_arg0.NewMissionsText:setText( Engine[0xED84C33EC5F01EA]( 0x4955BFFFA2EC18F ), 0 )
					f12_arg0.NewMissionsText:SetVisible( true )
				end
			end
			if f12_local5 == false and f12_local9 < 1 and f12_local1 ~= nil and f12_local2 ~= nil then
				if f12_local1:get() < f12_local6 or f12_local2:get() < f12_local10 then
					f12_arg0.NewMissionsText:setText( Engine[0xED84C33EC5F01EA]( 0x55607A4C200EE7C ), 0 )
					f12_arg0.NewMissionsText:SetVisible( true )
				end
				f12_local5 = true
			end
		end
	end
end

local f0_local3 = function ( f2_arg0, f2_arg1, f2_arg2 )
	Engine[0x3DACD106DDC0D71]()
	f0_local0( f2_arg0 )
	FrontEndScene.HideAllCharacters()
	Engine[0x685AE31DEDA30A4]( "squad_lobby" )
	f0_local0( f2_arg0, f2_arg1 )
	local f2_local0 = LUI.FlowManager.GetScopedData( f2_arg0 )
	if not f2_local0.preMatchMakingNotified then
		Engine[0x6055C55456F05DF]( "pre_match_making", 1 )
		f2_local0.preMatchMakingNotified = true
	end
	if not f2_local0._didResetPlaylistId then
		Lobby[0xE6E03A0292DA533]( Lobby.PartyUIData.PLAYLIST_ID, 0 )
		Lobby[0xE6E03A0292DA533]( Lobby.PartyUIData.PLAYLIST_CATEGORY, 0 )
		f2_local0._didResetPlaylistId = true
	end
	if Engine[0x2DE6F7A69111B92]( f2_arg1 ) then
		Engine[0x491916651571863]( f2_arg1, LOADOUT.GetFavoriteLoadoutIndex( f2_arg1 ) )
	end
	local f2_local1 = {
		buttonSize = "XLarge",
		imageSize = "ImageFull",
		removeEquipBanner = true,
		buttonData = {
			image = "loading_zm_jup_bigmap_bg_preview",
			header = GAMEMODE_SCRIPTBUNDLE_UTILS.GetFrontendPlayMenuButtonText() or 0xFDB576AE7ACC4A9
		}
	}
	local f2_local2 = {
		image = playlistIcon or bundleIcon,
		name = playlistName or bundleName
	}
	local f2_local3 = function ()
		Lobby[0xE6E03A0292DA533]( Lobby.PartyUIData.PLAYLIST_ID, OBPVP_LOBBY_UTILS.IsInOBPVPLobby() and OBPVP_LOBBY_UTILS.GetDefaultPlaylistID() or OB.DefaultPlaylistID() )
		LUI.FlowManager.RequestAddMenu( "OBMissionsOverview", false, f2_arg0, false )
	end
	
	f2_arg0.PlayButton:addEventHandler( "button_action", function ( f9_arg0, f9_arg1 )
		MenuUtils.CheckAndRunCodeOfConductFirstMatch( f9_arg1.controller, function ()
			f9_arg0()
		end )
	end )
	f2_arg0.QuestButton:SetupCurrentAct()
	f2_arg0.QuestButton:addEventHandler( "button_action", function ( f8_arg0, f8_arg1 )
		LUI.FlowManager.RequestAddMenu( "OBActSelect", false, f8_arg1.controller, false )
		return true
	end )
	local f2_local4 = function ()
		local f7_local0 = Lobby[0x63537242F1D48FF]()
		if f7_local0 then
			f7_local0 = not Lobby[0x6957722EF74F5D2]()
		end
		f2_arg0.PlayButton:SetButtonDisabled( f7_local0 )
		if f7_local0 then
			ACTIONS.AnimateSequence( f2_arg0.PlayButton, "WaitingLeaderEnabled" )
		else
			ACTIONS.AnimateSequence( f2_arg0.PlayButton, "WaitingLeaderDisabled" )
		end
	end
	
	f2_arg0:SubscribeToModel( DataSources.frontEnd.lobby.isPrivatePartyHost:GetModel( f2_arg1 ), f2_local4 )
	f2_arg0:registerEventHandler( "read_party_leader_state", function ( element, event )
		f2_arg0( element )
	end )
	f2_local4( f2_arg0 )
	GL_HACK.SetDMZModeDVar( true )
	local f2_local5 = MenuBuilder.BuildRegisteredType( "FrontendCameraMover", {
		enableSway = true,
		controllerIndex = f2_arg1
	} )
	f2_local5:SetLimits( -2, 2, -2, 2 )
	f2_arg0:addElement( f2_local5 )
	MenuUtils.SetupSceneChangeCallback( f2_arg0, function ()
		local f4_local0 = LUI.DeferredFence.AttachMultiple
		f4_local0( f2_arg0, f2_arg0, {
			nil,
			"CLIENT_CONNECT",
			"WEAPON_DEF"
		}, LUI.DeferredFence.Criticality.LOW, LUI.DeferredFence.BackOutMethod.NONE, function ( f5_arg0, f5_arg1 )
			if f5_arg1.fenceState == LUI.Fence.FenceObjectState.PASSING then
				CLIENTCHARACTER.BuildContainerAndWidgets( f4_local0, f4_local0, {
					showDetailWidget = true,
					dataSourcePath = Lobby.SquadMembersPath
				} )
			end
		end )
	end )
	if f2_arg0.ExfilStreakDisplay then
		f2_arg0.ExfilStreakDisplay:SetupOperatorName()
	end
	ClientCharacter[0x813BDB5DDDF1A24]( 0, false )
	DMZ.ApplyInventoryUpdates( f2_arg1 )
	Onboarding.RequestOnboardingPopup( f2_arg0, f2_arg1, Onboarding.Outbreak, Onboarding.tutorials.OB_INTRO, ONBOARDING_DATA.GetOBIntroOnboardingData() )
	f0_local0( f2_arg0, f2_arg1 )
	PROGRESSION.CheckAndGivePlayerProgressionAchievements( f2_arg1 )
	if f2_local0.showMissionsOverview then
		MenuUtils.CheckAndRunCodeOfConductFirstMatch( f2_arg1, function ()
			f2_arg0()
		end )
		f2_local0.showMissionsOverview = false
	end
end

function OBPlayMenu( f1_arg0, f1_arg1 )
	local f1_local0 = CONDITIONS
	local f1_local1 = LUI
	local f1_local2 = MenuBuilder
	local f1_local3 = f1_local1.UIElement.new()
	f1_local3:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
	f1_local3.id = "OBPlayMenu"
	local f1_local4
	if f1_arg1 then
		f1_local4 = f1_arg1
	else
		f1_local4 = f1_arg1.controllerIndex
	end
	f1_local4 = f1_local1.ValidateControllerIndex( f1_local3, f1_local4 )
	local f1_local5 = nil
	f1_local5 = f1_local2.BuildRegisteredType( 0xBFA51551D1ABD1B, {
		controllerIndex = f1_local4
	} )
	f1_local5[0x8B72E07B55C3AC0] = "QuestButton"
	f1_local5:SetAnchorsAndPosition( 0, 1, 1, 0, 1434, 1834, -294, -144 )
	f1_local3:addElement( f1_local5 )
	f1_local3[0x86086C83ADEC529] = f1_local5
	local f1_local6 = nil
	f1_local6 = f1_local2.BuildRegisteredType( 0xFE446860F7F5325, {
		controllerIndex = f1_local4
	} )
	f1_local6[0x8B72E07B55C3AC0] = "PlayButton"
	f1_local6:SetPixelGridEnabled( true )
	f1_local6:SetPixelGridContrast( 0.05, 0 )
	f1_local6:SetPixelGridBlockWidth( 10, 0 )
	f1_local6:SetPixelGridBlockHeight( 10, 0 )
	f1_local6:SetPixelGridGutterWidth( 1, 0 )
	f1_local6:SetPixelGridGutterHeight( 1, 0 )
	f1_local6:SetAnchorsAndPosition( 0, 1, 1, 0, 88, 512, -346, -144 )
	f1_local3:addElement( f1_local6 )
	f1_local3[0x5B9A2778743232B] = f1_local6
	local f1_local7 = nil
	if not f1_local0.IsJupPublicBetaBuildEnabled() and not f1_local0.IsCIABuildEnabled() then
		f1_local7 = f1_local2.BuildRegisteredType( 0xF5CE2C88A2F6A6D, {
			controllerIndex = f1_local4
		} )
		f1_local7[0x8B72E07B55C3AC0] = "LobbyTokensButton"
		f1_local7:SetAnchorsAndPosition( 0, 1, 0, 1, 1380, 1834, 660, 741 )
		f1_local3:addElement( f1_local7 )
		f1_local3[0xF5CE2C88A2F6A6D] = f1_local7
	end
	local f1_local8 = nil
	if not f1_local0.IsLeaguePlay() and not f1_local0.IsJupNexusBuildEnabled() then
		f1_local8 = f1_local2.BuildRegisteredType( 0xE20BB189595AAAF, {
			controllerIndex = f1_local4
		} )
		f1_local8[0x8B72E07B55C3AC0] = "ChallengePlaylistContainer"
		f1_local8:SetAnchorsAndPosition( 0, 1, 0, 1, 88, 512, 110, 685 )
		f1_local3:addElement( f1_local8 )
		f1_local3[0xE20BB189595AAAF] = f1_local8
	end
	local f1_local9 = nil
	if f1_local0.IsOBExfilStreakEnabled() then
		f1_local9 = f1_local2.BuildRegisteredType( 0x7732DD7B65CAF54, {
			controllerIndex = f1_local4
		} )
		f1_local9[0x8B72E07B55C3AC0] = "ExfilStreakDisplay"
		f1_local9:SetAnchorsAndPosition( 0, 1, 0, 1, 1238.72, 1730.72, 224.35, 374.35 )
		f1_local3:addElement( f1_local9 )
		f1_local3[0x913AE6B94F1F941] = f1_local9
	end
	local f1_local10 = nil
	f1_local10 = f1_local1.UIText.new()
	f1_local10[0x8B72E07B55C3AC0] = "NewMissionsText"
	f1_local10:SetVisible( false )
	f1_local10:setText( Engine[0xED84C33EC5F01EA]( 0x55607A4C200EE7C ), 0 )
	f1_local10:setCaseStyle( f1_local1.CaseStyle.Uppercase )
	f1_local10:SetFont( FONTS.GetFont( FONTS.SecondaryMedium.File ) )
	f1_local10:SetFontSize( 16 * _PT )
	f1_local10:SetMinFontSize( 16 * _PT )
	f1_local10:SetWordWrap( false )
	f1_local10:SetAlignment( f1_local1.Alignment.Right )
	f1_local10:SetBackingType( 2 )
	f1_local10[0x5328A3EAA342CE5] = f1_local1.UIImage.new()
	f1_local10[0x5328A3EAA342CE5]:SetRGB( 16711680, 0 )
	f1_local10:SetBackingLeftPadding( 10 )
	f1_local10:SetBackingTopPadding( 5 )
	f1_local10:SetBackingRightPadding( 10 )
	f1_local10:SetBackingBottomPadding( 5 )
	f1_local10[0x5328A3EAA342CE5]:SetAnchors( 0, 0, 0, 0 )
	f1_local10:SetRenderChildrenFirst( true )
	f1_local10:addElement( f1_local10[0x5328A3EAA342CE5] )
	f1_local10:SetBackingElementFitText( 1, 400 )
	f1_local10:SetBackingIgnoreParentColor( true )
	f1_local10:SetAnchorsAndPosition( 0, 1, 1, 0, 1424, 1824, -321, -297 )
	f1_local3:addElement( f1_local10 )
	f1_local3[0x3F3F8CBCF2572C9] = f1_local10
	local f1_local11 = nil
	if f1_local0.ShouldDisplayFreeGameTrialUpsellWidget() then
		f1_local11 = f1_local2.BuildRegisteredType( 0xC2553718B0166F8, {
			controllerIndex = f1_local4
		} )
		f1_local11[0x8B72E07B55C3AC0] = "FreeTrialUpsell"
		f1_local11:setPriority( 2 )
		f1_local11:SetAnchorsAndPosition( 1, 0, 0, 1, -589, -73, 85, 145 )
		f1_local3:addElement( f1_local11 )
		f1_local3[0xC2553718B0166F8] = f1_local11
	end
	f0_local0( f1_local3, f1_local4, f1_arg1 )
	return f1_local3
end

MenuBuilder.registerType( 0xC43556A79A4EC31, OBPlayMenu )
LockTable( _M )
