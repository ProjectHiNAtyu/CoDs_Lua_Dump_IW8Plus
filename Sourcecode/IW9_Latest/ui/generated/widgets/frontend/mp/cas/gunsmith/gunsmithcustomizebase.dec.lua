-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
local f0_local0 = {
	[LOADOUT.STICKER_1_SLOT] = "iw9_placement_sticker_1",
	[LOADOUT.STICKER_2_SLOT] = "iw9_placement_sticker_2",
	[LOADOUT.STICKER_3_SLOT] = "iw9_placement_sticker_3"
}
local f0_local1 = function ( f13_arg0, f13_arg1, f13_arg2 )
	f13_arg0.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f13_arg1
	} )
	f13_arg0.HelperBar.id = "HelperBar"
	f13_arg0.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	f13_arg0.HelperBar:setPriority( 10 )
	f13_arg0:addElement( f13_arg0.HelperBar )
	GUNSMITH.AddHelperBarSaveWeaponButton( f13_arg0, f13_arg1, f13_arg2.forShowcase )
end

local f0_local2 = function ( f11_arg0, f11_arg1, f11_arg2 )
	WEAPON.GetStickersAndVinyls()
	f11_arg0.weaponModel = WEAPON.GetWeaponModel( f11_arg1, FrontEndScene.ClientWeapons.Preview, CSV.weaponOffsets.attachmentFile )
	f11_arg0:addElement( f11_arg0.weaponModel )
	local f11_local0 = f11_arg2.weapon:get()
	local f11_local1 = WEAPON.GetMaxStickerSlotsForWeapon( f11_local0 )
	local f11_local2 = WEAPON.GenerateWeaponTable( f11_arg2 )
	f11_local2.stickers = {
		nil,
		"iw9_placement_sticker_1",
		"iw9_placement_sticker_2",
		"iw9_placement_sticker_3",
		"iw9_placement_sticker_4"
	}
	if WEAPON.GetWeaponClass( f11_local2.weapon ) ~= WEAPON.pistolClass then
		table.insert( f11_local2.stickers, "iw9_placement_sticker_5" )
	end
	local f11_local3 = WEAPON.GetWeaponModelName( f11_local0, f11_local2, {
		includeCamos = true,
		includeAttachments = true,
		includeStickers = true,
		controllerIndex = f11_arg1
	} )
	local f11_local4 = f11_arg0:Wait( 2 )
	f11_local4.onComplete = function ()
		local f12_local0 = true
		if CONDITIONS.IsDemoBuildOrDevBuildOrAreDevFeaturesEnabled() then
			f12_local0 = ClientWeapon[0xAADDC5F39D2F2D3]( f11_arg0, f11_arg0, ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview ) )
			if not f12_local0 then
				LUI.FlowManager.RequestDevErrorPopup( "ERROR", "Sticker Validation failed for weapon " .. f11_arg0 )
			end
		end
		if CONDITIONS.InFrontend() then
			local f12_local1 = WEAPON.GenerateWeaponTable( f11_arg0 )
			if f12_local0 then
				local f12_local2 = WEAPON.GetEquippedStickers( f11_arg0 )
				if f12_local2 ~= nil then
					for f12_local3 = LOADOUT.STICKER_1_SLOT, f11_arg0, 1 do
						local f12_local6 = f12_local2[f12_local3]
						if String.IsNilOrEmpty( f12_local6 ) or f12_local6 == WEAPON.StickerNoneValue then
							f12_local1.stickers[f12_local3] = f11_arg0[f12_local3]
						else
							f12_local1.stickers[f12_local3] = f12_local6
						end
					end
				end
			end
			local f12_local2 = WEAPON.GetWeaponModelName( f12_local1.weapon, f12_local1, {
				includeCamos = true,
				includeAttachments = true,
				includeStickers = true,
				controllerIndex = f11_arg0
			} )
			FrontEndScene.RequestWeaponViewModels( {
				f12_local2
			}, f11_arg0 )
			WEAPON.SetModelIfLoaded( f11_arg0, f11_arg0.weaponModel, f12_local2 )
		end
		f11_arg0.WeaponCustomizeButtons:SetStickerSlotState( f12_local0 )
	end
	
end

local f0_local3 = function ( f10_arg0, f10_arg1 )
	local f10_local0 = LOOT.GetScriptBundleForName( LOOT.itemTypes.GUN_SCREEN, f10_arg1.cosmeticAttachment:get() )
	if f10_local0 then
		local f10_local1 = f10_local0[0x287C1DA96264CE6]
		local f10_local2 = f10_local0[0x1656AA6615672BF] or 512
		local f10_local3 = f10_local0[0x683F393A1693D22] or 512
		if not String.IsNilOrEmpty( f10_local1 ) then
			f10_arg0.screenUI = MenuBuilder.BuildRegisteredType( f10_local1, {
				controllerIndex = f10_arg0._controllerIndex,
				gunscreenRef = f10_arg0._equippedCharm
			} )
			f10_arg0.screenUI.id = "screen"
			f10_arg0.screenUI:SetupRenderTarget( "$rtt_watchlcd", f10_local2, f10_local3, 1, 0, 0, 0, 0, f10_arg0._controllerIndex )
			f10_arg0.screenUI:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f10_local2 * _1080p, 0, f10_local3 * _1080p )
			f10_arg0.screenUI:ActivateDirtyCheck( false )
			f10_arg0:addElement( f10_arg0.screenUI )
		end
	end
end

local f0_local4 = function ( f9_arg0, f9_arg1, f9_arg2 )
	if f9_arg2 == GUNSMITH.BlockedWarningType.Stickers then
		local f9_local0 = ACTIONS.AnimateSequence
		local f9_local1 = f9_arg0
		local f9_local2
		if f9_arg1 then
			f9_local2 = "ShowStickerWarning"
		else
			f9_local2 = "HideStickerWarning"
		end
		f9_local0( f9_local1, f9_local2 )
	elseif f9_arg2 == GUNSMITH.BlockedWarningType.Charm or f9_arg2 == GUNSMITH.BlockedWarningType.Gunscreen then
		local f9_local0 = ACTIONS.AnimateSequence
		local f9_local1 = f9_arg0
		local f9_local2
		if f9_arg1 then
			f9_local2 = "ShowCharmWarning"
		else
			f9_local2 = "HideCharmWarning"
		end
		f9_local0( f9_local1, f9_local2 )
	end
end

local f0_local5 = function ( f6_arg0, f6_arg1 )
	if not f6_arg0.waitForLoadedWeaponTimer then
		f6_arg0.waitForLoadedWeaponTimer = LUI.UITimer.new( {
			interval = 50,
			event = "waitForLoadedWeapon"
		} )
		f6_arg0:addElement( f6_arg0.waitForLoadedWeaponTimer )
	end
	f6_arg0:registerEventHandler( "waitForLoadedWeapon", function ( element, event )
		if Game[0x28624DEF6F708C8]( f6_arg0, "frontend_weapon_position_updated" ) then
			GUNSMITH.SetAreInGunsmithScene( false )
			local f7_local0 = f6_arg0:Wait( 500 )
			f7_local0.onComplete = function ()
				element.WeaponCustomizeButtons._focusedElement:processEvent( {
					name = "button_over"
				} )
			end
			
			if f6_arg0.waitForLoadedWeaponTimer then
				f6_arg0.waitForLoadedWeaponTimer:closeTree()
				f6_arg0.waitForLoadedWeaponTimer = nil
			end
		end
	end )
end

local f0_local6 = function ( f4_arg0, f4_arg1, f4_arg2 )
	if f4_arg2.addBackoutAction then
		f4_arg0:AddGamepadEventCallback( "button_secondary", function ( f5_arg0, f5_arg1 )
			local f5_local0 = f5_arg1.controller or f4_arg0
			ACTIONS.LeaveMenu( f5_arg0 )
		end )
	end
end

local f0_local7 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdateBlockedWarning = f0_local0
	if Engine[0x2DA54CF5D6B7F02]() then
		if not f3_arg2.loadoutIndex then
			DebugPrint( "WARNING: Missing \"loadoutIndex\" option for WeaponCustomize menu. Only OK after a MyChanges." )
			f3_arg2.loadoutIndex = 0
		end
		if not f3_arg2.weaponSlot then
			DebugPrint( "WARNING: Missing \"weaponSlot\" option for WeaponCustomize menu. Only OK after a MyChanges." )
			f3_arg2.weaponSlot = 0
		end
	end
	Engine[0x805D0407BF691DA]()
	assert( f3_arg2.loadoutIndex )
	assert( f3_arg2.weaponSlot )
	f3_arg0._loadoutIndex = f3_arg2.loadoutIndex
	f3_arg0._weaponSlot = f3_arg2.weaponSlot
	GUNSMITH.SetupWeaponData( f3_arg0, f3_arg1, f3_arg0._weaponSlot, f3_arg2.forShowcase )
	f3_arg0._selectedWeapon = f3_arg0._weaponPlayerData.weapon:get()
	local f3_local0 = WEAPON.GetWeaponClass( f3_arg0._selectedWeapon )
	if GUNSMITH.WasInGunsmithScene() then
		f0_local0( f3_arg0, f3_arg1 )
	end
	f0_local0( f3_arg0, f3_arg1, f3_arg0._weaponPlayerData )
	GUNSMITH.SetAreInWeaponPreviewScene( true )
	WEAPON.SetCustomizeSceneForWeapon( f3_arg0._selectedWeapon )
	f0_local0( f3_arg0, f3_arg0._weaponPlayerData )
	f3_arg0.WeaponCustomizeButtons:SetupButtons( f3_arg1, f3_arg2.weaponSlot, f3_arg2.loadoutIndex, f3_arg2.forShowcase )
	GUNSMITH.SetupSaveWeaponPopup( f3_arg0, f3_arg1, f3_arg2 )
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
	f0_local0( f3_arg0, f3_arg1, f3_arg2 )
end

local f0_local8 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function GunsmithCustomizeBase( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "GunsmithCustomizeBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	GUNSMITH.SetupGunsmithMenu( self, f1_local1, controller )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "GunsmithCustomizeBase", GunsmithCustomizeBase )
LockTable( _M )
