-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
FenceMLGAccount = LUI.Class( LUI.Fence )
FenceMLGAccount.init = function ( f8_arg0 )
	LUI.Fence.init( f8_arg0 )
end

FenceMLGAccount.Start = function ( f7_arg0 )
	local f7_local0 = Engine[0x45B054C920178E9]()
	if MLG[0x6F1CEE91DAA0B95]( f7_local0 ) == GAMEBATTLES.INVALID_MATCH_ID then
		MLG[0x997C5A92C50E31C]( f7_local0 )
	end
end

FenceMLGAccount.Stop = function ( f6_arg0 )
	LUI.FlowManager.RequestLeaveMenuByName( "popup_getting_mlg_account", true )
	f6_arg0._openedWaitPopup = false
end

FenceMLGAccount.OpenPopup = function ( f4_arg0 )
	local f4_local0 = f4_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_getting_mlg_account", false, nil, false, {
		onCancel = function ( f5_arg0, f5_arg1 )
			f4_arg0._state = LUI.Fence.STATE.fail
		end
	}, nil, true, true )
	f4_arg0._openedWaitPopup = true
end

FenceMLGAccount.PostFail = function ( f3_arg0 )
	local f3_local0 = Engine[0x45B054C920178E9]()
	if f3_arg0._state == LUI.Fence.STATE.fail then
		if f3_arg0._errorCode == GAMEBATTLES.MLG_ERR_CODE.CANNOT_CONNECT then
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "MLGGamebattlesCannotConnectPopup", false, f3_local0, false, {
				controllerIndex = f3_local0
			} )
		elseif f3_arg0._errorCode == GAMEBATTLES.MLG_ERR_CODE.NO_SOCIAL_PRIVILEGES then
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "MLGGamebattlesNoSocialNetworkPrivilegesPopup", false, f3_local0, false, {
				controllerIndex = f3_local0
			} )
		elseif f3_arg0._errorCode == GAMEBATTLES.MLG_ERR_CODE.USER_NOT_REGISTERED then
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "GameBattlesUnregisteredUserPopup", false, f3_local0, false, {
				controllerIndex = f3_local0
			} )
		elseif f3_arg0._errorCode == GAMEBATTLES.MLG_ERR_CODE.FIRST_TIME_ENTRY then
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "GameBattlesFirstTimePopup", false, f3_local0, false, {
				controllerIndex = f3_local0
			} )
		end
	end
end

FenceMLGAccount.UpdateState = function ( f2_arg0 )
	assert( f2_arg0._state ~= LUI.Fence.STATE.fail )
	f2_arg0._state = LUI.Fence.STATE.pass
	local f2_local0 = Engine[0x45B054C920178E9]()
	local f2_local1 = MLG[0xBA9CBCB3B3DF1DF]( f2_local0 )
	if Engine[0x9D348E40740E9A8]() and not Engine[0x93D56A3736027F2]( f2_local0 ) then
		f2_arg0._state = LUI.Fence.STATE.fail
		f2_arg0._errorCode = GAMEBATTLES.MLG_ERR_CODE.NO_SOCIAL_PRIVILEGES
	elseif f2_local1 == GAMEBATTLES.MLG_ACCOUNT_STATE.RETRIEVING then
		f2_arg0._state = LUI.Fence.STATE.block
	elseif f2_local1 == GAMEBATTLES.MLG_ACCOUNT_STATE.UNAVAILABLE then
		f2_arg0._state = LUI.Fence.STATE.block
		MLG[0x997C5A92C50E31C]( f2_local0 )
	elseif f2_local1 == GAMEBATTLES.MLG_ACCOUNT_STATE.NO_ACCOUNT then
		f2_arg0._state = LUI.Fence.STATE.fail
		f2_arg0._errorCode = GAMEBATTLES.MLG_ERR_CODE.USER_NOT_REGISTERED
	elseif f2_local1 == GAMEBATTLES.MLG_ACCOUNT_STATE.ACCOUNT_ERROR then
		f2_arg0._state = LUI.Fence.STATE.fail
		f2_arg0._errorCode = GAMEBATTLES.MLG_ERR_CODE.CANNOT_CONNECT
	elseif f2_local1 == GAMEBATTLES.MLG_ACCOUNT_STATE.HAS_ACCOUNT then
		local f2_local2 = PlayerData[0x8B73907B55C4D71]( f2_local0, CoD.StatsGroup.Common )
		if not f2_local2.registeredToGamebattles:get() then
			f2_arg0._state = LUI.Fence.STATE.fail
			f2_arg0._errorCode = GAMEBATTLES.MLG_ERR_CODE.FIRST_TIME_ENTRY
		end
	end
	if f2_arg0._state == LUI.Fence.STATE.block and not f2_arg0._openedWaitPopup then
		f2_arg0:OpenPopup()
	end
end

function PopupGettingMLGAccount( f1_arg0, f1_arg1 )
	local f1_local0 = assert
	local f1_local1
	if f1_arg1 then
		f1_local1 = f1_arg1
	else
		f1_local1 = f1_arg1.onCancel
	end
	f1_local0( f1_local1 )
	local f1_local2 = MenuBuilder.BuildRegisteredType( "LiveTextBoxWithCancel", {
		message = Engine[0xED84C33EC5F01EA]( "MLG_GAMEBATTLES/FENCE_MLGACCOUNT" ),
		cancel_func = f1_arg1.onCancel
	} )
	f1_local2.id = "popup_getting_mlg_account"
	return f1_local2
end

MenuBuilder.registerType( "popup_getting_mlg_account", PopupGettingMLGAccount )
LUI.Fence.Register( "mlgAccount", FenceMLGAccount )
LockTable( _M )
