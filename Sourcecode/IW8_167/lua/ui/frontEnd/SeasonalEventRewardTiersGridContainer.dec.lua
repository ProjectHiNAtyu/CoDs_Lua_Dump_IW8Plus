-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
local f0_local0 = {
	CYCLE = 300,
	END = 1600,
	FLARE = 800,
	END_DOUBLE = 2400,
	PROGRESS = 500
}
local f0_local1 = function ( f22_arg0, f22_arg1, f22_arg2 )
	if f22_arg2 then
		f22_arg1:AddTooltipData( f22_arg0, {
			promptsData = {
				{
					button_ref = "button_primary",
					keyprompt_text = Engine.CBBHFCGDIC( "KEY/MOUSE1" ),
					helper_text = Engine.CBBHFCGDIC( "LUA_MENU/PREVIEW" )
				}
			}
		} )
	else
		f22_arg1:RemoveToolTipData()
	end
end

local f0_local2 = function ( f21_arg0, f21_arg1 )
	local f21_local0 = #f21_arg0._rewardsData - 1
	for f21_local5, f21_local6 in ipairs( f21_arg0._rewardsData ) do
		if f21_local6 then
			local f21_local4 = tonumber( f21_local6.level )
			if f21_arg0.maxPoints < tonumber( f21_local6.cost ) then
				f21_local0 = f21_local5 - 1
				f21_arg0._currentLevel = f21_local4 - 1
				break
			end
		end
	end
	f21_arg0.Grid:SetFocusedPosition( {
		y = 0,
		x = f21_local0
	}, true )
end

local f0_local3 = function ( f12_arg0 )
	if f12_arg0._isAnimating then
		
	else
		
	end
	local f12_local0 = 0
	local f12_local1 = 0
	for f12_local14, f12_local15 in ipairs( f12_arg0.Grid:GetBuiltChildren() ) do
		local f12_local5 = f0_local0.END
		if f12_local15.isMultiItemTier and 1 < #f12_local15.newUnlocks then
			f12_local5 = f0_local0.END_DOUBLE
		end
		if f12_local15.newUnlocks and #f12_local15.newUnlocks < #f12_arg0._totalPoints and (not (f12_local14 ~= 1 or 0 >= #f12_local15.newUnlocks) or 0 < f12_local0) then
			for f12_local12, f12_local13 in ipairs( f12_arg0._totalPoints ) do
				if 0 < f12_local15:GetProgress( f12_local12 ) then
					f12_local15:SetProgress( 0, 0, f12_local12 )
					local f12_local9 = f12_arg0
					local f12_local10 = f12_arg0.Wait
					local f12_local11
					if f12_local14 == 1 then
						f12_local11 = 1
					else
						f12_local11 = f12_local1
					end
					f12_local10 = f12_local10( f12_local9, f12_local11 )
					f12_local10.onComplete = function ()
						f12_arg0:EnableGlow( true, f12_arg0 )
						f12_arg0:SetProgress( f12_arg0, f12_arg0.PROGRESS, f12_arg0 )
						local f19_local0 = f12_arg0:Wait( f12_arg0.FLARE )
						f19_local0.onComplete = function ()
							f19_local0:EnableGlow( false, f19_local0 )
						end
						
					end
					
				end
			end
		end
		if f12_local15.newUnlocks and 0 < #f12_local15.newUnlocks then
			if f12_local0 < 1 then
				f12_arg0.Grid:SetDirectionalInputEnabled( false )
				f12_arg0.Grid:SetMouseFocusBlocker( true )
				f12_arg0.Grid:SetHandleMouse( false )
			end
			local f12_local6 = f12_arg0:Wait( math.max( f12_local1, 1 ) )
			f12_local6.onComplete = function ()
				f12_arg0.Grid:SetFocusedPosition( {
					y = 0,
					x = f12_arg0 - 1
				}, true )
				f12_arg0._isAnimating = true
				f12_arg0:SetIsAnimating( true )
				local f14_local0 = f12_arg0.FLARE
				for f14_local4, f14_local5 in ipairs( f12_arg0.newUnlocks ) do
					f12_arg0:EnableGlow( true, f14_local5 )
					f12_arg0:SetProgress( 1, f12_arg0.PROGRESS, f14_local5 )
					local f14_local6 = f12_arg0:Wait( f12_arg0.PROGRESS )
					f14_local6.onComplete = function ()
						f14_local0:EnableGlow( false, f14_local0 )
						ACTIONS.AnimateSequence( f14_local0, "TierCompleteFlare" )
						if f14_local0.isMultiItemTier and f14_local0._lootIndex ~= f14_local0 then
							local f16_local0 = f14_local0
							local f16_local1 = f16_local0
							f16_local0 = f16_local0.Wait
							local f16_local2
							if 1 < #f14_local0.newUnlocks then
								f16_local2 = f14_local0.FLARE
								if not f16_local2 then
								
								else
									f16_local0 = f16_local0( f16_local1, f16_local2 )
									f16_local0.onComplete = function ()
										f16_local0:CycleLootCards( {
											button = "down"
										}, true )
										local f17_local0 = f16_local0:Wait( f16_local0.CYCLE )
										f17_local0.onComplete = function ()
											f17_local0:PlayRarityFlare( f17_local0.lootData.rarity )
											f17_local0:SetLocked( false, f17_local0 )
										end
										
									end
									
								end
							end
							f16_local2 = 1
						elseif f14_local0 == 1 then
							f14_local0:PlayRarityFlare( f14_local0.lootData.rarity )
							f14_local0:SetLocked( false, f14_local0 )
						end
					end
					
					f14_local6 = f12_arg0:Wait( f12_arg0 )
					f14_local6.onComplete = function ()
						f14_local0:MarkCompleteAnimSeen( f14_local0 )
						if f14_local0 == #f14_local0.newUnlocks then
							f14_local0:SetIsAnimating( false )
						end
					end
					
				end
			end
			
			f12_local0 = f12_local0 + 1
			f12_local1 = f12_local1 + f12_local5
		end
	end
	if 0 < f12_local1 then
		f12_local2 = f12_arg0:Wait( f12_local1 )
		f12_local2.onComplete = function ()
			f12_arg0._isAnimating = false
			f12_arg0.Grid:SetDirectionalInputEnabled( true )
			f12_arg0.Grid:SetMouseFocusBlocker( false )
			f12_arg0.Grid:SetHandleMouse( true )
		end
		
	else
		f12_arg0._isAnimating = false
		f12_arg0.Grid:SetDirectionalInputEnabled( true )
		f12_arg0.Grid:SetMouseFocusBlocker( false )
		f12_arg0.Grid:SetHandleMouse( true )
	end
	return 0 < f12_local0
end

local f0_local4 = function ( f11_arg0, f11_arg1 )
	local f11_local0 = assert
	local f11_local1
	if f11_arg1 then
		f11_local1 = f11_arg1
	else
		f11_local1 = f11_arg1.rewardsData and f11_arg1.totalPoints
	end
	f11_local0( f11_local1 )
	f11_local0 = assert
	if type( f11_arg1.totalPoints ) ~= "table" or #f11_arg1.totalPoints ~= 2 then
		f11_local1 = false
	else
		f11_local1 = true
	end
	f11_local0( f11_local1 )
	f11_arg0._rewardsData = f11_arg1.rewardsData
	f11_arg0.finalTierCost = f11_arg0._rewardsData[#f11_arg0._rewardsData].cost
	f11_arg0._totalPoints = f11_arg1.totalPoints
	f11_arg0.maxPoints = math.max( f11_arg1.totalPoints[1], f11_arg1.totalPoints[2] )
	f11_arg0.Grid:SetNumChildren( #f11_arg0._rewardsData )
	f11_arg0.Grid:RefreshContent()
	if not f0_local0( f11_arg0 ) then
		f0_local0( f11_arg0, true )
	end
end

local f0_local5 = function ( f10_arg0, f10_arg1, f10_arg2 )
	local f10_local0 = f10_arg0._currentChild and f10_arg0._currentChild.itemData or nil
	local f10_local1
	if f10_local0 then
		f10_local1 = #f10_local0.lootTable
		if not f10_local1 then
		
		else
			if 1 < f10_local1 then
				if f10_arg1.button == "up" then
					if f10_arg0._lootIndex < f10_local1 then
						f10_arg0._lootIndex = f10_arg0._lootIndex + 1
					else
						f10_arg0._lootIndex = 1
					end
				elseif f10_arg1.button == "down" then
					if 1 < f10_arg0._lootIndex then
						f10_arg0._lootIndex = f10_arg0._lootIndex - 1
					else
						f10_arg0._lootIndex = f10_local1
					end
				end
				f10_arg0._currentChild:CycleLootCards( f10_arg0._lootIndex, nil, f10_arg2 )
			end
		end
	end
	f10_local1 = 0
end

local f0_local6 = function ( f4_arg0, f4_arg1, f4_arg2 )
	f4_arg0._controllerIndex = f4_arg1
	f4_arg0.SetupData = f0_local0
	f4_arg0.CycleLootCards = f0_local0
	local f4_local0 = function ( f6_arg0, f6_arg1, f6_arg2 )
		local f6_local0 = f6_arg1 + 1
		if not f4_arg0._rewardsData or #f4_arg0._rewardsData < f6_local0 then
			
		end
		local f6_local1 = f4_arg0._rewardsData[f6_local0]
		local f6_local2
		if f6_local1 then
			f6_local2 = f6_local1.level
			if not f6_local2 then
			
			else
				f6_arg0:SetLevel( f6_local2 )
				local f6_local3
				if f6_local1 then
					f6_local3 = f6_local1
				else
					f6_local3 = f6_local1.lootTable[1]
				end
				local f6_local4
				if f6_local1 then
					f6_local4 = f6_local1
				elseif 1 < #f6_local1.lootTable then
					if f6_local3 then
						f6_local4 = f6_local3
					else
						f6_local4 = tonumber( f6_local3.tierGroup )
					end
				else
					f6_local4 = false
				end
				f6_arg0.isMultiItemTier = f6_local4
				if f6_arg0.isMultiItemTier and f6_arg0.LootItemCardMiniDouble.FlipFocusable then
					f6_arg0.LootItemCardMiniDouble.FlipFocusable:AddTooltipData( f4_arg0._controllerIndex, {
						promptsData = {
							{
								button_ref = "button_right_stick",
								keyprompt_text = Engine.CBBHFCGDIC( "KEY/MOUSE1" ),
								helper_text = Engine.CBBHFCGDIC( "BATTLEPASS/FLIP" )
							}
						}
					} )
				end
				f6_arg0.itemData = f6_local1
				f6_arg0:SetupLootData( f6_local1 )
				f6_local4 = f6_arg0.lootData
				f6_arg0:SetIsAnimating( f4_arg0._isAnimating )
				local f6_local5
				if f6_local1 then
					f6_local5 = f6_local1.cost
					if not f6_local5 then
					
					else
						f6_arg0:SetCost( f6_local5, {
							costString = "SEASONAL_EVENT_TU_WZ350/TIER_COST"
						} )
						local f6_local6 = 0
						if 1 < f6_local0 then
							f6_local6 = f4_arg0._rewardsData[f6_local0 - 1].cost
						end
						f6_arg0.unlockIds = {}
						f6_arg0.newUnlocks = {}
						for f6_local17, f6_local18 in ipairs( f4_arg0._totalPoints ) do
							table.insert( f6_arg0.unlockIds, #f4_arg0._totalPoints * f6_arg1 + f6_local17 )
							f6_arg0:EnableGlow( false, f6_local17 )
							local f6_local10 = 0
							if f6_local5 <= f6_local18 then
								f6_local10 = 1
							elseif f6_local6 < f6_local18 then
								f6_local10 = (f6_local18 - f6_local6) / (f6_local5 - f6_local6)
							end
							if f6_local10 < 1 then
								ACTIONS.AnimateSequence( f6_arg0, "HideCheckbox" )
							end
							local f6_local11
							if f6_arg0.isMultiItemTier and not f6_local17 then
								f6_local11 = f6_local17
							else
								f6_local11 = 1
							end
							local f6_local12 = f6_arg0._ownedLoot[f6_local11]
							if not f6_local12 then
								f6_local12 = 1 <= f6_local10
							end
							local f6_local13 = SEASONAL_EVENT.GetSeenUnlockID( f4_arg0._controllerIndex, f6_arg0.unlockIds[f6_local17] )
							f6_arg0:SetOwned( f6_local12, f6_local11 )
							if f6_arg0:GetProgress( f6_local17 ) < 1 and 1 <= f6_local10 and (Dvar.IBEGCHEFE( "test_ignore_rewards_unlock_seen" ) or not f6_local13) then
								table.insert( f6_arg0.newUnlocks, f6_local17 )
								f6_arg0:SetLocked( true, f6_local17 )
							else
								f6_arg0:SetProgress( f6_local10, 0, f6_local17 )
								local f6_local14 = f6_arg0
								local f6_local15 = f6_arg0.SetLocked
								local f6_local16
								if f6_arg0.isMultiItemTier or 0 >= #f6_arg0.newUnlocks then
									f6_local16 = not f6_local12
								else
									f6_local16 = true
								end
								f6_local15( f6_local14, f6_local16, f6_local17 )
							end
							f6_arg0._initialized = true
						end
						f6_arg0._column = f6_arg1
						f6_arg0:UpdateExpandedState()
						f6_arg0:SetDirectionalInputEnabled( not f4_arg0._isAnimating )
						if not f6_arg0._buttonHandlerAdded then
							f6_arg0._buttonHandlerAdded = true
							f6_arg0:addEventHandler( "button_over", function ( f9_arg0, f9_arg1 )
								if f6_arg0._focusItem == nil or f6_arg0._focusItem ~= f9_arg0 then
									if f6_arg0._focusItem ~= nil then
										f6_arg0( f6_arg0, f6_arg0._focusItem, false )
										f6_arg0._focusItem:processEvent( {
											name = "lose_active"
										} )
									end
									f6_arg0._focusItem = f9_arg0
									f6_arg0._currentChild = f6_arg0
									f6_arg0._lootIndex = 1
								end
							end )
							f6_arg0.LootItemCardMiniDouble.FlipFocusable:addEventHandler( "button_action", function ( f8_arg0, f8_arg1 )
								if f6_arg0._backCardPulledUp then
									f6_arg0:CycleLootCards( {
										button = "down"
									} )
								end
							end )
							f6_arg0.LootItemCardMiniDouble:addEventHandler( "button_action", function ( f7_arg0, f7_arg1 )
								f7_arg0 = f7_arg0:getParent()
								if not f6_arg0._isAnimating and f7_arg1.controller == f6_arg0._controllerIndex and LOOT.CanPreview( f7_arg0.lootData.type, f7_arg0.lootData.itemID ) then
									STORE.PreviewItem( f6_arg0._controllerIndex, f7_arg0.lootData.type, f7_arg0.lootData.itemID )
								end
								return true
							end )
						end
					end
				end
				f6_local5 = 0
			end
		end
		f6_local2 = 0
	end
	
	f4_arg0.Grid:SetSnapOnWrapEnabled( true )
	f4_arg0.Grid:SetRefreshChild( f4_local0 )
	f4_arg0.Grid:SetMeasureColumnFunction( LUI.ExpanderUtils.GenerateMeasureColumnFunction( 150 * _1080p ) )
	f4_arg0:addEventHandler( "gamepad_button", function ( f5_arg0, f5_arg1 )
		if f5_arg1.down and not f4_arg0._isAnimating and (f5_arg1.button == "up" or f5_arg1.button == "down") then
			f4_arg0( f4_arg0, f5_arg1 )
		end
	end )
end

function SeasonalEventRewardTiersGridContainer( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 900 * _1080p, 0, 350 * _1080p )
	self.id = "SeasonalEventRewardTiersGridContainer"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	local Grid = nil
	
	Grid = LUI.UIGrid.new( {
		scrollingThresholdX = 0,
		maxVisibleRows = 1,
		maxVelocity = 5000,
		adjustSizeToContent = false,
		scrollingThresholdY = 1,
		wrapX = true,
		maxVisibleColumns = 5,
		wrapY = false,
		arrowsVerticalOffset = 0,
		forcePrimaryAxisScrolling = true,
		buildArrowsLabel = false,
		springCoefficient = 400,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "SeasonalEventRewardTier", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f2_arg0, f2_arg1, f2_arg2 )
			
		end,
		primaryAxis = LUI.DIRECTION.horizontal,
		spacingX = _1080p * 0,
		spacingY = _1080p * 0,
		columnWidth = _1080p * 150,
		rowHeight = _1080p * 250,
		horizontalAlignment = LUI.Alignment.Center,
		verticalAlignment = LUI.Alignment.Top
	} )
	Grid.id = "Grid"
	Grid:setUseStencil( false )
	Grid:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -450, _1080p * 450, _1080p * -272, _1080p * -34 )
	self:addElement( Grid )
	self.Grid = Grid
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "SeasonalEventRewardTiersGridContainer", SeasonalEventRewardTiersGridContainer )
LockTable( _M )
