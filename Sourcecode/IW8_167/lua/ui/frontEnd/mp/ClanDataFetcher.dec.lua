-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
local f0_local0 = "clan_data_fetcher_timer_refresh"
local f0_local1 = 5000
local f0_local2 = 5
local f0_local3 = {
	PROFILE = 1,
	LABELS = 3,
	DATA = 2
}
local f0_local4 = function ( f21_arg0 )
	f21_arg0._isLocked = true
	f21_arg0._labelsCache = nil
	f21_arg0._ignoreTimerForOneCycle = false
	f21_arg0._remainingRetries = f0_local0
	for f21_local3, f21_local4 in ipairs( f21_arg0._clanData.fetchedData ) do
		f21_arg0._clanData.fetchedData[f21_local3] = false
	end
end

local f0_local5 = function ( f19_arg0 )
	f19_arg0._isTimerStarted = true
	f19_arg0.ClanDataFetcherTimer = LUI.UITimer.new( {
		interval = f19_arg0._refreshTime,
		event = f0_local0
	} )
	f19_arg0.ClanDataFetcherTimer.id = "ClanDataFetcherTimer"
	f19_arg0:addElement( f19_arg0.ClanDataFetcherTimer )
	f19_arg0:addAndCallEventHandler( f0_local0, function ( f20_arg0, f20_arg1 )
		f19_arg0:HandleTimerRefresh()
	end )
end

local f0_local6 = function ( f18_arg0 )
	if f18_arg0.ClanDataFetcherTimer ~= nil then
		f18_arg0.ClanDataFetcherTimer:closeTree()
		f18_arg0.ClanDataFetcherTimer = nil
	end
	f18_arg0._isTimerStarted = false
	f18_arg0._ignoreTimerForOneCycle = false
end

local f0_local7 = function ( f17_arg0 )
	local f17_local0 = f17_arg0._remainingRetries - 1
	if 0 < f17_local0 then
		f17_arg0._remainingRetries = f17_local0
	else
		f0_local0( f17_arg0 )
		f0_local0( f17_arg0 )
	end
end

local f0_local8 = function ( f16_arg0, f16_arg1, f16_arg2 )
	assert( f16_arg1 )
	assert( f16_arg2 )
	if f16_arg0._clanId ~= f16_arg1 then
		if f16_arg0._isTimerStarted then
			f16_arg0._ignoreTimerForOneCycle = true
		end
		f0_local0( f16_arg0 )
	end
	f16_arg0._clanId = f16_arg1
	f16_arg0._memberXUID = f16_arg2
	local f16_local0 = Clans2.BJAACDECGE( f16_arg0._controllerIndex, f16_arg1 )
	if f16_local0 then
		f16_local0 = Clans2.IBJFIGED( f16_arg0._controllerIndex, f16_arg2 )
	end
	if f16_local0 and f16_arg0._labelsCache == nil then
		f16_local0 = Clans2.BJFEDEICAC( f16_arg0._controllerIndex, f16_arg1 )
	end
	if f16_local0 then
		f16_arg0._isLocked = false
	end
	if not f16_arg0._isTimerStarted and f16_arg0._useTimer then
		f0_local0( f16_arg0 )
	end
	f0_local0( f16_arg0 )
	return f16_local0
end

local f0_local9 = function ( f15_arg0 )
	if f15_arg0._clanData == nil then
		f15_arg0._clanData = {
			fetchedData = {
				[f0_local0.PROFILE] = false,
				[f0_local0.DATA] = false,
				[f0_local0.LABELS] = false
			}
		}
	end
end

local f0_local10 = function ( f14_arg0 )
	for f14_local3, f14_local4 in ipairs( f14_arg0._clanData.fetchedData ) do
		if not f14_local4 then
			return false
		end
	end
	return true
end

local f0_local11 = function ( f13_arg0 )
	if f0_local0( f13_arg0 ) then
		f0_local0( f13_arg0 )
		f0_local0( f13_arg0 )
		f13_arg0:dispatchEventToParent( {
			name = CLANS.CLAN_EVENTS.CLAN_EXTERNAL_DATA_RESOLVED,
			controllerIndex = f13_arg0._controllerIndex,
			clanData = f13_arg0._clanData
		} )
	end
end

local f0_local12 = function ( f12_arg0, f12_arg1 )
	local f12_local0 = f12_arg1.clanProfiles[1]
	if f12_local0 then
		f12_arg0._clanData.emblemData = f12_local0.emblem
		f12_arg0._clanData.clanDescription = f12_local0.profileDescription
		f12_arg0._clanData.clanAnnouncement = f12_local0.profileAnnouncement
		f12_arg0._clanData.fetchedData[f0_local0.PROFILE] = true
	end
end

local f0_local13 = function ( f11_arg0, f11_arg1 )
	local f11_local0 = f11_arg1.clanDetails[1]
	if f11_local0 then
		f11_arg0._clanData.clanId = f11_local0.clanId
		f11_arg0._clanData.clanName = f11_local0.clanName
		f11_arg0._clanData.clanTag = f11_local0.clanTag
		f11_arg0._clanData.clanPrivacyLevel = f11_local0.clanPrivacyLevel
		f11_arg0._clanData.clanOwner = f11_local0.clanOwner
		f11_arg0._clanData.numClanMembers = f11_local0.numClanMembers
		local f11_local1 = f11_arg0._clanData
		local f11_local2
		if 1 < f11_local0.numClanMembers then
			f11_local2 = 1
		else
			f11_local2 = 0
		end
		f11_local1.clanStatus = f11_local2
		f11_arg0._clanData.fetchedData[f0_local0.DATA] = true
	end
end

local f0_local14 = function ( f10_arg0, f10_arg1 )
	local f10_local0 = CLANS.GetLabelsFromEvent( f10_arg1 )
	if f10_arg0._labelsCache == nil then
		f10_arg0._labelsCache = f10_local0
	end
	f10_arg0._clanData.labels = f10_arg0._labelsCache
	f10_arg0._clanData.fetchedData[f0_local0.LABELS] = true
end

local f0_local15 = function ( f9_arg0, f9_arg1, f9_arg2 )
	f0_local0( f9_arg0 )
	if not f9_arg0._clanData.fetchedData[f9_arg2] and not f9_arg0._isLocked then
		if f9_arg2 == f0_local0.DATA then
			f0_local0( f9_arg0, f9_arg1 )
		elseif f9_arg2 == f0_local0.PROFILE then
			f0_local0( f9_arg0, f9_arg1 )
		elseif f9_arg2 == f0_local0.LABELS then
			f0_local0( f9_arg0, f9_arg1 )
		end
		f0_local0( f9_arg0 )
	end
end

local f0_local16 = function ( f8_arg0 )
	if not f8_arg0._ignoreTimerForOneCycle then
		if CLANS.IsValidId( f8_arg0._clanId ) then
			f0_local0( f8_arg0, f8_arg0._clanId, f8_arg0._memberXUID )
		end
	else
		f8_arg0._ignoreTimerForOneCycle = false
	end
end

local f0_local17 = function ( f7_arg0, f7_arg1 )
	f7_arg0._isTimerStarted = false
	local f7_local0
	if f7_arg1 then
		f7_local0 = f7_arg1.useTimer
		if not f7_local0 then
		
		else
			f7_arg0._useTimer = f7_local0
			f7_arg0._remainingRetries = f0_local0
			if f7_arg0._useTimer then
				if f7_arg1 then
					f7_local0 = f7_arg1.refreshTime
					if not f7_local0 then
					
					else
						f7_arg0._refreshTime = f7_local0
					end
				end
				f7_local0 = f0_local0
			end
		end
	end
	f7_local0 = false
end

local f0_local18 = function ( f3_arg0 )
	f3_arg0:addEventHandler( CLANS.CLAN_EVENTS.CLAN_PROFILE_RESOLVED, function ( f6_arg0, f6_arg1 )
		f3_arg0( f3_arg0, f6_arg1, f3_arg0.PROFILE )
	end )
	f3_arg0:addEventHandler( CLANS.CLAN_EVENTS.CLAN_DATA_RESOLVED, function ( f5_arg0, f5_arg1 )
		f3_arg0( f3_arg0, f5_arg1, f3_arg0.DATA )
	end )
	f3_arg0:addEventHandler( CLANS.CLAN_EVENTS.CLAN_SEARCH_TAGS, function ( f4_arg0, f4_arg1 )
		f3_arg0( f3_arg0, f4_arg1, f3_arg0.LABELS )
	end )
end

local f0_local19 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0._clanId = CLANS.INVALID_CLAN_ID_STRING
	f2_arg0._memberXUID = nil
	f2_arg0._clanData = nil
	f2_arg0._labelsCache = nil
	f2_arg0._isLocked = true
	f2_arg0._ignoreTimerForOneCycle = false
	f2_arg0.HandleTimerRefresh = f0_local0
	f2_arg0.FetchExternalClanData = f0_local0
	f2_arg0.StopRefreshTimer = f0_local0
	f0_local0( f2_arg0 )
	f0_local0( f2_arg0, f2_arg2 )
	f0_local0( f2_arg0 )
end

function ClanDataFetcher( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 100 * _1080p, 0, 100 * _1080p )
	self.id = "ClanDataFetcher"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine.DDJFBBJAIG() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ClanDataFetcher", ClanDataFetcher )
LockTable( _M )
