-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
FenceDiscCheck = LUI.Class( LUI.Fence )
FenceDiscCheck.init = function ( f12_arg0 )
	LUI.Fence.init( f12_arg0 )
end

FenceDiscCheck.Start = function ( f11_arg0 )
	
end

FenceDiscCheck.Stop = function ( f10_arg0 )
	LUI.FlowManager.RequestLeaveMenuByName( "ModeFencePopup", true )
	f10_arg0._openedWaitPopup = false
end

FenceDiscCheck.OnBackOut = function ( f9_arg0 )
	
end

local f0_local0 = function ( f5_arg0 )
	if not f5_arg0._isShowingBlockingPopup then
		local f5_local0 = {
			popupCallbackFunc = function ()
				f5_arg0._state = LUI.Fence.STATE.pass
			end,
			popupFailFunc = function ()
				f5_arg0._state = LUI.Fence.STATE.fail
			end,
			popupCancelFunc = function ()
				f5_arg0._state = LUI.Fence.STATE.fail
			end
		}
		f5_arg0._isShowingBlockingPopup = true
		LUI.FlowManager.RequestPopupMenu( nil, Install.DiscErrorPopupMenu, true, f5_arg0._controllerIndex, false, f5_local0, nil, false, true )
	end
end

FenceDiscCheck.PostFail = function ( f2_arg0 )
	if f2_arg0._state == LUI.Fence.STATE.fail then
		local f2_local0 = {
			popupCallbackFunc = function ()
				f2_arg0._state = LUI.Fence.STATE.pass
			end,
			popupCancelFunc = function ()
				if not CONDITIONS.IsCortezSubExe() then
					local f3_local0 = LUI.FlowManager.RequestRestoreMenu
					local f3_local1
					if Engine[0xBBF0609667DBEA]() then
						f3_local1 = "MainMenu"
					else
						f3_local1 = "MainMenuOffline"
					end
					f3_local0( f3_local1, nil, f2_arg0._controllerIndex, true )
				else
					PLAY_MENU.PLAY_MENU.ForcePlayerBackToCODHQExecutableOffline( f2_arg0._controllerIndex )
				end
			end
		}
		f2_arg0._isShowingBlockingPopup = true
		LUI.FlowManager.RequestPopupMenu( nil, Install.DiscErrorPopupMenu, true, f2_arg0._controllerIndex, false, f2_local0, nil, false, true )
	end
end

FenceDiscCheck.UpdateState = function ( f1_arg0 )
	assert( f1_arg0._state ~= LUI.Fence.STATE.fail )
	if not f1_arg0._isEnteringFromMainMenuDataSource then
		f1_arg0._isEnteringFromMainMenuDataSource = LUI.DataSourceInGlobalModel.new( "frontEnd.isEnteringFromMainMenu" )
	end
	f1_arg0._state = LUI.Fence.STATE.pass
	if f1_arg0._isEnteringFromMainMenuDataSource and f1_arg0._isEnteringFromMainMenuDataSource:GetValue( f1_arg0._controllerIndex ) then
		return 
	end
	f1_arg0._controllerIndex = Engine[0x45B054C920178E9]()
	if not Install.IsDiscCheckRequired( f1_arg0._controllerIndex ) then
		return 
	elseif not f1_arg0._isDiscCheckSuccessful and not Install.StartDiscCheck( f1_arg0._controllerIndex ) then
		f1_arg0._state = LUI.Fence.STATE.fail
		return 
	end
	f1_arg0._isDiscCheckSuccessful = true
	if not f1_arg0._isShowingBlockingPopup then
		f0_local0( f1_arg0 )
		f1_arg0._state = LUI.Fence.STATE.block
	end
end

LUI.Fence.Register( "discCheck", FenceDiscCheck )
LockTable( _M )
