-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:48
module( ..., package.seeall )
require( "ui.generated.widgets.genericbutton" )
require( "ui.generated.widgets.frontend.menutitle" )
local f0_local0 = function ( f10_arg0, f10_arg1, f10_arg2 )
	assert( f10_arg2 )
	if Engine[0xC436AD5B92B0408]( f10_arg1 ) then
		LUI.FlowManager.RequestPopupMenu( f10_arg0, "OverwriteSaveWarningPopup", true, f10_arg1, false, {
			mapName = f10_arg2
		} )
	else
		local f10_local0 = MenuBuilder.BuildRegisteredType( "SPPauseDifficultyFlyin", {
			controllerIndex = f10_arg1
		} )
		f10_local0:SetMap( f10_arg2 )
		LUI.FlowManager.RequestPopupMenu( nil, "FlyInPopup", true, f10_arg1, false, {
			disableQuickAccessShortcuts = false,
			widget = f10_local0
		} )
	end
end

local f0_local1 = function ( f6_arg0, f6_arg1 )
	local f6_local0 = nil
	local f6_local1 = -2
	local f6_local2 = MapInfo.spLevels.GetFile()
	if not MapInfo.UsingSingleplayerMapAsset() then
		local f6_local3 = StringTable[0xFD4E49A34DD43AE]( f6_local2 ) - 1
		for f6_local4 = 0, f6_local3, 1 do
			local f6_local7 = CSV.ReadRowWithFile( MapInfo.spLevels, f6_local2, f6_local4 )
			local f6_local8 = f6_local7.ref
			if SPSharedUtils.IsLevelInFileSystem( f6_local8 ) then
				if String.IsNilOrEmpty( f6_local7.previewBack ) then
					f6_local7.previewBack = CoD.PLACEHOLDER_TEXTURE
				end
				if String.IsNilOrEmpty( f6_local7.previewFront ) then
					f6_local7.previewFront = CoD.PLACEHOLDER_TEXTURE
				end
				if String.IsNilOrEmpty( f6_local7.image ) then
					f6_local7.image = CoD.PLACEHOLDER_TEXTURE
				end
				local f6_local9 = {
					disabled = true,
					isCurrentMission = f6_local8 == f6_arg0._currentMission,
					levelIndex = f6_local4,
					levelRef = f6_local8,
					displayName = Engine[0xED84C33EC5F01EA]( f6_local7.string ),
					locationText = Engine[0xED84C33EC5F01EA]( f6_local7.location ),
					objectiveText = Engine[0xED84C33EC5F01EA]( f6_local7.desc ),
					previewBack = RegisterMaterial( f6_local7.previewBack ),
					previewFront = RegisterMaterial( f6_local7.previewFront ),
					image = RegisterMaterial( f6_local7.image ),
					positionLeft = f6_local7.posLeft,
					positionTop = f6_local7.posTop,
					latitude = f6_local7.latitude,
					longitude = f6_local7.longitude,
					mapPosition = f6_local7.mapPosition,
					focusSFX = f6_local7.focusSFX
				}
				if f6_local9.missionState == SPSharedUtils.MissionState.COMPLETE then
					f6_local1 = f6_local4
				end
				local f6_local10 = f6_local4 - 1 <= f6_local1
				local f6_local11
				if f6_local9.missionState == SPSharedUtils.MissionState.LOCKED then
					f6_local11 = f6_local10
				else
					f6_local11 = true
				end
				if f6_local11 or SPSharedUtils.UnlockAllMissions( f6_arg1 ) then
					if f6_local9.isCurrentMission then
						f6_local0 = #f6_arg0._levelList
					end
					f6_local9.disabled = false
					table.insert( f6_arg0._levelList, f6_local9 )
				end
			end
		end
	else
		local f6_local3 = Lobby[0xF14659C6AA6180F]()
		for f6_local4 = 0, f6_local3 - 1, 1 do
			local f6_local7 = Game[0x16A8B517C8280EA]( f6_local4 )
			local f6_local8 = MapInfo.BundleGetName( f6_local7 )
			if SPSharedUtils.IsLevelInFileSystem( f6_local8 ) then
				local f6_local9 = {
					focusSFX = 0x6E5C9271089101C,
					disabled = true,
					bundle = f6_local7,
					isCurrentMission = f6_local7.mapName == f6_arg0._currentMission,
					levelIndex = f6_local4,
					levelRef = f6_local8,
					displayName = MapInfo.BundleGetDisplayName( f6_local7 ),
					locationText = MapInfo.BundleGetDisplayLocation( f6_local7 ),
					objectiveText = MapInfo.BundleGetDisplayDescription( f6_local7 ),
					previewBack = RegisterMaterial( "white" ),
					previewFront = RegisterMaterial( "white" ),
					image = RegisterMaterial( MapInfo.BundleGetLoadingImageName( f6_local7 ) ),
					positionLeft = MapInfo.BundleGetLocationPositionLeft( f6_local7 ),
					positionTop = MapInfo.BundleGetLocationPositionTop( f6_local7 ),
					latitude = MapInfo.BundleGetLocationLatitude( f6_local7 ),
					longitude = MapInfo.BundleGetLocationLongitude( f6_local7 ),
					mapPosition = MapInfo.BundleGetLocationMapPosition( f6_local7 )
				}
				if f6_local9.missionState == SPSharedUtils.MissionState.COMPLETE then
					f6_local1 = f6_local4
				end
				local f6_local10 = f6_local4 - 1 <= f6_local1
				local f6_local11
				if f6_local9.missionState == SPSharedUtils.MissionState.LOCKED then
					f6_local11 = f6_local10
				else
					f6_local11 = true
				end
				if f6_local11 or SPSharedUtils.UnlockAllMissions( f6_arg1 ) then
					if f6_local9.isCurrentMission then
						f6_local0 = #f6_arg0._levelList
					end
					f6_local9.disabled = false
					table.insert( f6_arg0._levelList, f6_local9 )
				end
			end
		end
	end
	f6_arg0.MissionList:SetRefreshChild( function ( f7_arg0, f7_arg1, f7_arg2 )
		local f7_local0 = f6_arg0._levelList[1 + f6_arg0.MissionList:GetContentIndex( f7_arg1, f7_arg2 )]
		local f7_local1 = {
			isCurrentMission = f7_local0.isCurrentMission,
			levelRef = f7_local0.levelRef,
			displayName = f7_local0.displayName,
			image = f7_local0.image
		}
		f7_arg0:SetButtonDisabled( f7_local0.disabled )
		f7_arg0.Text:setText( f7_local0.displayName )
		f7_arg0:setGainFocusAllSFX( f7_local0.focusSFX )
		f7_arg0._column = f7_arg1
		f7_arg0._row = f7_arg2
		if not f7_arg0.addHandlers then
			f7_arg0.addHandlers = true
			f7_arg0:registerEventHandler( "button_over", function ( element, event )
				f7_arg0.MissionList:SetFocusedPosition( {
					x = element._column,
					y = element._row
				}, true )
				ACTIONS.AnimateSequence( element, "ButtonOver" )
			end )
			f7_arg0:registerEventHandler( "button_action", function ( element, event )
				assert( f7_arg0 )
				local f8_local0 = f7_arg0
				if f8_local0.isCurrentMission then
					LUI.FlowManager.RequestPopupMenu( element, "ResumeOrRestartPopup", false, event.controller, false, {
						controllerIndex = event.controller,
						mapName = f8_local0.levelRef,
						levelName = f8_local0.displayName
					} )
				else
					f7_arg0( element, event.controller, f8_local0.levelRef )
				end
			end )
		end
	end )
	if f6_local0 ~= nil then
		f6_arg0.MissionList:SetDefaultFocus( {
			x = 0,
			y = f6_local0
		} )
	end
	f6_arg0.MissionList:SetNumChildren( #f6_arg0._levelList )
	f6_arg0.MissionList:RefreshContent()
end

local f0_local2 = function ( f5_arg0, f5_arg1, f5_arg2 )
	f5_arg0._levelList = {}
	f0_local0( f5_arg0, f5_arg1 )
end

function CampaignMissionSelect( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "CampaignMissionSelect"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	self.HelperBar.id = "HelperBar"
	self.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	self.HelperBar:setPriority( 10 )
	self:addElement( self.HelperBar )
	local f1_local2 = self
	local MissionList = nil
	
	MissionList = LUI.UIGrid.new( {
		maxVisibleRows = 10,
		maxVisibleColumns = 1,
		adjustSizeToContent = true,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "GenericButton", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f3_arg0, f3_arg1, f3_arg2 )
			
		end,
		spacingX = _1080p * 12,
		spacingY = _1080p * 12,
		columnWidth = _1080p * 420,
		rowHeight = _1080p * 38
	} )
	MissionList.id = "MissionList"
	MissionList:SetMaxVisibleRows( 10 )
	MissionList:SetRowSpacing( 12 )
	MissionList:setUseStencil( true )
	MissionList:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 130, _1080p * 550, _1080p * 216, _1080p * 254 )
	self:addElement( MissionList )
	self.MissionList = MissionList
	
	local MenuTitle = nil
	
	MenuTitle = MenuBuilder.BuildRegisteredType( "MenuTitle", {
		controllerIndex = f1_local1
	} )
	MenuTitle.id = "MenuTitle"
	MenuTitle.MenuTitle:setText( "SP MISSION SELECT", 0 )
	MenuTitle:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, _1080p * 2, _1080p * 107 )
	self:addElement( MenuTitle )
	self.MenuTitle = MenuTitle
	
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		button_ref = "button_secondary",
		helper_text = Engine[0xED84C33EC5F01EA]( 0x4010B35574F3A9F )
	} )
	MenuTitle:AddGamepadEventCallback( "button_secondary", function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or menu
		ACTIONS.LeaveMenu( menu )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "CampaignMissionSelect", CampaignMissionSelect )
LockTable( _M )
