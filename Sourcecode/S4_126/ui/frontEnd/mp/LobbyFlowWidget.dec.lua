-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.frontEnd.CRMMain" )
require( "ui.frontEnd.CRMWebView" )
require( "ui.widgets.DoubleXPNotifications" )
require( "ui.frontEnd.mp.LPPlayMenuButton" )
local f0_local0 = {
	matchMadeLPC = 5,
	waitingForClanLobby = 6,
	searchingForLobby = 1,
	waitingForMatchmaking = 2,
	matchMadeIndividual = 4,
	matchMadeTeam = 3
}
local f0_local1 = 1000
local f0_local2 = function ()
	return Dvar[0x9E5BE3B4BBA4E0E]( "#x3554d1e0d6478fa2a" )
end

local f0_local3 = function ( f26_arg0 )
	local f26_local0
	if f26_arg0._state ~= f0_local0.matchMadeLPC and f26_arg0._state ~= f0_local0.matchMadeIndividual and f26_arg0._state ~= f0_local0.matchMadeTeam then
		f26_local0 = false
	else
		f26_local0 = true
	end
	return f26_local0
end

local f0_local4 = function ( f25_arg0 )
	local f25_local0 = f25_arg0:InMatchMadeState()
	if not f25_local0 then
		if f25_arg0._state ~= f0_local0.waitingForMatchmaking then
			f25_local0 = f25_arg0._delayMatchmakingLobby
		else
			f25_local0 = true
		end
	end
	return f25_local0
end

local f0_local5 = function ( f24_arg0, f24_arg1 )
	assert( f24_arg0._state )
	local f24_local0 = nil
	local f24_local1 = DataSources.frontEnd.lobby.memberMaxCount:GetValue( f24_arg1 ) or 0
	if f24_arg0._state == f0_local0.matchMadeLPC then
		f24_local0 = "LobbyLPCMatchmade"
	elseif f24_arg0._state == f0_local0.matchMadeIndividual then
		f24_local0 = "LobbyIndividualMatchmade"
	elseif f24_arg0._state == f0_local0.matchMadeTeam then
		f24_local0 = "LobbySmallTeamMatchmade"
	end
	assert( f24_local0 )
	return MenuBuilder.BuildRegisteredType( f24_local0, {
		controllerIndex = f24_arg1
	} )
end

local f0_local6 = function ( f23_arg0, f23_arg1 )
	local matchMadeLobby = f23_arg0:GetMatchMadeWidgetToBuild( f23_arg1 )
	assert( matchMadeLobby )
	f23_arg0:addElement( matchMadeLobby )
	f23_arg0.matchMadeLobby = matchMadeLobby
	
	Lobby.PreloadViewHandsForLocalPlayer( f23_arg1 )
	Engine[0x685AE31DEDA30A4]( "squad_lobby" )
end

local f0_local7 = function ( f22_arg0, f22_arg1 )
	if Lobby.IsLPCApprovedGameMode() and DataSources.frontEnd.lobby.memberMaxCount:GetValue( f22_arg1 ) > Dvar[0x22EAAB59AA27E9B]( "#x3d6691e8d4b3aee22" ) then
		f22_arg0._state = f0_local0.matchMadeLPC
	elseif Lobby.IsCurrentGameTypeteamBased() then
		f22_arg0._state = f0_local0.matchMadeTeam
	else
		f22_arg0._state = f0_local0.matchMadeIndividual
	end
end

local f0_local8 = function ( f21_arg0 )
	local f21_local0 = f21_arg0:GetCurrentMenu()
	if f21_local0 and f21_local0.SetDedi then
		f21_local0:SetDedi( f21_arg0 )
	end
end

local f0_local9 = function ( f20_arg0 )
	f20_arg0:dispatchEventToRoot( {
		name = "searching_for_lobby",
		isSearching = f20_arg0._state == f0_local0.searchingForLobby
	} )
end

local f0_local10 = function ( f19_arg0, f19_arg1, f19_arg2 )
	if f19_arg0.matchMakingLobby and f19_arg0.matchMakingLobby:getParent() == f19_arg0 then
		f19_arg0.matchMakingLobby:closeTree()
		f19_arg0.matchMakingLobby = nil
	end
	f19_arg0.matchMakingLobby = MenuBuilder.BuildRegisteredType( f19_arg1, {
		controllerIndex = f19_arg2
	} )
	f19_arg0:addElement( f19_arg0.matchMakingLobby )
	f19_arg0.matchMakingLobby:processEvent( {
		dispatchChildren = true,
		name = "tab_create"
	} )
	f19_arg0:UpdateParentLobbyStatus()
end

local f0_local11 = function ( f17_arg0, f17_arg1 )
	local f17_local0 = f0_local0()
	if not f17_local0 then
		f17_local0 = Lobby[0xF0740ECE49C1DA1]()
	end
	local f17_local1
	if f17_local0 or f17_arg0._state == f0_local0.searchingForLobby then
		f17_local1 = false
	else
		f17_local1 = true
	end
	local f17_local2
	if f17_local0 then
		f17_local2 = f17_local0
	else
		f17_local2 = f17_arg0._state == f0_local0.searchingForLobby
	end
	f0_local0( f17_arg0 )
	if f17_local1 then
		f17_arg0._state = f0_local0.searchingForLobby
		f17_arg0:ReplaceLobbyWidget( "SearchingForLobby", f17_arg1 )
		f17_arg0:dispatchEventToCurrentMenu( {
			show = true,
			name = "refresh_join_info"
		} )
	elseif f17_local2 and not f17_arg0._delayMatchmakingLobby then
		f17_arg0._delayMatchmakingLobby = true
		local f17_local3 = f17_arg0:Wait( f0_local0 )
		f17_local3.onComplete = function ()
			f17_arg0._delayMatchmakingLobby = false
			f17_arg0._state = f17_arg0.waitingForMatchmaking
			f17_arg0:ReplaceLobbyWidget( "MatchmakingLobby", f17_arg0 )
			f17_arg0:dispatchEventToCurrentMenu( {
				show = false,
				name = "refresh_join_info"
			} )
		end
		
	end
	if f17_arg0.LobbyButtons then
		local f17_local3 = f17_arg0._state == f0_local0.searchingForLobby
		if f17_arg0._showingLPButtons ~= f17_local3 then
			if f17_local3 then
				ACTIONS.AnimateSequence( f17_arg0, "ShowLPButtons" )
				f17_arg0.LobbyButtons:processEvent( {
					dispatchChildren = true,
					name = "enable"
				} )
				f17_arg0.LobbyButtons:processEvent( {
					name = "gain_focus",
					controller = f17_arg1
				} )
			else
				ACTIONS.AnimateSequence( f17_arg0, "HideLPButtons" )
				f17_arg0.LobbyButtons:processEvent( {
					dispatchChildren = true,
					name = "disable"
				} )
				f17_arg0.LobbyButtons:processEvent( {
					name = "lose_focus"
				} )
			end
			f17_arg0._showingLPButtons = f17_local3
		end
	end
end

local f0_local12 = function ( f16_arg0, f16_arg1 )
	if not f16_arg0:InMatchMadeState() then
		f16_arg0:UpdateLobbyBasedOnMatchmakerState( f16_arg1 )
	end
	local f16_local0, f16_local1 = Lobby[0xE282396C3A4C54B]()
	if f16_local0 and f16_local1 and f16_local0 == Lobby.PartyState.STARTING then
		local f16_local2 = math.ceil( f16_local1.timeRemaining / 1000 )
		if f16_arg0._state == f0_local0.waitingForMatchmaking and f16_arg0.matchMakingLobby and f16_arg0.matchMakingLobby:getParent() == f16_arg0 then
			f16_arg0.matchMakingLobby:closeTree()
			f16_arg0.matchMakingLobby = nil
			f16_arg0:UpdateLobbyState( f16_arg1 )
			f16_arg0:AddMatchMadeWidget( f16_arg1 )
			f0_local0( f16_arg0 )
		end
	end
	if f16_arg0.CRMMain then
		if f16_arg0:InMatchMadeState() or f16_arg0.CRMMain:ShouldHideCRM() or CONDITIONS.IsGLFrontendEnabled() then
			f16_arg0.CRMMain:HideCRM()
		else
			f16_arg0.CRMMain:SetMinimized( false )
		end
	end
	if f16_arg0.CRMWebView then
		if f16_arg0:InMatchMadeState() then
			f16_arg0.CRMWebView:SwitchVisibility( false )
			local f16_local2 = LUI.WebViewManager.Instance()
			f16_local2:MakeSureFullScreenClosed()
		else
			f16_arg0.CRMWebView:SwitchVisibility( true )
		end
	end
end

local f0_local13 = function ( f15_arg0 )
	if f15_arg0.DoubleXPNotifications then
		local f15_local0 = f15_arg0.DoubleXPNotifications:GetEnablePrompt()
		local f15_local1 = ACTIONS.AnimateSequence
		local f15_local2 = f15_arg0
		local f15_local3
		if f15_local0 then
			f15_local3 = "ShowTokenPrompt"
		else
			f15_local3 = "HideTokenPrompt"
		end
		f15_local1( f15_local2, f15_local3 )
	end
end

local f0_local14 = function ( f14_arg0, f14_arg1 )
	if f14_arg1 then
		f14_arg1:RemoveButtonHelperText( "button_r3", "left" )
	end
end

local f0_local15 = function ( f11_arg0, f11_arg1, f11_arg2 )
	f11_arg0.UpdateLobbyStatus = f0_local0
	f11_arg0.AddMatchMadeWidget = f0_local0
	f11_arg0.UpdateLobbyState = f0_local0
	f11_arg0.GetMatchMadeWidgetToBuild = f0_local0
	f11_arg0.CreatePlayerGrid = CreatePlayerGrid
	f11_arg0.ReplaceLobbyWidget = f0_local0
	f11_arg0.InMatchMadeState = f0_local0
	f11_arg0.ShouldHideJoinInfo = f0_local0
	f11_arg0.UpdateLobbyBasedOnMatchmakerState = f0_local0
	f11_arg0.UpdateDoubleXPToken = f0_local0
	f11_arg0.UpdateParentLobbyStatus = f0_local0
	f11_arg0.LoseFocusCallback = f0_local0
	if CONDITIONS.IsGLFrontendEnabled() then
		if f11_arg0.DoubleXPNotifications then
			f11_arg0.DoubleXPNotifications:SetVisibility( LUI.Visibility.Hidden )
			if f11_arg0.DoubleXPNotifications.bindButton then
				f11_arg0.DoubleXPNotifications.bindButton:registerEventHandler( "button_left_stick", nil )
			end
		end
		f11_arg0.CRMMain:SetVisibility( LUI.Visibility.Hidden )
	end
	f11_arg0._isClanQuickMatch = CLANS.IsInQuickMatch( f11_arg1 )
	local f11_local0 = LUI.FlowManager.GetScopedData( f11_arg0 )
	if f11_arg0._isClanQuickMatch then
		f11_arg0._state = f0_local0.waitingForClanLobby
		f11_arg0:ReplaceLobbyWidget( "ClanWaitingLobby", f11_arg1 )
	else
		f11_arg0._state = f0_local0.searchingForLobby
		f11_arg0:ReplaceLobbyWidget( "SearchingForLobby", f11_arg1 )
	end
	f11_arg0._numDots = 0
	Engine[0xC4146BA76D0F982]( SOUND_SETS.mpMainMenu.matchSearch )
	local self = LUI.UITimer.new( {
		interval = 400,
		event = "update_lobby_status"
	} )
	self.id = "lobbyStatusTimer"
	f11_arg0:addElement( self )
	f11_arg0:registerEventHandler( "update_lobby_status", function ( element, event )
		element:UpdateLobbyStatus( f11_arg0 )
	end )
	f11_arg0:UpdateLobbyStatus( f11_arg1 )
	assert( f11_arg0.Vignette )
	assert( f11_arg0.GradientRight )
	LAYOUT.AddHandlerAspectRatioScaleAdjustment( f11_arg0, {
		f11_arg0.Vignette,
		f11_arg0.GradientRight
	}, LAYOUT.AspectRatioImageScalePct.LARGE )
	f11_arg0:addAndCallEventHandler( "update_double_xp_token", function ( f12_arg0, f12_arg1 )
		f11_arg0( f12_arg0 )
	end )
	SEQUENCEPRESETS.RegisterAnimation( f11_arg0, LUI.Transition.TransNextFrom, "OutLeft", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f11_arg0, LUI.Transition.TransNextTo, "InLeft", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f11_arg0, LUI.Transition.TransPrevFrom, "OutRight", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f11_arg0, LUI.Transition.TransPrevTo, "InRight", 0 )
end

function LobbyFlowWidget( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "LobbyFlowWidget"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local f1_local3 = nil
	if CONDITIONS.IsGLFrontendEnabled() then
		f1_local3 = MenuBuilder.BuildRegisteredType( "Cinematic", {
			fullscreen = true,
			controllerIndex = f1_local1
		} )
		f1_local3.id = "Cinematic"
		self:addElement( f1_local3 )
		self.Cinematic = f1_local3
	end
	local Vignette = nil
	
	Vignette = LUI.UIImage.new()
	Vignette.id = "Vignette"
	Vignette:SetVisibility( LUI.Visibility.Hidden )
	Vignette:SetRGBFromTable( SWATCHES.genericMenu.blackBackground, 0 )
	Vignette:SetAlpha( 0.65, 0 )
	Vignette:setImage( RegisterMaterial( "gradient_curve" ), 0 )
	Vignette:SetAnchorsAndPosition( 0, 1, 0, 0, 0, _1080p * 900, _1080p * 164, _1080p * -66 )
	self:addElement( Vignette )
	self.Vignette = Vignette
	
	local GradientRight = nil
	
	GradientRight = LUI.UIImage.new()
	GradientRight.id = "GradientRight"
	GradientRight:SetVisibility( LUI.Visibility.Hidden )
	GradientRight:SetRGBFromTable( SWATCHES.genericMenu.blackBackground, 0 )
	GradientRight:SetAlpha( 0.5, 0 )
	GradientRight:setImage( RegisterMaterial( "gradient_curve" ), 0 )
	GradientRight:SetAnchorsAndPosition( 1, 0, 0, 0, 0, _1080p * -900, _1080p * 164, _1080p * -66 )
	self:addElement( GradientRight )
	self.GradientRight = GradientRight
	
	local f1_local6 = nil
	if not CONDITIONS.IsWebMotdEnabled() then
		f1_local6 = MenuBuilder.BuildRegisteredType( "CRMMain", {
			controllerIndex = f1_local1
		} )
		f1_local6.id = "CRMMain"
		f1_local6:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 1394, _1080p * 1824, _1080p * -344, _1080p * -68 )
		self:addElement( f1_local6 )
		self.CRMMain = f1_local6
	end
	local f1_local7 = nil
	if CONDITIONS.IsWebMotdEnabled() then
		f1_local7 = MenuBuilder.BuildRegisteredType( "CRMWebView", {
			controllerIndex = f1_local1
		} )
		f1_local7.id = "CRMWeb"
		f1_local7:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 1394, _1080p * 1802, _1080p * -395, _1080p * -95 )
		self:addElement( f1_local7 )
		self.CRMWeb = f1_local7
	end
	local f1_local8 = nil
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8 = MenuBuilder.BuildRegisteredType( "DoubleXPNotifications", {
			controllerIndex = f1_local1
		} )
		f1_local8.id = "DoubleXPNotifications"
		f1_local8:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 976, _1080p * 1360, _1080p * -251, _1080p * -121 )
		self:addElement( f1_local8 )
		self.DoubleXPNotifications = f1_local8
	end
	local f1_local9 = nil
	if CONDITIONS.InFrontendLP() then
		f1_local9 = LUI.UIDataSourceGrid.new( {
			maxVisibleColumns = 1,
			maxVisibleRows = 5,
			controllerIndex = f1_local1,
			buildChild = function ()
				return MenuBuilder.BuildRegisteredType( "LPPlayMenuButton", {
					controllerIndex = menu
				} )
			end,
			spacingX = _1080p * 10,
			spacingY = _1080p * 10,
			columnWidth = _1080p * 300,
			rowHeight = _1080p * 70
		} )
		f1_local9.id = "LobbyButtons"
		f1_local9:SetMaxVisibleRows( 5 )
		f1_local9:SetRowSpacing( 10 )
		f1_local9:setUseStencil( true )
		if CONDITIONS.InFrontendLP() then
			f1_local9:SetGridDataSource( DataSources.frontEnd.LP.LobbyButtonsShortList, f1_local1 )
		end
		f1_local9:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 151, _1080p * 516, _1080p * 738, _1080p * 979 )
		self:addElement( f1_local9 )
		self.LobbyButtons = f1_local9
	end
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local10 = nil
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8:RegisterAnimationSequence( "CRMMaximized", {
			{
				duration = 150,
				property = TWEEN_PROPERTY.Top,
				value = _1080p * 598
			},
			{
				duration = 150,
				property = TWEEN_PROPERTY.Bottom,
				value = _1080p * 718
			}
		} )
	end
	self._sequences.CRMMaximized = function ()
		if CONDITIONS.DoubleXPTokensEnabled( menu ) then
			menu:AnimateSequence( "CRMMaximized" )
		end
	end
	
	self._sequenceLengths.CRMMaximized = 150
	local f1_local11 = nil
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8:RegisterAnimationSequence( "CRMMinimized", {
			{
				duration = 150,
				property = TWEEN_PROPERTY.Top,
				value = _1080p * 825
			},
			{
				duration = 150,
				property = TWEEN_PROPERTY.Bottom,
				value = _1080p * 945
			}
		} )
	end
	self._sequences.CRMMinimized = function ()
		if CONDITIONS.DoubleXPTokensEnabled( menu ) then
			menu:AnimateSequence( "CRMMinimized" )
		end
	end
	
	self._sequenceLengths.CRMMinimized = 150
	local f1_local12 = nil
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8:RegisterAnimationSequence( "ShowTokenPrompt", {
			{
				value = 1,
				duration = 0,
				property = TWEEN_PROPERTY.Alpha
			}
		} )
	end
	self._sequences.ShowTokenPrompt = function ()
		if CONDITIONS.DoubleXPTokensEnabled( menu ) then
			menu:AnimateSequence( "ShowTokenPrompt" )
		end
	end
	
	self._sequenceLengths.ShowTokenPrompt = 0
	local f1_local13 = nil
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8:RegisterAnimationSequence( "HideTokenPrompt", {
			{
				value = 0,
				duration = 0,
				property = TWEEN_PROPERTY.Alpha
			}
		} )
	end
	self._sequences.HideTokenPrompt = function ()
		if CONDITIONS.DoubleXPTokensEnabled( menu ) then
			menu:AnimateSequence( "HideTokenPrompt" )
		end
	end
	
	self._sequenceLengths.HideTokenPrompt = 0
	local f1_local14 = nil
	if not CONDITIONS.IsWebMotdEnabled() then
		f1_local6:RegisterAnimationSequence( "SafeAreaAdjustment", {
			{
				duration = 0,
				property = TWEEN_PROPERTY.Top,
				value = _1080p * -364
			},
			{
				duration = 0,
				property = TWEEN_PROPERTY.Bottom,
				value = _1080p * -88
			}
		} )
	end
	if CONDITIONS.IsWebMotdEnabled() then
		f1_local7:RegisterAnimationSequence( "SafeAreaAdjustment", {
			{
				duration = 0,
				property = TWEEN_PROPERTY.Top,
				value = _1080p * -417
			},
			{
				duration = 0,
				property = TWEEN_PROPERTY.Bottom,
				value = _1080p * -117
			}
		} )
	end
	if CONDITIONS.DoubleXPTokensEnabled( self ) then
		f1_local8:RegisterAnimationSequence( "SafeAreaAdjustment", {
			{
				duration = 0,
				property = TWEEN_PROPERTY.Top,
				value = _1080p * -273
			},
			{
				duration = 0,
				property = TWEEN_PROPERTY.Bottom,
				value = _1080p * -143
			}
		} )
	end
	self._sequences.SafeAreaAdjustment = function ()
		if not CONDITIONS.IsWebMotdEnabled() then
			menu:AnimateSequence( "SafeAreaAdjustment" )
		end
		if CONDITIONS.IsWebMotdEnabled() then
			menu:AnimateSequence( "SafeAreaAdjustment" )
		end
		if CONDITIONS.DoubleXPTokensEnabled( menu ) then
			menu:AnimateSequence( "SafeAreaAdjustment" )
		end
	end
	
	self._sequenceLengths.SafeAreaAdjustment = 0
	local f1_local15 = nil
	if CONDITIONS.InFrontendLP() then
		f1_local9:RegisterAnimationSequence( "ShowLPButtons", {
			{
				duration = 0,
				property = TWEEN_PROPERTY.Visibility,
				value = LUI.Visibility.Visible
			}
		} )
	end
	self._sequences.ShowLPButtons = function ()
		if CONDITIONS.InFrontendLP() then
			menu:AnimateSequence( "ShowLPButtons" )
		end
	end
	
	self._sequenceLengths.ShowLPButtons = 0
	local f1_local16 = nil
	if CONDITIONS.InFrontendLP() then
		f1_local9:RegisterAnimationSequence( "HideLPButtons", {
			{
				duration = 0,
				property = TWEEN_PROPERTY.Visibility,
				value = LUI.Visibility.Hidden
			}
		} )
	end
	self._sequences.HideLPButtons = function ()
		if CONDITIONS.InFrontendLP() then
			menu:AnimateSequence( "HideLPButtons" )
		end
	end
	
	self._sequenceLengths.HideLPButtons = 0
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "LobbyFlowWidget", LobbyFlowWidget )
LockTable( _M )
