-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
require( "ui.generated.widgets.doublexp.doublexpnotifications" )
require( "ui.generated.widgets.frontend.menutitletext" )
require( "ui.generated.widgets.frontend.mp.tokenbutton" )
require( "ui.generated.widgets.frontend.xpbonuslist" )
local f0_local0 = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3 )
	f16_arg2.NumberCount:setText( Engine[0xED84C33EC5F01EA]( 0xE8DAE370E2F324, f16_arg3.tokenAmount ) )
	f16_arg2.TokenImage:setImage( RegisterMaterial( f16_arg3.image ) )
	f16_arg2.TokenDuration:setText( f16_arg3.duration )
	local f16_local0 = LOOT.IsDoubleXPActive()
	local f16_local1 = LOOT.IsDoubleWeaponXPActive()
	local f16_local2 = LOOT.IsDoubleBattlePassXPActive()
	if f16_local2 then
		f16_local2 = CONDITIONS.IsBattlePassEnabled()
	end
	if not f16_local0 then
		local f16_local3 = f16_local0
	elseif not f16_local1 then
		local f16_local3 = f16_local1
	else
		local f16_local3 = f16_local2
	end
	local f16_local4 = XPTOKENS.GetTokenUseLocked( f16_arg1 )
	if not f16_local4 then
		if f16_arg3.tokenAmount ~= 0 then
			if f16_arg3.type == LOOT.doubleXpTypes.XP and not f16_local0 then
				f16_local4 = f16_local0
			elseif f16_arg3.type == LOOT.doubleXpTypes.WEAPON and not f16_local1 then
				f16_local4 = f16_local1
			elseif f16_arg3.type == LOOT.doubleXpTypes.BATTLE_PASS then
				f16_local4 = f16_local2
			else
				f16_local4 = false
			end
		else
			f16_local4 = true
		end
	end
	f16_arg2:SetButtonDisabled( f16_local4 )
	f16_arg2:setActionSFX( SOUND_SETS.popups.tokenButtonAction )
	f16_arg2:registerEventHandler( "button_action", function ( element, event )
		if OnlineChallenges[0x6AE20EF4832FEF]( f16_arg0, f16_arg0.achievementID, AEKinds.IW9_AE_KIND_TOKENS.ID, AEGameEvents[f16_arg0.eventName].eventID ) then
			XPTOKENS.SetTokenUseLocked( f16_arg0, true )
			f16_arg0:RefreshGrid()
			ACTIONS.AnimateSequence( f16_arg0, "ShowActivating" )
		end
	end )
end

local f0_local1 = function ( f14_arg0, f14_arg1 )
	f14_arg0._tokenData = {}
	for f14_local12, f14_local13 in pairs( LOOT.doubleXpTypes ) do
		if not f14_arg0._tokenData[f14_local13] then
			f14_arg0._tokenData[f14_local13] = {}
		end
		local f14_local3 = XPTOKENS.GetLootIdTable( f14_local13 )
		local f14_local4 = XPTOKENS.GetTokenUseTitle( f14_local13 )
		for f14_local9, f14_local10 in pairs( f14_local3 ) do
			local f14_local11 = PROXY_LOOT.IsOwned( f14_arg1, f14_local10 )
			if f14_local10 ~= LOOT.DOUBLE_XP_TOKENS.XP_Year or 0 < f14_local11 then
				local f14_local8 = XPTOKENS.GetTokenData( f14_local10, f14_local11 )
				f14_local8.header = f14_local4
				f14_local8.type = f14_local13
				table.insert( f14_arg0._tokenData[f14_local13], f14_local8 )
			end
		end
		table.sort( f14_arg0._tokenData[f14_local13], function ( f15_arg0, f15_arg1 )
			if f15_arg0.rarity ~= f15_arg1.rarity then
				return f15_arg0.rarity < f15_arg1.rarity
			else
				
			end
		end )
	end
end

local f0_local2 = function ( f13_arg0 )
	local f13_local0 = 0 < PROXY_LOOT.IsOwned( f13_arg0._controllerIndex, LOOT.DOUBLE_XP_TOKENS.XP_Year )
	local f13_local1 = f13_arg0.TokenGrid
	local f13_local2 = f13_local1
	f13_local1 = f13_local1.SetNumChildren
	local f13_local3
	if f13_local0 then
		f13_local3 = 9
	else
		f13_local3 = 8
	end
	f13_local1( f13_local2, f13_local3 )
	f13_arg0.TokenGrid:RefreshContent()
end

local f0_local3 = function ( f8_arg0, f8_arg1, f8_arg2 )
	f8_arg0.RefreshGrid = f0_local0
	f8_arg0._controllerIndex = f8_arg1
	f8_arg0._tokenButtonArray = {}
	TOAST_NOTIF.UpdateToastPosition( LUI.ToastManager.ToastPositionModifier.TokenMenu, LUI.ToastManager.ToastPositionModifierStates.Opened )
	f0_local0( f8_arg0, f8_arg1 )
	f8_arg0.TokenGrid:SetMask( f8_arg0.GridMask )
	f8_arg0.TokenGrid:SetRefreshChild( function ( f12_arg0, f12_arg1, f12_arg2 )
		local f12_local0 = LUI.clamp( f12_arg1 + 1, 1, 3 )
		local f12_local1 = f8_arg0( f8_arg0, f8_arg0, f12_arg0, f8_arg0._tokenData[LUI.clamp( f12_arg1 + 1, 1, 3 )][LUI.clamp( f12_arg2 + 1, 1, 5 )] )
	end )
	f8_arg0:RefreshGrid()
	f8_arg0:registerEventHandler( "OnAchievementActivated", function ( element, event )
		if event.kind == AEKinds.IW9_AE_KIND_TOKENS.ID then
			ACTIONS.AnimateSequence( f8_arg0, "HideActivating" )
			f8_arg0( f8_arg0, f8_arg0 )
			f8_arg0:RefreshGrid()
		end
	end )
	f8_arg0:addEventHandler( "menu_close", function ( f10_arg0, f10_arg1 )
		TOAST_NOTIF.UpdateToastPosition( LUI.ToastManager.ToastPositionModifier.TokenMenu, LUI.ToastManager.ToastPositionModifierStates.Closed )
	end )
	f8_arg0.XPBonusList:UpdateBonusList()
	local f8_local0 = DataSources.alwaysLoaded.loot.xpTokenUseLocked
	if f8_local0 then
		f8_arg0:SubscribeToModel( f8_local0:GetModel( f8_arg1 ), function ( f9_arg0, f9_arg1 )
			f9_arg1:RefreshGrid()
		end )
	end
end

States = {
	[0xAD14C6E7156B923] = function ( f4_arg0, f4_arg1 )
		local f4_local0 = function ( f7_arg0, f7_arg1 )
			
		end
		
		f4_arg0.spinner:RegisterAnimationSequence( "ShowActivating", {
			nil,
			nil,
			1,
			0,
			[1] = TWEEN_PROPERTY.Alpha
		} )
		f4_arg0.ActivatingTokensLabel:RegisterAnimationSequence( "ShowActivating", {
			nil,
			nil,
			1,
			0,
			[1] = TWEEN_PROPERTY.Alpha
		} )
		local f4_local1 = function ( f6_arg0, f6_arg1 )
			f6_arg0.spinner:AnimateSequence( "ShowActivating" )
			f6_arg0.ActivatingTokensLabel:AnimateSequence( "ShowActivating" )
		end
		
		f4_arg0.spinner:RegisterAnimationSequence( "HideActivating", {
			nil,
			nil,
			0,
			0,
			[1] = TWEEN_PROPERTY.Alpha
		} )
		f4_arg0.ActivatingTokensLabel:RegisterAnimationSequence( "HideActivating", {
			nil,
			nil,
			0,
			0,
			[1] = TWEEN_PROPERTY.Alpha
		} )
		f4_arg0._sequences = {
			DefaultSequence = f4_local0,
			ShowActivating = f4_local1,
			HideActivating = function ( f5_arg0, f5_arg1 )
				f5_arg0.spinner:AnimateSequence( "HideActivating" )
				f5_arg0.ActivatingTokensLabel:AnimateSequence( "HideActivating" )
			end
		}
		f4_arg0._sequenceLengths = {
			DefaultSequence = 0,
			HideActivating = 0,
			ShowActivating = 0
		}
	end
}
function TokenMenu( menu, controller )
	local self = LUI.UIHorizontalNavigator.new()
	self:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, -300 * _1080p, 300 * _1080p, -540 * _1080p, 540 * _1080p )
	self.id = "TokenMenu"
	self.__states = States
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local Background = nil
	
	Background = LUI.UIImage.new()
	Background.id = "Background"
	Background:SetRGBFromInt( 0, 0 )
	Background:SetAlpha( 0.4, 0 )
	Background:Setup9SliceImage( _1080p * 20, _1080p * 20, 0.3, 0.3 )
	Background:SetAnchorsAndPosition( 0, 0, 0, 0, _1080p * 1, _1080p * -1, _1080p * 90, 0 )
	self:addElement( Background )
	self.Background = Background
	
	local WarningLabel = nil
	
	WarningLabel = LUI.UIText.new()
	WarningLabel.id = "WarningLabel"
	WarningLabel:SetRGBFromTable( SWATCHES.IW9StyleGuide.styleGuideCool01, 0 )
	WarningLabel:setText( Engine[0xED84C33EC5F01EA]( 0x849F2616A844C09 ), 0 )
	WarningLabel:SetFont( FONTS.GetFont( FONTS.PrimaryRegular.File ) )
	WarningLabel:SetFontSize( 20 * _PT )
	WarningLabel:SetMinFontSize( 20 * _PT )
	WarningLabel:SetWordWrap( true )
	WarningLabel:SetAlignment( LUI.Alignment.Left )
	WarningLabel:SetAnchorsAndPosition( 0, 1, 1, 0, _1080p * 28, _1080p * 590, _1080p * -105, _1080p * -55 )
	self:addElement( WarningLabel )
	self.WarningLabel = WarningLabel
	
	local spinner = nil
	
	spinner = LUI.UIImage.new()
	spinner.id = "spinner"
	spinner:SetAlpha( 0, 0 )
	spinner:setImage( RegisterMaterial( 0xBD9F4B6D704F060 ), 0 )
	spinner:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -215, _1080p * 215, _1080p * 950, _1080p * 960 )
	self:addElement( spinner )
	self.spinner = spinner
	
	local ActivatingTokensLabel = nil
	
	ActivatingTokensLabel = LUI.UIText.new()
	ActivatingTokensLabel.id = "ActivatingTokensLabel"
	ActivatingTokensLabel:SetRGBFromTable( SWATCHES.genericMenu.descText, 0 )
	ActivatingTokensLabel:SetAlpha( 0, 0 )
	ActivatingTokensLabel:setText( Engine[0xED84C33EC5F01EA]( 0xC03EB66A11093E7 ), 0 )
	ActivatingTokensLabel:SetFont( FONTS.GetFont( FONTS.PrimaryRegular.File ) )
	ActivatingTokensLabel:SetFontSize( 20 * _PT )
	ActivatingTokensLabel:SetMinFontSize( 18 * _PT )
	ActivatingTokensLabel:SetWordWrap( true )
	ActivatingTokensLabel:SetAlignment( LUI.Alignment.Center )
	ActivatingTokensLabel:SetVerticalAlignment( LUI.Alignment.Middle )
	ActivatingTokensLabel:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -215, _1080p * 215, _1080p * 925, _1080p * 945 )
	self:addElement( ActivatingTokensLabel )
	self.ActivatingTokensLabel = ActivatingTokensLabel
	
	local RankTokenList = nil
	
	RankTokenList = LUI.UIVerticalList.new( {
		controller = f1_local1,
		direction = LUI.DIRECTION.vertical,
		verticalAlignment = LUI.Alignment.Top
	} )
	RankTokenList.id = "RankTokenList"
	RankTokenList:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -272, _1080p * -112, _1080p * 359, _1080p * 860 )
	self:addElement( RankTokenList )
	self.RankTokenList = RankTokenList
	
	local WeaponTokenList = nil
	
	WeaponTokenList = LUI.UIVerticalList.new( {
		controller = f1_local1,
		direction = LUI.DIRECTION.vertical,
		verticalAlignment = LUI.Alignment.Top
	} )
	WeaponTokenList.id = "WeaponTokenList"
	WeaponTokenList:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -80, _1080p * 80, _1080p * 359, _1080p * 860 )
	self:addElement( WeaponTokenList )
	self.WeaponTokenList = WeaponTokenList
	
	local BattlepassTokenList = nil
	
	BattlepassTokenList = LUI.UIVerticalList.new( {
		controller = f1_local1,
		direction = LUI.DIRECTION.vertical,
		verticalAlignment = LUI.Alignment.Top
	} )
	BattlepassTokenList.id = "BattlepassTokenList"
	BattlepassTokenList:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * 112, _1080p * 272, _1080p * 359, _1080p * 860 )
	self:addElement( BattlepassTokenList )
	self.BattlepassTokenList = BattlepassTokenList
	
	local DoubleXPNotifications = nil
	
	DoubleXPNotifications = MenuBuilder.BuildRegisteredType( "DoubleXPNotifications", {
		controllerIndex = f1_local1
	} )
	DoubleXPNotifications.id = "DoubleXPNotifications"
	DoubleXPNotifications:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -261, _1080p * 261, _1080p * 130, _1080p * 334 )
	self:addElement( DoubleXPNotifications )
	self.DoubleXPNotifications = DoubleXPNotifications
	
	local MenuTitleText = nil
	
	MenuTitleText = MenuBuilder.BuildRegisteredType( "MenuTitleText", {
		controllerIndex = f1_local1
	} )
	MenuTitleText.id = "MenuTitleText"
	MenuTitleText.Text:SetRight( _1080p * 933, 0 )
	MenuTitleText.Text:setText( Engine[0xED84C33EC5F01EA]( 0xA006674783FB8BC ), 0 )
	MenuTitleText:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 87, _1080p * 355, _1080p * 29, _1080p * 61 )
	self:addElement( MenuTitleText )
	self.MenuTitleText = MenuTitleText
	
	local GridMask = nil
	
	GridMask = LUI.UIImage.new()
	GridMask.id = "GridMask"
	GridMask:setImage( RegisterMaterial( 0xF718FC1BD1FE7E0 ), 0 )
	GridMask:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 28, _1080p * 572, _1080p * 351, _1080p * 903 )
	self:addElement( GridMask )
	self.GridMask = GridMask
	
	local TokenGrid = nil
	
	TokenGrid = LUI.UIGrid.new( {
		scrollingThresholdX = 2,
		maxVisibleColumns = 2,
		maxVisibleRows = 4,
		wrapX = false,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "TokenButton", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f2_arg0, f2_arg1, f2_arg2 )
			
		end,
		spacingX = _1080p * 32,
		spacingY = _1080p * 8,
		columnWidth = _1080p * 160,
		rowHeight = _1080p * 124
	} )
	TokenGrid.id = "TokenGrid"
	TokenGrid:setUseStencil( false )
	TokenGrid:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -176, _1080p * 176, _1080p * 359, _1080p * 899 )
	self:addElement( TokenGrid )
	self.TokenGrid = TokenGrid
	
	local XPBonusList = nil
	
	XPBonusList = MenuBuilder.BuildRegisteredType( "XPBonusList", {
		controllerIndex = f1_local1
	} )
	XPBonusList.id = "XPBonusList"
	XPBonusList:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * -441, _1080p * -57, _1080p * 122, _1080p * 722 )
	self:addElement( XPBonusList )
	self.XPBonusList = XPBonusList
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "TokenMenu", TokenMenu )
LockTable( _M )
