-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
local f0_local0 = function ( f19_arg0 )
	return f19_arg0.ReticleGrid:GetFocusPositionIndex() + 1
end

local f0_local1 = function ( f18_arg0 )
	local f18_local0 = WEAPON.GetReticleCategories()
	if f18_local0 then
		for f18_local1 = 1, #f18_local0, 1 do
			local f18_local4 = Engine[0x6093D047200548]( "reticlecategory:" .. f18_local0[f18_local1][0xBD2E7FFB1224E91] )
			if f18_local4 and f18_local4[0x6C6E9BC1769C076] == f18_arg0 then
				return f18_local4
			end
		end
	end
end

local f0_local2 = function ( f17_arg0 )
	local f17_local0 = WEAPON.GetReticleCategories()
	local f17_local1 = WEAPON.GetReticles()
	if f17_local1 then
		for f17_local2 = 1, #f17_local1, 1 do
			local f17_local5 = Engine[0x6093D047200548]( "reticledata:" .. f17_local1[f17_local2][0x33AFE50D7CDA297] )
			if f17_local5 and not f17_local5[0xAED63DFE5400760] then
				local f17_local6 = {
					ref = f17_local1[f17_local2][0x33AFE50D7CDA297],
					name = f17_local5[0x4BCADBA8E631B86],
					desc = f17_local5[0x5EAEF67427CA780],
					image = f17_local5[0xAB612888528489A],
					unlockInfo = {}
				}
				if f17_local5[0x9E9C01960F4C582] == 0xA68FF2DD9E3FE20 then
					for f17_local7 = 1, #f17_local0, 1 do
						local f17_local10 = Engine[0x6093D047200548]( "reticlecategory:" .. f17_local0[f17_local7] )
						if f17_local10 and f17_local10[0xA51E8E50DB8EB6F] == f17_arg0._opticRef then
							f17_local6.image = f17_local10[0x3CD44D4A96C9C93]
							f17_local6.altImage = f17_local10[0x59C3AD81A8D54B1]
						end
					end
				end
				table.insert( f17_arg0._reticleTable, f17_local6 )
			end
		end
	end
end

local f0_local3 = function ( f15_arg0 )
	local f15_local0 = function ()
		for f16_local3, f16_local4 in ipairs( f15_arg0._reticleTable ) do
			if f15_arg0._equippedReticle == f16_local4.ref then
				return f16_local3 - 1
			end
		end
	end
	
	f15_arg0.ReticleGrid:SetFocusedPosition( f15_arg0.ReticleGrid:GetPositionForIndex( f15_local0() or 0 ), true )
end

local f0_local4 = function ( f14_arg0 )
	local f14_local0 = f14_arg0._reticleTable[f0_local0( f14_arg0 )]
	if f14_arg0._equippedReticle == f14_local0.ref then
		f14_local0 = f14_arg0._reticleTable[1]
	end
	WEAPON.SetEquippedReticle( f14_arg0.weaponPlayerData, f14_local0.ref )
	f14_arg0:UpdateGrid()
	local f14_local1 = "hud_cmd_active_backer"
	if f14_local0.image ~= "" then
		f14_local1 = f14_local0.image
	end
	if not CONDITIONS.IsMobileOrMobileSim() then
		f14_arg0:dispatchEventToRoot( {
			name = "send_toast_notification",
			immediate = true,
			options = {
				displayTime = 2000,
				icon = f14_local1,
				header = Engine[0xED84C33EC5F01EA]( 0x9BF8128C5F2EB8F ),
				description = Engine[0xED84C33EC5F01EA]( f14_local0.name ),
				type = LUI.ToastManager.NotificationType.ReticleEquipped,
				controllerIndex = f14_arg0._controllerIndex
			}
		} )
	end
end

local f0_local5 = function ( f13_arg0 )
	local f13_local0 = f0_local0( f13_arg0 )
	local f13_local1 = f13_arg0._reticleTable[f13_local0]
	local f13_local2 = nil
	if 1 < f13_local0 then
		f13_local2 = f13_arg0._reticleTable[f13_local0 - 1]
	end
	f13_arg0.ReticlePanel.Name:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f13_local1.name ) ) )
	local f13_local3 = f13_local1.image
	if f13_arg0._isAltImage then
		if f13_arg0._opticRef == "hybrid" then
			local f13_local4 = f13_local1.flipHybridAltImage
			if not f13_local4 then
				f13_local3 = f13_local4
			else
				f13_local3 = f13_local1.altImage
			end
		end
		f13_local3 = f13_local1.altImage
	end
	if f13_local3 ~= "" then
		f13_arg0.Preview:setImage( RegisterMaterial( f13_local3 ) )
	end
	if f13_arg0._supportAltImage then
		local f13_local5 = RegisterMaterial( f13_arg0._isAltImage and f13_arg0._altScopeImage or f13_arg0._defaultScopeImage )
		if 1 < Engine[0x5B4AB50CF5D1DDD]( f13_local5 ) then
			ACTIONS.AnimateSequence( f13_arg0, "ScopeImage2x1" )
		else
			ACTIONS.AnimateSequence( f13_arg0, "ScopeImage1x1" )
		end
		f13_arg0.Scope:setImage( f13_local5 )
	end
	local f13_local4 = f13_arg0._equippedReticle == f13_local1.ref
	if f13_local4 and not f13_arg0.ReticlePanel.EquippedWidget.enabled then
		ACTIONS.AnimateSequence( f13_arg0.ReticlePanel.EquippedWidget, "TurnOn" )
		f13_arg0.ReticlePanel.EquippedWidget.enabled = true
	end
	f13_arg0.ReticlePanel.EquippedWidget:UpdateVisibility( f13_local4 )
	local f13_local5 = f13_local1.unlockInfo
	f13_local5.equipped = f13_local4
	f13_local5.lockedText = Engine[0xED84C33EC5F01EA]( 0x7656F4B4D8525BC, f13_arg0._categoryName )
	if not f13_local2 or not f13_local2.unlockInfo.unlocked then
		f13_local5.isClassified = true
	end
	f13_arg0.ReticlePanel:UpdatePanelInfo( f13_local5 )
end

local f0_local6 = function ( f12_arg0 )
	f12_arg0._equippedReticle = WEAPON.GetEquippedReticle( f12_arg0.weaponPlayerData )
	f12_arg0.ReticleGrid:RemoveFocusFromChild()
	f12_arg0.ReticleGrid:SetNumChildren( #f12_arg0._reticleTable )
	f12_arg0.ReticleGrid:RefreshContent()
end

local f0_local7 = function ( f10_arg0 )
	return function ( f11_arg0, f11_arg1, f11_arg2 )
		local f11_local0 = LUI.ShallowCopy( f10_arg0._reticleTable[f11_arg1 + f11_arg2 * f10_arg0.ReticleGrid:GetNumColumns() + 1] )
		if f10_arg0._isAltImage then
			f11_local0.image = f11_local0.altImage
		end
		f11_local0.lootType = LOOT.itemTypes.RETICLE
		f11_arg0:RefreshButton( f10_arg0, f11_local0, f10_arg0._equippedReticle == f11_local0.ref )
	end
	
end

local f0_local8 = function ( f9_arg0, f9_arg1 )
	f9_arg0.ReticlePanel.NewItemNotification:UpdateBreadcrumbByID( f9_arg0._controllerIndex, f9_arg1 )
end

local f0_local9 = function ( f8_arg0, f8_arg1 )
	FrontEndScene.HideWeaponModels()
	Engine[0x685AE31DEDA30A4]( "quartermaster" )
	local f8_local0 = MenuBuilder.BuildRegisteredType( "FrontendCameraMover", {
		enableSway = true,
		controllerIndex = f8_arg1
	} )
	f8_local0:SetLimits( -10, 10, -10, 4 )
	f8_local0:SetSwayValues( 2000, 0.06, 0.1 )
	f8_arg0:addElement( f8_local0 )
end

local f0_local10 = function ( f6_arg0 )
	if f6_arg0._supportAltImage then
		f6_arg0:AddGamepadEventCallback( "button_alt1", function ( f7_arg0, f7_arg1 )
			f7_arg0._isAltImage = not f7_arg0._isAltImage
			f7_arg0:PreviewItem()
			f7_arg0.ReticleGrid:RefreshContent()
		end )
	end
end

local f0_local11 = function ( f3_arg0, f3_arg1, f3_arg2 )
	assert( f3_arg0.MenuTitle )
	assert( f3_arg0.ReticlePanel )
	assert( f3_arg0.ReticleGrid )
	f3_arg0.EquipItem = f0_local0
	f3_arg0.PreviewItem = f0_local0
	f3_arg0.UpdateGrid = f0_local0
	f3_arg0.UpdateBreadcrumb = f0_local0
	f0_local0( f3_arg0, f3_arg1 )
	f3_arg0._controllerIndex = f3_arg1
	if not f3_arg2.isStorePreview then
		assert( f3_arg2.loadoutIndex )
		assert( f3_arg2.weaponSlot )
		assert( f3_arg2.equippedOptic )
		f3_arg0._opticRef = ATTACHMENT.GetOpticRef( f3_arg2.equippedOptic )
		f3_arg0._category = ATTACHMENT.GetOpticReticleCategory( f3_arg0._opticRef )
		f3_arg0._categoryName = Engine[0xED84C33EC5F01EA]( WEAPON.GetReticleCategoryName( f3_arg0._category ) )
		f3_arg0._supportAltImage = ATTACHMENT.ReticleTypeSupportsAltImage( f3_arg0._category )
		f3_arg0._isAltImage = false
		f3_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( 0xE6158169E010EDF, f3_arg0._categoryName ) )
		if f3_arg0._supportAltImage then
			local f3_local0 = f0_local0( f3_arg0._category )
			f3_arg0._defaultScopeImage = f3_local0[0xECFAA94C0DD10B0]
			f3_arg0._altScopeImage = f3_local0[0xC8D11B837D116E5]
			f3_arg0.Scope:setImage( RegisterMaterial( f3_arg0._defaultScopeImage ) )
			f3_arg0.ReticlePanel.ToggleHybridPrompt:SetAlpha( 1 )
		else
			local f3_local0 = f0_local0( f3_arg0._category )
			if f3_local0 then
				local f3_local1 = f3_local0[0xECFAA94C0DD10B0]
				if not String.IsNilOrEmpty( f3_local1 ) then
					f3_arg0.Scope:setImage( RegisterMaterial( f3_local1 ) )
				end
			end
		end
		local f3_local0 = LOADOUT.GetFrontendLoadoutWithShowcase( f3_arg1, f3_arg2.loadoutIndex, f3_arg2.forShowcase )
		f3_arg0.weaponPlayerData = f3_local0.weaponSetups[f3_arg2.weaponSlot]
		f3_arg0._equippedReticle = WEAPON.GetEquippedReticle( f3_arg0.weaponPlayerData )
		f3_arg0._reticleTable = {}
		f0_local0( f3_arg0 )
		f3_arg0.ReticleGrid:SetRefreshChild( f0_local0( f3_arg0 ) )
		f3_arg0:UpdateGrid()
		f0_local0( f3_arg0 )
		f3_arg0:addEventHandler( "restore_focus", function ( f5_arg0, f5_arg1 )
			f3_arg0( f3_arg0, f3_arg0 )
			f3_arg0:UpdateGrid()
		end )
		f0_local0( f3_arg0 )
		local f3_local1 = f3_arg0.weaponPlayerData.weapon:get()
		if PROGRESSION.ShouldUnlockAll() then
			f3_arg0.GunsmithWeaponLevel:SetAlpha( 0 )
		else
			f3_arg0.GunsmithWeaponLevel:Setup( f3_arg1, f3_local1 )
		end
	else
		f3_arg0.ReticleGrid:closeTree()
		f3_arg0.ReticleGrid = nil
		f3_arg0.Scrollbar:SetAlpha( 0 )
		f3_arg0.ReticlePanel:SetAlpha( 0 )
		f3_arg0.GunsmithWeaponLevel:SetAlpha( 0 )
		local f3_local0 = LOOT.GetItemRef( f3_arg2.lootID )
		local f3_local1 = WEAPON.GetReticleName( f3_local0 )
		local f3_local2 = f0_local0( WEAPON.GetReticleCategory( f3_local0 ) )
		f3_arg0.Scope:setImage( RegisterMaterial( f3_local2[0xECFAA94C0DD10B0] ) )
		f3_arg0.Preview:setImage( RegisterMaterial( WEAPON.GetReticleImage( f3_local0 ) ) )
		f3_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( f3_local1 ) )
		if f3_arg0.HelperBar then
			f3_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
				side = "left",
				button_ref = "button_primary"
			} )
		end
		if f3_arg2.quickPurchaseEnabled and CONDITIONS.IsMenuInStack( "StoreBundlePreview" ) and not f3_arg2.bundleData.isBundlePurchased then
			if f3_arg0.HelperBar then
				f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
					side = "left",
					button_ref = "button_alt1",
					priority = 10,
					helper_text = Engine[0xED84C33EC5F01EA]( 0x93B4C732F65A26C )
				} )
			end
			f3_arg0:AddGamepadEventCallback( "button_alt1", function ( f4_arg0, f4_arg1 )
				STORE.OpenQuickPurchasePopupInPreview( f3_arg0 )
			end )
		end
	end
	if IsLanguageRussian() or IsLanguagePolish() then
		ACTIONS.AnimateSequence( f3_arg0, "RU" )
	end
	ACTIONS.ScaleFullscreen( f3_arg0.ReticleBackground )
	if f3_arg0.TabBacker then
		ACTIONS.ScaleStretchAnchorFullscreen( f3_arg0.TabBacker )
	end
end

local f0_local12 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function ReticleSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "ReticleSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ReticleSelectBase", ReticleSelectBase )
LockTable( _M )
