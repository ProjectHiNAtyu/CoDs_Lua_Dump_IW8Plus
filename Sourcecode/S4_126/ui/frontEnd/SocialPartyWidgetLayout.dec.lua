-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
require( "ui.widgets.NewItemSmallIcon" )
require( "ui.frontEnd.mp.FriendsButton" )
require( "ui.frontEnd.SocialMenuButton" )
local f0_local0 = 1000
local f0_local1 = function ( f21_arg0, f21_arg1, f21_arg2 )
	local f21_local0 = Friends[0xE30C6358EF728A1]( f21_arg1 )
	f21_arg0.partyMemberSettings = f21_local0[f21_arg2]
	local f21_local1 = function ( f22_arg0, f22_arg1 )
		return function ()
			local f23_local0 = f22_arg0.partyMemberSettings
			return {
				platformId = "0",
				isContextualMenu = true,
				xuid = Friends[0x7E6685E08C0BB92]( f23_local0.xuidString ),
				xuidString = f23_local0.xuidString,
				selectedTab = FRIENDS.TabIDs.CROSSPLAY_FRIENDS,
				controllerIndex = f22_arg0,
				presencePlatform = ClientPlatformToPresencePlatform[f23_local0.clientPlatform],
				gamertag = f23_local0.gamertag,
				getButtonsCallback = function ( f24_arg0 )
					return FRIENDS.GetFriendActions( f24_arg0 )
				end
				
			}
		end
		
	end
	
	FRIENDS.SetupPlayerContextualMenuOptions( f21_arg0, f21_arg1, f21_local1( f21_arg0, f21_arg1 ) )
end

local f0_local2 = function ( f20_arg0 )
	local f20_local0 = #f20_arg0._emblems
	if f20_local0 <= 0 then
		return 
	else
		f20_arg0._emblems[f20_local0]:closeTree()
		f20_arg0._emblems[f20_local0] = nil
		f20_local0 = f20_local0 - 1
	end
end

local f0_local3 = function ( f19_arg0, f19_arg1 )
	local f19_local0 = #f19_arg0._emblems
	if f19_arg0._maxEmblems <= f19_local0 then
		return 
	end
	f19_local0 = f19_local0 + 1
	f19_arg0._emblems[f19_local0] = LUI.UIImage.new()
	f19_arg0._emblems[f19_local0].id = "Emblem" .. f19_local0
	f19_arg0._emblems[f19_local0]:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f19_arg0._emblemSize, 0, f19_arg0._emblemSize )
	f19_arg0._emblems[f19_local0]:SetAlpha( 0 )
	if f19_local0 == 1 then
		f19_arg0._emblems[f19_local0]:addElementAfter( f19_arg0.FriendsButton )
	else
		f19_arg0._emblems[f19_local0]:addElementAfter( f19_arg0._emblems[f19_local0 - 1] )
	end
	f19_arg0._emblems[f19_local0]:SetHandleMouse( true )
	f0_local0( f19_arg0._emblems[f19_local0], f19_arg1, f19_local0 )
end

local f0_local4 = function ( f18_arg0, f18_arg1, f18_arg2 )
	if f18_arg2 < 0 then
		for f18_local0 = f18_arg2 + 1, 0, 1 do
			local f18_local3 = f18_local0
			f0_local0( f18_arg0 )
		end
	elseif 0 < f18_arg2 then
		for f18_local0 = f18_arg2 - 1, 0, -1 do
			local f18_local3 = f18_local0
			f0_local0( f18_arg0, f18_arg1 )
		end
	end
	local f18_local0 = Friends[0xE30C6358EF728A1]( f18_arg1 )
	for f18_local4, f18_local5 in ipairs( f18_arg0._emblems ) do
		if f18_local0[f18_local4] and f18_local5.index ~= f18_local0[f18_local4].emblemIndex then
			f18_local5.index = f18_local0[f18_local4].emblemIndex
			f18_local5:setImage( RegisterMaterial( EmblemEditorUtils.GetEmblemImageFromID( f18_local5.index ) ) )
			f18_local5:SetAlpha( 1 )
		end
	end
end

local f0_local5 = function ( f16_arg0, f16_arg1 )
	local f16_local0 = nil
	local f16_local1 = function ()
		f16_arg0( f16_arg0, f16_arg0, 0 )
		local f17_local0 = f16_arg0:Wait( f16_arg0 )
		f17_local0.onComplete = f16_arg0
	end
	
	f16_local1()
end

local f0_local6 = function ( menu, controller )
	menu.BindButton = LUI.UIBindButton.new()
	menu.BindButton.id = "BindButton"
	menu.BindButton:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 0, 0, 0 )
	menu.BindButtonContainer:addElement( menu.BindButton )
	menu.BindButton:addEventHandler( "button_alt2", function ( f15_arg0, f15_arg1 )
		if menu._socialMenuEnabled then
			FRIENDS.OpenFriendsList( f15_arg1.controller )
		end
	end )
	menu._buttonAdded = true
	local f12_local0 = function ( f14_arg0, f14_arg1 )
		local f14_local0 = LUI.IsLastInputGamepad( f14_arg1.controllerIndex )
		f14_arg0._isGamepad = f14_local0
		local f14_local1 = f14_arg0.BindButtonContainer
		if f14_local0 then
			if f14_local1 and not f14_arg0._buttonAdded then
				f14_local1:addElement( f14_arg0.BindButton )
				f14_arg0._buttonAdded = true
			end
			if IsLanguageArabic() then
				ACTIONS.AnimateSequence( f14_arg0.SocialMenuButton, "ARGamepad" )
			else
				ACTIONS.AnimateSequence( f14_arg0.SocialMenuButton, "Gamepad" )
			end
		else
			if f14_local1 and f14_arg0._buttonAdded then
				f14_local1:RemoveElement( f14_arg0.BindButton )
				f14_arg0._buttonAdded = false
			end
			if IsLanguageArabic() then
				ACTIONS.AnimateSequence( f14_arg0.SocialMenuButton, "AR" )
			else
				ACTIONS.AnimateSequence( f14_arg0.SocialMenuButton, "ButtonUp" )
			end
		end
	end
	
	menu:addEventHandler( "menu_create", function ( f13_arg0, f13_arg1 )
		local f13_local0 = f13_arg0:GetCurrentMenu()
		local f13_local1, f13_local2, f13_local3 = Friends[0x225FFBEAEDD4168]( f13_arg0._controllerIndex )
		f13_arg0.onlineFriendCount = f13_local3
		if f13_local0.HelperBar then
			if IsLanguageArabic() then
				f13_arg0.SocialMenuButton:SetSocialButtonLabelText( " (" .. f13_arg0.onlineFriendCount .. ")" .. Engine[0xED84C33EC5F01EA]( "LUA_MENU/SOCIAL_BUTTON" ) )
			else
				f13_arg0.SocialMenuButton:SetSocialButtonLabelText( Engine[0xED84C33EC5F01EA]( "LUA_MENU/SOCIAL_BUTTON" ) .. " (" .. f13_arg0.onlineFriendCount .. ")" )
			end
		end
		f13_arg0:addAndCallEventHandler( "update_input_type", menu, {
			controllerIndex = f13_arg1.controller
		} )
	end )
end

local f0_local7 = function ( f11_arg0, f11_arg1 )
	f11_arg0._socialMenuEnabled = f11_arg1
	f11_arg0.SocialMenuButton:SetMouseFocusBlocker( not f11_arg1 )
end

local f0_local8 = function ( f9_arg0 )
	f9_arg0:SubscribeToModel( DataSources.alwaysLoaded.social.allRequestCount:GetModel( f9_arg0._controllerIndex ), function ()
		local f10_local0 = DataSources.alwaysLoaded.social.allRequestCount:GetValue( f9_arg0._controllerIndex )
		local f10_local1
		if f10_local0 then
			f10_local1 = f10_local0
		else
			f10_local1 = 0 < f10_local0
		end
		local f10_local2 = f9_arg0.SocialNotification
		local f10_local3 = f10_local2
		f10_local2 = f10_local2.SetAlpha
		local f10_local4
		if f10_local1 then
			f10_local4 = 1
		else
			f10_local4 = 0
		end
		f10_local2( f10_local3, f10_local4 )
	end )
end

local f0_local9 = function ( f7_arg0 )
	local f7_local0 = function ( f8_arg0 )
		local f8_local0, f8_local1, f8_local2 = Friends[0x225FFBEAEDD4168]( f8_arg0._controllerIndex )
		if f7_arg0.onlineFriendCount ~= f8_local2 then
			f7_arg0.onlineFriendCount = f8_local2
			local f8_local3 = f8_arg0:GetCurrentMenu()
			if f8_local3 and f8_local3.HelperBar then
				if IsLanguageArabic() then
					f7_arg0.SocialMenuButton:SetSocialButtonLabelText( " (" .. f7_arg0.onlineFriendCount .. ")" .. Engine[0xED84C33EC5F01EA]( "LUA_MENU/SOCIAL_BUTTON" ) )
				else
					f7_arg0.SocialMenuButton:SetSocialButtonLabelText( Engine[0xED84C33EC5F01EA]( "LUA_MENU/SOCIAL_BUTTON" ) .. " (" .. f7_arg0.onlineFriendCount .. ")" )
				end
			end
		end
	end
	
	f7_arg0.onlineFriendsCounterTimer = LUI.UITimer.new( {
		interval = 1000,
		event = "update_online_friends_counter"
	} )
	f7_arg0.onlineFriendsCounterTimer.id = "onlineFriendsCounterTimer"
	f7_arg0.onlineFriendsCounterTimer:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 0, _1080p * 0, _1080p * 0, _1080p * 0 )
	f7_arg0:addElement( f7_arg0.onlineFriendsCounterTimer )
	f7_arg0:registerAndCallEventHandler( "update_online_friends_counter", f7_local0 )
end

local f0_local10 = function ( f2_arg0, f2_arg1, f2_arg2 )
	assert( f2_arg0.Emblem )
	f2_arg0.onlineFriendCount = 0
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0.EnableSocialMenu = f0_local0
	f2_arg0._isGamepad = LUI.IsLastInputGamepad( f2_arg1 )
	f2_arg0._socialMenuEnabled = true
	f2_arg0:SetAlignment( LUI.Alignment.Right )
	LAYOUT.ScaleWidgetToTextWidthLeftAligned( f2_arg0.FriendsButton.SocialDetails.CountText, f2_arg0.FriendsButton.SocialDetails.CountText )
	LAYOUT.ScaleWidgetToHorizontalListContentLeftAligned( f2_arg0.FriendsButton, f2_arg0.FriendsButton.SocialDetails )
	local f2_local0, f2_local1, f2_local2, f2_local3 = f2_arg0.Emblem:getLocalRect()
	f2_arg0._emblemSize = f2_local2 - f2_local0
	f2_arg0._maxEmblems = Dvar[0x22EAAB59AA27E9B]( "#x331afe3854384dff3" )
	f2_arg0._partyCount = 0
	f2_arg0._emblems = {
		f2_arg0.Emblem
	}
	f0_local0( f2_arg0 )
	f0_local0( f2_arg0, f2_arg1 )
	f0_local0( f2_arg0, f2_arg1 )
	local f2_local4 = LUI.DataSourceInGlobalModel.new( "alwaysLoaded.privateParty.count" )
	f2_arg0:SubscribeToModel( f2_local4:GetModel( f2_arg1 ), function ()
		f2_arg0._maxEmblems = Dvar[0x22EAAB59AA27E9B]( "#x331afe3854384dff3" )
		local f6_local0 = f2_arg0:GetValue( f2_arg0 )
		if f6_local0 and 0 < f6_local0 then
			local f6_local1 = f6_local0 - f2_arg0._partyCount
			f2_arg0._partyCount = f6_local0
			f2_arg0( f2_arg0, f2_arg0, f6_local1 )
		end
	end )
	f2_arg0:SubscribeToModel( DataSources.frontEnd.lobby.isDedi:GetModel( f2_arg1 ), function ()
		if not Lobby[0xF1D2956B0C99DF6]() or f2_arg0:GetValue( f2_arg0 ) then
			f2_arg0.IsDediMarker:SetAlpha( 0 )
		else
			f2_arg0.IsDediMarker:SetAlpha( 0.25 )
		end
	end )
	f0_local0( f2_arg0 )
	local f2_local5 = nil
	local f2_local6 = function ()
		local f3_local0 = f2_arg0:Wait( 500 )
		f3_local0.onComplete = function ()
			return f3_local0()
		end
		
		f2_arg0()
	end
	
	f2_local6()
	f0_local0( f2_arg0 )
end

function SocialPartyWidgetLayout( menu, controller )
	local self = LUI.UIHorizontalStackedLayout.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 332 * _1080p, 0, 64 * _1080p )
	self.id = "SocialPartyWidgetLayout"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local BindButtonContainer = nil
	
	BindButtonContainer = LUI.UIElement.new()
	BindButtonContainer.id = "BindButtonContainer"
	BindButtonContainer:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 4, _1080p * 13, _1080p * 17 )
	self:addElement( BindButtonContainer )
	self.BindButtonContainer = BindButtonContainer
	
	local SocialNotification = nil
	
	SocialNotification = MenuBuilder.BuildRegisteredType( "NewItemSmallIcon", {
		controllerIndex = f1_local1
	} )
	SocialNotification.id = "SocialNotification"
	SocialNotification:SetAlpha( 0.6, 0 )
	SocialNotification:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 4, _1080p * 12, _1080p * 16, _1080p * 24 )
	self:addElement( SocialNotification )
	self.SocialNotification = SocialNotification
	
	local Spacer = nil
	
	Spacer = LUI.UIImage.new()
	Spacer.id = "Spacer"
	Spacer:SetAlpha( 0, 0 )
	Spacer:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 12, _1080p * 30, _1080p * -8, _1080p * 56 )
	self:addElement( Spacer )
	self.Spacer = Spacer
	
	local Emblem = nil
	
	Emblem = LUI.UIImage.new()
	Emblem.id = "Emblem"
	Emblem:SetAnchorsAndPosition( 0, 1, 0.5, 0.5, _1080p * 30, _1080p * 94, _1080p * -40, _1080p * 24 )
	self:addElement( Emblem )
	self.Emblem = Emblem
	
	local IsDediMarker = nil
	
	IsDediMarker = LUI.UIImage.new()
	IsDediMarker.id = "IsDediMarker"
	IsDediMarker:SetAlpha( 0, 0 )
	IsDediMarker:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 94, _1080p * 96, _1080p * 10, _1080p * 30 )
	self:addElement( IsDediMarker )
	self.IsDediMarker = IsDediMarker
	
	local FriendsButton = nil
	
	FriendsButton = MenuBuilder.BuildRegisteredType( "FriendsButton", {
		controllerIndex = f1_local1
	} )
	FriendsButton.id = "FriendsButton"
	FriendsButton:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 212, 0, _1080p * 40 )
	self:addElement( FriendsButton )
	self.FriendsButton = FriendsButton
	
	local ButtonSpacer = nil
	
	ButtonSpacer = LUI.UIImage.new()
	ButtonSpacer.id = "ButtonSpacer"
	ButtonSpacer:SetAlpha( 0, 0 )
	ButtonSpacer:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 212, _1080p * 238, _1080p * -8, _1080p * 56 )
	self:addElement( ButtonSpacer )
	self.ButtonSpacer = ButtonSpacer
	
	local SocialMenuButton = nil
	
	SocialMenuButton = MenuBuilder.BuildRegisteredType( "SocialMenuButton", {
		controllerIndex = f1_local1
	} )
	SocialMenuButton.id = "SocialMenuButton"
	SocialMenuButton:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 238, _1080p * 348, _1080p * 4, _1080p * 34 )
	self:addElement( SocialMenuButton )
	self.SocialMenuButton = SocialMenuButton
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "SocialPartyWidgetLayout", SocialPartyWidgetLayout )
LockTable( _M )
