-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
require( "ui.widgets.ButtonHelperBar" )
require( "ui.frontEnd.ClanList" )
require( "ui.widgets.ClanDetails" )
require( "ui.widgets.ButtonPromptContainerHorizontal" )
local f0_local0 = 50
local f0_local1 = 1000
local f0_local2 = function ( f16_arg0, f16_arg1 )
	local f16_local0 = f16_arg0.ClanDetails
	local f16_local1 = f16_local0
	f16_local0 = f16_local0.SetVisibility
	local f16_local2
	if f16_arg1 then
		f16_local2 = LUI.Visibility.Visible
		if not f16_local2 then
		
		else
			f16_local0( f16_local1, f16_local2 )
		end
	end
	f16_local2 = LUI.Visibility.Hidden
end

local f0_local3 = function ( f13_arg0, f13_arg1 )
	if f13_arg0._retryTimer then
		f13_arg0:RemoveElement( f13_arg0._retryTimer )
		f13_arg0._retryTimer:closeTree()
		f13_arg0._retryTimer = nil
	end
	local f13_local0 = CLANS.GetClanSearchScopedData()
	local f13_local1 = f13_local0[f13_arg0._lastSearchResultsTable]
	if f13_local1 then
		f13_arg0:SearchResultsResolved( f13_local1 )
	end
	local f13_local2 = f13_local0.searchParams or {}
	local f13_local3 = nil
	if f13_arg0._useSuggestedClans then
		f13_local3 = Clans[0xF8D4D3DC4F91F51]( f13_arg1, nil, nil, Dvar[0x22EAAB59AA27E9B]( "#x3e4db8f2922d6fb7c" ), nil, nil, true )
	else
		f13_local3 = Clans[0xF8D4D3DC4F91F51]( f13_arg1, f13_local2.clanName, f13_local2.clanTag, f13_local2.privacyLevel, f13_local2.showFullClans, f13_local2.clanSearchLabels, nil )
	end
	if f13_local3 then
		LUI.FlowManager.RequestPopupMenu( nil, "FenceDialogPopup", true, f13_arg1, false, {
			message = Engine[0xED84C33EC5F01EA]( "CLANS/SEARCHING_FOR_CLANS" ),
			controllerIndex = f13_arg1,
			onCancel = function ( f15_arg0 )
				LUI.FlowManager.RequestLeaveMenu()
				LUI.FlowManager.RequestLeaveMenuByName( "FenceDialogPopup", true, true )
			end
		} )
	elseif not f13_arg0._retryTimer then
		local _retryTimer = LUI.UITimer.new( {
			interval = f0_local0,
			event = {
				name = "search_retry"
			}
		} )
		_retryTimer.id = "searchRetryTimer"
		f13_arg0:addElement( _retryTimer )
		f13_arg0._retryTimer = _retryTimer
		
		f13_arg0._retryTimer:registerEventHandler( "search_retry", function ()
			f13_arg0:SearchForClans( f13_arg0 )
		end )
	end
end

local f0_local4 = function ( f12_arg0, f12_arg1 )
	if f12_arg1.success then
		f12_arg0._clanDetails = f12_arg1.clanDetails
		if f12_arg0._useSuggestedClans then
			if 1 <= #f12_arg0._clanDetails then
				
			else
				
			end
			if f0_local0 < #f12_arg0._clanDetails then
				
			else
				
			end
		end
		if #f12_arg0._clanDetails == 0 then
			f12_arg0:SearchResultsResolved( {} )
			f12_arg0._pendingClanProfilesFetch = {}
			return 
		end
		local f12_local0 = {}
		for f12_local4, f12_local5 in ipairs( f12_arg0._clanDetails ) do
			table.insert( f12_local0, f12_local5.clanId )
		end
		f12_arg0._pendingClanProfilesFetch = nil
		if not Clans[0xD122B71FD62B5CD]( f12_arg0._controllerIndex, f12_local0 ) then
			f12_arg0._pendingClanProfilesFetch = f12_local0
		end
	end
end

local f0_local5 = function ( f11_arg0, f11_arg1 )
	if f11_arg0._pendingClanProfilesFetch then
		if 0 < #f11_arg0._pendingClanProfilesFetch then
			Clans[0xD122B71FD62B5CD]( f11_arg0._controllerIndex, f11_arg0._pendingClanProfilesFetch )
		end
		f11_arg0._pendingClanProfilesFetch = nil
		return 
	elseif f11_arg1.success and f11_arg0._clanDetails then
		for f11_local3, f11_local4 in ipairs( f11_arg1.clanProfiles ) do
			if f11_arg0._clanDetails[f11_local3] then
				assert( f11_arg0._clanDetails[f11_local3].clanId == f11_local4.clanId )
				f11_arg0._clanDetails[f11_local3].profile = f11_local4
			end
		end
		if Dvar[0x9E5BE3B4BBA4E0E]( "#x37c8dd5cc715f8fcf" ) then
			f11_local0 = {}
			for f11_local4, f11_local5 in ipairs( f11_arg0._clanDetails ) do
				table.insert( f11_local0, f11_local5.clanId )
			end
			Leaderboards[0x64D2AD25F1E7711]( f11_arg0._controllerIndex, f11_local0 )
		end
		f11_local0 = CLANS.GetClanSearchScopedData()
		f11_local0[f11_arg0._lastSearchResultsTable] = f11_arg0._clanDetails
		f11_arg0:SearchResultsResolved( f11_arg0._clanDetails )
	end
end

local f0_local6 = function ( f10_arg0, f10_arg1 )
	local f10_local0 = f10_arg1.clanRanks
	if f10_local0 and f10_arg0._clanDetails then
		for f10_local4, f10_local5 in ipairs( f10_arg0._clanDetails ) do
			if f10_local0[f10_local5.clanId] then
				f10_local5.clanRank = f10_local0[f10_local5.clanId]
			end
		end
	end
	local f10_local1 = CLANS.GetClanSearchScopedData()
	f10_local1[f10_arg0._lastSearchResultsTable] = f10_arg0._clanDetails
	f10_arg0:SearchResultsResolved( f10_arg0._clanDetails )
end

local f0_local7 = function ( f9_arg0, f9_arg1 )
	f9_arg0._clanDetails = f9_arg1
	f9_arg0._clanOwnerProfileButtonShown = false
	f9_arg0:UpdateButtonPrompts()
	if #f9_arg1 == 0 then
		f9_arg0:SetClanPreviewVisible( false )
	end
	f9_arg0.BrowseList:AddListEntries( f9_arg0._clanDetails )
	LUI.FlowManager.RequestLeaveMenuByName( "FenceDialogPopup", true, true )
end

local f0_local8 = function ( f8_arg0 )
	local f8_local0 = f8_arg0._parentButtonHelperBar
	if f8_local0 then
		if f8_arg0._clanOwnerProfileButtonShown then
			f8_local0.ButtonHelperText:PushButtonPrompt( {
				side = "left",
				button_ref = "button_r3",
				priority = 6,
				helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/CLAN_OWNER_PROFILE" )
			} )
		else
			f8_local0.ButtonHelperText:PopButtonPrompt( {
				button_ref = "button_r3"
			} )
		end
	end
end

local f0_local9 = function ( f7_arg0, f7_arg1 )
	if not f7_arg0._clanDetails[f7_arg1] then
		return 
	end
	f7_arg0._activeClanID = f7_arg0._clanDetails[f7_arg1].clanId
	f7_arg0.currentClanIndex = f7_arg1
	f7_arg0.ClanDetails:SetDetails( f7_arg0._clanDetails[f7_arg1] )
	f7_arg0:SetClanPreviewVisible( true )
	local f7_local0 = f7_arg0._clanDetails[f7_arg0.currentClanIndex].clanOwner
	if f7_local0 then
		f7_local0 = f7_arg0._clanDetails[f7_arg0.currentClanIndex].clanOwner ~= Engine[0x29DFACECF20DE0E]( f7_arg0._controllerIndex )
	end
	if f7_arg0._clanOwnerProfileButtonShown ~= f7_local0 then
		f7_arg0._clanOwnerProfileButtonShown = f7_local0
		f7_arg0:UpdateButtonPrompts()
	end
end

local f0_local10 = function ( f6_arg0, f6_arg1 )
	LUI.FlowManager.RequestAddMenu( "ClanProfile", true, f6_arg0._controllerIndex, false, {
		clanData = f6_arg0._clanDetails[f6_arg1]
	}, true, true )
end

local f0_local11 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.SearchForClans = f0_local0
	f2_arg0.SearchForClansResolved = f0_local0
	f2_arg0.SearchResultsResolved = f0_local0
	f2_arg0.UpdateButtonPrompts = f0_local0
	f2_arg0.PreviewClan = f0_local0
	f2_arg0.ViewClan = f0_local0
	f2_arg0.SetClanPreviewVisible = f0_local0
	f2_arg0._controllerIndex = f2_arg1
	local self = f2_arg2.useSuggestedClans
	if self then
		self = CONDITIONS.IsClansRecommendedEnabled()
	end
	f2_arg0._useSuggestedClans = self
	if f2_arg0._useSuggestedClans then
		self = "lastSuggestedSearchResults"
	else
		self = "lastSearchResults"
	end
	f2_arg0._lastSearchResultsTable = self
	f2_arg0._clanDetails = {}
	f2_arg0._parentButtonHelperBar = f2_arg2.parentButtonHelperBar
	f2_arg0:SetClanPreviewVisible( false )
	f2_arg0.BrowseList:SetSourceDataOwnerWidget( f2_arg0 )
	f2_arg0:addEventHandler( "clans_search_resolved", f0_local0 )
	f2_arg0:addEventHandler( "clans_profile_fetch_resolved", f0_local0 )
	f2_arg0:addEventHandler( "clan_leaderboard_fetch_clan_ranks_complete", f0_local0 )
	f0_local0( f2_arg0, f2_arg1 )
	if f2_arg0.ButtonHelperBar and not f2_arg0._useSuggestedClans then
		f2_arg0.ButtonHelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 0,
			button_ref = "button_l3",
			helper_text = Engine[0xED84C33EC5F01EA]( "CLANS/SORT_FILTER" ),
			container = f2_arg0.FilterClans
		} )
	end
	if not f2_arg0.bindButton then
		self = LUI.UIBindButton.new()
		self.id = "selfBindButton"
		f2_arg0:addElement( self )
		f2_arg0.bindButton = self
	end
	f2_arg0.bindButton:addEventHandler( "button_right_stick", function ( f5_arg0, f5_arg1 )
		if f2_arg0._clanOwnerProfileButtonShown and f2_arg0._clanDetails[f2_arg0.currentClanIndex].clanOwner and f2_arg0._clanDetails[f2_arg0.currentClanIndex].clanOwner ~= Engine[0x29DFACECF20DE0E]( f2_arg0 ) then
			CLANS.OpenClanOwnerProfile( f5_arg0, f2_arg0, Friends[0x7E6685E08C0BB92]( f2_arg0._clanDetails[f2_arg0.currentClanIndex].clanOwner ) )
		end
	end )
	f2_arg0.bindButton:registerEventHandler( "button_left_stick", function ( element, event )
		if not f2_arg0._useSuggestedClans then
			LUI.FlowManager.RequestPopupMenu( nil, "FlyInPopup", true, f2_arg0._controllerIndex, false, {
				flyInLeftWide = true,
				disableQuickAccessShortcuts = false,
				controllerIndex = f2_arg0._controllerIndex,
				widgetConstructor = function ()
					return MenuBuilder.BuildRegisteredType( "ClanBrowserSearchParameters", {
						controllerIndex = element._controllerIndex
					} )
				end
			} )
		end
	end )
end

function ClanBrowserList( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "ClanBrowserList"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	self.HelperBar.id = "HelperBar"
	self.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	self.HelperBar:setPriority( 10 )
	self:addElement( self.HelperBar )
	local f1_local2 = self
	local ButtonHelperBar = nil
	
	ButtonHelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	ButtonHelperBar.id = "ButtonHelperBar"
	ButtonHelperBar:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -830, _1080p * 830, _1080p * 978, _1080p * 1026 )
	self:addElement( ButtonHelperBar )
	self.ButtonHelperBar = ButtonHelperBar
	
	local BrowseList = nil
	
	BrowseList = MenuBuilder.BuildRegisteredType( "ClanList", {
		controllerIndex = f1_local1
	} )
	BrowseList.id = "BrowseList"
	BrowseList:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 736, _1080p * 252, _1080p * 882 )
	self:addElement( BrowseList )
	self.BrowseList = BrowseList
	
	local ClanDetails = nil
	
	ClanDetails = MenuBuilder.BuildRegisteredType( "ClanDetails", {
		controllerIndex = f1_local1
	} )
	ClanDetails.id = "ClanDetails"
	ClanDetails:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 780, _1080p * 1824, _1080p * 140, _1080p * 940 )
	self:addElement( ClanDetails )
	self.ClanDetails = ClanDetails
	
	local SortType = nil
	
	SortType = LUI.UIText.new()
	SortType.id = "SortType"
	SortType:SetRGBFromTable( SWATCHES.text.buttonTextDefault, 0 )
	SortType:SetAlpha( 0.8, 0 )
	SortType:setText( "", 0 )
	SortType:SetFont( FONTS.GetFont( FONT_STYLES.fontStyle_SHeaderBold.font.File ) )
	SortType:SetFontSize( FONT_STYLES.fontStyle_SHeaderBold.size )
	SortType:SetMinFontSize( FONT_STYLES.fontStyle_SHeaderBold.minSize )
	SortType:SetWordWrap( false )
	SortType:SetAlignment( LUI.Alignment.Left )
	SortType:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 709, _1080p * 216, _1080p * 248 )
	self:addElement( SortType )
	self.SortType = SortType
	
	local FilterClans = nil
	FilterClans = MenuBuilder.BuildRegisteredType( "ButtonPromptContainerHorizontal", {
		controllerIndex = f1_local1
	} )
	FilterClans.id = "FilterClans"
	if CONDITIONS.AlwaysFalse() then
		FilterClans.Label:setText( Engine[0xED84C33EC5F01EA]( "CLANS/SORT_FILTER" ), 0 )
	end
	FilterClans:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 274, _1080p * 185, _1080p * 216 )
	self:addElement( FilterClans )
	self.FilterClans = FilterClans
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ClanBrowserList", ClanBrowserList )
LockTable( _M )
