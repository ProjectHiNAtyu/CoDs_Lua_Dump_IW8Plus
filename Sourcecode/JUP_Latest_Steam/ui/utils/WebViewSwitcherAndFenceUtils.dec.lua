-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
WebViewSwitcherAndFenceUtils = WebViewSwitcherAndFenceUtils or {}
WebViewSwitcherAndFenceUtils.WebViewSwitcher = {}
WebViewSwitcherAndFenceUtils.DefaultFenceConfig = {}
WebViewSwitcherAndFenceUtils.FenceConfig = {}
WebViewSwitcherAndFenceUtils.FenceUpdateResult = {
	block = 1,
	pass = 0,
	fail = 2
}
WebViewSwitcherAndFenceUtils.CacheFenceState = {}
local f0_local0 = {
	nil,
	"ONLINE_DAILY_LOGIN",
	"USER_STATE"
}
local f0_local1 = function ( f35_arg0, f35_arg1 )
	local f35_local0 = DataSources.telescope.cachefencestate[f35_arg1]
	if f35_local0 then
		return f35_local0:GetValue( f35_arg0 ) == true
	else
		return false
	end
end

local f0_local2 = function ( f34_arg0, f34_arg1 )
	local f34_local0 = DataSources.telescope.cachefencestate[f34_arg1]
	if f34_local0 and f34_local0:GetValue( f34_arg0 ) ~= true then
		f34_local0:SetValue( f34_arg0, true )
	end
end

local f0_local3 = function ( f33_arg0, f33_arg1 )
	if f0_local0( f33_arg0, f33_arg1 ) then
		return true
	elseif Fences[0x6C6D08978B8C65]( f33_arg0, f33_arg1 ) ~= LUI.Fence.FenceObjectState.PASSING then
		return false
	else
		f0_local0( f33_arg0, f33_arg1 )
	end
end

WebViewSwitcherAndFenceUtils.InitDataSources = function ()
	DataSources.telescope.cachefencestate = LUI.DataSourceInGlobalModel.new( "telescope.cachefencestate" )
	for f32_local3, f32_local4 in ipairs( f0_local0 ) do
		DataSources.telescope.cachefencestate[f32_local4] = LUI.DataSourceInGlobalModel.new( "telescope.cachefencestate." .. f32_local4 )
	end
end

WebViewSwitcherAndFenceUtils.RegisterDeferredFence = function ( f30_arg0 )
	for f30_local3, f30_local4 in ipairs( f0_local0 ) do
		LUI.DeferredFence.Attach( f30_arg0, 0, f30_local4, LUI.DeferredFence.Criticality.LOW, LUI.DeferredFence.BackOutMethod.NONE, function ( f31_arg0, f31_arg1 )
			if f31_arg1.fenceState == LUI.Fence.FenceObjectState.PASSING then
				f30_arg0( f31_arg1.controllerIndex, f30_arg0 )
			end
		end, true )
	end
end

local f0_local4 = function ( f29_arg0, f29_arg1 )
	for f29_local3, f29_local4 in ipairs( f29_arg1 ) do
		if not f0_local0( f29_arg0, f29_local4 ) then
			return false, f29_local4
		end
	end
	return true
end

WebViewSwitcherAndFenceUtils.CreateWebViewSwitcher = function ( f28_arg0, f28_arg1 )
	local f28_local0 = LUI.Class()
	f28_local0.subSwitcherList = f28_arg1
	WebViewSwitcherAndFenceUtils.WebViewSwitcher[f28_arg0] = f28_local0
	return f28_local0
end

WebViewSwitcherAndFenceUtils.CreateSubSwitcher = function ( f25_arg0, f25_arg1 )
	local f25_local0 = LUI.Class()
	f25_local0.dependencyFenceNameList = f25_arg0
	f25_local0.checkFn = f25_arg1
	f25_local0.checkPassFn = function ( f27_arg0, f27_arg1, f27_arg2 )
		if not f27_arg2 then
			local f27_local0, f27_local1 = f25_arg0( f27_arg1, f27_arg0.dependencyFenceNameList )
			if not f27_local0 then
				return false, "not pass " .. f27_local1
			end
		end
		local f27_local0, f27_local1 = f27_arg0.checkFn( f27_arg1 )
		if f27_local0 == false then
			return false, f27_local1
		end
		return true
	end
	
	f25_local0.checkFailedFn = function ( f26_arg0, f26_arg1 )
		local f26_local0, f26_local1 = f25_arg0( f26_arg1, f26_arg0.dependencyFenceNameList )
		if not f26_local0 then
			return false
		else
			local f26_local2, f26_local3 = f26_arg0.checkFn( f26_arg1 )
			if f26_local2 == false then
				return true, f26_local3
			else
				return false
			end
		end
	end
	
	return f25_local0
end

local f0_local5 = function ( f24_arg0 )
	local f24_local0 = WebViewSwitcherAndFenceUtils.WebViewSwitcher[f24_arg0]
	if f24_local0 then
		return f24_local0
	else
		return {
			subSwitcherList = {}
		}
	end
end

WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAnyFailed = function ( f23_arg0, f23_arg1 )
	local f23_local0 = f0_local0( f23_arg1 )
	local f23_local1 = f23_local0.subSwitcherList
	if not f23_local1 or #f23_local1 == 0 then
		return false
	end
	for f23_local5, f23_local6 in ipairs( f23_local1 ) do
		local f23_local7, f23_local8 = f23_local6:checkFailedFn( f23_arg0 )
		if f23_local7 then
			return true, " subswitcher index:" .. f23_local5 .. " reason:" .. f23_local8
		end
	end
	return false
end

WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAllPass = function ( f22_arg0, f22_arg1, f22_arg2 )
	local f22_local0 = f0_local0( f22_arg1 )
	local f22_local1 = f22_local0.subSwitcherList
	if not f22_local1 or #f22_local1 == 0 then
		return true
	end
	for f22_local5, f22_local6 in ipairs( f22_local1 ) do
		local f22_local7, f22_local8 = f22_local6:checkPassFn( f22_arg0, f22_arg2 )
		if not f22_local7 then
			return false, "switcher index:" .. f22_local5 .. " reason:" .. f22_local8
		end
	end
	return true
end

WebViewSwitcherAndFenceUtils.RegisterWebViewSwitcherEnabledCallback = function ( f20_arg0, f20_arg1, f20_arg2, f20_arg3 )
	f20_arg0["_switcher_" .. f20_arg2 .. "_enabled"] = false
	f20_arg0:CreateEventTimer( "WebViewSwitcherEnabledTimer", 1000, {
		immediate = true,
		callbackFunc = function ( f21_arg0, f21_arg1 )
			local f21_local0 = WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAllPass( f20_arg0, f20_arg0 )
			local f21_local1 = f21_arg0[f20_arg0]
			if f21_local0 and not f21_local1 then
				f20_arg0( f21_arg0, f20_arg0 )
				f21_arg0[f20_arg0] = true
			else
				local f21_local2, f21_local3 = WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAnyFailed( f20_arg0, f20_arg0 )
				if f21_local2 and f21_local1 then
					f20_arg0( f21_arg0, f20_arg0 )
					f21_arg0[f20_arg0] = false
				end
			end
		end
	} )
end

local f0_local6 = function ( f16_arg0 )
	local f16_local0 = LUI.Class()
	f16_local0.fenceUpdate = function ( f19_arg0, f19_arg1 )
		if not DataSources.telescope.loadcomplete:GetValue( f19_arg1 ) then
			return WebViewSwitcherAndFenceUtils.FenceUpdateResult.block
		else
			return WebViewSwitcherAndFenceUtils.FenceUpdateResult.pass
		end
	end
	
	f16_local0.fenceCheckFailed = function ( f18_arg0, f18_arg1 )
		return false
	end
	
	f16_local0.fencePassCallback = function ( f17_arg0, f17_arg1 )
		
	end
	
	return f16_local0
end

WebViewSwitcherAndFenceUtils.CreateDefaultFenceConfig = function ()
	local f11_local0 = LUI.Class()
	f11_local0.enableTimeout = true
	f11_local0.enableCancel = true
	f11_local0.popupName = "PopupWaitWebViewLoadComplete"
	f11_local0.useWZLogo = false
	f11_local0.message = ""
	f11_local0.timeoutSecond = Dvar[0x22EAAB59AA27E9B]( 0x7FAC857EB041D1C )
	f11_local0.backgroundImage = 0xB0EA9B4C5FD88B8
	f11_local0.fenceGroup = {
		f0_local0( WebViewFullScreenConfigs.FullScreenName.default )
	}
	f11_local0.cancelCallback = function ( f15_arg0, f15_arg1 )
		
	end
	
	f11_local0.completeCallback = function ( f14_arg0, f14_arg1 )
		
	end
	
	f11_local0.failCallback = function ( f13_arg0, f13_arg1 )
		
	end
	
	f11_local0.timeoutCallback = function ( f12_arg0, f12_arg1 )
		
	end
	
	WebViewSwitcherAndFenceUtils.DefaultFenceConfig = f11_local0
	WebViewSwitcherAndFenceUtils.FenceConfig[WebViewFullScreenConfigs.FullScreenName.default] = f11_local0
	return f11_local0
end

local f0_local7 = function ( f7_arg0 )
	local f7_local0 = LUI.Class()
	f7_local0.fenceUpdate = function ( f10_arg0, f10_arg1 )
		return WebViewSwitcherAndFenceUtils.FenceUpdateResult.pass
	end
	
	f7_local0.fenceCheckFailed = function ( f9_arg0, f9_arg1 )
		return false
	end
	
	f7_local0.fencePassCallback = function ( f8_arg0, f8_arg1 )
		
	end
	
	return f7_local0
end

local f0_local8 = function ( f6_arg0, f6_arg1 )
	local f6_local0 = nil
	if f6_arg1 then
		f6_local0 = WebViewSwitcherAndFenceUtils.FenceConfig[f6_arg1]
	end
	if not f6_local0 then
		f6_local0 = WebViewSwitcherAndFenceUtils.DefaultFenceConfig
	end
	local f6_local1 = LUI.Class( f6_local0 )
	local f6_local2 = f0_local0( f6_arg0 )
	local f6_local3 = f0_local0( f6_arg0 )
	f6_local1.fenceGroup = {
		f6_local2,
		f6_local3
	}
	f6_local1.switcherFence = f6_local2
	f6_local1.loadCompleteFence = f6_local3
	WebViewSwitcherAndFenceUtils.FenceConfig[f6_arg0] = f6_local1
	return f6_local1
end

WebViewSwitcherAndFenceUtils.CreateEntryWebViewFenceConfig = function ( f4_arg0, f4_arg1 )
	local f4_local0 = f0_local0( f4_arg0, f4_arg1 )
	f4_local0.enableTimeout = false
	f4_local0.enableCancel = true
	f4_local0.isEntryFence = true
	f4_local0.isPopupFence = false
	f4_local0.switcherFence.fenceUpdate = function ( f5_arg0, f5_arg1 )
		return WebViewSwitcherAndFenceUtils.FenceUpdateResult.pass
	end
	
	return f4_local0
end

WebViewSwitcherAndFenceUtils.CreatePopupWebViewFenceConfig = function ( f2_arg0, f2_arg1 )
	local f2_local0 = f0_local0( f2_arg0, f2_arg1 )
	f2_local0.enableTimeout = true
	f2_local0.enableCancel = true
	f2_local0.isEntryFence = false
	f2_local0.isPopupFence = true
	f2_local0.switcherFence.fenceUpdate = function ( f3_arg0, f3_arg1 )
		local f3_local0, f3_local1 = WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAnyFailed( f3_arg1, f2_arg0 )
		if f3_local0 then
			return WebViewSwitcherAndFenceUtils.FenceUpdateResult.fail
		elseif WebViewSwitcherAndFenceUtils.IsWebViewSwitcherAllPass( f3_arg1, f2_arg0 ) then
			return WebViewSwitcherAndFenceUtils.FenceUpdateResult.pass
		else
			return WebViewSwitcherAndFenceUtils.FenceUpdateResult.block
		end
	end
	
	return f2_local0
end

WebViewSwitcherAndFenceUtils.GetFenceConfig = function ( f1_arg0 )
	return WebViewSwitcherAndFenceUtils.FenceConfig[f1_arg0]
end

