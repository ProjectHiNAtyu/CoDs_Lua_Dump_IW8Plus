-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-07-2025 21:51
module( ..., package.seeall )
FenceSignIn = LUI.Class( LUI.Fence )
FenceSignIn.ACCOUNT_PICKER_STATE = {
	picking = 2,
	inactive = 1
}
FenceSignIn.BattleNetSignInState = {
	signedIn = 2,
	error = 3,
	idle = 0,
	signingIn = 1
}
FenceSignIn.init = function ( f18_arg0 )
	LUI.Fence.init( f18_arg0 )
	f18_arg0._force2FABlock = false
	f18_arg0._perController = {}
	f18_arg0._show2FAWarning = true
	f18_arg0._forceSMSBlock = false
	f18_arg0._smsUrl = ""
	for f18_local0 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		f18_arg0._perController[f18_local0] = {
			accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
		}
	end
end

FenceSignIn.Start = function ( f17_arg0 )
	DebugPrint( "FenceSignIn.Start" )
end

FenceSignIn.Stop = function ( f16_arg0 )
	DebugPrint( "FenceSignIn.Stop" )
end

FenceSignIn.PostFail = function ( f15_arg0 )
	if f15_arg0._state == LUI.Fence.STATE.fail then
		if f15_arg0._force2FABlock then
			LUI.FlowManager.RequestPopupMenu( nil, "popup_force_2fa_block", false, nil, false, {}, nil, false, true )
		elseif f15_arg0._forceSMSBlock then
			LUI.FlowManager.RequestPopupMenu( nil, "popup_sms_reset_block", false, controllerIndex, false, {
				url = f15_arg0._smsUrl
			}, nil, false, true )
		elseif Fences.BDEBEIHECI() then
			LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_error", false, nil, false, {}, nil, false, true )
		end
	end
end

function PopupSignInQueue( f13_arg0, f13_arg1 )
	assert( f13_arg1 )
	local f13_local0 = {
		message = Engine.CBBHFCGDIC( "LUA_MENU_MP/SERVER_QUEUE" ),
		description = Engine.CBBHFCGDIC( "PLATFORM/BNET_SERVER_QUEUE_MSG" )
	}
	local f13_local1 = {}
	local f13_local2 = Engine.CBBHFCGDIC
	local f13_local3
	if Engine.CGABICJHAI() then
		f13_local3 = "LUA_MENU/QUIT_DESKTOP"
	else
		f13_local3 = "MENU/EXIT"
	end
	f13_local1.label = f13_local2( f13_local3 )
	f13_local1.alignment = LUI.Alignment.Center
	f13_local1.action = function ()
		if Engine.CGABICJHAI() then
			Engine.DJEDDFJEIG()
		else
			LUI.FlowManager.RequestLeaveMenu()
		end
	end
	
	f13_local0.buttons = f13_local1
	f13_local1 = f13_arg1.controllerIndex
	if not f13_local1 then
		f13_local1 = Engine.IJEBHJIJF()
	end
	f13_local0.controllerIndex = f13_local1
	f13_local1 = MenuBuilder.BuildRegisteredType( "FenceSigninQueueDialogPopup", f13_local0 )
	f13_local1.id = "popup_signin_queue"
	return f13_local1
end

FenceSignIn.OpenSignInQueuedPopup = function ( f11_arg0 )
	local f11_local0 = f11_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_queue", false, nil, false, {
		onCancel = function ( f12_arg0, f12_arg1 )
			f11_arg0._perController[f12_arg1].isCancelling = true
		end
	}, nil, true, true )
	f11_arg0._openedWaitPopup = "popup_signin_queue"
end

FenceSignIn.UpdateState = function ( f9_arg0 )
	assert( f9_arg0._state ~= LUI.Fence.STATE.fail )
	f9_arg0._state = LUI.Fence.STATE.pass
	if Engine.EAAHJIGHHI() then
		f9_arg0._state = LUI.Fence.STATE.pass
	end
	if Engine.DBFCJBDJEC() then
		local f9_local0 = 0
		if not Engine.CDCCDDJAJJ( f9_local0 ) then
			local f9_local1 = Engine.BIBHHEJBIB()
			local f9_local2 = function ( f10_arg0 )
				if f9_arg0._openedWaitPopup ~= nil and f9_arg0._openedWaitPopup ~= f10_arg0 then
					LUI.FlowManager.RequestLeaveMenuByName( f9_arg0._openedWaitPopup, true )
					f9_arg0._openedWaitPopup = nil
					return true
				elseif f9_arg0._openedWaitPopup == nil then
					return true
				else
					return false
				end
			end
			
			if f9_local1 then
				if f9_local2( "popup_signin_queue" ) then
					f9_arg0:OpenSignInQueuedPopup()
				end
			elseif f9_arg0._openedWaitPopup then
				LUI.FlowManager.RequestLeaveMenuByName( f9_arg0._openedWaitPopup, true )
				f9_arg0._openedWaitPopup = nil
			end
			local f9_local3 = Engine.BDJHIJJHGG( f9_local0 )
			if f9_local3 == FenceSignIn.BattleNetSignInState.error then
				f9_arg0._state = LUI.Fence.STATE.fail
			elseif f9_local3 ~= FenceSignIn.BattleNetSignInState.signedIn then
				f9_arg0._state = LUI.Fence.STATE.block
			end
		else
			if AccountRegistration.DGGCBFCCGF( f9_local0 ) and not f9_arg0._forceSMSBlock then
				local f9_local1 = AccountRegistration.CEFIIHJEFG( f9_local0 )
				if not f9_local1.isCompleted and f9_local1.mechanism == "sms" then
					f9_arg0._state = LUI.Fence.STATE.fail
					f9_arg0._forceSMSBlock = true
					f9_arg0._smsUrl = f9_local1.url
				end
			end
			if Engine.CGABICJHAI() and Dvar.IBEGCHEFE( "OMTMMOTQOO" ) and OnlineABTesting.DEFDBJBAJ( f9_local0 ) and TwoFactorAuth.DGEDAGGDJC( f9_local0 ) and not Engine.CFHBIHABCB( f9_local0 ) and f9_arg0._show2FAWarning and (TwoFactorAuth.CGFIJBGHEB() or Dvar.CFHDGABACF( "LMTKLKNROQ" ) == 0) then
				local f9_local1 = TwoFactorAuth.DGGBCHIBEF()
				if f9_local1 < 0 or Dvar.CFHDGABACF( "LMTKLKNROQ" ) == 0 then
					Engine.CEJJDJJHIJ( f9_local0, "dlog_event_2fa_disabled_block_popup", {} )
					Dvar.DFIJDJFIFD( "LMLQLMQOSR", 0 )
					f9_arg0._state = LUI.Fence.STATE.fail
					f9_arg0._force2FABlock = true
				else
					f9_arg0._show2FAWarning = false
					Engine.CEJJDJJHIJ( f9_local0, "dlog_event_2fa_warning_popup", {
						logins_remaining = f9_local1
					} )
					if Engine.BECCFCBIAA( "hasEverSeen_CODAccountOTP", f9_local0 ) == 1 then
						LUI.FlowManager.RequestPopupMenu( nil, "CODAccountAuthenticationAdv", true, f9_local0, false, {
							tfa_warning = true,
							state = f9_arg0,
							logins_remaining = f9_local1
						}, nil, true, true )
					end
				end
			end
		end
		return 
	elseif Engine.JIFHCDAFB() then
		f9_arg0._state = LUI.Fence.STATE.block
		return 
	end
	for f9_local4 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		if Engine.BBHAECABBD( f9_local4 ) and not Engine.CDCCDDJAJJ( f9_local4 ) then
			local f9_local5 = assert
			local f9_local6 = Engine.BAHIIBFDDG()
			if not f9_local6 then
				f9_local6 = Engine.DEHJIFFID()
				if not f9_local6 then
					f9_local6 = Engine.BEFACAIFDD()
				end
			end
			f9_local5( f9_local6 )
			if f9_arg0._perController[f9_local4].accountPickerState == FenceSignIn.ACCOUNT_PICKER_STATE.inactive then
				f9_arg0._state = LUI.Fence.STATE.block
				f9_arg0._perController[f9_local4].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.picking
				Engine.BGEFGFACEH( f9_local4, false )
				return 
			end
		end
	end
	local f9_local4 = 0
	local f9_local1 = 0
	for f9_local2 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		if Engine.BBHAECABBD( f9_local2 ) and Engine.CDCCDDJAJJ( f9_local2 ) then
			f9_local4 = f9_local4 + 1
			if not Engine.DBAEJAHFGJ( f9_local2 ) then
				f9_local1 = f9_local1 + 1
			end
		end
	end
	local f9_local2 = false
	if Dvar.IBEGCHEFE( "LPSPMQSNPQ" ) and Engine.CIEGIACHAE() and 0 < f9_local4 then
		f9_local2 = true
	end
	if 0 < f9_local4 and 0 < f9_local1 then
		f9_local2 = true
	end
	if f9_local2 then
		for f9_local3 = 0, Engine.DCJGJDDEHE() - 1, 1 do
			if Engine.BBHAECABBD( f9_local3 ) and not Engine.CDCCDDJAJJ( f9_local3 ) then
				Engine.CIHFHAIIHC( f9_local3 )
				f9_arg0._perController[f9_local3].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
			end
		end
	else
		f9_arg0._state = LUI.Fence.STATE.fail
	end
end

function PopupSignInError( f6_arg0, f6_arg1 )
	local f6_local0 = "LUA_MENU/PROFILE_NOT_SIGNED_IN"
	if Engine.CIEGIACHAE() then
		f6_local0 = "PLATFORM/NOT_SIGNED_IN"
	end
	if Engine.EAAHGICFBD() then
		f6_local0 = "XBOXLIVE/MUSTLOGIN"
	end
	local f6_local1 = {
		controllerIndex = f6_arg1.controllerIndex,
		title = Engine.CBBHFCGDIC( "MENU/SIGN_IN" ),
		message = Engine.CBBHFCGDIC( f6_local0 ),
		buttons = {
			{
				label = Engine.CBBHFCGDIC( "MENU/OK" )
			}
		}
	}
	if Engine.DBFCJBDJEC() then
		f6_local1.message = Engine.DJHABIGCGE()
		f6_local1.buttons[1].label = Engine.CBBHFCGDIC( "LUA_MENU/QUIT_DESKTOP" )
		f6_local1.buttons[1].action = function ()
			Engine.DJEDDFJEIG()
		end
		
		if Engine.EDFJDAHID() then
			table.insert( f6_local1.buttons, 1, {
				label = Engine.CBBHFCGDIC( "PLATFORM/GO_TO_BLIZZARD_ACCOUNT_SETTINGS" ),
				action = function ()
					Engine.BHECIAHGC( f6_arg0.controllerIndex, 0, "https://account.blizzard.com/details#phone-number" )
				end
			} )
		end
		if Engine.DBDHEJCHCI() then
			Lobby.ForceEndPlayerLFPSession( {
				resetAllData = false,
				eventName = Lobby.LFPEvents.DISCONNECT
			} )
			f6_local1.title = Engine.CBBHFCGDIC( "EXE/SERVER_DISCONNECTED" )
		end
	end
	local f6_local2 = MenuBuilder.BuildRegisteredType( "GenericImagePopup", f6_local1 )
	f6_local2.id = "popup_signin_error"
	return f6_local2
end

function PopupForce2FABlock( f3_arg0, f3_arg1 )
	assert( f3_arg1 )
	local f3_local0 = {
		message = Engine.CBBHFCGDIC( "CODACCOUNT/TFA_BLOCK_MESSAGE" ),
		title = Engine.CBBHFCGDIC( "CODACCOUNT/LOGIN_ERROR_TITLE" ),
		buttons = {
			{
				label = Engine.CBBHFCGDIC( "MENU/OK" )
			},
			{
				label = Engine.CBBHFCGDIC( "MENU/OK" )
			}
		},
		controllerIndex = f3_arg1.controllerIndex,
		imageOverride = "logo_wz_shadow"
	}
	f3_local0.buttons[1].label = Engine.CBBHFCGDIC( "CODACCOUNT/TFA_BTN_ENROLL" )
	f3_local0.buttons[1].action = function ()
		Engine.BHECIAHGC( f3_arg0.controllerIndex, WebBrowserType.FULLSCREEN, CODACCOUNT.AccountSettingsURL )
		Engine.DJEDDFJEIG()
	end
	
	f3_local0.buttons[2].label = Engine.CBBHFCGDIC( "LUA_MENU/QUIT_DESKTOP" )
	f3_local0.buttons[2].action = function ()
		Engine.DJEDDFJEIG()
	end
	
	local f3_local1 = MenuBuilder.BuildRegisteredType( "GenericImagePopup", f3_local0 )
	f3_local1.id = "popup_force_2fa_block"
	return f3_local1
end

function SMSResetBlock( f1_arg0, f1_arg1 )
	assert( f1_arg1 )
	local f1_local0 = {
		message = Engine.CBBHFCGDIC( "CODACCOUNT/SMS_RESET_BODY", Engine.JCBDICCAH( f1_arg1.url ) ),
		title = Engine.CBBHFCGDIC( "CODACCOUNT/SMS_RESET_TITLE" ),
		buttons = {
			{
				label = Engine.CBBHFCGDIC( "MENU/OK" )
			}
		},
		controllerIndex = f1_arg1.controllerIndex
	}
	if not CONDITIONS.IsLaze() then
		f1_local0.imageOverride = "logo_cod_warzone_mw_shadow"
	else
		f1_local0.imageOverride = "mm_element_logo_white"
	end
	f1_local0.buttons[1].label = Engine.CBBHFCGDIC( "CODACCOUNT/SMS_RESET_BTN" )
	f1_local0.buttons[1].action = function ()
		Engine.BHECIAHGC( f1_arg0.controllerIndex, WebBrowserType.FULLSCREEN, f1_arg0.url )
		Engine.DJEDDFJEIG()
	end
	
	local f1_local1 = MenuBuilder.BuildRegisteredType( "GenericImagePopup", f1_local0 )
	f1_local1.id = "popup_sms_reset_block"
	return f1_local1
end

MenuBuilder.registerType( "popup_signin_queue", PopupSignInQueue )
MenuBuilder.registerType( "popup_signin_error", PopupSignInError )
MenuBuilder.registerType( "popup_force_2fa_block", PopupForce2FABlock )
MenuBuilder.registerType( "popup_sms_reset_block", SMSResetBlock )
LUI.Fence.Register( "signIn", FenceSignIn )
LockTable( _M )
