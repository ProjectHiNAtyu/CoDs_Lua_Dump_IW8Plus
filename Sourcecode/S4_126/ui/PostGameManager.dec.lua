-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
LUI.PostGameManager = LUI.Class( LUI.UIElement )
local f0_local0 = 300
local f0_local1 = 5000
local f0_local2 = 3000
PostGameState = {
	NUKE_TOTAL_WHITE = 12,
	NUKE_BNK = 13,
	BROSHOT = 7,
	SHOW_INGAME_AAR = 14,
	ACTIVE = 1,
	FINAL_KILLCAM = 3,
	WINNERS_CIRCLE_TEAM_MVP_TITLE_CARD = 15,
	POTG = 4,
	CP_RETRY_POPUP = 10,
	ROUND_END = 2,
	INACTIVE = 0,
	SCOREBOARD = 5,
	TAC_OPS_INTERMISSION = 8,
	WINNERS_CIRCLE_VIEW_MVP_WINNER = 17,
	WINNERS_CIRCLE = 16,
	CLASSIC_REWARDSCREEN = 11,
	BR_END_SPLASH = 9,
	GAMEBATTLE_RESULT = 6
}
LUI.PostGameManager.init = function ( f19_arg0, f19_arg1 )
	LUI.UIElement.init( f19_arg0 )
	assert( f19_arg1 )
	f19_arg0._controllerIndex = f19_arg1
	f19_arg0.id = "PostGameManager"
	f19_arg0:registerEventHandler( "shake_post_game_hud", function ( element, event )
		if f19_arg0.shakeable then
			LUI.HUD.Shake( f19_arg0, event )
		end
	end )
end

LUI.PostGameManager.ShouldBeVisible = function ( f18_arg0 )
	local f18_local0 = Engine[0x9258F49F515F97B]()
	if f18_local0 then
		f18_local0 = Game[0xA988866C889EAAD]()
		if f18_local0 then
			f18_local0 = f18_arg0.IsPostGame( f18_arg0._controllerIndex )
		end
	end
	return f18_local0
end

LUI.PostGameManager.IsHidden = function ( f17_arg0 )
	local f17_local0 = {
		nil,
		"RoundEndButtons"
	}
	if CONDITIONS.IsNukeEndState( f17_arg0, f17_arg0._controllerIndex ) then
		return false
	end
	local f17_local1 = DataSources.inGame.HUD.isScoreboardOpen:GetValue( f17_arg0._controllerIndex )
	if Engine[0xD151EC5B41223B5]() then
		if not f17_local1 then
			local f17_local2 = AnyActiveMenusInStack( Engine[0xEE6F69FEA944B13]() )
			if f17_local2 then
				f17_local1 = f17_local2
			else
				f17_local1 = not LUI.IsItemInArray( f17_local0, GetVisibleMenu( Engine[0xEE6F69FEA944B13]() ) )
			end
		end
	elseif Engine[0xCA085C21FCBD7CA]() and f17_local1 then
		f17_local1 = Game[0x28624DEF6F708C8]( f17_arg0._controllerIndex, "post_game_state" ) ~= PostGameState.SCOREBOARD
	end
	return f17_local1
end

LUI.PostGameManager.UpdateAlpha = function ( f16_arg0 )
	local f16_local0 = f16_arg0
	local f16_local1 = f16_arg0.SetAlpha
	local f16_local2
	if f16_arg0:IsHidden() then
		f16_local2 = 0
	else
		f16_local2 = 1
	end
	f16_local1( f16_local0, f16_local2 )
end

LUI.PostGameManager.InitLayer = function ( f12_arg0 )
	f12_arg0.showing = PostGameState.INACTIVE
	f12_arg0:registerOmnvarHandler( "post_game_state", function ( f15_arg0 )
		f15_arg0:Refresh()
	end )
	assert( not f12_arg0._subscriptionToScoreboard )
	f12_arg0._subscriptionToScoreboard = f12_arg0:SubscribeToModel( DataSources.inGame.HUD.isScoreboardOpen:GetModel( f12_arg0._controllerIndex ), function ( f14_arg0 )
		f12_arg0:UpdateAlpha()
	end )
	if Engine[0xD151EC5B41223B5]() then
		f12_arg0:registerEventHandler( "empty_menu_stack", f12_arg0.UpdateAlpha )
		f12_arg0:registerEventHandler( "non_empty_menu_stack", f12_arg0.UpdateAlpha )
	end
	local f12_local0 = LUI.DataSourceInGlobalModel.new( "cg.MP.winnersCircle.players.notify" )
	f12_arg0:SubscribeToModel( f12_local0:GetModel( f12_arg0._controllerIndex ), function ()
		WINNERS_CIRCLE.SpawnCharacters( f12_arg0, f12_arg0._controllerIndex )
	end, true )
	Engine[0xFCF332AA8AC9B0F]( "mp_teammvp_background", VideoPlaybackFlags.STARTPAUSED )
	if IsCodcaster() and not f12_arg0._areVisualStatesSetup then
		CODCASTER.SetupPostGameManagerVisualStates( f12_arg0, f12_arg0._controllerIndex )
		f12_arg0._areVisualStatesSetup = true
	end
	f12_arg0:Refresh()
end

LUI.PostGameManager.ClearLayer = function ( f10_arg0, f10_arg1 )
	f10_arg0:Refresh()
	f10_arg0:closeChildren()
	f10_arg0:registerOmnvarHandler( "post_game_state", function ()
		
	end )
	if f10_arg0._subscriptionToScoreboard then
		f10_arg0:UnsubscribeFromModel( f10_arg0._subscriptionToScoreboard )
		f10_arg0._subscriptionToScoreboard = nil
	end
	if LUI.PostGameManager.wasInFinalKillcam then
		local f10_local0 = Engine[0xEE6F69FEA944B13]()
		f10_local0.inWorldManager:EndFinalKillcam()
		LUI.PostGameManager.wasInFinalKillcam = false
	end
end

LUI.PostGameManager.IsPostGame = function ( f9_arg0 )
	if Engine[0x9258F49F515F97B]() and Game[0xA988866C889EAAD]() then
		return Game[0x28624DEF6F708C8]( f9_arg0, "post_game_state" ) ~= PostGameState.INACTIVE
	else
		return false
	end
end

LUI.PostGameManager.IsPostGameWithHUDChat = function ( f8_arg0 )
	if LUI.PostGameManager.IsPostGame( f8_arg0 ) then
		return not LUI.PostGameManager.IsFullChatPostGameState( Game[0x28624DEF6F708C8]( f8_arg0, "post_game_state" ) )
	else
		return false
	end
end

LUI.PostGameManager.IsBRExfilStarted = function ( f7_arg0 )
	if CONDITIONS.IsBRGameType() then
		if Game[0x28624DEF6F708C8]( f7_arg0, "ui_br_end_game_splash_type" ) then
			return 12 < Game[0x28624DEF6F708C8]( f7_arg0, "ui_br_end_game_splash_type" )
		else
			return false
		end
	else
		return false
	end
end

LUI.PostGameManager.FinalizeCPGame = function ( f6_arg0 )
	if f6_arg0._finalizedCPGame then
		DebugPrint( "CP Game already done" )
		return 
	elseif not Engine[0xCA085C21FCBD7CA]() or not CONDITIONS.IsAliensOnline( f6_arg0 ) then
		DebugPrint( " Not CP Mode or Not Online" )
		return 
	elseif not Engine[0x4C63E8C3DFC342D]() then
		DebugPrint( "No client data" )
		return 
	else
		f6_arg0._finalizedCPGame = true
	end
end

LUI.PostGameManager.FinalizeMission = function ( f5_arg0 )
	if not f5_arg0._dlogRecordingDone then
		METRICS.MatchEndDLogRecording( f5_arg0._controllerIndex )
		f5_arg0._dlogRecordingDone = true
	end
	if f5_arg0._finalizedMission then
		DebugPrint( "Mission already finalized" )
		return 
	end
	OnlineChallenges[0x6E2FE7B68B06A33]( f5_arg0._controllerIndex )
	if Engine[0xCA085C21FCBD7CA]() or not Dvar[0x9E5BE3B4BBA4E0E]( "#x34e9ab8c76756925d" ) then
		DebugPrint( " Aliens Mode or Not Online" )
		return 
	elseif not Engine[0x4C63E8C3DFC342D]() or not CONDITIONS.IsPublicMatch() then
		DebugPrint( "No client data and Not Public Match" )
		return 
	elseif MissionUtils.GetFlowState() == MissionUtils.FlowState.PRE_INIT then
		DebugPrint( "Mission State is PRE_INIT - " .. MissionUtils.FlowState.PRE_INIT )
		return 
	end
	local f5_local0 = f5_arg0._controllerIndex
	local f5_local1 = PlayerData[0x8B73907B55C4D71]( f5_local0, CoD.StatsGroup.Common )
	local f5_local2 = f5_local1.round.scoreboardType:get()
	if f5_local2 == "none" then
		DebugPrint( "Scoreboard Type is None" )
		return 
	end
	DebugPrint( "LUI.PostGameManager.FinalizeMission" )
	local f5_local3 = 0
	local f5_local4 = 0
	local f5_local5 = Engine[0x9C92CEACE770019]( "scoreboardPlayerCount" )
	local f5_local6 = ""
	if Engine[0x29680E4E30C45C2] then
		f5_local6 = Engine[0x29680E4E30C45C2]( f5_local0 )
		DebugPrint( "Searching for user " .. f5_local6 )
	end
	if f5_local5 ~= nil and 0 < f5_local5 then
		for f5_local7 = 1, f5_local5, 1 do
			DebugPrint( "Looking at " .. f5_local7 )
			DebugPrint( "Scoreboard Type " .. f5_local2 )
			local f5_local10 = Engine[0x9C92CEACE770019]( "scoreboards", f5_local7 - 1 )
			DebugPrint( "Player " .. f5_local10 )
			if 0 <= f5_local10 then
				local f5_local11 = Engine[0x9C92CEACE770019]( "players", f5_local10, "username" )
				DebugPrint( "Found Player " .. f5_local11 )
				if f5_local11 == f5_local6 then
					f5_local3 = f5_local1.round.timePlayed:get()
					DebugPrint( "Timeplayed " .. f5_local3 )
					local f5_local12 = Engine[0x9C92CEACE770019]( "players", f5_local10, "team" )
					local f5_local13 = Engine[0x9C92CEACE770019]( "axisScore" )
					local f5_local14 = Engine[0x9C92CEACE770019]( "alliesScore" )
					if f5_local12 == "axis" then
						if f5_local14 <= f5_local13 then
							DebugPrint( "Axis Win" )
							f5_local4 = 1
							break
						end
					elseif f5_local12 == "allies" and f5_local13 <= f5_local14 then
						DebugPrint( "Allies Win" )
						f5_local4 = 1
						break
					end
				end
			end
		end
	end
	DebugPrint( "Post Game" .. f5_local3 .. " Result " .. f5_local4 )
	for f5_local7 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f5_local7 ) then
			Engine[0x7F73E63562708F7]( "post_game", {
				controllerIndex = f5_local7,
				timePlayed = f5_local3,
				result = f5_local4
			} )
		end
	end
	DebugPrint( " Setting Mission State to MISSION_OVER - " .. MissionUtils.FlowState.MISSION_OVER )
	MissionUtils.SetFlowState( MissionUtils.FlowState.MISSION_OVER )
	f5_arg0._finalizedMission = true
end

LUI.PostGameManager.IsFullChatPostGameState = function ( f4_arg0 )
	local f4_local0
	if f4_arg0 == PostGameState.INACTIVE or f4_arg0 == PostGameState.FINAL_KILLCAM or f4_arg0 == PostGameState.POTG or f4_arg0 == PostGameState.WINNERS_CIRCLE_TEAM_MVP_TITLE_CARD or f4_arg0 == PostGameState.ROUND_END then
		f4_local0 = false
	else
		f4_local0 = true
	end
	return f4_local0
end

LUI.PostGameManager.Refresh = function ( f1_arg0 )
	if f1_arg0._videoPlaying and not CONDITIONS.IsNukeEndState( f1_arg0, f1_arg0._controllerIndex ) then
		Engine[0x3DACD106DDC0D71]()
		f1_arg0._videoPlaying = false
	end
	local f1_local0 = Game[0x28624DEF6F708C8]( f1_arg0._controllerIndex, "post_game_state" )
	DebugPrint( "########post_game_state value = " .. f1_local0 or "" )
	local f1_local1 = LUI.PostGameManager.IsFullChatPostGameState( f1_local0 )
	if not f1_arg0.menuChatSetup and f1_local1 then
		LUI.HUD.AllowChatInHUD()
		f1_arg0.menuChatSetup = true
	elseif not f1_local1 then
		LUI.HUD.DisallowChatInHUD()
		f1_arg0.menuChatSetup = false
	end
	local f1_local2 = true
	if IsCodcaster() and f1_local0 == PostGameState.ACTIVE then
		f1_local2 = false
	end
	if f1_local0 ~= f1_arg0.showing and f1_local2 then
		f1_arg0:closeChildren()
		if f1_arg0.showing == PostGameState.WINNERS_CIRCLE_VIEW_MVP_WINNER then
			LUI.FlowManager.RequestLeaveMenuByName( "WinnersCircle", true, true )
		end
		if f1_arg0.showing == PostGameState.ROUND_END then
			LUI.FlowManager.RequestLeaveMenuByName( "RoundEndButtons", true, true )
		end
		if (f1_local0 == PostGameState.ACTIVE or f1_local0 == PostGameState.SCOREBOARD) and CONDITIONS.IsNukeEndState( f1_arg0, f1_arg0._controllerIndex ) then
			f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "Cinematic", {
				controllerIndex = f1_arg0._controllerIndex
			} ) )
		end
		if f1_local0 == PostGameState.ROUND_END then
			local shakeable = nil
			if not CONDITIONS.IsBRGameType( f1_arg0 ) then
				if Engine[0xD151EC5B41223B5]() then
					if GameX.gameModeIsFFA() then
						shakeable = MenuBuilder.BuildRegisteredType( "RoundEndFFAHUD", {
							controllerIndex = f1_arg0._controllerIndex
						} )
					else
						local f1_local4
						if IsCodcaster() then
							f1_local4 = "CodcasterRoundEnd"
						else
							f1_local4 = "RoundEndTeamHUD"
						end
						shakeable = MenuBuilder.BuildRegisteredType( f1_local4, {
							controllerIndex = f1_arg0._controllerIndex
						} )
						if CONDITIONS.IsNukeEndState( f1_arg0, f1_arg0._controllerIndex ) then
							f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "Cinematic", {
								controllerIndex = f1_arg0._controllerIndex
							} ) )
						end
						if CONDITIONS.IsArenaEvoGameType() then
							LUI.FlowManager.RequestAddMenu( "RoundEndButtons", false, f1_arg0._controllerIndex, false )
						end
						f1_arg0._videoPlaying = true
					end
				elseif CONDITIONS.IsThirdGameMode() then
					shakeable = MenuBuilder.BuildRegisteredType( "RoundEndTeamHUD", {
						controllerIndex = f1_arg0._controllerIndex
					} )
					f1_arg0._videoPlaying = true
				end
				if shakeable then
					f1_arg0:addElement( shakeable )
					f1_arg0.shakeable = shakeable
					
					f1_arg0.shakeable.shakeDuration = 0
				end
			end
		elseif f1_local0 == PostGameState.FINAL_KILLCAM or f1_local0 == PostGameState.POTG then
			local f1_local4 = MP.IsRoundEndTitleEndOfMatch( DataSources.inGame.MP.roundEnd.roundEndTitleIndex:GetValue( f1_arg0._controllerIndex ) )
			local f1_local5 = not f1_local4
			local f1_local6 = f1_local0 == PostGameState.POTG
			local f1_local7 = f1_local0 == PostGameState.FINAL_KILLCAM
			LUI.FlowManager.LeaveMenusForPostMatchFlow()
			if f1_local6 then
				local f1_local8
				if IsCodcaster() then
					f1_local8 = "CodcasterKillcam"
				else
					f1_local8 = "Killcam"
				end
				f1_arg0:addElement( MenuBuilder.BuildRegisteredType( f1_local8, {
					controllerIndex = f1_arg0._controllerIndex,
					isPlayOfTheGame = f1_local6
				} ) )
			elseif f1_local7 then
				LUI.PostGameManager.wasInFinalKillcam = true
				local f1_local8
				if IsCodcaster() then
					f1_local8 = "CodcasterKillcam"
				else
					f1_local8 = "Killcam"
				end
				local f1_local9 = MenuBuilder.BuildRegisteredType
				local f1_local10 = f1_local8
				local f1_local11 = {
					controllerIndex = f1_arg0._controllerIndex
				}
				local f1_local12
				if not f1_local4 then
					f1_local12 = f1_local4
				else
					f1_local12 = f1_local5
				end
				f1_local11.isFinalOrRoundEnd = f1_local12
				f1_arg0:addElement( f1_local9( f1_local10, f1_local11 ) )
				local f1_local13 = Engine[0xEE6F69FEA944B13]()
				f1_local13.inWorldManager:StartFinalKillcam()
			end
		elseif f1_local0 == PostGameState.SCOREBOARD then
			if Engine[0xCA085C21FCBD7CA]() then
				f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "CPPostMatchScreen", {
					controllerIndex = f1_arg0._controllerIndex
				} ) )
			else
				f1_arg0:dispatchEventToRoot( {
					dispatchChildren = true,
					name = "Frontend_Preload"
				} )
			end
		elseif f1_local0 == PostGameState.CLASSIC_REWARDSCREEN then
			LUI.FlowManager.RequestAddMenu( "SOPostMatchScreen", true, f1_arg0._controllerIndex, false )
		elseif f1_local0 == PostGameState.BROSHOT then
			local shakeable = LUI.ScoreboardLayer:GetInstance()
			if shakeable then
				shakeable:CloseScoreboard()
			end
			f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "Broshot", {
				controllerIndex = f1_arg0._controllerIndex
			} ) )
		elseif f1_local0 == PostGameState.TAC_OPS_INTERMISSION then
			DebugPrint( "########post_game_state TAC_OPS_INTERMISSION" )
		elseif f1_local0 == PostGameState.BR_END_SPLASH then
			f1_arg0:addElement( MenuBuilder.BuildRegisteredType( "BrEndGameResultSplash", {
				controllerIndex = f1_arg0._controllerIndex
			} ) )
			local f1_local4 = Dvar[0x22EAAB59AA27E9B]( "#x3d65fc7c516cbbb3f" )
			local f1_local5
			if f1_local4 and f1_local4 ~= 0 then
				f1_local5 = false
			else
				f1_local5 = true
			end
			if not f1_local5 then
				local f1_local6 = LUI.SquadEliminatedLayer:GetInstance()
				f1_local6:SetVisibilityOverride( false )
				f1_local6 = LUI.SquadEliminatedLayer:GetInstance()
				f1_local6:SetVisibilityOverride( nil )
			end
		elseif f1_local0 == PostGameState.CP_RETRY_POPUP then
			LUI.FlowManager.RequestAddMenu( "CPPostRetryVote", true, f1_arg0._controllerIndex, false )
		elseif f1_local0 == PostGameState.SHOW_INGAME_AAR then
			BR.SetupEndgameDataSource( f1_arg0._controllerIndex )
		elseif f1_local0 == PostGameState.WINNERS_CIRCLE_TEAM_MVP_TITLE_CARD then
			LUI.FlowManager.RequestAddMenu( "TeamMVPTitleCard", true, f1_arg0._controllerIndex, false )
		elseif f1_local0 == PostGameState.WINNERS_CIRCLE then
			LUI.HUD.DisallowChatInHUD()
			f1_arg0.wait = f1_arg0:Wait( f0_local0 )
			f1_arg0.wait.onComplete = function ()
				if Game[0x28624DEF6F708C8]( f1_arg0._controllerIndex, "post_game_state" ) == PostGameState.WINNERS_CIRCLE then
					LUI.FlowManager.RequestLeaveMenuByName( "TeamMVPTitleCard", false, true )
					LUI.FlowManager.RequestAddMenu( "WinnersCircle", true, f1_arg0._controllerIndex, false )
				end
			end
			
		elseif f1_local0 == PostGameState.WINNERS_CIRCLE_VIEW_MVP_WINNER then
			LUI.FlowManager.LeaveMenusForPostMatchFlow()
		elseif f1_local0 == PostGameState.NUKE_BNK then
			local shakeable = f1_arg0:Wait( f0_local0 )
			shakeable.onComplete = function ()
				local f2_local0 = MenuBuilder.BuildRegisteredType( "Cinematic", {
					controllerIndex = f1_arg0._controllerIndex
				} )
				f1_arg0:addElement( f2_local0 )
				f2_local0:SetAlpha( 0 )
				f2_local0:SetAlpha( 1, f1_arg0 )
				Engine[0xFCF332AA8AC9B0F]( "default", VideoPlaybackFlags.LOOP )
			end
			
			f1_arg0._videoPlaying = true
		end
		f1_arg0.showing = f1_local0
	end
	f1_arg0:FinalizeCPGame()
	f1_arg0:FinalizeMission()
end

