-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
require( "ui.inGame.HUDPromptWithLabel" )
require( "ui.inGame.AltFireTypeIcons" )
require( "ui.inGame.HUDPrompt" )
local f0_local0 = function ( f19_arg0 )
	local f19_local0 = nil
	if Engine[0x6938F45868B1BBC]( f19_arg0._controllerIndex ) then
		f19_local0 = f19_arg0.AltFireTypePrompt.ActionIcon:GetCurrentAnchorsAndPositions()
	else
		f19_local0 = f19_arg0.AltFireTypePrompt.KBMButtonPrompt:GetCurrentAnchorsAndPositions()
	end
	local f19_local1 = f19_local0.right - f19_local0.left
	local f19_local2 = f19_arg0.AltFireTypePrompt:GetCurrentAnchorsAndPositions()
	f19_arg0.AltFireTypePrompt:SetAnchorsAndPosition( f19_local2.leftAnchor, f19_local2.rightAnchor, f19_local2.topAnchor, f19_local2.bottomAnchor, f19_local2.right - f19_local1, f19_local2.right, f19_local2.top, f19_local2.bottom )
end

local f0_local1 = function ( f18_arg0 )
	assert( f18_arg0.AltFireTypeIcons )
	assert( f18_arg0.TextAltModeToggleHint )
	assert( f18_arg0.AltFireTypePrompt )
	local f18_local0 = DataSources.inGame.player.currentWeapon.inAltMode:GetValue( f18_arg0._controllerIndex )
	if CONDITIONS.WeaponHasAltMode( f18_arg0._controllerIndex, f18_arg0 ) then
		local f18_local1 = "[{ui_dpad_left;toggleweapalt}]"
		local f18_local2 = DataSources.inGame.player.currentWeapon.totalAltAmmo:GetValue( f18_arg0._controllerIndex )
		if f18_local2 ~= -1 then
			local f18_local3 = ""
			f18_arg0.AltFireTypeIcons:SetAlpha( 0 )
			f18_arg0.AltFireTypePrompt:SetAlpha( 0 )
			f18_arg0.TextAltModeToggleHint:SetVisibilityPrompt( true )
			if not f18_local0 then
				local f18_local4 = f18_arg0._altWeaponClassDatasource:GetValue( f18_arg0._controllerIndex )
				local f18_local5
				if f18_local2 == 0 then
					f18_local5 = "^," .. f18_local2 .. "^7"
					if not f18_local5 then
					
					elseif f18_local4 == WEAPON.WeaponClassInC.SPREAD then
						f18_local3 = Engine[0xED84C33EC5F01EA]( "HUD/UNDER_BARREL_AND_AMMO", "[{ui_underbarrel_shotgun}]", tostring( f18_local5 ) )
					elseif f18_local4 == WEAPON.WeaponClassInC.GRENADE then
						f18_local3 = Engine[0xED84C33EC5F01EA]( "HUD/UNDER_BARREL_AND_AMMO", "[{ui_underbarrel_grenade}]", tostring( f18_local5 ) )
					end
				end
				f18_local5 = f18_local2
			else
				local f18_local4 = ""
				if Engine[0x9258F49F515F97B]() then
					f18_local4 = WEAPON.GetName( WEAPON.GetBaseRef( Game[0x83A9582F97A9E41]( f18_arg0._controllerIndex ) ) )
				else
					f18_local4 = DataSources.inGame.player.currentWeapon.displayName:GetValue( f18_arg0._controllerIndex )
				end
				f18_local3 = Engine[0xED84C33EC5F01EA]( "HUD/WEAPON_SWAP", f18_local4 )
			end
			f18_arg0.TextAltModeToggleHint:UpdateInstruction( f18_local3, StripColorMarkers( f18_local1 ) )
		else
			f18_arg0.TextAltModeToggleHint:SetVisibilityPrompt( false )
			f18_arg0.AltFireTypeIcons:SetAlpha( 1 )
			f18_arg0.AltFireTypePrompt:SetAlpha( 1 )
			local f18_local3 = f18_arg0._currentAltModeFireTypeDatasource:GetValue( f18_arg0._controllerIndex )
			f18_arg0.AltFireTypePrompt:SetText( StripColorMarkers( f18_local1 ) )
			f18_arg0:SetAltFirePromptToContent()
			if f18_local3 == f18_arg0.primaryFireTypeIndex then
				ACTIONS.AnimateSequence( f18_arg0.AltFireTypeIcons, "SelectFire1" )
			elseif f18_local3 == f18_arg0.secondaryFireTypeIndex then
				ACTIONS.AnimateSequence( f18_arg0.AltFireTypeIcons, "SelectFire2" )
			end
		end
	end
end

local f0_local2 = function ( f17_arg0, f17_arg1 )
	f17_arg0.primaryFireTypeIndex = f17_arg0._primaryFireTypeDatasource:GetValue( f17_arg1 )
	f17_arg0.secondaryFireTypeIndex = f17_arg0._secondaryFireTypeDatasource:GetValue( f17_arg1 )
	local f17_local0 = DYN_ATTACHMENT.GetFireTypeIcon( f17_arg0.primaryFireTypeIndex )
	local f17_local1 = DYN_ATTACHMENT.GetFireTypeIcon( f17_arg0.secondaryFireTypeIndex )
	if f17_local0 then
		f17_arg0.AltFireTypeIcons.FireType1:setImage( RegisterMaterial( f17_local0 ) )
	end
	if f17_local1 then
		f17_arg0.AltFireTypeIcons.FireType2:setImage( RegisterMaterial( f17_local1 ) )
	end
end

local f0_local3 = function ( f7_arg0, f7_arg1, f7_arg2 )
	assert( f7_arg0.TextAltModeToggleHint )
	f7_arg0._controllerIndex = f7_arg1
	f7_arg0.SetAltFirePromptToContent = f0_local0
	local f7_local0 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.defaultWeaponFireType" )
	local f7_local1 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.altWeaponFireType" )
	local f7_local2 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.altModeFireType" )
	local f7_local3 = LUI.DataSourceInControllerModel.new( "cg.player.currentWeapon.altWeaponClass" )
	local f7_local4 = function ()
		if CONDITIONS.IsSpectating( f7_arg0 ) then
			ACTIONS.AnimateSequence( f7_arg0, "HideAltFire" )
		elseif CONDITIONS.WeaponHasAltMode( f7_arg0, f7_arg0 ) then
			ACTIONS.AnimateSequence( f7_arg0, "ShowAltFire" )
		end
	end
	
	if f7_arg0.TextAltModeToggleHint then
		if CONDITIONS.IsSplitscreen( f7_arg0 ) then
			
		else
			
		end
		local f7_local5 = function ( f15_arg0, f15_arg1 )
			f7_arg0( f15_arg0 )
		end
		
		f7_arg0._primaryFireTypeDatasource = f7_local0
		f7_arg0._secondaryFireTypeDatasource = f7_local1
		f7_arg0._currentAltModeFireTypeDatasource = f7_local2
		f7_arg0._altWeaponClassDatasource = f7_local3
		f0_local0( f7_arg0, f7_arg1 )
		f7_arg0:registerAndCallEventHandler( "key_bindings_update", f7_local5 )
		f7_arg0:registerEventHandler( "empty_menu_stack", UpdateMeterPrompt )
		f7_arg0:registerOmnvarHandler( "ui_using_killstreak_remote", function ( f14_arg0, f14_arg1 )
			if f14_arg1.value == false then
				f7_arg0( f14_arg0 )
			end
		end )
		f7_arg0:registerOmnvarHandler( "ui_veh_vehicle", function ( f13_arg0, f13_arg1 )
			if f13_arg1.value == -1 then
				f7_arg0( f13_arg0 )
			end
		end )
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.hasAltMode:GetModel( f7_arg1 ), function ( f12_arg0 )
			f7_arg0( f7_arg0 )
			f7_arg0()
		end )
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.inAltMode:GetModel( f7_arg1 ), function ( f11_arg0 )
			f7_arg0( f7_arg0 )
		end )
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.stockAmmoDisplay:GetModel( f7_arg1 ), function ( f10_arg0 )
			f7_arg0( f7_arg0 )
		end )
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.name:GetModel( f7_arg1 ), function ( f9_arg0 )
			f7_arg0( f7_arg0, f7_arg0 )
			f7_arg0( f7_arg0 )
		end )
	end
	if Engine[0x9258F49F515F97B]() then
		f7_arg0:SubscribeToModel( DataSources.inGame.MP.spectating.isSpectating:GetModel( f7_arg1 ), f7_local4 )
	end
	if not CONDITIONS.ShouldHideButtonPrompts( f7_arg0 ) then
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.displayName:GetModel( f7_arg1 ), f7_local4 )
		f7_arg0:SubscribeToModel( DataSources.inGame.player.currentWeapon.altModeDisplayName:GetModel( f7_arg1 ), f7_local4 )
	end
	f7_arg0.AltFireTypePrompt.KBMButtonPrompt.KeyString.onDirectiveInvalidated = function ( f8_arg0 )
		f7_arg0.AltFireTypePrompt.KBMButtonPrompt:DirectiveInvalidated( f8_arg0 )
		f7_arg0:SetAltFirePromptToContent()
	end
	
end

function WeaponAltInstruction( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 200 * _1080p, 0, 24 * _1080p )
	self.id = "WeaponAltInstruction"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local f1_local3 = nil
	if not CONDITIONS.ShouldHideButtonPrompts() then
		f1_local3 = MenuBuilder.BuildRegisteredType( "HUDPromptWithLabel", {
			controllerIndex = f1_local1
		} )
		f1_local3.id = "TextAltModeToggleHint"
		f1_local3.Prompt.ActionIcon:setText( StripColorMarkers( "[F]" ), 0 )
		f1_local3.Prompt.KBMButtonPrompt.KeyString:setText( StripColorMarkers( "[F]" ), 0 )
		f1_local3.Instruction:setText( "", 0 )
		f1_local3.Instruction:SetAlignment( LUI.Alignment.Left )
		f1_local3.Instruction:SetTintFontIcons( true )
		f1_local3.Instruction:SetShadowMinDistance( -0.2, 0 )
		f1_local3.Instruction:SetShadowMaxDistance( 0.2, 0 )
		f1_local3.Instruction:SetShadowUOffset( -0.002, 0 )
		f1_local3:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 200, 0, _1080p * 24 )
		self:addElement( f1_local3 )
		self.TextAltModeToggleHint = f1_local3
	end
	local AltFireTypeIcons = nil
	
	AltFireTypeIcons = MenuBuilder.BuildRegisteredType( "AltFireTypeIcons", {
		controllerIndex = f1_local1
	} )
	AltFireTypeIcons.id = "AltFireTypeIcons"
	AltFireTypeIcons:SetAlpha( 0, 0 )
	AltFireTypeIcons:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 114, _1080p * 178, _1080p * -1, _1080p * 31 )
	self:addElement( AltFireTypeIcons )
	self.AltFireTypeIcons = AltFireTypeIcons
	
	local AltFireTypePrompt = nil
	
	AltFireTypePrompt = MenuBuilder.BuildRegisteredType( "HUDPrompt", {
		controllerIndex = f1_local1
	} )
	AltFireTypePrompt.id = "AltFireTypePrompt"
	AltFireTypePrompt:SetAlpha( 0, 0 )
	AltFireTypePrompt.ActionIcon:setText( "[{+activate}]", 0 )
	AltFireTypePrompt.KBMButtonPrompt.KeyString:setText( StripFromPattern( LocalizeString( "" ), "%^. " ), 0 )
	AltFireTypePrompt:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 60, _1080p * 100, _1080p * -6, _1080p * 34 )
	self:addElement( AltFireTypePrompt )
	self.AltFireTypePrompt = AltFireTypePrompt
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local6 = nil
	if not CONDITIONS.ShouldHideButtonPrompts() then
		f1_local3:RegisterAnimationSequence( "ShowAltFire", {
			{
				value = 1,
				duration = 0,
				property = TWEEN_PROPERTY.Alpha
			}
		} )
	end
	self._sequences.ShowAltFire = function ()
		if not CONDITIONS.ShouldHideButtonPrompts() then
			menu:AnimateSequence( "ShowAltFire" )
		end
	end
	
	self._sequenceLengths.ShowAltFire = 0
	local f1_local7 = nil
	if not CONDITIONS.ShouldHideButtonPrompts() then
		f1_local3:RegisterAnimationSequence( "HideAltFire", {
			{
				value = 0,
				duration = 0,
				property = TWEEN_PROPERTY.Alpha
			}
		} )
	end
	AltFireTypeIcons:RegisterAnimationSequence( "HideAltFire", {
		{
			value = 0,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	AltFireTypePrompt:RegisterAnimationSequence( "HideAltFire", {
		{
			value = 0,
			duration = 0,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	self._sequences.HideAltFire = function ()
		if not CONDITIONS.ShouldHideButtonPrompts() then
			menu:AnimateSequence( "HideAltFire" )
		end
		menu:AnimateSequence( "HideAltFire" )
		menu:AnimateSequence( "HideAltFire" )
	end
	
	self._sequenceLengths.HideAltFire = 0
	if not CONDITIONS.ShouldHideButtonPrompts() then
		f1_local3:SubscribeToModel( DataSources.inGame.player.currentWeapon.displayName:GetModel( f1_local1 ), function ()
			if not CONDITIONS.WeaponHasAltMode( menu, menu ) or CONDITIONS.IsSpectating( menu ) then
				ACTIONS.AnimateSequence( menu, "HideAltFire", menu )
			end
		end )
		f1_local3:SubscribeToModel( DataSources.inGame.player.currentWeapon.altModeDisplayName:GetModel( f1_local1 ), function ()
			if not CONDITIONS.WeaponHasAltMode( menu, menu ) or CONDITIONS.IsSpectating( menu ) then
				ACTIONS.AnimateSequence( menu, "HideAltFire", menu )
			end
		end )
	end
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "WeaponAltInstruction", WeaponAltInstruction )
LockTable( _M )
