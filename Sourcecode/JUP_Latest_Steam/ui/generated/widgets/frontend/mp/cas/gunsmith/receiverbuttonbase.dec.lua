-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:04
module( ..., package.seeall )
local f0_local0 = 6
local f0_local1 = 16
local f0_local2 = 10
local f0_local3 = 10
local f0_local4 = 370
local f0_local5 = 500
local f0_local6 = function ( f17_arg0 )
	local f17_local0 = LAYOUT.GetTextWidth( f17_arg0.CategoryName )
	local f17_local1 = f17_arg0.CategoryName:GetAnchorsAndPosition()
	f17_local1 = f17_local1.left
	local f17_local2 = LAYOUT.GetTextWidth( f17_arg0.AttachmentName )
	local f17_local3 = f17_local0 + (f17_arg0.CostLabel and f0_local0 + LAYOUT.GetTextWidth( f17_arg0.CostLabel ) or 0)
	local f17_local4 = f17_local1
	if f17_arg0._useDynamicWidth then
		if f17_local2 < f17_local3 then
			f17_local4 = f17_local4 + f17_local3
		else
			f17_local4 = f17_local4 + f17_local2
		end
		f17_local4 = f17_local4 + f0_local0 * 2
		local f17_local5 = LAYOUT.GetTextWidth( f17_arg0.AmmoName ) + 0
		if f17_local4 < f17_local5 then
			f17_local4 = f17_local5
		end
		if f0_local0 < f17_local4 then
			f17_local4 = f0_local0
		elseif f17_local4 < f0_local0 then
			f17_local4 = f0_local0
		end
	else
		f17_local4 = f0_local0
	end
	if f17_arg0._isFocused then
		f17_arg0.Background:SetRight( f17_local4 )
		f17_arg0.TopBar:SetRight( f17_local4 )
		f17_arg0.BottomBar:SetRight( f17_local4 )
	end
	f17_arg0.AmmoName:SetRight( f17_local4 - f0_local0 )
	f17_arg0.AttachmentName:SetRight( f17_local4 - f0_local0 )
	f17_arg0.CategoryName:SetRight( f17_local4 - f0_local0 )
	if f17_arg0._brandingImageRightPos then
		f17_arg0.Branding:SetRight( math.min( f17_arg0._brandingImageRightPos, f17_local4 - f0_local0 ) )
	end
	local f17_local6 = LAYOUT.GetTextWidth( f17_arg0.AmmoName )
	local f17_local5 = f17_arg0.AmmoName:GetAnchorsAndPosition()
	local f17_local7 = 8
	local f17_local8 = f17_local5.left + f17_local6
	if f17_local5.right < f17_local8 then
		f17_local8 = f17_local5.right
	end
	f17_arg0.ClassBacker:SetRight( f17_local8 + f17_local7 )
	local f17_local9 = LAYOUT.GetTextWidth( f17_arg0.UnlockCount )
	local f17_local10 = LAYOUT.GetElementWidth( f17_arg0.UnlockIcon )
	local f17_local11 = 8
	local f17_local12 = 12
	f17_arg0.LockedBacker:SetRight( f17_local4 )
	f17_arg0.LockedBacker:SetLeft( f17_local4 - f17_local9 - f17_local10 - f17_local11 * 3 - f17_local12 )
	f17_arg0.UnlockCount:SetRight( f17_local4 - f17_local11 )
	f17_arg0.UnlockIcon:SetRight( f17_local4 - f17_local9 - f17_local11 * 2 )
	f17_arg0.UnlockIcon:SetLeft( f17_local4 - f17_local9 - f17_local11 * 2 - f17_local10 )
	local f17_local13 = LAYOUT.GetElementWidth( f17_arg0.RestrictionWarning )
	local f17_local14 = 2
	f17_arg0.RestrictionWarning:SetRight( f17_local4 - f17_local14 * 2 )
	f17_arg0.RestrictionWarning:SetLeft( f17_local4 - f17_local14 * 2 - f17_local13 )
end

local f0_local7 = function ( f16_arg0, f16_arg1 )
	if not f16_arg0._attachLine then
		return 
	end
	local f16_local0 = f16_arg0._attachLine
	local f16_local1 = f16_local0
	f16_local0 = f16_local0.SetAlpha
	local f16_local2
	if f16_arg0._isFocused then
		f16_local2 = 1
	else
		f16_local2 = 0.2
	end
	f16_local0( f16_local1, f16_local2 )
	f16_arg0._attachLine:SetVertexPadding( LUI.UILine.END, 1 )
	f16_local0 = f16_arg0._attachLine
	f16_local1 = f16_local0
	f16_local0 = f16_local0.SetVertexPadding
	f16_local2 = LUI.UILine.END
	local f16_local3 = 0
	local f16_local4
	if f16_arg1 and not f16_arg1 then
		f16_local4 = f16_arg1
	else
		f16_local4 = GUNSMITH.lineDuration
	end
	f16_local0( f16_local1, f16_local2, f16_local3, f16_local4, LUI.EASING.outQuadratic )
	if f16_arg0._attachPoint then
		f16_local0 = f16_arg0._attachPoint
		f16_local1 = f16_local0
		f16_local0 = f16_local0.SetAlpha
		if f16_arg0._isFocused then
			f16_local2 = 1
		else
			f16_local2 = 0.2
		end
		f16_local0( f16_local1, f16_local2 )
	end
end

local f0_local8 = function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
	local f13_local0 = function ( f15_arg0 )
		GUNSMITH.SetupAttachLine( f15_arg0, f13_arg0.weapon, f13_arg0.variantID, f13_arg0 )
		GUNSMITH.SetupAttachPoint( f13_arg0, f13_arg0.weapon, f13_arg0.variantID, f13_arg0._category )
		if f15_arg0._attachLine then
			f15_arg0._attachLine:SetThickness( 2 )
			f15_arg0._attachLine:SetVertexPosition( LUI.UILine.START, 0, 0, 1, 0 )
		end
		f13_arg0( f15_arg0 )
	end
	
	if #Dvar[0x54084D7CA2317BB]( 0x8CC749B90DD2705 ) == 0 then
		f13_local0( f13_arg0 )
	else
		f13_arg0:registerEventHandler( "scene_transitioned", function ( element, event )
			f13_arg0( element )
		end )
	end
end

local f0_local9 = function ( f12_arg0 )
	if f12_arg0._attachLine then
		f12_arg0._attachLine:SetRGB( f12_arg0._isFocused and SWATCHES[0xEAF2060ABE5269B][0x53B984BE8B3BE65] or SWATCHES[0xEAF2060ABE5269B][0x25ECEAC112DE079] )
	end
end

local f0_local10 = function ( f11_arg0, f11_arg1 )
	f11_arg0.AttachmentName:setText( Engine[0xEB2A2834B76AEA4]( f11_arg1 ) )
	f11_arg0.Branding:setImage( RegisterMaterial( "iw9_icon_weapon_manufacturer_tempest_sm" ) )
end

local f0_local11 = function ( f7_arg0, f7_arg1, f7_arg2 )
	GUNSMITH.SetupSharedButton( f7_arg0, f7_arg1, f7_arg2 )
	local f7_local0 = f7_arg0._weaponTable
	if f7_arg2.weaponTable.variantID ~= WEAPON.baseVariant then
		f7_arg0._weaponTable = WEAPON.GenerateWeaponTableFromWeaponString( f7_arg2.weaponTable.weapon, f7_arg2.weaponModelName, {
			shouldConvertVariantIDToNumber = true,
			shouldOrganizeAttachments = true,
			shouldIncludeAllAttachments = true
		} )
	end
	f7_arg0._weaponRef = GL_HACK.GetWeaponMPRef( f7_arg0._weaponRef )
	local f7_local1 = GUNSMITH.GetSelectedAttachIndexForCategory( f7_arg0._category, f7_local0 )
	local f7_local2
	if f7_local1 then
		f7_local2 = f7_local1
	else
		f7_local2 = f7_local0.attachments[f7_local1].variantID
	end
	local f7_local3
	if not f7_local2 then
		f7_local3 = f7_local2
	else
		f7_local3 = 0
	end
	f7_arg0._variantID = f7_local3
	if f7_local1 then
		f7_local3 = f7_local1
	else
		f7_local3 = ATTACHMENT.GetRef( f7_arg0._weaponTable.attachments[f7_local1].ref, f7_local0.weapon )
	end
	local f7_local4 = Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( f7_arg0._category ) )
	local f7_local5 = Engine[0xED84C33EC5F01EA]( 0x905E03005927C0F, f7_local4 )
	local f7_local6 = f7_arg0.CategoryName
	local f7_local7 = f7_local6
	f7_local6 = f7_local6.setText
	local f7_local8 = Engine[0xEB2A2834B76AEA4]
	local f7_local9
	if f7_local2 and f7_local2 > WEAPON.baseVariant and not f7_local5 then
		f7_local9 = f7_local5
	else
		f7_local9 = f7_local4
	end
	f7_local6( f7_local7, f7_local8( f7_local9 ) )
	if f7_arg0.CostLabel then
		f7_arg0.CostLabel:setText( LocalizeIntoString( WEAPON.GetWeaponCost( f7_arg0._weaponRef, {} ), 0x757A21A4FFB96DF ) )
		local f7_local10 = LAYOUT.GetTextWidth( f7_arg0.CategoryName )
		f7_local7 = f7_arg0.CategoryName:GetAnchorsAndPosition()
		f7_arg0.CostLabel:SetRight( f7_local7.left + f7_local10 + f0_local0 + LAYOUT.GetTextWidth( f7_arg0.CostLabel ) )
	end
	f7_local6 = WEAPON.GetAmmoData( f7_arg1, f7_local0 )
	local f7_local10 = f7_arg0.AmmoName
	f7_local8 = f7_local10
	f7_local10 = f7_local10.setText
	local f7_local11 = f7_local6.ammoDisplayName
	f7_local9 = 0x0
	f7_local10( f7_local8, REG20 and Engine[0xED84C33EC5F01EA]( f7_local6.ammoName ) or Engine[0xED84C33EC5F01EA]( f7_local6.ammoDisplayName ) )
	if f7_local3 then
		f7_arg0.AttachmentName:setText( Engine[0xEB2A2834B76AEA4]( ATTACHMENT.GetName( f7_local3 ) ) )
		f7_arg0.Icon:setImage( RegisterMaterial( WEAPON.GetIconWithWeaponTable( f7_local0 ) ) )
		f7_local10 = Engine[0xFC084BF31D917C5]( f7_arg0._weaponRef, f7_local3, f7_arg0._variantID )
		if f7_local10 then
			f7_local7 = f7_local10
		else
			f7_local7 = f7_local10[0x2EAB902F6509817]
		end
		f7_local8 = GUNSMITH.GetBrandingSmallMaterialName( f7_local7 )
		if not String.IsNilOrEmpty( f7_local8 ) then
			f7_arg0.Branding:setImage( RegisterMaterial( f7_local8 ) )
			f7_arg0.Branding:SetVisible( true )
			f7_local11 = f7_arg0.Branding:GetAnchorsAndPosition()
			f7_arg0._brandingImageRightPos = f7_local11.left + GUNSMITH.GetBrandingSmallMaterialWidth( f7_local7 ) * 0.625
			f7_arg0.Branding:SetRight( f7_arg0._brandingImageRightPos )
		else
			f7_arg0.Branding:SetVisible( false )
		end
		f7_local11 = false
		f7_local9 = f7_arg0._weaponTable.attachments[f7_local1].ref
		if CONDITIONS.AreRestrictionsActive( f7_arg1 ) then
			if MatchRules[0x722F56788C744E9]( f7_local9, weapon ) then
				f7_local11 = true
			else
				local f7_local12 = WEAPON.GetWeaponRefByRec( f7_local9 )
				if MatchRules[0x966A6F3A93A1200]( f7_local12 ) or MatchRules[0xB0FA3D79A09CF96]( WEAPON.GetWeaponClass( f7_local12 ) ) then
					f7_local11 = true
				end
			end
		end
		local f7_local12 = ACTIONS.AnimateSequence
		local f7_local13 = f7_arg0
		local f7_local14
		if f7_local11 then
			f7_local14 = "ShowRestriction"
		else
			f7_local14 = "HideRestriction"
		end
		f7_local12( f7_local13, f7_local14 )
	end
	f7_local10, f7_local7 = WEAPON.GetAmountOfReceiverUnlocksForPlatform( f7_local0.weapon, f7_arg1 )
	f7_arg0.UnlockCount:setText( Engine[0xED84C33EC5F01EA]( "LUA_MENU/X_OF_Y", f7_local10, f7_local7 ) )
	if not f7_arg0._handlersAdded then
		f7_arg0:registerEventHandler( "button_action", function ( element, event )
			local f10_local0 = GUNSMITH.GetSelectedAttachIndexForCategory( f7_arg0._category, f7_arg0 )
			local f10_local1 = LUI.FlowManager.GetScopedData( element )
			local f10_local2 = element:getParent()
			local f10_local3 = f10_local2:getParent()
			if f10_local3 then
				local f10_local4 = LUI.FlowManager.GetScopedData( f10_local3 )
				if f10_local4 then
					f10_local4.buttonCategoryToFocus = f7_arg0._category
					f10_local4.buttonIndex = f7_arg0._buttonIndex
				end
			end
			LUI.FlowManager.RequestAddMenu( LOADOUT.GetAttachmentSelectMenuRef(), true, f7_arg0, false, {
				weaponSlot = f10_local1.weaponSlot,
				loadoutIndex = f10_local1.loadoutIndex,
				category = f7_arg0._category,
				attachSlot = f10_local0,
				attachments = f7_arg0._attachments,
				forShowcase = f10_local1.forShowcase
			} )
		end )
		f7_arg0:addEventHandler( "button_over", function ( f9_arg0, f9_arg1 )
			f9_arg0:ButtonOver( f9_arg1.controller and f9_arg1.controller or Engine[0x45B054C920178E9]() )
			local f9_local0 = f9_arg0:getParent()
			f9_local0:processEvent( {
				name = "update_tune_button"
			} )
		end )
		f7_arg0:addEventHandler( "button_up", function ( f8_arg0, f8_arg1 )
			f8_arg0:ButtonUp()
		end )
		f7_arg0._handlersAdded = true
	end
	if not CONDITIONS.IsMobileOrMobileSim() then
		
	else
		
	end
	if CONDITIONS.ShouldShowAttachmentLines() then
		f0_local0( f7_arg0, f7_arg1, f7_arg0._category, f7_local0 )
	end
	f0_local0( f7_arg0 )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f7_arg0:setActionSFX( SOUND_SETS.gunsmith.attachmentSelect )
		f7_arg0:setGainFocusAllSFX( SOUND_SETS.gunsmith.attachmentHover, {
			clearChildrenSFX = true
		} )
	end
end

local f0_local12 = function ( f6_arg0 )
	return f6_arg0._category
end

local f0_local13 = function ( f5_arg0, f5_arg1 )
	f5_arg0._isFocused = true
	if f5_arg0._attachLine then
		f5_arg0._attachLine:SetAlpha( 0.5 )
	end
	local f5_local0 = GUNSMITH.GetFrontendTagWorldPositionAndAxis( f5_arg1, f5_arg0._weaponRef, f5_arg0._variantID, f5_arg0._category )
	if f5_arg0:getParent() then
		
	else
		
	end
	ACTIONS.AnimateSequence( f5_arg0, "ButtonOver" )
	f0_local0( f5_arg0 )
	f0_local0( f5_arg0 )
	f0_local0( f5_arg0, 150 )
end

local f0_local14 = function ( f4_arg0 )
	f4_arg0._isFocused = false
	if f4_arg0._attachLine then
		f4_arg0._attachLine:SetAlpha( 0 )
	end
	ACTIONS.AnimateSequence( f4_arg0, "ButtonUp" )
	f0_local0( f4_arg0 )
	f0_local0( f4_arg0, 0 )
end

local f0_local15 = function ( f3_arg0, f3_arg1, f3_arg2 )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.ButtonOver = f0_local0
		f3_arg0.ButtonUp = f0_local0
	end
	f3_arg0.Setup = f0_local0
	f3_arg0.GetCategory = f0_local0
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0._category = nil
	f3_arg0._isFocused = false
	f3_arg0._useDynamicWidth = true
end

local f0_local16 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function ReceiverButtonBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIButton.new()
	f1_local1:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 400, 0, 120 )
	f1_local1.id = "ReceiverButtonBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f0_local0( f1_local1, f1_local0.ValidateControllerIndex( f1_local1, f1_local2 ), f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0xB5B23700F669431, ReceiverButtonBase )
LockTable( _M )
