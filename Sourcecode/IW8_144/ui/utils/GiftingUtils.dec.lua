-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 27-09-2025 22:41
GIFT = GIFT or {}
GIFT.CATEGORY_BATTLEPASS = "battlepass"
GIFT.CATEGORY_BASICGIFT = "basicGift"
GIFT.GIFT_NOT_APPROVED_REASONS = {
	EXCEEDED_ITEM_MAX_QUANTITY = 1,
	EXCEEDED_MAX_USAGE_TIME = 0,
	ITEM_ALREADY_PERMANENTLY_OWNED = 2,
	UNKNOWN_ERROR_MESSAGE = 4294967295,
	WEEKLY_GIFT_LIMIT_REACHED = 3
}
local f0_local0 = function ( f26_arg0, f26_arg1 )
	return Gifting.BBJAHCGAFC( f26_arg0, f26_arg1 )
end

local f0_local1 = function ( f23_arg0, f23_arg1, f23_arg2, f23_arg3 )
	local f23_local0 = f23_arg1:Pop()
	if f23_local0 then
		local f23_local1 = LOOT.GetTypeForID( f23_local0.gift_sku )
		f23_arg2:Push( f23_local0 )
		if f23_local1 then
			local f23_local2 = LUI.FlowManager.GetMenuByName( MenuUtils.GetMainMenu() )
			f23_local2 = f23_local2.menu
			local f23_local3 = nil
			local f23_local4 = function ( f24_arg0, f24_arg1 )
				local f24_local0 = f23_arg0:Wait( 200 )
				f24_local0.onComplete = function ()
					if LUI.FlowManager.IsInStack( "GiftReceivedPopup" ) then
						f24_arg0( f24_arg0, f24_arg0 )
					else
						LUI.FlowManager.RequestPopupMenu( nil, "GiftReceivedPopup", true, f24_arg0, false, {
							giftData = f24_arg0
						} )
					end
				end
				
			end
			
			f23_local4( f23_arg0, f23_local0 )
		end
		f23_arg3( f23_arg0 )
	else
		local f23_local5 = {}
		if 0 < #f23_local5 then
			GIFT.MarkGiftsSeen( f23_arg0, f23_local5 )
		end
	end
end

GIFT.GetBattlePassGiftingPossibleRecipients = function ( f22_arg0, f22_arg1 )
	return f0_local0( f22_arg0, f22_arg1 )
end

GIFT.GetBundleGiftingPossibleRecipients = function ( f21_arg0, f21_arg1 )
	return f0_local0( f21_arg0, f21_arg1 )
end

GIFT.FocusBattlePassTab = function ( f20_arg0, f20_arg1 )
	local f20_local0 = LUI.FlowManager.GetMenuByName( MenuUtils.GetMainMenu() )
	f20_local0 = f20_local0.menu
	if f20_local0 and f20_local0.MPTabsMenu and f20_local0.MPTabsMenu.Tabs then
		local f20_local1 = f20_local0.MPTabsMenu:GetTabIndexByWidgetName( "BattlePassMenu" ) - 1
		if f20_local1 and 0 <= f20_local1 then
			f20_local0.MPTabsMenu.Tabs:FocusTab( f20_arg1.controller, f20_local1, LUI.IsLastInputGamepad( f20_arg1.controller ) and FocusType.Gamepad or FocusType.MouseOver )
		end
	end
end

GIFT.IsInBattlePassTab = function ( f19_arg0, f19_arg1 )
	local f19_local0 = LUI.FlowManager.GetMenuByName( MenuUtils.GetMainMenu() )
	f19_local0 = f19_local0.menu
	if f19_local0 and f19_local0.MPTabsMenu and f19_local0.MPTabsMenu.Tabs then
		local f19_local1 = f19_local0.MPTabsMenu:GetTabIndexByWidgetName( "BattlePassMenu" ) - 1
		local f19_local2 = f19_local0.MPTabsMenu.Tabs:GetCurrentTabIndex()
		if f19_local1 and f19_local2 and 0 <= f19_local1 and 0 <= f19_local2 and f19_local1 == f19_local2 then
			return true
		end
	end
	return false
end

GIFT.QueueGiftReceived = function ( f18_arg0 )
	local f18_local0 = Gifting.DBCIFGGCEG( f18_arg0 )
	if not f18_local0 or #f18_local0 == 0 then
		return 
	end
	local f18_local1 = LUI.FlowManager.GetScopedData( "MainMenu" )
	f18_local1.SeenGifts = f18_local1.SeenGifts or {}
	local f18_local2 = f18_local1.bundleGiftQueue
	if not f18_local2 then
		f18_local2 = LUI.CreateQueue()
	end
	f18_local1.bundleGiftQueue = f18_local2
	f18_local2 = f18_local1.battlepassGiftQueue
	if not f18_local2 then
		f18_local2 = LUI.CreateQueue()
	end
	f18_local1.battlepassGiftQueue = f18_local2
	f18_local2 = f18_local1.markGiftQueue
	if not f18_local2 then
		f18_local2 = LUI.CreateQueue()
	end
	f18_local1.markGiftQueue = f18_local2
	for f18_local2 = 1, #f18_local0, 1 do
		local f18_local5 = f18_local0[f18_local2]
		if not f18_local1.SeenGifts[f18_local5.gift_index] then
			f18_local1.SeenGifts[f18_local5.gift_index] = f18_local5.gift_index
			if f18_local5.gift_category == GIFT.CATEGORY_BATTLEPASS then
				f18_local1.battlepassGiftQueue:Push( f18_local5 )
			else
				f18_local1.bundleGiftQueue:Push( f18_local5 )
			end
		end
	end
end

GIFT.ProcessQueuedBundleGifts = function ( f17_arg0 )
	local f17_local0 = LUI.FlowManager.GetScopedData( "MainMenu" )
	if f17_local0 and f17_local0.bundleGiftQueue then
		f0_local0( f17_arg0, f17_local0.bundleGiftQueue, f17_local0.markGiftQueue, GIFT.ProcessQueuedBundleGifts )
	end
end

GIFT.ProcessQueuedBattlepassGifts = function ( f16_arg0 )
	local f16_local0 = LUI.FlowManager.GetScopedData( "MainMenu" )
	if f16_local0 and f16_local0.battlepassGiftQueue then
		f0_local0( f16_arg0, f16_local0.battlepassGiftQueue, f16_local0.markGiftQueue, GIFT.ProcessQueuedBattlepassGifts )
	end
end

GIFT.MarkGiftsSeen = function ( f15_arg0, f15_arg1 )
	Gifting.EFBECJEAI( f15_arg0, f15_arg1 )
	if LUI.FlowManager.IsInStack( "MainMenu" ) then
		local f15_local0 = LUI.FlowManager.GetScopedData( "MainMenu" )
		for f15_local1 = 1, #f15_arg1, 1 do
			f15_local0.SeenGifts[f15_arg1[f15_local1]] = nil
		end
	end
end

GIFT.StartFTUEFlow = function ( f5_arg0, f5_arg1 )
	assert( f5_arg0._controllerIndex, "[GiftingUtils] Invalid controllerIndex" )
	local f5_local0 = function ()
		local _spinner = nil
		
		_spinner = MenuBuilder.BuildRegisteredType( "FenceSpinner", {
			controllerIndex = f5_arg0._controllerIndex
		} )
		_spinner.id = "Spinner"
		_spinner:SetAlpha( 1 )
		_spinner:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 720, _1080p * 1060, _1080p * 552, _1080p * 562 )
		f5_arg0:addElement( _spinner )
		f5_arg0._spinner = _spinner
		
	end
	
	local f5_local1 = function ()
		local f12_local0 = Onboarding.Gifting2FA.WasCompleted( f5_arg0, f5_arg0._controllerIndex )
		if f12_local0 then
			f5_arg0()
		end
		Onboarding.Gifting2FA.MarkCompleted( f5_arg0, f5_arg0._controllerIndex )
		local f12_local1 = ONBOARDING_DATA.GetGiftingFTUEData2FAEnrolled()
		local f12_local2 = function ( f13_arg0, f13_arg1 )
			ACTIONS.LeaveMenu( f13_arg0 )
			f12_local0()
		end
		
		f12_local1.isEnrolledIn2FA = true
		f12_local1.confirmButton.action = f12_local2
		f12_local1.showBackButton = false
		LUI.FlowManager.RequestPopupMenu( f5_arg0, "onboardingpopup", true, f5_arg0._controllerIndex, false, f12_local1 )
	end
	
	local f5_local2 = function ()
		local f9_local0 = ONBOARDING_DATA.GetGiftingFTUEData2FANotEnrolled()
		f9_local0.isGiftingPopup = true
		f9_local0.continueSetupAction = function ( f11_arg0, f11_arg1 )
			Engine.BHECIAHGC( f11_arg1, WebBrowserType.FULLSCREEN, f9_local0.setup2FA_URL )
		end
		
		f9_local0.alreadySetUp2FAAction = function ( f10_arg0, f10_arg1 )
			ACTIONS.LeaveMenu( f10_arg0 )
			TwoFactorAuth.DEACFDICFJ( f10_arg1, true )
			f9_local0()
			f10_arg0.forceUnloadSpinnerTimer = LUI.UITimer.new( {
				interval = 5000,
				event = "force_unload_spinner"
			} )
			f10_arg0.forceUnloadSpinnerTimer.id = "forceUnloadSpinnerTimer"
			f10_arg0:addElement( f10_arg0.forceUnloadSpinnerTimer )
		end
		
		f9_local0.isEnrolledIn2FA = false
		f9_local0.showBackButton = true
		LUI.FlowManager.RequestPopupMenu( f5_arg0, "onboardingpopup", true, f5_arg0._controllerIndex, false, f9_local0 )
	end
	
	f5_arg0:registerEventHandler( "two_factor_auth_status", function ( element, event )
		if f5_arg0._spinner then
			f5_arg0:RemoveElement( f5_arg0._spinner )
		end
		if f5_arg0.forceUnloadSpinnerTimer then
			f5_arg0:RemoveElement( f5_arg0.forceUnloadSpinnerTimer )
		end
		if event.enrolled then
			f5_arg0()
		else
			LUI.FlowManager.RequestPopupMenu( nil, "PopupOK", true, f5_arg0._controllerIndex, false, {
				title = Engine.CBBHFCGDIC( "MENU/ERROR" ),
				message = Engine.CBBHFCGDIC( "ONBOARDING/GIFTING_ERROR_2FA_NOT_ENROLLED" ),
				action = function ()
					element()
				end
			}, nil, false, true )
		end
	end )
	f5_arg0:addEventHandler( "force_unload_spinner", function ( f6_arg0, f6_arg1 )
		if f5_arg0._spinner then
			f5_arg0:RemoveElement( f5_arg0._spinner )
		end
	end )
	if TwoFactorAuth.BDAFCCAEDG( f5_arg0._controllerIndex ) then
		f5_local1()
	else
		f5_local2()
	end
end

GIFT.IsItemGiftable = function ( f4_arg0 )
	assert( f4_arg0 )
	local f4_local0 = StringTable.DIFCHIGDFB( CSV.bundleIDs.file, CSV.bundleIDs.cols.id, f4_arg0, CSV.bundleIDs.cols.giftable )
	if f4_local0 and 0 < #f4_local0 then
		return f4_local0 == "1"
	else
		return false
	end
end

GIFT.WaitForTransitionAndProcessGift = function ( f2_arg0, f2_arg1, f2_arg2 )
	if not LUI.FlowManager.IsMenuOnTop( f2_arg2 ) then
		if not f2_arg0._waitingForTransition then
			f2_arg0._waitingForTransition = true
			local f2_local0 = f2_arg0:Wait( 200 )
			f2_local0.onComplete = function ()
				f2_arg0._waitingForTransition = false
				GIFT.WaitForTransitionAndProcessGift( f2_arg0, f2_arg0, f2_arg0 )
			end
			
		end
	else
		f2_arg0._waitingForTransition = false
		GIFT.QueueGiftReceived( f2_arg1 )
		LUI.UIRoot.ProcessEvent( Engine.DBFFAEEFGJ(), {
			name = "gift_queued_in"
		} )
	end
end

GIFT.LogGiftingScreenInteraction = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3, f1_arg4 )
	Engine.CEJJDJJHIJ( f1_arg0, "dlog_event_gifting_interaction", {
		screen_id = f1_arg1,
		screen_duration_ms = f1_arg3,
		previous_screen_id = f1_arg2,
		button_pressed = f1_arg4
	} )
end

