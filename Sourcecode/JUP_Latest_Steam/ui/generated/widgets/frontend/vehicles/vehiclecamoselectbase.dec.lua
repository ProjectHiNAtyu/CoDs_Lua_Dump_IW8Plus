-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
local f0_local0 = false
FILTER_BUTTON_REF = "button_right_trigger"
local f0_local1 = function ( f30_arg0, f30_arg1 )
	if f30_arg1 then
		for f30_local3, f30_local4 in ipairs( f30_arg0._camoTable ) do
			if f30_local4.ref == f30_arg1 then
				return f30_local3 - 1
			end
		end
	end
	return 0
end

local f0_local2 = function ( f29_arg0, f29_arg1 )
	f29_arg0._previewOptions = {}
	f29_arg0._previewOptions.lootID = f29_arg1.lootID
	if f29_arg1.lootID ~= 0 then
		f29_arg0._previewOptions.lootID = f29_arg1.lootID
		f29_arg0._previewOptions.storePreviewItemType = LOOT.GetTypeForID( f29_arg0._previewOptions.lootID )
		f29_arg0._previewOptions.lootType = LOOT.GetTypeForID( f29_arg0._previewOptions.lootID )
		f29_arg0._previewOptions.itemRef = LOOT.GetItemRef( f29_arg0._previewOptions.lootID )
		if f29_arg1.vehicleRef == "default" then
			f29_arg0._previewOptions.isDefault = true
			f29_arg0._previewOptions.showcaseImage = f29_arg1.showcaseImage
		end
	else
		f29_arg0._previewOptions = f29_arg1
		f29_arg0._previewOptions.isDefault = true
	end
	local f29_local0 = Challenge.GetWinChallengeIDFromLootID( f29_arg0._controllerIndex, f29_arg0._previewOptions.lootID )
	if f29_arg0.WinChallengeUnlockItem then
		f29_arg0.WinChallengeUnlockItem:SetChallenge( f29_local0, {
			isUnlockCriteria = true
		} )
	end
end

local f0_local3 = function ( f28_arg0, f28_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "VehiclePreview", true, f28_arg1, nil, f28_arg0._previewOptions, true )
end

local f0_local4 = function ( f26_arg0, f26_arg1, f26_arg2, f26_arg3 )
	f26_arg2:AddContextualMenuAction( {
		id = "vehicleCamoPreview",
		button = "button_l3",
		actionName = Engine[0xED84C33EC5F01EA]( 0x723B50246C20EF6 ),
		actionFunction = function ()
			f26_arg0( f26_arg0, f26_arg0 )
		end
	} )
end

local f0_local5 = function ( f25_arg0 )
	f25_arg0.CamoGrid:RefreshContent()
	f25_arg0._unlockCamoNum = 0
	local f25_local0 = #f25_arg0._camoTable
	local f25_local1 = 0 and f25_local0 - 1 or 0
	for f25_local2 = f25_local0, 2, -1 do
		if f25_arg0._camoTable[f25_local2].isUnlocked == true then
			f25_arg0._unlockCamoNum = f25_arg0._unlockCamoNum + 1
		end
	end
	if f25_arg0.UnlockCount then
		f25_arg0.UnlockCount:UpdateCount( f25_arg0._unlockCamoNum, f25_local1, true )
	end
end

local f0_local6 = function ( f24_arg0 )
	local f24_local0 = f24_arg0.CamoGrid
	local f24_local1 = f24_arg0._camoTable
	local f24_local2 = VEHICLE.SetFavoriteItem( f24_arg0, f24_local0, f24_local1, LOOT.itemTypes.VEHICLE_CAMO, f24_arg0._favoriteVehicleCamos )
	local f24_local3 = f24_local0:GetFocusPositionIndex()
	if f24_local3 then
		local f24_local4 = f24_local1[f24_local3 + 1]
		if f24_local4 and f24_local2 and f24_local4.ref ~= VEHICLE.DEFAULT_REF then
			f24_arg0._favoriteVehicleCamos = f24_local2
			f0_local0( f24_arg0 )
			if f24_arg0.UpdateFavorite then
				f24_arg0:UpdateFavorite( f24_local4 )
			end
		end
	end
end

local f0_local7 = function ( f23_arg0 )
	local f23_local0 = MenuUtils.GetSortPromptText( f23_arg0, true )
	local f23_local1 = f23_arg0.CamoGridControls.ButtonHelperText
	f23_local1:PopButtonPrompt( {
		button_ref = FILTER_BUTTON_REF
	} )
	f23_local1:PushButtonPrompt( {
		side = "right",
		priority = 1,
		ignoreTooltipPrompt = true,
		useTextButtons = true,
		helper_text = f23_local0,
		button_ref = FILTER_BUTTON_REF
	} )
end

local f0_local8 = function ( f21_arg0, f21_arg1 )
	local f21_local0 = PLAYER_DATA.IO( f21_arg1, CoD.StatsGroup.NonGame )
	f21_local0 = f21_local0.sortPreferences.vehicleSortPreference.camoActiveFilter:get()
	table.sort( f21_arg0._camoTable, function ( f22_arg0, f22_arg1 )
		if f22_arg0.index == 0 or f22_arg1.index == 0 then
			return f22_arg0.index < f22_arg1.index
		elseif f21_arg0 == VEHICLE.Filter.ALL or f21_arg0 == VEHICLE.Filter.FAVORITES then
			if f21_arg0._favoriteVehicleCamos[f22_arg0.ref] ~= f21_arg0._favoriteVehicleCamos[f22_arg1.ref] then
				local f22_local0 = f21_arg0._favoriteVehicleCamos[f22_arg0.ref]
				if f22_local0 then
					f22_local0 = not f21_arg0._favoriteVehicleCamos[f22_arg1.ref]
				end
				return f22_local0
			end
		elseif f21_arg0 == VEHICLE.Filter.COLLECTED then
			if f22_arg0.isUnlocked ~= f22_arg1.isUnlocked then
				local f22_local0 = f22_arg0.isUnlocked
				if f22_local0 then
					f22_local0 = not f22_arg1.isUnlocked
				end
				return f22_local0
			end
		elseif f21_arg0 == VEHICLE.Filter.FROM_BATTLE_PASS then
			if f22_arg0.isFromBattlePass ~= f22_arg1.isFromBattlePass then
				local f22_local0 = f22_arg0.isFromBattlePass
				if f22_local0 then
					f22_local0 = not f22_arg1.isFromBattlePass
				end
				return f22_local0
			end
		elseif f21_arg0 == VEHICLE.Filter.FROM_STORE_BUNDLE and f22_arg0.isFromStoreBundle ~= f22_arg1.isFromStoreBundle then
			local f22_local0 = f22_arg0.isFromStoreBundle
			if f22_local0 then
				f22_local0 = not f22_arg1.isFromStoreBundle
			end
			return f22_local0
		end
		local f22_local0 = Engine[0xED84C33EC5F01EA]( f22_arg0.name or 0x0 )
		local f22_local1 = Engine[0xED84C33EC5F01EA]( f22_arg1.name or 0x0 )
		if f22_local0 ~= f22_local1 then
			return f22_local0 < f22_local1
		end
		return false
	end )
	f21_arg0.CamoGrid:RemoveFocusFromChild()
	f21_arg0.CamoGrid:SetNumChildren( #f21_arg0._camoTable )
	f21_arg0.CamoGrid:RefreshContent()
	if f21_arg0.CamoGridControls then
		f0_local0( f21_arg0 )
	end
end

local f0_local9 = function ( f20_arg0, f20_arg1, f20_arg2 )
	local f20_local0 = f20_arg0._camoTable[f20_arg2 * f20_arg0.CamoGrid:GetNumColumns() + f20_arg1 + 1]
	local f20_local1 = VEHICLE.GetDefaultCamo()
	if f20_local0.ref == f20_local1.ref then
		f20_local0.isUnlocked = true
	else
		local f20_local2 = f20_local0.isUnlocked
		if not f20_local2 then
			f20_local2 = LOOT.IsUnlockedWithID( f20_arg0._controllerIndex, f20_local0.lootID )
		end
		f20_local0.isUnlocked = f20_local2
	end
	f20_local0.isSelected = f20_local0.ref == f20_arg0._equippedCamo.ref
	f20_local0.isFavorite = f20_arg0._favoriteVehicleCamos[f20_local0.ref]
	return f20_local0
end

local f0_local10 = function ( f18_arg0, f18_arg1 )
	f18_arg0.CamoGrid:SetRefreshChild( function ( f19_arg0, f19_arg1, f19_arg2 )
		local f19_local0 = f18_arg0( f18_arg0, f19_arg1, f19_arg2 )
		f19_arg0:SetupButton( f18_arg0.GetCamoButtonConfig( f19_local0 ) )
		f19_arg0._itemData = f19_local0
		if not CONDITIONS.IsMobileOrMobileSim() and f19_local0.lootID == 0 then
			f19_arg0:SetEquipped( false )
			f19_arg0:SetNegative( true )
		else
			f19_arg0:SetFavorite( f19_local0.isFavorite )
			f19_arg0:SetEquipped( f19_local0.isSelected )
			f19_arg0:SetDisabled( not f19_local0.isUnlocked )
		end
		f18_arg0( f18_arg0, f18_arg0, f19_arg0, f19_local0.name )
		f18_arg0.SetupCamoButton( f19_arg0, f19_local0 )
		MenuUtils.SetupItemButtonTags( f18_arg0, f19_arg0, f19_local0.lootID )
	end )
end

local f0_local11 = function ( f16_arg0, f16_arg1 )
	local f16_local0 = function ( f17_arg0 )
		if f17_arg0.isUnlocked or not String.IsNilOrEmpty( f17_arg0.unlockString ) then
			return true
		elseif not Dvar[0x9E5BE3B4BBA4E0E]( 0xBBF84FBDC361CAF ) then
			return false
		end
		local f17_local0 = f17_arg0.lootID
		if f17_local0 then
			f17_local0 = STORE.Bundles.GetFirstBundleWithLootId( f16_arg0, f17_arg0.lootID ) ~= nil
		end
		local f17_local1 = f17_arg0.lootID
		if f17_local1 then
			f17_local1 = BATTLEMAP.IsReward( f17_arg0.lootID )
		end
		local f17_local2
		if not f17_local0 then
			f17_local2 = f17_local0
		else
			f17_local2 = f17_local1
		end
		return f17_local2
	end
	
	local f16_local1 = {}
	for f16_local5, f16_local6 in ipairs( f16_arg1 ) do
		if f16_local6.ref ~= VEHICLE.DEFAULT_REF and not f16_local0( f16_local6 ) then
			table.insert( f16_local1, f16_local5 )
		end
	end
	for f16_local2 = #f16_local1, 1, -1 do
		table.remove( f16_arg1, f16_local1[f16_local2] )
	end
end

local f0_local12 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdateSorting = f0_local0
	f3_arg0.FavoriteItem = f0_local0
	local f3_local0 = f3_arg2.vehicleInfo
	local f3_local1 = f3_arg2.vehicleInfo.ref
	f3_arg0._camoTable = VEHICLE.GetVehicleCamos( f3_arg1, f3_local1 )
	f0_local0( f3_arg1, f3_arg0._camoTable )
	f3_arg0.CamoGrid:SetNumChildren( #f3_arg0._camoTable )
	f3_arg0._vehiclePlayerData = VEHICLE.GetPlayerData( f3_arg1, f3_local1 )
	f3_arg0._equippedCamo = VEHICLE.GetEquippedCamo( f3_arg1, f3_local1 )
	f3_arg0._favoriteVehicleCamos = LOOT.GetFavoritesForType( LOOT.itemTypes.VEHICLE_CAMO )
	f3_arg0._controllerIndex = f3_arg1
	if CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.ItemDetails:UpdateDetails( f3_arg0._equippedCamo )
	else
		f3_arg0.ItemDetails:SetupForVehicles()
	end
	f3_arg0:UpdateSorting( f3_arg1 )
	f0_local0( f3_arg0, f3_arg1 )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.FullImage:setImage( RegisterMaterial( f3_arg0._equippedCamo.showcaseImage ) )
	else
		local f3_local2 = f3_arg0._equippedCamo.showcaseImage
		if f3_local2 == f3_local0.defaultImage then
			f3_local2 = f3_local0.defaultShowcaseImage
		end
		f3_arg0.FullImage:setImage( RegisterMaterial( f3_local2 ) )
	end
	f3_arg0:addEventHandler( "loot_button_over", function ( f15_arg0, f15_arg1 )
		local f15_local0 = f15_arg1.itemData
		local f15_local1 = STORE.Bundles.GetFirstBundleWithLootId( f3_arg0, f15_local0.lootID ) ~= nil
		local f15_local2 = BATTLEMAP.IsReward( f15_local0.lootID )
		if f15_local1 then
			f15_local0.unlockText = Engine[0xED84C33EC5F01EA]( 0xFF2BB87EDFA49 )
		elseif f15_local2 then
			f15_local0.unlockText = Engine[0xED84C33EC5F01EA]( 0xBF89C15728EBC78 )
		elseif f15_local0.unlockType == "CHALLENGE" then
			f15_local0.unlockText = f15_local0.unlockString
		else
			f15_local0.unlockText = nil
		end
		f15_local0.isCamo = true
		f15_local0.desc = f15_local0.flavorText and f15_local0.flavorText or ""
		f15_local0.isFavorite = f3_arg0._favoriteVehicleCamos[f15_local0.ref]
		f15_local0.isEquipped = f15_local0.isSelected
		f3_arg0.ItemDetails:UpdateDetails( f15_local0 )
		local f15_local3 = f15_local0.ref
		local f15_local4 = VEHICLE.DEFAULT_REF
		f3_arg0.FullImage:setImage( RegisterMaterial( REG15 and f15_local0.showcaseImage or f3_arg0.defaultShowcaseImage ) )
		if f3_arg0.BundleUpsellButton then
			if f15_local1 then
				f3_arg0.BundleUpsellButton:SetupUpsellButtonWithLootID( f3_arg0, f15_local0.lootID )
			else
				f3_arg0.BundleUpsellButton:HideButton()
			end
		end
		if f15_local0.vehicleRef == "default" then
			f15_local0.showcaseImage = f3_arg0.defaultShowcaseImage
		end
		f3_arg0( f3_arg0, f15_local0 )
		if f15_arg0.UpdateFavorite then
			f15_arg0:UpdateFavorite( f15_local0 )
		end
	end )
	local f3_local2 = VEHICLE.GetEquippedCamo( f3_arg1, f3_local1 )
	local f3_local3 = f3_arg0.CamoGrid:GetPositionForIndex( f0_local0( f3_arg0, f3_local2.ref ) )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f3_arg0.CamoGrid:SetFocusedPosition( f3_local3, true )
	else
		f3_arg0.CamoGrid:TouchMouseSetActiveToDefaultFocusMenuCreate( f3_arg1 )
		f3_arg0.CamoGrid:SetDefaultFocus( f3_local3 )
	end
	f0_local0( f3_arg0 )
	f3_arg0:addEventHandler( "loot_button_action", function ( f14_arg0, f14_arg1 )
		local f14_local0 = f14_arg1.itemData
		f3_arg0._vehiclePlayerData.camo:set( f14_local0.playerDataIndex and f14_local0.playerDataIndex or 0 )
		f3_arg0._equippedCamo = f14_local0
		f3_arg0.CamoGrid:RefreshContent()
		f14_local0.isCamo = true
		f14_local0.desc = f14_local0.flavorText and f14_local0.flavorText or ""
		f14_local0.isFavorite = f3_arg0._favoriteVehicleCamos[f14_local0.ref]
		f14_local0.isEquipped = f14_local0.isSelected
		f3_arg0.ItemDetails:UpdateDetails( f14_local0 )
		LUI.FlowManager.RequestLeaveMenu( f14_arg0 )
	end )
	f3_arg0:AddGamepadEventCallback( "button_left_stick", function ( f13_arg0, f13_arg1 )
		if not CONDITIONS.IsIW9BetaBuildEnabled() then
			f3_arg0( f13_arg0, f13_arg1.controller or f3_arg0 )
		end
	end )
	if CONDITIONS.IsUserSignedInDemonware( f3_arg1 ) then
		f3_arg0:AddGamepadEventCallback( "button_alt2", function ( f12_arg0, f12_arg1 )
			local f12_local0 = f12_arg0.CamoGrid
			local f12_local1 = f12_arg0._camoTable
			local f12_local2 = f12_local0
			if f12_local1[f12_local0:GetFocusPositionIndex() + 1].ref ~= VEHICLE.DEFAULT_REF then
				f3_arg0( f12_arg0 )
				return true
			else
				
			end
		end )
	end
	f3_arg0:addEventHandler( "update_vehicle_sorting", function ( f11_arg0, f11_arg1 )
		f3_arg0:UpdateSorting( f11_arg1.controller or f3_arg0 )
	end )
	f3_arg0:AddGamepadEventCallback( "button_right_trigger", function ( f10_arg0, f10_arg1 )
		local f10_local0 = f10_arg1.controller or f3_arg0
		if f3_arg0 then
			LUI.FlowManager.RequestPopupMenu( nil, "VehiclesFilterPopupLayout", true, f10_local0, false, {
				menuDescription = 0xBA4110736267DDD,
				menuTitleRef = 0x44C248608099C2C,
				controllerIndex = f10_local0,
				shouldSkipFilters = {
					VEHICLE.Filter.UNLOCKED
				},
				filterType = VEHICLE.FilterType.CAMO_FILTER
			} )
		end
	end )
	LAYOUT.SetupGenericGridViewInputAnimations( f3_arg0, f3_arg0.CamoGrid, {
		gridChangeToGridViewAnimOverride = "GridView",
		gridChangeToDetailViewAnimOverride = "NormalView"
	} )
	if f3_arg0.CamoGridControls then
		f3_arg0.CamoGrid:SetGridViewAction( f3_arg0, f3_arg0.CamoGridControls.ButtonHelperText, f3_arg0.CamoGrid:GetNumColumns() )
		f3_arg0.CamoGrid:RegisterGamepadEventHandlers( f3_arg0, f3_arg0.CamoGridControls, f3_arg0.CamoGridControls.ButtonHelperText, {
			condensedRows = 1,
			expandedRows = 3
		} )
		f3_arg0.CamoGridControls.ButtonHelperText:addEventHandler( "grid_view_prompt_refreshed", function ( f9_arg0, f9_arg1 )
			f3_arg0( f3_arg0, f3_arg0 )
		end )
	end
	f3_arg0:addAndCallEventHandler( "restore_focus", function ( f8_arg0, f8_arg1 )
		f3_arg0:UpdateSorting( f3_arg0 )
	end )
	local f3_local4 = Engine[0x3B8CFB6758EF57C]()
	local f3_local5 = f3_arg0._equippedCamo
	local f3_local6 = f3_arg0._equippedCamo.lootID
	f3_arg0:addEventHandler( "menu_close", function ( f7_arg0, f7_arg1 )
		local f7_local0 = f3_arg0._equippedCamo
		METRICS.VehicleUsageSendDLogEvent( f3_arg0.id, f3_arg0, f3_arg0, f3_arg0, f3_arg0._equippedCamo.lootID )
		LOOT.SendDlogLootEquipped( f3_arg0, LOOT.itemTypes.VEHICLE_CAMO, f3_arg0, f7_local0 )
	end )
	if f3_arg0.SideArrows then
		MenuUtils.SetupSideArrows( f3_arg0, f3_arg0.CamoGrid, true )
	end
	if CONDITIONS.IsWinTokenPurchasingEnabled() then
		f3_arg0:registerEventHandler( "loot_button_action_disable", function ( element, event )
			local f4_local0 = event.itemData
			local f4_local1 = function ()
				element.CamoGrid:RefreshContent()
			end
			
			local f4_local2 = function ()
				LUI.FlowManager.RequestPopupMenu( element, "PopupOK", true, element, false, {
					title = Engine[0xED84C33EC5F01EA]( 0x1CCA5C59ECE1EA6 ),
					message = Engine[0xED84C33EC5F01EA]( 0x7D2DEC35B43660 )
				} )
			end
			
			if not f4_local0.isUnlocked then
				local f4_local3 = f3_arg0.GetCamoButtonConfig( f4_local0 )
				LOOT.PurchaseWithWinTokens( f3_arg0, f4_local0.lootID, f4_local3.buttonData.winTokenCost, f4_local1, f4_local2 )
			end
			return true
		end )
	end
end

local f0_local13 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
	f2_arg0._controllerIndex = f2_arg1
end

function VehicleCamoSelectBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIElement.new()
	f1_local1:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
	f1_local1.id = "VehicleCamoSelectBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f0_local0( f1_local1, f1_local0.ValidateControllerIndex( f1_local1, f1_local2 ), f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0x519263856797AE6, VehicleCamoSelectBase )
LockTable( _M )
