-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
LUI.UIMessageQueue = LUI.Class( LUI.UIElement )
LUI.UIMessageQueue.MessageType = {
	StartInfo = {
		priority = 0,
		key = "StartInfo",
		maxWaitTime = 5000,
		displayTime = 2000
	},
	LevelUp = {
		priority = 10,
		key = "LevelUp",
		maxWaitTime = 5000,
		displayTime = 2000
	},
	Accolades = {
		priority = 20,
		key = "Accolades",
		maxWaitTime = 5000,
		displayTime = 2000
	},
	Killstreaks = {
		priority = 30,
		key = "Killstreaks",
		maxWaitTime = 5000,
		displayTime = 2000
	},
	ObjectiveUpdate = {
		priority = 40,
		key = "ObjectiveUpdate",
		maxWaitTime = 5000,
		displayTime = 2000
	},
	LocalPlayerSplash = {
		priority = 10,
		key = "LocalPlayerSplash",
		maxWaitTime = 4294967295,
		displayTime = 1500
	},
	GlobalPlayerSplash = {
		priority = 10,
		key = "GlobalPlayerSplash",
		maxWaitTime = 4294967295,
		displayTime = 2250
	},
	MiscMessages = {
		priority = 20,
		key = "MiscMessages",
		maxWaitTime = 4294967295,
		displayTime = 1250
	}
}
LUI.UIMessageQueue.init = function ( f15_arg0, f15_arg1 )
	LUI.UIMessageQueue.super.init( f15_arg0, f15_arg1 )
	assert( type( f15_arg1 ) == "table" )
	assert( f15_arg1.controller )
	f15_arg0.messageQueue = {}
	f15_arg0.widgetMap = {}
	f15_arg0.currentMessage = nil
	f15_arg0.controller = f15_arg1.controller
	f15_arg0.nextMessageDelay = f15_arg1.nextMessageDelay or 500
	f15_arg0:registerEventHandler( "level_load", function ( element )
		element.currentMessage = nil
		element.messageQueue = {}
	end )
end

LUI.UIMessageQueue.AddWidget = function ( f12_arg0, f12_arg1, f12_arg2 )
	assert( type( f12_arg2 ) == "table" )
	assert( f12_arg2.messageType )
	assert( not LUI.IsItemInArray( f12_arg0.widgetMap, f12_arg2.messageType ) )
	f12_arg0.widgetMap[f12_arg2.messageType.key] = f12_arg1
	f12_arg0:SubscribeToModel( f12_arg2.dataSourcesFrom.push:GetModel( f12_arg0.controller ), function ()
		if f12_arg0.dataSourcesFrom.push:GetValue( f12_arg0.controller ) then
			local f14_local0 = {}
			for f14_local4, f14_local5 in pairs( f12_arg0.dataSourcesFrom ) do
				f14_local0[f14_local4] = f14_local5:GetValue( f12_arg0.controller )
			end
			DataModel[0x83C9B5DE1D9371]( f12_arg0.dataSourcesFrom.push:GetModel( f12_arg0.controller ), false )
			f12_arg0:AddMessage( f12_arg0.messageType, f14_local0, f12_arg0.dataSourcesTo )
		end
	end, true )
	if f12_arg2.dataSourcesFrom.clear then
		f12_arg0:SubscribeToModel( f12_arg2.dataSourcesFrom.clear:GetModel( f12_arg0.controller ), function ()
			if f12_arg0.dataSourcesFrom.clear:GetValue( f12_arg0.controller ) then
				f12_arg0:RemoveMessagesOfType( f12_arg0.messageType, true, true )
				DataModel[0x83C9B5DE1D9371]( f12_arg0.dataSourcesFrom.clear:GetModel( f12_arg0.controller ), false )
			end
		end, true )
	end
end

LUI.UIMessageQueue.AddMessage = function ( f11_arg0, f11_arg1, f11_arg2, f11_arg3 )
	local f11_local0 = {
		messageType = f11_arg1,
		values = f11_arg2,
		dataSourcesTo = f11_arg3,
		insertTime = Engine[0x6991337AE950F99](),
		maxWaitTime = f11_arg1.maxWaitTime,
		displayTime = f11_arg1.displayTime
	}
	if f11_arg2.priorityOverride then
		f11_local0.priorityOverride = f11_arg2.priorityOverride:GetValue( f11_arg0.controller )
	end
	if f11_arg1.displayTime < 0 then
		DebugPrint( "Adding new non-expiring message of type " .. f11_arg1.key .. ". Removing any previous ones." )
		f11_arg0:RemoveMessagesOfType( f11_arg1, true, false )
	end
	f11_arg0.messageQueue[#f11_arg0.messageQueue + 1] = f11_local0
	if not f11_arg0.currentMessage then
		f11_arg0:ExecuteNextMessage()
	end
end

LUI.UIMessageQueue.RemoveMessagesOfType = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	for f10_local0 = #f10_arg0.messageQueue, 1, -1 do
		if f10_arg0.messageQueue[f10_local0].messageType == f10_arg1 then
			table.remove( f10_arg0.messageQueue, f10_local0 )
		end
	end
	if f10_arg0.currentMessage and f10_arg0.currentMessage.messageType == f10_arg1 then
		if f10_arg2 and -1 < f10_arg0.currentMessage.messageType.displayTime then
			f10_arg0:OnMessageComplete()
		elseif f10_arg3 then
			f10_arg0:OnMessageDisplayFinished()
		else
			f10_arg0:ExecuteNextMessage()
		end
	elseif f10_arg3 then
		f10_arg0.widgetMap[f10_arg1.key]:processEvent( {
			name = "message_queue_hide"
		} )
	end
end

LUI.UIMessageQueue.GetHighestPriorityIndex = function ( f9_arg0 )
	assert( 0 < #f9_arg0.messageQueue )
	local f9_local0 = 0
	local f9_local1 = -1
	for f9_local2 = 1, #f9_arg0.messageQueue, 1 do
		local f9_local5 = f9_arg0.messageQueue[f9_local2]
		local f9_local6 = f9_local5.priorityOverride and f9_local5.priorityOverride or f9_local5.messageType.priority
		if f9_local1 < f9_local6 then
			f9_local0 = f9_local2
			f9_local1 = f9_local6
		end
	end
	return f9_local0
end

LUI.UIMessageQueue.ExecuteMessage = function ( f7_arg0, f7_arg1 )
	local f7_local0 = table.remove( f7_arg0.messageQueue, f7_arg1 )
	local f7_local1 = f7_arg0.currentMessage
	local f7_local2
	if f7_local1 then
		f7_local2 = f7_local1
	else
		f7_local2 = f7_local1.messageType.isStackable
		if f7_local2 then
			f7_local2 = f7_local1.messageType == f7_local0.messageType
		end
	end
	f7_arg0.currentMessage = f7_local0
	if f7_local0.dataSourcesTo then
		local f7_local3 = "push"
		for f7_local7, f7_local8 in pairs( f7_local0.dataSourcesTo ) do
			if f7_local7 ~= f7_local3 then
				DataModel[0x83C9B5DE1D9371]( f7_local8:GetModel( f7_arg0.controller ), f7_local0.values[f7_local7] )
			end
		end
		if f7_local0.dataSourcesTo[f7_local3] ~= nil then
			DataModel[0x83C9B5DE1D9371]( f7_local0.dataSourcesTo[f7_local3]:GetModel( f7_arg0.controller ), f7_local0.values[f7_local3] )
		end
	end
	if f7_arg0.widgetMap[f7_local0.messageType.key] then
		if not f7_local2 then
			f7_arg0.widgetMap[f7_local0.messageType.key]:processEvent( {
				name = "message_queue_show",
				messageType = f7_local0.messageType
			} )
		end
	else
		DebugPrint( "WARNING: No widget set to handle message of type " .. f7_local0.messageType.key )
	end
	if -1 < f7_local0.displayTime then
		local f7_local3 = f7_arg0:Wait( f7_local0.displayTime )
		f7_local3.onComplete = function ()
			if f7_arg0.currentMessage and f7_arg0.currentMessage == f7_arg0 then
				f7_arg0:OnMessageDisplayFinished()
			end
		end
		
	end
end

LUI.UIMessageQueue.ExecuteNextMessage = function ( f6_arg0 )
	if 0 < #f6_arg0.messageQueue then
		f6_arg0:RemoveExpiredMessages()
		if 0 < #f6_arg0.messageQueue then
			local f6_local0 = f6_arg0:GetHighestPriorityIndex()
			assert( 0 < f6_local0 )
			f6_arg0:ExecuteMessage( f6_local0 )
		end
	end
end

LUI.UIMessageQueue.OnMessageComplete = function ( f5_arg0 )
	if f5_arg0.currentMessage then
		f5_arg0.currentMessage = nil
		f5_arg0:ExecuteNextMessage()
	end
end

LUI.UIMessageQueue.OnMessageDisplayFinished = function ( f3_arg0 )
	local f3_local0 = f3_arg0:IsNextMessageStackable()
	if f3_arg0.currentMessage and f3_arg0.widgetMap[f3_arg0.currentMessage.messageType.key] and not f3_local0 then
		f3_arg0.widgetMap[f3_arg0.currentMessage.messageType.key]:processEvent( {
			name = "message_queue_hide"
		} )
	end
	if f3_local0 then
		f3_arg0:OnMessageComplete()
	else
		local f3_local1 = f3_arg0:Wait( f3_arg0.nextMessageDelay )
		f3_local1.onComplete = function ()
			f3_arg0:OnMessageComplete()
		end
		
	end
end

LUI.UIMessageQueue.RemoveExpiredMessages = function ( f2_arg0 )
	local f2_local0 = Engine[0x6991337AE950F99]()
	for f2_local1 = #f2_arg0.messageQueue, 1, -1 do
		local f2_local4 = f2_arg0.messageQueue[f2_local1]
		if -1 < f2_local4.maxWaitTime and f2_local4.maxWaitTime <= f2_local0 - f2_local4.insertTime then
			table.remove( f2_arg0.messageQueue, f2_local1 )
		end
	end
end

LUI.UIMessageQueue.IsNextMessageStackable = function ( f1_arg0 )
	if not f1_arg0.currentMessage or not f1_arg0.currentMessage.messageType.isStackable or #f1_arg0.messageQueue < 1 then
		return false
	else
		local f1_local0 = f1_arg0:GetHighestPriorityIndex()
		assert( 0 < f1_local0 )
		return f1_arg0.currentMessage.messageType == f1_arg0.messageQueue[f1_local0].messageType
	end
end

