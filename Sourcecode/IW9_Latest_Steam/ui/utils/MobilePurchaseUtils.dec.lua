-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:48
MOBILE_PURCHASE = MOBILE_PURCHASE or {}
MOBILE_PURCHASE.ProductType = {
	Blueprint = 3,
	Unknown = 0,
	LuckyDrawSpin = 4,
	Bundle = 2,
	CodPoints = 1,
	EdgeItem = 5
}
local f0_local0 = 5000
local f0_local1 = {
	"dlog_event_fe_commerce_purchase_success",
	"dlog_event_fe_commerce_purchase_failure",
	"dlog_event_fe_commerce_purchase_cancelled",
	"dlog_event_fe_commerce_purchase_pending"
}
MOBILE_PURCHASE.CurrencyId = {
	RealMoney = 0,
	CodPoints = 20
}
MOBILE_PURCHASE.ShowPurchaseCelebration = function ( f43_arg0 )
	if f43_arg0.video then
		Engine[0xFCF332AA8AC9B0F]( f43_arg0.video )
		local f43_local0 = LUI.FlowManager.GetMenuByName( "MobileGenericPopupWindow" )
		local self = LUI.UITimer.new( {
			event = "purchase_finished",
			interval = f43_arg0.closeTimer
		} )
		self.id = "timer"
		f43_local0.menu:addElement( self )
		f43_local0.menu:registerEventHandler( "purchase_finished", function ()
			f43_arg0.onClose()
		end )
	else
		local f43_local2 = LUI.MobilePurchaseCelebrationLayer.GetLayer()
		f43_local2:ShowPurchaseCelebration( f43_arg0 )
	end
end

MOBILE_PURCHASE.ClosePurchaseCelebration = function ( f42_arg0 )
	local f42_local0 = LUI.MobilePurchaseCelebrationLayer.GetLayer()
	f42_local0:ClearLayer()
	if f42_arg0.options.onClose then
		f42_arg0.options.onClose()
	end
end

MOBILE_PURCHASE.HandleCelebrationTouch = function ( f41_arg0 )
	MOBILE_PURCHASE.ClosePurchaseCelebration( f41_arg0 )
	local f41_local0 = -1
	if f41_arg0.options.product.prices and f41_arg0.options.product.prices[1] then
		f41_local0 = f41_arg0.options.product.prices[1].currencyId
	end
	Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_celebration_closed", {
		sku_id = f41_arg0.options.product.id,
		currency_id = f41_local0
	} )
end

MOBILE_PURCHASE.LoadCelebrationProduct = function ( f38_arg0, f38_arg1, f38_arg2 )
	f38_arg0.RarityBackground:SetVisible( false )
	f38_arg0.RarityFlare:SetVisible( false )
	f38_arg0.ChaseFlare:SetVisible( false )
	ACTIONS.AnimateSequence( f38_arg0, "StoreItem" )
	if f38_arg1.isCurrencyBundle then
		local f38_local0 = Table.Find( f38_arg1.currencyGrants, function ( f40_arg0 )
			return f40_arg0.currency.id == MOBILE_PURCHASE.CurrencyId.CodPoints
		end )
		local f38_local1
		if f38_local0 then
			f38_local1 = f38_local0.amount
			if not f38_local1 then
			
			else
				f38_arg0.ProductElement = f38_arg0:CreateCodPointsCard( f38_local1 )
			end
		end
		f38_local1 = 0
	elseif f38_arg1.id == STORE.UI.GetMobileBlackcellSkuIDForSeason( SEASON.GetCurrentSeason() ) then
		f38_arg0.CinematicFrame:StartCinematic( "bp_celebration_black_cell", 0 )
		local f38_local0 = f38_arg0:Wait( f0_local0 )
		f38_local0.onComplete = function ()
			f38_arg0.CinematicFrame:StopCinematic( 0 )
			MOBILE_PURCHASE.ClosePurchaseCelebration( f38_arg0 )
		end
		
	else
		local f38_local0 = MobileStoreUtils.GetAssetPath( MobileStoreUtils.AssetTypes.Icon, f38_arg1.assets )
		if f38_local0 then
			f38_arg0.ProductElement = f38_arg0:CreateFixedAspectRatioImage( f38_local0 )
		end
		if f38_arg1.isBundle then
			f38_arg0._itemIndex = #f38_arg0._product.items
		elseif f38_arg1.isBattlePassToken and f38_arg1.tokensPurchased then
			local f38_local1
			if 1 < f38_arg1.tokensPurchased then
				f38_local1 = Engine[0xED84C33EC5F01EA]( "LUA_MENU_MOBILE/TOKENS_PURCHASED", f38_arg1.tokensPurchased )
				if not f38_local1 then
				
				else
					f38_arg0.Title:setText( f38_local1 )
				end
			end
			f38_local1 = Engine[0xED84C33EC5F01EA]( "LUA_MENU_MOBILE/TOKEN_PURCHASED" )
		end
	end
end

MOBILE_PURCHASE._isShowingPurchaseInProgress = false
MOBILE_PURCHASE.GetPurchaseContext = function ()
	return MOBILE_PURCHASE._isShowingPurchaseInProgress and Enum[0x9ACDAE76A5AA08D][0xCA6C3E4D75BE2B8] or Enum[0x9ACDAE76A5AA08D][0x69F4BAB3A4B9A01]
end

MOBILE_PURCHASE.ShowPurchaseInProgress = function ( f36_arg0 )
	local f36_local0 = LUI.MobilePurchaseCelebrationLayer.GetLayer()
	if f36_local0 ~= nil then
		f36_local0:ClearLayer()
	end
	local f36_local1 = LUI.MobilePurchaseCelebrationLayer.GetLayer()
	local f36_local2 = f36_local1:ShowPurchaseInProgress( f36_arg0 )
	MOBILE_PURCHASE._isShowingPurchaseInProgress = true
	Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_spinner_appeared", {
		sku_id = f36_arg0.sku[1],
		currency_id = f36_arg0.currency
	} )
	if f36_arg0.currency == MOBILE_PURCHASE.CurrencyId.RealMoney then
		MOBILE_PURCHASE.PendingPurchaseTimeout( f36_local2, f36_arg0 )
	end
end

MOBILE_PURCHASE.ClosePurchaseInProgress = function ( f35_arg0 )
	local f35_local0 = LUI.MobilePurchaseCelebrationLayer.GetLayer()
	if f35_local0 ~= nil then
		f35_local0:ClearLayer()
		Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_spinner_closed", {
			sku_id = f35_arg0.sku[1],
			currency_id = f35_arg0.currency,
			was_timeout = f35_arg0.was_timeout or false
		} )
	end
	MOBILE_PURCHASE._isShowingPurchaseInProgress = false
end

MOBILE_PURCHASE.BattlePassCelebration = function ( f34_arg0 )
	assert( f34_arg0 )
	MOBILE_PURCHASE.ShowPurchaseCelebration( {
		video = "bp_aar_purchased_gold_mobile",
		product = f34_arg0.product,
		onClose = f34_arg0.onClose,
		closeTimer = f34_arg0.closeTimer,
		hideContinueText = f34_arg0.hideContinueText,
		onTouch = MOBILE_PURCHASE.HandleCelebrationTouch,
		onProductLoad = MOBILE_PURCHASE.LoadCelebrationProduct
	} )
end

MOBILE_PURCHASE.ShowInsufficientCodPointsPopup = function ( f31_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "MobileGenericPopupWindow", true, f31_arg0.controllerIndex, false, {
		customContent = {
			type = "MobileInsufficientCodPointsPopup",
			typeOfPopup = PopupsUtils.typeOfPopup.POPUP_OK
		},
		product = f31_arg0.product,
		neededCodPoints = f31_arg0.neededCodPoints,
		onComplete = function ( f33_arg0, f33_arg1 )
			if f31_arg0.onPurchased then
				f31_arg0.onPurchased( f33_arg1, f31_arg0.neededCodPoints )
			end
			ACTIONS.LeaveMenu( f33_arg0 )
		end,
		onCancel = function ( f32_arg0 )
			ACTIONS.LeaveMenu( f32_arg0 )
			if f31_arg0.onCancel then
				f31_arg0.onCancel( f31_arg0.neededCodPoints )
			end
		end,
		product = f31_arg0.product
	}, nil, true, true )
end

MOBILE_PURCHASE.TestInsufficientCodPointsPopup = function ( f30_arg0 )
	MOBILE_PURCHASE.ShowInsufficientCodPointsPopup( {
		neededCodPoints = f30_arg0,
		product = {
			id = 1234,
			currencyId = MOBILE_PURCHASE.CurrencyId.CodPoints
		}
	} )
end

MOBILE_PURCHASE.ShowInsufficientEventPointsPopup = function ( f27_arg0 )
	local f27_local0 = ONLINE_EVENTS.GetActiveEventCurrencyId( f27_arg0.controllerIndex ) == f27_arg0.product.prices[1].currencyId
	local f27_local1 = {
		typeOfPopup = PopupsUtils.typeOfPopup.POPUP_OK,
		action = function ( f29_arg0 )
			if f27_arg0.uri ~= nil then
				Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_insufficient_points_redirect", {
					purchased = 0,
					currency_id = f27_arg0,
					sku_id = f27_arg0.product.id,
					needed = f27_arg0.neededEventPoints
				} )
				Web[0x65BEA259C01824B]()
			end
		end,
		actionDisabled = not f27_local0,
		title = Engine[0xEB2A2834B76AEA4]( Engine[0xED84C33EC5F01EA]( 0x535F77D883DFA02 ) ),
		label = Engine[0xEB2A2834B76AEA4]( Engine[0xED84C33EC5F01EA]( 0x60DFB2C2E329F17 ) )
	}
	local f27_local2
	if f27_local0 then
		f27_local2 = Engine[0xED84C33EC5F01EA]( 0xEEDDB9C123F7474, f27_arg0.neededEventPoints, f27_arg0.currencyTitle )
		if not f27_local2 then
		
		else
			f27_local1.message = f27_local2
			f27_local1.customExitFunction = function ( f28_arg0, f28_arg1 )
				Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_insufficient_points_cancel", {
					currency_id = f27_arg0,
					sku_id = f27_arg0.product.id,
					needed = f27_arg0.neededEventPoints
				} )
				ACTIONS.LeaveMenu( f28_arg1 )
			end
			
			LUI.FlowManager.RequestPopupMenu( nil, "MobileGenericPopupWindow", true, f27_arg0.controllerIndex, false, f27_local1, nil, true, true )
		end
	end
	f27_local2 = Engine[0xED84C33EC5F01EA]( 0x223B9F4BFFA1EBD, f27_arg0.neededEventPoints, f27_arg0.currencyTitle )
end

MOBILE_PURCHASE.ShowInsufficientPointsPopupIfNeeded = function ( f25_arg0 )
	assert( f25_arg0.product )
	local f25_local0 = f25_arg0.product.price
	if f25_arg0.product.prices and f25_arg0.product.prices[1] then
		f25_local0 = f25_arg0.product.prices[1].price
	end
	if 1 < f25_arg0.quantity then
		f25_local0 = f25_local0 * f25_arg0.quantity
	end
	local f25_local1 = f25_arg0.currency.id
	local f25_local2 = Commerce[0xFCE51EA6B7B00CC]( f25_arg0.controllerIndex, f25_arg0.currency.id )
	local f25_local3 = f25_local0 - f25_local2
	if f25_local0 ~= nil and f25_local2 < f25_local0 then
		if f25_local1 == MOBILE_PURCHASE.CurrencyId.CodPoints then
			MOBILE_PURCHASE.ShowInsufficientCodPointsPopup( {
				neededCodPoints = f25_local3,
				controllerIndex = f25_arg0.controllerIndex,
				uri = f25_arg0.uri,
				product = f25_arg0.product,
				onCancel = f25_arg0.onCancel,
				onPurchased = function ()
					if f25_arg0.onPurchased then
						f25_arg0.onPurchased()
					end
					if f25_arg0.onComplete then
						f25_arg0.onComplete()
					end
				end
			} )
		else
			MOBILE_PURCHASE.ShowInsufficientEventPointsPopup( {
				neededEventPoints = f25_local3,
				currencyTitle = f25_arg0.currency.title,
				controllerIndex = f25_arg0.controllerIndex,
				uri = f25_arg0.uri,
				product = f25_arg0.product
			} )
		end
		if f25_arg0.onPrompt then
			f25_arg0.onPrompt( f25_local3 )
		end
	elseif f25_arg0.onComplete then
		f25_arg0.onComplete()
	end
end

MOBILE_PURCHASE.ShowPurchaseConfirmationPopup = function ( f22_arg0 )
	assert( f22_arg0.product )
	local f22_local0 = DataSources.frontEnd.commerce.purchaseIndex:GetValue( f22_arg0.controllerIndex )
	LUI.FlowManager.RequestPopupMenu( nil, "MobileGenericPopupWindow", true, f22_arg0.controllerIndex, false, {
		customExitFunction = function ( f24_arg0, f24_arg1 )
			Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_confirmation_closed", {
				purchase_index = f22_arg0,
				sku_id = f22_arg0.product.id,
				currency_id = f22_arg0.product.prices[1].currencyId
			} )
			ACTIONS.LeaveMenu( f24_arg1 )
		end,
		customContent = {
			type = "MobilePurchaseConfirmationPopupContent",
			product = f22_arg0.product,
			quantity = f22_arg0.quantity
		},
		menuPurchaseButton = f22_arg0.menuPurchaseButton,
		onComplete = function ( f23_arg0 )
			Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_confirmation_confirmed", {
				purchase_index = f22_arg0,
				sku_id = f22_arg0.product.id,
				currency_id = f22_arg0.product.prices[1].currencyId
			} )
			if f22_arg0.onComplete then
				f22_arg0.onComplete( f23_arg0 )
			end
		end,
		purchaseButtonContextIndex = f22_arg0.purchaseButtonContextIndex
	}, nil, true, true )
	local f22_local1 = "virtual_flow"
	if f22_arg0.wasInsufficient then
		f22_local1 = "insufficient_flow"
	end
	Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_confirmation_appeared", {
		purchase_index = f22_local0,
		sku_id = f22_arg0.product.id,
		currency_id = f22_arg0.product.prices[1].currencyId,
		context = f22_local1
	} )
end

MOBILE_PURCHASE.BattlePassPurchaseConfirmation = function ( f21_arg0 )
	assert( f21_arg0 )
	MOBILE_PURCHASE.ShowPurchaseConfirmationPopup( {
		product = f21_arg0.product,
		onComplete = f21_arg0.onComplete,
		controllerIndex = f21_arg0.controllerIndex
	} )
end

local f0_local2 = function ( f20_arg0, f20_arg1, f20_arg2, f20_arg3, f20_arg4 )
	Engine[0x15D98DF5F61904B]( 0, f20_arg0, {
		purchase_index = f20_arg1,
		sku_id = f20_arg2,
		currency_id = f20_arg3,
		context = f20_arg4
	} )
end

local f0_local3 = function ( f19_arg0, f19_arg1, f19_arg2, f19_arg3, f19_arg4, f19_arg5 )
	local f19_local0 = DataSources.frontEnd.commerce.purchaseIndex
	local f19_local1 = f19_local0
	f19_local0 = f19_local0.GetValue
	local f19_local2 = Engine[0xEE6F69FEA944B13]()
	f19_local0 = f19_local0( f19_local1, f19_local2:GetControllerIndex() )
	local f19_local3 = nil
	if f19_arg2 and f19_arg2[1] then
		f19_local3 = f19_arg2[1].id
	end
	f19_local1 = nil
	if f19_arg2 and f19_arg2[1] and f19_arg2[1].prices then
		f19_local1 = f19_arg2[1].prices[1].currencyId
	end
	Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_resumed", {
		purchase_index = f19_local0,
		sku_id = f19_local3,
		currency_id = f19_local1
	} )
	Engine[0x15D98DF5F61904B]( 0, f0_local0[f19_arg0], {
		context = "resumed_subflow",
		purchase_index = f19_local0,
		sku_id = f19_local3,
		currency_id = f19_local1
	} )
end

local f0_local4 = {}
local f0_local5 = function ( f18_arg0 )
	table.insert( f0_local0, f18_arg0 )
end

local f0_local6 = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3, f16_arg4, f16_arg5 )
	if f16_arg1 == Enum[0x9ACDAE76A5AA08D][0x69F4BAB3A4B9A01] then
		f0_local0( f16_arg0, f16_arg1, f16_arg2, f16_arg3, f16_arg4, f16_arg5 )
	end
	for f16_local3, f16_local4 in ipairs( f0_local0 ) do
		f16_local4( f16_arg0, f16_arg1, f16_arg2, f16_arg3, f16_arg4, f16_arg5 )
	end
	f0_local0 = {}
	if f16_arg0 == Enum[0x74490F48BEC8575][0x9FE06E3408E53D0] then
		BREADCRUMBS.SetPurchaseLootAsNew( f16_arg1, f16_arg2[1].items )
		for f16_local0 = 1, #f16_arg2 - 1, 1 do
			MOBILE_PURCHASE.ShowPurchaseCelebration( {
				product = f16_arg2[f16_local0],
				onTouch = MOBILE_PURCHASE.HandleCelebrationTouch,
				onProductLoad = MOBILE_PURCHASE.LoadCelebrationProduct
			} )
		end
		MOBILE_PURCHASE.ShowPurchaseCelebration( {
			product = f16_arg2[#f16_arg2],
			onClose = function ()
				local f17_local0 = LUI.FlowManager.GetVisibleMenu()
				f17_local0:processEvent( {
					name = "celebration_layer_closed",
					product = f16_arg0[#f16_arg0]
				} )
			end,
			onTouch = MOBILE_PURCHASE.HandleCelebrationTouch,
			onProductLoad = MOBILE_PURCHASE.LoadCelebrationProduct
		} )
	elseif f16_arg0 == Enum[0x74490F48BEC8575][0x7338946B42394F4] and f16_arg1 ~= Enum[0x9ACDAE76A5AA08D][0x69F4BAB3A4B9A01] then
		MOBILE_PURCHASE.ShowPurchaseErrorPopup( {
			message = f16_arg5,
			skus = f16_arg2
		} )
	end
end

MOBILE_PURCHASE.RegisterPurchaseUpdatedEvent = function ()
	if CONDITIONS.IsMobileCommerceEnabled() then
		local f14_local0 = Engine[0xEE6F69FEA944B13]()
		assert( f14_local0 ~= nil, "Root element is unavaulable, cannot add an event handler for commerce_transaction_updated" )
		if f14_local0 ~= nil then
			f14_local0:registerEventHandlerIfFree( "commerce_transaction_updated", function ( f15_arg0, f15_arg1 )
				f14_local0( f15_arg1.transactionStatus, MOBILE_PURCHASE.GetPurchaseContext(), f15_arg1.skus, f15_arg1.storeId, f15_arg1.errorCode, f15_arg1.errorMessage )
				return true
			end )
		end
	end
end

local f0_local7 = function ( f11_arg0 )
	assert( f11_arg0.product )
	local f11_local0 = f11_arg0.product.prices[1].storeId
	local f11_local1 = f11_arg0.product.prices[1].currencyId
	local f11_local2 = {
		f11_arg0.product.id
	}
	local f11_local3 = f11_arg0.product.prices[1].price == 0
	local f11_local4 = function ( f12_arg0 )
		Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_confirmed", {
			purchase_index = DataSources.frontEnd.commerce.purchaseIndex:GetValue( f11_arg0.controllerIndex ),
			sku_id = f11_arg0.product.id,
			currency_id = f11_arg0
		} )
		MOBILE_PURCHASE.ShowPurchaseInProgress( {
			sku = f11_arg0,
			currency = f11_arg0,
			isFree = f11_arg0,
			store = f11_arg0
		} )
		if f11_arg0.onPurchaseStart then
			f11_arg0.onPurchaseStart()
		end
		f11_arg0( function ( f13_arg0, f13_arg1, f13_arg2, f13_arg3, f13_arg4, f13_arg5 )
			if f13_arg4 ~= Enum[0x99746266406E9B5][0xE4C65AA61FAEC38][0x3E5E2D86833E126] then
				MOBILE_PURCHASE.ClosePurchaseInProgress( f12_arg0 )
			end
			local f13_local0 = {
				context = "purchase_subflow",
				purchase_index = f12_arg0,
				sku_id = f12_arg0.product.id,
				currency_id = f12_arg0.product.prices[1].currencyId
			}
			if not f12_arg0[f13_arg0] then
				MobileStoreUtils.LogError( "MobilePurchaseUtils MakePurchase is receiving an unknown transaction status: " .. tostring( f13_arg0 ) )
			else
				Engine[0x15D98DF5F61904B]( 0, f12_arg0[f13_arg0], f13_local0 )
			end
			if f13_arg0 == Enum[0x74490F48BEC8575][0xECB0755A82D8B1C] then
				if f12_arg0.onCancel then
					f12_arg0.onCancel()
				end
			elseif f13_arg0 == Enum[0x74490F48BEC8575][0x9FE06E3408E53D0] then
				if f12_arg0 == MOBILE_PURCHASE.CurrencyId.RealMoney then
					MainMenuMobileUtils.SetFirstPartyPurchaseCompleted( true )
				end
				if f12_arg0.onComplete then
					f12_arg0.onComplete( f13_arg0, f13_arg1, f13_arg2, f13_arg3 )
				end
			elseif f13_arg0 == Enum[0x74490F48BEC8575][0x2DEA0D6EEB5083C] then
				local f13_local1 = Engine[0xED84C33EC5F01EA]( 0xD5D3D1CD13035B9 )
				if not String.IsNilOrEmpty( f13_arg5 ) then
					f13_local1 = f13_arg5
				end
				if f13_arg4 ~= Enum[0x99746266406E9B5][0xE4C65AA61FAEC38][0x3E5E2D86833E126] then
					MOBILE_PURCHASE.ShowPurchaseErrorPopup( {
						title = Engine[0xED84C33EC5F01EA]( 0x795C22BE16B8B25 ),
						message = f13_local1
					} )
				end
				if f12_arg0.onPending then
					f12_arg0.onPending( f13_arg0, f13_arg1, f13_arg2, f13_arg3, f13_arg4, f13_arg5 )
				end
			elseif f12_arg0.onError then
				f12_arg0.onError( f13_arg0, f13_arg1, f13_arg2, f13_arg3, f13_arg4, f13_arg5 )
			end
			if f12_arg0 then
				ACTIONS.LeaveMenu( f12_arg0 )
			end
		end )
		Commerce[0x17A932905B381F0]( f11_arg0.product.id, f11_arg0.quantity or 1, f11_arg0, f11_arg0, f11_arg0.placement, f11_arg0.placementType, f11_arg0.controllerIndex )
	end
	
	if f11_local1 == MOBILE_PURCHASE.CurrencyId.RealMoney then
		f11_local4()
	else
		MOBILE_PURCHASE.ShowPurchaseConfirmationPopup( {
			product = f11_arg0.product,
			quantity = f11_arg0.quantity,
			onComplete = f11_local4,
			onCancel = f11_arg0.onCancel,
			controllerIndex = f11_arg0.controllerIndex,
			wasInsufficient = f11_arg0.wasInsufficient
		} )
	end
end

MOBILE_PURCHASE.MakePurchase = function ( f6_arg0 )
	assert( f6_arg0.product )
	f6_arg0.quantity = f6_arg0.quantity or 1
	local f6_local0 = nil
	if f6_arg0.product.prices and f6_arg0.product.prices[1] then
		local f6_local1 = f6_arg0.product.prices[1]
		if f6_local1.currencyId then
			f6_local0 = f6_local1.currencyId
		elseif f6_local1.currency and f6_local1.currency.id then
			f6_local0 = f6_local1.currency.id
		end
	end
	assert( f6_local0 )
	local f6_local1 = DataSources.frontEnd.commerce.purchaseIndex:GetValue( f6_arg0.controllerIndex )
	local f6_local2 = DataSources.frontEnd.commerce.purchaseIndexSku:GetValue( f6_arg0.controllerIndex )
	if f6_arg0.product.id ~= nil then
		if f6_local2 == f6_arg0.product.id then
			DataSources.frontEnd.commerce.purchaseIndex:SetValue( f6_arg0.controllerIndex, f6_local1 + 1 )
		else
			DataSources.frontEnd.commerce.purchaseIndex:SetValue( f6_arg0.controllerIndex, 1 )
			DataSources.frontEnd.commerce.purchaseIndexSku:SetValue( f6_arg0.controllerIndex, f6_arg0.product.id )
		end
	end
	Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_purchase_started", {
		purchase_index = DataSources.frontEnd.commerce.purchaseIndex:GetValue( f6_arg0.controllerIndex ),
		sku_id = f6_arg0.product.id,
		currency_id = f6_local0
	} )
	local f6_local3 = function ()
		f6_arg0( f6_arg0 )
	end
	
	local f6_local4 = MobileStoreUtils.DataUtils.GetCurrency( f6_local0, f6_arg0.controllerIndex )
	if f6_local4 and f6_local4.isVirtual then
		MOBILE_PURCHASE.ShowInsufficientPointsPopupIfNeeded( {
			product = f6_arg0.product,
			quantity = f6_arg0.quantity,
			currency = f6_local4,
			onComplete = f6_local3,
			onCancel = function ( f8_arg0 )
				Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_insufficient_points_cancel", {
					needed = f8_arg0,
					currency_id = f6_arg0,
					sku_id = f6_arg0.product.id
				} )
				f6_arg0.onCancel()
			end,
			controllerIndex = f6_arg0.controllerIndex,
			uri = f6_local4.insufficientURI,
			onPrompt = function ( f9_arg0 )
				Engine[0x15D98DF5F61904B]( 0, "dlog_event_fe_commerce_insufficient_points_prompt", {
					needed = f9_arg0,
					currency_id = f6_arg0,
					sku_id = f6_arg0.product.id
				} )
			end,
			onPurchased = function ()
				f6_arg0.wasInsufficient = true
			end
		} )
	else
		f6_local3()
	end
end

MOBILE_PURCHASE.ShowPurchaseErrorPopup = function ( f4_arg0 )
	local f4_local0 = ""
	local f4_local1 = ""
	local f4_local2 = String.IsNilOrEmpty( f4_arg0.message ) and Engine[0xED84C33EC5F01EA]( 0x8282094FF8701C7 ) or f4_arg0.message
	if f4_arg0.skus and f4_arg0.skus[1] then
		f4_local0 = Engine[0xED84C33EC5F01EA]( 0x4739EBD7004178E, f4_arg0.skus[1].title, f4_local2 )
	else
		f4_local0 = f4_local2
	end
	local f4_local3 = {}
	local f4_local4 = f4_arg0.title
	if not f4_local4 then
		f4_local4 = Engine[0xEB2A2834B76AEA4]( Engine[0xED84C33EC5F01EA]( 0x931106BC5C7946 ) )
	end
	f4_local3.title = f4_local4
	f4_local3.message = f4_local0
	f4_local4 = f4_arg0.label
	if not f4_local4 then
		f4_local4 = Engine[0xEB2A2834B76AEA4]( Engine[0xED84C33EC5F01EA]( 0x1B38A071E843C6D ) )
	end
	f4_local3.label = f4_local4
	f4_local3.action = f4_arg0.action or function ( f5_arg0 )
		ACTIONS.LeaveMenu( f5_arg0 )
	end
	
	f4_local3.typeOfPopup = PopupsUtils.typeOfPopup.POPUP_OK
	LUI.FlowManager.RequestPopupMenu( nil, "MobileGenericPopupWindow", true, f4_arg0.controllerIndex, false, f4_local3, nil, true, true )
end

MOBILE_PURCHASE.PendingPurchaseTimeout = function ( f1_arg0, f1_arg1 )
	local f1_local0 = Dvar[0x22EAAB59AA27E9B]( 0xEC82F47B8BFA66A )
	if not f1_local0 or f1_local0 <= 0 then
		
	end
	local f1_local1 = f1_arg0:Wait( f1_local0 )
	f1_local1.onComplete = function ()
		ACTIONS.AnimateSequence( f1_arg0, "Timeout" )
		local f2_local0 = f1_arg0.MobilePurchaseInProgressContentsTimeout.CloseButton
		local f2_local1 = f2_local0
		f2_local0 = f2_local0.addEventHandler
		f2_local0( f2_local1, "button_action", function ()
			MOBILE_PURCHASE.ClosePurchaseInProgress( Table.Merge( f2_local0, {
				was_timeout = true
			} ) )
			f2_local0( Enum[0x74490F48BEC8575][0x2DEA0D6EEB5083C], MOBILE_PURCHASE.GetPurchaseContext(), f2_local0.skus, f2_local0.store, Enum[0x99746266406E9B5][0xE4C65AA61FAEC38][0x3E5E2D86833E126], Engine[0xED84C33EC5F01EA]( 0xD24EED2D5F61F53 ) )
		end )
	end
	
end

