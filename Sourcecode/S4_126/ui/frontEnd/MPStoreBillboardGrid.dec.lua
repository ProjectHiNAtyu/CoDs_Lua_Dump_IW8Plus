-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
require( "ui.frontEnd.StoreBillboardItem" )
require( "ui.frontEnd.MPStoreBillboardGridRow" )
require( "ui.widgets.VerticalScrollbar" )
require( "ui.frontEnd.NoMoreItemsMessage" )
require( "ui.frontEnd.EventBanner" )
require( "ui.frontEnd.SupportingCreatorCode" )
require( "ui.widgets.ButtonPromptContainer" )
local f0_local0 = 3000
local f0_local1 = function ( f50_arg0, f50_arg1, f50_arg2 )
	local f50_local0 = {}
	local f50_local1 = f50_arg2.items[1] or {}
	local f50_local2 = Dvar[0x9E5BE3B4BBA4E0E]( "#x3e18487f3c2aa939a" ) and f50_arg2.itemIDsString
	local f50_local3 = true
	local f50_local4 = ""
	if f50_arg2.isFirstPartyCategory then
		table.insert( f50_local0, {
			asset = "v_ui_bg_generic",
			name = "STORE/FETCHING_STORE_DATA",
			buttonAction = function ()
				
			end
		} )
		if f50_arg0._storeSchedule then
			f50_local4 = STORE.GetScheduledProductsForCategory( f50_arg2, f50_arg0._storeSchedule )
		end
	elseif not (not f50_arg2.idPubVar or not f50_local1.layoutOnlyItem) or f50_local2 then
		if not Dvar[0x9E5BE3B4BBA4E0E]( "#x3256f9a703f3494a7" ) then
			if f50_arg0._storeSchedule then
				f50_local4 = STORE.GetScheduledProductsForCategory( f50_arg2, f50_arg0._storeSchedule )
			end
			local f50_local5 = ""
			if f50_arg2.justForYou and f50_arg0._recommendations then
				f50_arg0.recommendationData = {
					items = f50_arg0._recommendations,
					isEnabled = true
				}
				f50_local5 = f50_arg0._recommendations
			elseif f50_arg2.commsLocationId then
				f50_local5 = Store.GetAdditionalCategoryItems( f50_arg2.commsLocationId )
				if f50_local5 then
					f50_local5 = table.concat( STORE.TrimRecommendationsByBlacklistedItems( split( f50_local5, "," ) ), "," )
				end
			end
			f50_local4 = STORE.FormatRecommendationItems( f50_local4 .. "," .. f50_local5 )
		end
		if f50_arg2.idPubVar and (not f50_local4 or f50_local4 == "") then
			f50_local4 = STORE.FormatRecommendationItems( f50_local4 .. "," .. (Dvar[0x54084D7CA2317BB]( f50_arg2.idPubVar ) or "") )
		end
		if STORE.CategoryType[f50_arg2.id] == STORE.CategoryType.featured and STORE.ShouldModifyFeaturedItems( f50_arg1 ) then
			f50_local4 = STORE.GetPriorityFeaturedItems() .. "," .. f50_local4
		end
		if f50_local2 then
			f50_local4 = f50_arg2.itemIDsString
		end
	end
	local f50_local5 = split( f50_local4, "," )
	local f50_local6 = 0
	f50_arg2.hasFirstPartyBundle = false
	for f50_local7 = 1, #f50_local5, 1 do
		local f50_local10 = tonumber( f50_local5[f50_local7] )
		if STORE.BundleAvailable( f50_arg1, f50_local10, f50_local3 ) or STORE.BundleForceAvailable( f50_arg1, f50_local10 ) then
			local f50_local11 = LUI.DeepCopy( f50_local1 )
			f50_local11.emptyCategory = false
			f50_local11.id = f50_local10
			local f50_local12 = {
				file = CSV.bundleIDs.file,
				cols = CSV.bundleIDs.cols
			}
			local f50_local13 = StringTable[0x8073B436CDE1BF]( CSV.bundleIDs.file, CSV.bundleIDs.cols.id, f50_local5[f50_local7] )
			if f50_local13 ~= -1 then
				local f50_local14 = CSV.ReadRow( f50_local12, f50_local13 )
				f50_local11.name = f50_local14.name
				f50_local11.asset = f50_local14.image
				f50_local11.description = STORE.GetBundleDescription( f50_local11.id )
				f50_local11.rarity = f50_local14.rarity
				f50_local11.bundleType = f50_local14.bundleType
				f50_local11.titleImage = f50_local14.titleImage
				f50_local11.currencyID = tonumber( f50_local14.currencyID )
				f50_local11.currencyAmount = tonumber( f50_local14.currencyAmount )
				local f50_local15
				if 0 < #f50_local14.firstPartyProductID then
					f50_local15 = f50_local14.firstPartyProductID
					if not f50_local15 then
					
					else
						f50_local11.firstPartyProductID = f50_local15
						f50_local11.purchaseEnd = f50_arg2.endDate or nil
						if 0 < #f50_local14.video then
							f50_local15 = f50_local14.video
							if not f50_local15 then
							
							else
								f50_local11.video = f50_local15
								if f50_local10 == tonumber( BATTLEPASS.GetTierSkipGiftID() ) and BATTLEPASS.IsTierSkipGiftActive( f50_arg1 ) then
									f50_local11.purchaseEnd = BATTLEPASS.GetTierSkipGiftTimer()
								end
								f50_local15, f50_local16, f50_local17 = STORE.GetCategoryTimeLeft( nil, f50_local11.purchaseEnd )
								if not f50_local11.purchaseEnd or 0 < f50_local15 then
									table.insert( f50_local0, f50_local11 )
									f50_local6 = f50_local6 + 1
								end
								if f50_local11.firstPartyProductID then
									f50_arg2.hasFirstPartyBundle = true
								end
							end
						end
						f50_local15 = nil
					end
				end
				f50_local15 = nil
			end
		end
		if f50_local6 == f50_arg2.numItemsShown then
			break
		end
	end
	if #f50_local0 == 0 then
		local f50_local7 = LUI.DeepCopy( f50_local1 )
		f50_local7.emptyCategory = true
		f50_local7.titleImage = nil
		f50_local7.purchaseEnd = nil
		f50_local7.asset = "v_ui_bg_generic"
		f50_local7.name = "LUA_MENU/EMPTY"
		table.insert( f50_local0, f50_local7 )
	end
	f50_arg2.items = f50_local0
end

local f0_local2 = function ( f49_arg0, f49_arg1 )
	local f49_local0 = {
		controllerIndex = f49_arg1
	}
	local f49_local1 = LUI.FlowManager.GetPerControllerPersistentData( f49_arg0._controllerIndex )
	f49_local1.creatorCodePopupActive = true
	LUI.FlowManager.RequestPopupMenu( f49_arg0, "CreatorCodePopup", true, f49_arg1, false, f49_local0 )
end

local f0_local3 = function ( f48_arg0, f48_arg1, f48_arg2 )
	local f48_local0, f48_local1 = STORE.BundleAvailable( f48_arg0._controllerIndex, f48_arg1 )
	if f48_local0 then
		local f48_local2 = STORE.GetBundle( f48_arg1 )
		if f48_local2 then
			local f48_local3 = {
				startPurchaseImmediately = false,
				bundleID = tonumber( f48_local2.id ),
				rarity = f48_local2.rarity,
				description = f48_local2.description,
				bundleType = f48_local2.bundleType,
				titleImage = f48_local2.titleImage,
				currencyID = tonumber( f48_local2.currencyID ),
				currencyAmount = tonumber( f48_local2.currencyAmount ),
				timerValue = f48_local2.purchaseEnd
			}
			local f48_local4 = LUI.FlowManager.GetPerControllerPersistentData( f48_arg0._controllerIndex )
			f48_local4.storeBundlePreview = true
			LUI.FlowManager.RequestAddMenu( "StoreBundlePreview", true, f48_arg0._controllerIndex, false, f48_local3, false, false )
			local f48_local5, f48_local6 = STORE.GetIndexForBundle( f48_arg1, f48_arg0._controllerIndex )
			if f48_local5 and f48_local6 and f48_arg0.BundlesGrid then
				local f48_local7 = f48_arg0._allCategoryData[f48_local5]
				local f48_local8 = LUI.FlowManager.GetPerControllerPersistentData( f48_arg0._controllerIndex )
				f48_arg0._selectedCategory = f48_local5
				f48_local8._selectedCategory = f48_local7.categoryIndex
				f48_arg0._selectedBundle = f48_local6
				f48_arg0.BundlesGrid:SetFocusedPosition( {
					x = 0,
					y = f48_local5 - 1
				}, true )
			end
		else
			LUI.FlowManager.RequestPopupMenu( f48_arg0, "MessagePopup", true, f48_arg0._controllerIndex, false, {
				messageText = Engine[0xED84C33EC5F01EA]( "LUA_MENU/BUNDLE_NOT_AVAILABLE" )
			} )
		end
	elseif f48_local1 and f48_local1 == STORE.BundleUnavailableReason.BUNDLE_OWNED then
		LUI.FlowManager.RequestPopupMenu( f48_arg0, "MessagePopup", true, f48_arg0._controllerIndex, false, {
			messageText = Engine[0xED84C33EC5F01EA]( "LUA_MENU_MP/ALREADY_OWN_ITEM" )
		} )
	else
		LUI.FlowManager.RequestPopupMenu( f48_arg0, "MessagePopup", true, f48_arg0._controllerIndex, false, {
			messageText = Engine[0xED84C33EC5F01EA]( "LUA_MENU/BUNDLE_NOT_AVAILABLE" )
		} )
	end
end

local f0_local4 = function ( f47_arg0, f47_arg1 )
	local f47_local0 = STORE.GetCategoryIndex( f47_arg1 )
	if f47_local0 and f47_arg0.BundlesGrid then
		local f47_local1 = LUI.FlowManager.GetPerControllerPersistentData( f47_arg0._controllerIndex )
		local f47_local2 = f47_arg0._allCategoryData[f47_local0]
		if f47_local2 then
			f47_arg0._selectedCategory = f47_local0
			f47_local1._selectedCategory = f47_local2.categoryIndex
			f47_arg0.BundlesGrid:SetFocusedPosition( {
				x = 0,
				y = f47_local0 - 1
			}, true )
		else
			f47_arg0._selectedCategory = 1
			f47_local1._selectedCategory = 1
			f47_arg0.BundlesGrid:SetFocusedPosition( {
				x = 0,
				y = 0
			}, true )
		end
	end
end

local f0_local5 = function ( f46_arg0, f46_arg1, f46_arg2, f46_arg3 )
	local f46_local0 = f46_arg0._selectedBundle or 1
	local f46_local1 = f46_arg3.items[f46_local0]
	local f46_local2 = f46_local1.id
	if f46_local1.emptyCategory then
		f46_arg0._startPurchaseImmediately = false
		return 
	end
	local f46_local3 = LUI.FlowManager.GetScopedData( f46_arg0 )
	f46_local3.selectedBundleIndex = f46_local0
	if f46_arg3.isFirstPartyCategory then
		f46_local3.firstPartyColumnIndex = f46_local0
		if f46_arg0._catalogStatus == InGameStoreCatalogStatus.ERROR then
			LUI.FlowManager.RequestPopupMenu( nil, "ErrorNoticePopup", false, f46_arg0._controllerIndex, false, {
				message = f46_arg0._catalogFetchErrorMessage
			}, nil, false, true )
			return 
		elseif f46_local1.buttonAction then
			f46_arg0._startPurchaseImmediately = false
			f46_local1.buttonAction( f46_arg1, f46_arg2 )
			return 
		end
	else
		f46_local3.firstPartyColumnIndex = nil
	end
	QUARTERMASTER.CoalesceBrowseData()
	QUARTERMASTER.RecordMenuBrowseEvent( f46_arg0._controllerIndex, true )
	if f46_local1.firstPartyProductID then
		local f46_local4 = f46_local1.firstPartyProductID
		if Dvar[0x9E5BE3B4BBA4E0E]( "#x34caead4968e9e6e" ) and STORE.IsGameUpsellBundle( f46_local2 ) then
			local f46_local5 = LUI.FlowManager.GetPerControllerPersistentData( f46_arg0._controllerIndex )
			f46_local5.gameUpsellPopupActive = true
			LUI.FlowManager.RequestPopupMenu( f46_arg0, "StoreGameUpsellPopup", true, f46_arg0._controllerIndex, false, {
				defaultProductId = f46_local4
			} )
		elseif f46_arg0._catalogStatus == InGameStoreCatalogStatus.READY then
			if 0 < STORE.GetNumItemsInBundle( f46_local2 ) then
				local f46_local6 = LUI.FlowManager.GetPerControllerPersistentData( f46_arg0._controllerIndex )
				f46_local6.storeBundlePreview = true
				LUI.FlowManager.RequestAddMenu( "StoreBundlePreview", true, f46_arg0._controllerIndex, false, STORE.GetFirstPartyBundleData( f46_arg0._controllerIndex, f46_local2, f46_local4 ), false, true )
			else
				local f46_local6 = LUI.FlowManager.GetPerControllerPersistentData( f46_arg0._controllerIndex )
				f46_local6.storeGameUpsell = true
				LUI.FlowManager.RequestPopupMenu( nil, "StoreGameUpsellPopup", true, controllerIndex, false, {
					defaultProductId = f46_local4
				} )
			end
		else
			LUI.FlowManager.RequestPopupMenu( nil, "ErrorNoticePopup", false, f46_arg0._controllerIndex, false, {
				message = f46_arg0._catalogFetchErrorMessage
			}, nil, false, true )
		end
		return 
	end
	local f46_local4 = {
		bundleID = f46_local1.id,
		rarity = f46_local1.rarity,
		description = f46_local1.description,
		bundleType = f46_local1.bundleType,
		titleImage = f46_local1.titleImage,
		currencyID = f46_local1.currencyID,
		currencyAmount = f46_local1.currencyAmount,
		startPurchaseImmediately = f46_arg0._startPurchaseImmediately,
		timerValue = f46_local1.purchaseEnd
	}
	f46_arg0._startPurchaseImmediately = false
	if not f46_arg3.justForYou then
		f46_local4.timerPubVar = f46_arg3.timerPubVar
	end
	local f46_local7 = true
	if f46_local4.startPurchaseImmediately then
		f46_local7 = false
	end
	if StringTable[0x2DCF0973239E909]( CSV.bundleIDs.file, CSV.bundleIDs.cols.id, f46_local4.bundleID, CSV.bundleIDs.cols.isBattlePassBundle ) == "1" then
		f46_arg0:dispatchEventToRoot( {
			name = "show_battlepass_bundle",
			immediate = true,
			controller = f46_arg0._controllerIndex
		} )
	else
		if f46_local1.video and 0 < #f46_local1.video then
			f46_arg0:dispatchEventToParent( {
				name = "override_stop_video"
			} )
		end
		local f46_local6 = LUI.FlowManager.GetPerControllerPersistentData( f46_arg0._controllerIndex )
		f46_local6.storeBundlePreview = true
		LUI.FlowManager.RequestAddMenu( "StoreBundlePreview", true, f46_arg0._controllerIndex, false, f46_local4, false, f46_local7 )
	end
end

local f0_local6 = function ( f43_arg0, f43_arg1 )
	local f43_local0 = {
		{
			name = "INGAMESTORE/CATEGORY_CODPOINTS",
			titleImage = "mw_store_title_cod_points",
			asset = "mw_store_billboard_cod_points",
			id = STORE.CODPointsCategory
		},
		{
			name = "LUA_MENU/CWL_MODES",
			titleImage = "mw_store_title_cdl",
			asset = "mw_store_billboard_cdl",
			id = STORE.CDLCategory
		},
		{
			name = "LUA_MENU_MP/COD_ENDOWMENT",
			titleImage = "mw_store_title_code",
			asset = "mw_store_billboard_code",
			id = STORE.MiscCategory
		},
		{
			name = "INGAMESTORE/PRODUCT_MW2R",
			titleImage = "mw_store_title_ghost_pack_oil_rig",
			asset = "mw_store_billboard_ghost_pack_oil_rig",
			id = STORE.TitlesCategory
		},
		{
			id = 4294967295,
			name = "STORE/STORE_CAT_FRANCHISE",
			titleImage = "mw_store_title_franchise_store",
			asset = "v_ui_billboard_franchise_store"
		}
	}
	local f43_local1 = {}
	if f43_arg0._allCategoryData and f43_arg0._allCategoryData[#f43_arg0._allCategoryData] and 0 < #f43_arg0._allCategoryData[#f43_arg0._allCategoryData].items then
		f43_local1 = f43_arg0._allCategoryData[#f43_arg0._allCategoryData].items
		table.remove( f43_local1, 1 )
	end
	f43_arg0._allCategoryData[#f43_arg0._allCategoryData].items = {}
	for f43_local2 = 1, #f43_local0, 1 do
		local f43_local5 = f43_local0[f43_local2]
		local f43_local6 = nil
		if f43_local5.id == -1 then
			f43_local6 = {
				isDefaultFirstPartyItem = true,
				asset = f43_local5.asset,
				name = f43_local5.name,
				titleImage = f43_local5.titleImage,
				buttonAction = function ( f45_arg0, f45_arg1 )
					local f45_local0 = STORE.GoToStore
					local f45_local1 = f43_arg0
					local f45_local2 = f43_arg0:GetCurrentMenu()
					f45_local0( f45_local1, f45_local2.id, f45_arg0.id )
				end
			}
		else
			local f43_local7 = InGameStore.GetCategoryProducts( f43_arg1, f43_local5.id )
			if f43_local7 and 0 < #f43_local7 then
				local f43_local8 = f43_local5.id == STORE.MiscCategory
				local f43_local9 = f43_local5.id == STORE.TitlesCategory
				local f43_local10 = false
				local f43_local11 = false
				if f43_local8 then
					for f43_local12 = 1, #f43_local7, 1 do
						if f43_local7[f43_local12].productId == STORE.CODEID then
							f43_local10 = true
							break
						end
					end
				end
				if f43_local9 then
					for f43_local12 = 1, #f43_local7, 1 do
						if f43_local7[f43_local12].productId == STORE.MW2RProductID then
							local f43_local15 = InGameStore.GetProduct( f43_arg1, STORE.MW2RProductID )
							local f43_local16
							if f43_local15 then
							
							else
								f43_local16 = f43_local15.status ~= InGameStoreProductStatus.NOT_OWNED
							end
							f43_local16 = f43_local15
						end
					end
				end
				local f43_local12
				if f43_local9 then
					f43_local12 = f43_local9
				else
					f43_local12 = f43_local11
				end
				local f43_local13
				if f43_local8 then
					f43_local13 = f43_local8
				else
					f43_local13 = f43_local10
				end
				if not (f43_local9 or f43_local8) or f43_local12 or f43_local13 then
					local f43_local14 = {
						asset = f43_local5.asset,
						name = f43_local5.name,
						titleImage = f43_local5.titleImage,
						buttonAction = function ( f44_arg0, f44_arg1 )
							local f44_local0 = STORE.GoToStore
							local f44_local1 = f43_arg0
							local f44_local2 = f43_arg0:GetCurrentMenu()
							f44_local0( f44_local1, f44_local2.id, f44_arg0.id, f43_arg0[1].productId )
						end
					}
				end
			end
		end
		if f43_local6 then
			table.insert( f43_arg0._allCategoryData[#f43_arg0._allCategoryData].items, f43_local6 )
		end
	end
	for f43_local2 = 1, #f43_local1, 1 do
		table.insert( f43_arg0._allCategoryData[#f43_arg0._allCategoryData].items, f43_local1[f43_local2] )
	end
	f43_arg0:dispatchEventToChildren( {
		name = "categoryTimerUpdate"
	} )
	if f43_arg0._allCategoryData[#f43_arg0._allCategoryData].isFirstPartyCategory and f43_arg0._selectedCategory == f43_arg0._allCategoryData[#f43_arg0._allCategoryData].categoryIndex then
		local f43_local2 = f43_arg0.BundlesGrid:GetElementAtPosition( 0, f43_arg0._selectedCategory - 1 )
		if f43_local2 then
			local f43_local3 = LUI.FlowManager.GetScopedData( f43_arg0 )
			local f43_local4 = f43_local2.RowGrid
			if not f43_local3.firstPartyColumnIndex or f43_local3.firstPartyColumnIndex == 1 then
				local f43_local17 = f43_local4:GetElementAtPosition( 0, 0 )
				f43_local17:processEvent( {
					name = "button_over"
				} )
			else
				f43_local4:SetFocusedPosition( {
					y = 0,
					x = f43_local3.firstPartyColumnIndex - 1
				}, true )
			end
		end
	end
end

local f0_local7 = function ( f41_arg0, f41_arg1 )
	InGameStore.FetchCatalog( f41_arg1, true, true )
	f41_arg0._catalogStatus = InGameStore.GetCatalogStatus( f41_arg1 )
	f41_arg0._catalogFetchErrorMessage = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE" )
	
	local _refreshTimer = LUI.UITimer.new( {
		interval = -28,
		event = {
			name = "refresh_timer",
			controllerIndex = f41_arg1
		}
	} )
	_refreshTimer.id = "refreshTimer"
	f41_arg0:addElement( _refreshTimer )
	f41_arg0._refreshTimer = _refreshTimer
	
	f41_arg0:registerEventHandler( "refresh_timer", function ( element, event )
		local f42_local0 = InGameStore.GetCatalogStatus( event.controllerIndex )
		local f42_local1 = false
		if f41_arg0._catalogStatus == InGameStoreCatalogStatus.FETCHING and f42_local0 == InGameStoreCatalogStatus.READY then
			f41_arg0:dispatchEventToChildren( {
				catalogFetched = true,
				name = "categoryTimerUpdate"
			} )
		end
		f41_arg0._catalogStatus = f42_local0
		if f41_arg0._catalogStatus == InGameStoreCatalogStatus.READY then
			if CONDITIONS.IsFranchiseStoreEnabled() then
				f41_arg0( f41_arg0, f41_arg0 )
			end
			if f41_arg0._originalCategoryData then
				local f42_local2 = {}
				local f42_local3 = false
				for f42_local4 = 1, #f41_arg0._originalCategoryData, 1 do
					local f42_local7 = f41_arg0._originalCategoryData[f42_local4]
					f42_local7.showingCatalog = f41_arg0._catalogStatus == InGameStoreCatalogStatus.READY
					local f42_local8
					if 0 < #f42_local7.items then
						f42_local8 = not f42_local7.items[1].emptyCategory
					else
						f42_local8 = true
					end
					if not f42_local8 then
						f41_arg0( f41_arg0, f41_arg0, f42_local7 )
						if 0 < #f42_local7.items then
							f42_local8 = not f42_local7.items[1].emptyCategory
						else
							f42_local8 = true
						end
						if f42_local8 then
							f42_local3 = true
						end
					end
					if f42_local8 then
						table.insert( f42_local2, f42_local7 )
					end
				end
				if f42_local3 then
					f41_arg0._allCategoryData = f42_local2
					for f42_local9, f42_local7 in ipairs( f41_arg0._allCategoryData ) do
						f42_local7.categoryIndex = f42_local9
					end
					f41_arg0.BundlesGrid:SetNumRows( #f41_arg0._allCategoryData )
					f41_arg0.BundlesGrid:RefreshContent()
					f41_arg0:dispatchEventToChildren( {
						catalogFetched = true,
						name = "categoryTimerUpdate"
					} )
				end
			end
			f42_local1 = true
		elseif f41_arg0._catalogStatus == InGameStoreCatalogStatus.ERROR then
			f42_local1 = true
			if Engine[0x5575DCFF312365A]() then
				local f42_local2 = Engine[0xF47248634BEA927]()
				if f42_local2 ~= nil then
					f41_arg0._catalogFetchErrorMessage = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE_ERROR", Engine[0x7D3158A9539A355]( f42_local2 ) )
					Engine[0x2B86472F39BE88]()
				else
					f41_arg0._catalogFetchErrorMessage = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE_PC" )
				end
			else
				f41_arg0._catalogFetchErrorMessage = Engine[0xED84C33EC5F01EA]( "MP_FRONTEND_ONLY/STORE_UNAVAILABLE" )
			end
			local f42_local2 = LUI.FlowManager.GetScopedData( element )
			if f42_local2.useStandaloneStore then
				LUI.FlowManager.RequestLeaveMenu( element )
			else
				local f42_local4
				if LUI.IsLastInputMouseNavigation( f41_arg0 ) then
					f42_local4 = FocusType.MouseOver
					if not f42_local4 then
					
					else
						local f42_local5 = f41_arg0:GetCurrentMenu()
						f42_local5.MPTabsMenu.Tabs:FocusTab( event.controller or f41_arg0, 0, f42_local4 )
					end
				end
				f42_local4 = FocusType.Gamepad
			end
			LUI.FlowManager.RequestPopupMenu( nil, "PopupConfirm", false, f41_arg0._controllerIndex, false, {
				messageText = f41_arg0._catalogFetchErrorMessage,
				label = Engine[0xED84C33EC5F01EA]( "LUA_MENU/OK" ),
				headerText = Engine[0xED84C33EC5F01EA]( "MENU/NOTICE" ),
				controllerIndex = f41_arg0._controllerIndex
			}, nil, false, true )
			Engine[0x74CAD26749A8415]()
			if Commerce[0x38D9AC0641AEF71]() then
				f41_arg0( f41_arg0, f41_arg0 )
			else
				f41_arg0._allCategoryData[#f41_arg0._allCategoryData].items[1].fetchingDataFailed = true
				f41_arg0:dispatchEventToChildren( {
					name = "categoryTimerUpdate"
				} )
			end
		end
		if f42_local1 then
			element._refreshTimer:closeTree()
			element._refreshTimer = nil
		end
	end )
end

local f0_local8 = function ( f40_arg0 )
	local f40_local0 = {}
	if 1 < f40_arg0._selectedCategory then
		table.insert( f40_local0, f40_arg0._allCategoryData[f40_arg0._selectedCategory - 1] )
	end
	if f40_arg0._selectedCategory < #f40_arg0._allCategoryData then
		table.insert( f40_local0, f40_arg0._allCategoryData[f40_arg0._selectedCategory + 1] )
	end
	for f40_local1 = 1, #f40_local0, 1 do
		local f40_local4 = f40_local0[f40_local1]
		f40_local4.hasNewItems = false
		for f40_local5 = 1, #f40_local4.items, 1 do
			local f40_local8 = f40_local4.items[f40_local5]
			if f40_local8.id and not STORE.HasSeenItem( f40_arg0._controllerIndex, f40_local8.id ) then
				f40_local4.hasNewItems = true
			end
		end
	end
end

local f0_local9 = function ( f8_arg0, f8_arg1, f8_arg2 )
	f8_arg0.BillboardCategoryButtonAction = f0_local0
	f8_arg0._gridChildMouseFocusCount = 0
	f8_arg0.FocusBundleByID = function ( f39_arg0, f39_arg1, f39_arg2 )
		f8_arg0( f8_arg0, f39_arg1, f39_arg2 )
	end
	
	f8_arg0.FocusButtonByName = function ( f38_arg0, f38_arg1 )
		f8_arg0( f8_arg0, f38_arg1 )
	end
	
	ACTIONS.ScaleFullscreen( f8_arg0.Background )
	Engine[0x685AE31DEDA30A4]( "quartermaster" )
	f8_arg0.BundlesGrid:SetMask( f8_arg0.GridMask )
	f8_arg0.BundlesGrid:SetSnapOnScrollBarMouseDrag( true )
	f8_arg0._controllerIndex = f8_arg1
	f8_arg0._promotedItems = STORE.ParsePromotedItems( f8_arg1 )
	local f8_local0 = LUI.FlowManager.GetScopedData( f8_arg0 )
	f8_local0.controllerIndex = f8_arg1
	f0_local0( f8_arg0, f8_arg1 )
	if QUARTERMASTER.itemData then
		QUARTERMASTER.itemData = {}
	end
	f8_arg0.BackButtonOverride = function ( f37_arg0, f37_arg1 )
		local f37_local0 = LUI.FlowManager.GetScopedData( f37_arg0 )
		local f37_local1 = LUI.FlowManager.GetPerControllerPersistentData( f8_arg0 )
		f37_local1._selectedCategory = nil
		if f37_local0.useStandaloneStore then
			LUI.FlowManager.RequestLeaveMenu( f37_arg0 )
		else
			local f37_local2
			if f37_arg1.qualifier == "keyboard" or f37_arg1.qualifier == "gamepad" then
				f37_local2 = false
			else
				f37_local2 = true
			end
			local f37_local3
			if f37_local2 then
				f37_local3 = FocusType.MouseOver
				if not f37_local3 then
				
				else
					local f37_local4 = f37_arg0:getParent()
					f37_local4.Tabs:FocusTab( f37_arg1.controller or f8_arg0, 0, f37_local3 )
				end
			end
			f37_local3 = FocusType.Gamepad
		end
		return false
	end
	
	local f8_local1 = function ( f36_arg0, f36_arg1, f36_arg2, f36_arg3 )
		local f36_local0 = LUI.FlowManager.GetPerControllerPersistentData( f8_arg0 )
		if f8_arg0.DisableAutoScrollTimer and not f8_arg0._autoScroll then
			f8_arg0.DisableAutoScrollTimer()
		end
		if #f36_arg2.items < f36_arg3 then
			f36_arg3 = 1
		end
		local f36_local1 = f36_arg2.items[f36_arg3]
		if f36_local1.purchaseEnd then
			local f36_local2, f36_local3, f36_local4 = STORE.GetCategoryTimeLeft( nil, f36_local1.purchaseEnd )
			if f36_local2 <= 0 then
				f8_arg0:dispatchEventToChildren( {
					expiredBundle = true,
					name = "categoryTimerUpdate"
				} )
				return 
			end
		end
		if f36_local1.id then
			STORE.MarkItemSeen( f8_arg0, f36_local1.id )
			f8_arg0.BundlesGrid:RefreshContent()
			local f36_local2 = f8_arg0:GetCurrentMenu( f8_arg0 )
			if f36_local2.MPTabsMenu and f36_local2.MPTabsMenu.UpdateTabBreadcrumbs then
				f36_local2.MPTabsMenu:UpdateTabBreadcrumbs( f8_arg0._controllerIndex )
			end
		end
		if not f36_local1.isDefaultFirstPartyItem then
			f36_local1.isDefaultFirstPartyItem = false
		end
		f8_arg0.BillboardItem:UpdateBillboard( f36_local1, f36_arg2.isFirstPartyCategory )
		if not f36_arg2.isFirstPartyCategory then
			if QUARTERMASTER.itemData and QUARTERMASTER.itemData.sessionId ~= nil then
				QUARTERMASTER.RecordMenuBrowseEvent( f8_arg0, false )
			end
			QUARTERMASTER.BeginMenuBrowseEvent( f8_arg0, f36_arg2, f36_local1 )
		end
		local f36_local2 = f8_arg0._selectedCategory ~= f36_arg2.categoryIndex
		f8_arg0._selectedCategory = f36_arg2.categoryIndex
		f36_local0._selectedCategory = f36_arg2.categoryIndex
		f8_arg0._selectedBundle = f36_arg3
		if f36_local2 then
			f8_arg0:dispatchEventToChildren( {
				categoryChanged = true,
				name = "categoryTimerUpdate"
			} )
			f8_arg0( f8_arg0 )
		end
	end
	
	local f8_local2 = Engine[0xB6B0898C7795778]( Store[0xB6B0898C7795778]() )
	f8_arg0._allCategoryData = STORE.GetCategoryData( f8_arg1 )
	f8_arg0._recommendations = STORE.CheckForPersonalRecommendations( f8_arg1 )
	if Dvar[0x9E5BE3B4BBA4E0E]( "#x3e18487f3c2aa939a" ) then
		f8_arg0._allCategoryData = STORE.GetCategoryDataForAllBundles( f8_arg1 )
	end
	f8_arg0._storeSchedule = STORE.GetSchedule()
	if not f8_arg0._recommendations then
		f8_arg0.recommendationData = {
			isEnabled = false
		}
	end
	if CONDITIONS.IsFranchiseStoreEnabled() then
		f8_arg0._allCategoryData[#f8_arg0._allCategoryData + 1] = {
			id = "franchise_store_row",
			name = "STORE/STORE_CAT_FRANCHISE",
			isFirstPartyCategory = true
		}
	end
	local f8_local3 = {}
	for f8_local4 = 1, #f8_arg0._allCategoryData, 1 do
		local f8_local7 = f8_arg0._allCategoryData[f8_local4]
		f8_local7.items = f8_local7.items or {}
		f8_local7.showingCatalog = f8_arg0._catalogStatus == InGameStoreCatalogStatus.READY
		f0_local0( f8_arg0, f8_arg1, f8_local7 )
		f8_local7.categoryIndex = f8_local4
		if 0 >= #f8_local7.items or not f8_local7.items[1].emptyCategory then
			table.insert( f8_local3, f8_local7 )
		end
	end
	if Dvar[0x9E5BE3B4BBA4E0E]( "#x36c6c217d980bbc44" ) then
		f8_arg0._originalCategoryData = f8_arg0._allCategoryData
		f8_arg0._allCategoryData = f8_local3
		for self, f8_local7 in ipairs( f8_arg0._allCategoryData ) do
			f8_local7.categoryIndex = self
		end
	end
	QUARTERMASTER.RecordStoreEnterEvent( f8_arg1, f8_local2.layoutType, f8_arg0.recommendationData )
	f8_local5 = function ( f35_arg0, f35_arg1 )
		if f35_arg1.name then
			if f35_arg1.items[1].emptyCategory then
				f35_arg0.CategoryText:setText( ToUpperCase(), Engine[0xED84C33EC5F01EA]( "CAS/X_TO_Y", Engine[0xED84C33EC5F01EA]( f35_arg1.name ), Engine[0xED84C33EC5F01EA]( "MENU/SOLD_OUT" ) ) )
			elseif Dvar[0x9E5BE3B4BBA4E0E]( "#x3e18487f3c2aa939a" ) then
				child.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f35_arg1.name, f35_arg1.firstBundleIndex, f35_arg1.lastBundleIndex ) ) )
			else
				f35_arg0.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f35_arg1.name ) ) )
			end
		else
			f35_arg0.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( "MENU/SOLD_OUT" ) ) )
		end
	end
	
	f8_local6 = function ( f21_arg0, f21_arg1, f21_arg2 )
		local f21_local0 = f8_arg0._allCategoryData[f21_arg2 + 1]
		f21_arg0.RowGrid:SetDefaultFocus( function ()
			local f34_local0 = LUI.FlowManager.GetScopedData( f21_arg0 )
			local f34_local1 = f21_arg0._selectedBundle
			if not f34_local1 then
				f34_local1 = f34_local0.selectedBundleIndex or 1
			end
			if #f21_arg0.items < f34_local1 then
				f34_local1 = #f21_arg0.items
			end
			f34_local0.selectedBundleIndex = nil
			return {
				y = 0,
				x = f34_local1 - 1
			}
		end )
		f21_arg0.RowGrid:SetRefreshChild( function ( f23_arg0, f23_arg1, f23_arg2 )
			local f23_local0 = f21_arg0.items[f23_arg1 + 1]
			if not f23_local0 then
				DebugPrint( "STORE SCROLL BUG: Column: " .. f23_arg1 .. ", Row: " .. f23_arg2 )
				f23_arg0:registerEventHandler( "button_over", function ( element, event )
					
				end )
				f23_arg0:registerEventHandler( "button_action", function ( element, event )
					
				end )
				f23_arg0:registerEventHandler( "mouseenter", function ( element, event )
					
				end )
				f23_arg0:registerEventHandler( "mouseleave", function ( element, event )
					
				end )
				f23_arg0:registerEventHandler( "categoryTimerUpdate", function ( element, event )
					
				end )
				f23_arg0.NewItemNotification:SetAlpha( 0 )
				return 
			end
			f23_arg0:UpdateButton( f23_local0, f21_arg0._promotedItems, f21_arg0.isFirstPartyCategory )
			if not f21_arg0.isFirstPartyCategory and CONDITIONS.IsFranchiseStoreEnabled() and f23_local0.id then
				if not f23_local0.emptyCategory and f23_arg0.NewItemNotification and not STORE.HasSeenItem( f21_arg0, f23_local0.id ) then
					f23_arg0.NewItemNotification:SetAlpha( 1 )
				else
					f23_arg0.NewItemNotification:SetAlpha( 0 )
				end
			else
				f23_arg0.NewItemNotification:SetAlpha( 0 )
			end
			f23_arg0:registerEventHandler( "button_over", function ( element, event )
				f23_arg0( element, event, f23_arg0, f23_arg0 + 1 )
				f23_arg0._focusedBundle = element
			end )
			f23_arg0:registerEventHandler( "button_action", function ( element, event )
				f23_arg0:BillboardCategoryButtonAction( element, event, f23_arg0 )
			end )
			f23_arg0:registerEventHandler( "mouseenter", function ( element, event )
				f23_arg0._gridChildMouseFocusCount = f23_arg0._gridChildMouseFocusCount + 1
			end )
			f23_arg0:registerEventHandler( "mouseleave", function ( element, event )
				f23_arg0._gridChildMouseFocusCount = math.max( 0, f23_arg0._gridChildMouseFocusCount - 1 )
			end )
			f23_arg0:registerEventHandler( "categoryTimerUpdate", function ( element, event )
				if not event.expiredBundle and f23_arg0.purchaseEnd then
					local f24_local0, f24_local1, f24_local2 = STORE.GetCategoryTimeLeft( nil, f23_arg0.purchaseEnd )
					if f24_local0 <= 0 then
						f23_arg0:dispatchEventToChildren( {
							expiredBundle = true,
							name = "categoryTimerUpdate"
						} )
					end
				end
			end )
		end )
		f21_arg0._timerValue = nil
		f21_arg0._idPubVarString = nil
		f21_arg0:registerEventHandler( "categoryTimerUpdate", function ( element, event )
			local f22_local0 = f21_arg0.categoryIndex == f21_arg0._selectedCategory
			if f21_arg0.isFirstPartyCategory and not event.firstPartyCategoryIgnoreUpdate then
				if not event.categoryChanged then
					f21_arg0.RowGrid:SetNumRows( 1 )
					f21_arg0.RowGrid:SetNumColumns( #f21_arg0.items )
					f21_arg0.RowGrid:RefreshContent()
				end
				if f22_local0 then
					f21_arg0.NoMoreItemsMessage:SetVisibility( LUI.Visibility.Hidden )
				end
				return 
			elseif not f21_arg0.justForYou then
				local f22_local1, f22_local2, f22_local3 = STORE.GetCategoryTimeLeft( f21_arg0.timerPubVar )
				if not f21_arg0._timerValue and f21_arg0.timerPubVar and f22_local3 ~= "" then
					f21_arg0._timerValue = f22_local3
				end
				local f22_local4 = f21_arg0.idPubVar and Dvar[0x54084D7CA2317BB]( f21_arg0.idPubVar ) or ""
				if not f21_arg0._idPubVarString and f22_local4 ~= "" then
					f21_arg0._idPubVarString = f22_local4
				end
				local f22_local5 = event.expiredBundle and f22_local0
				local f22_local6 = event.catalogFetched
				local f22_local7 = f21_arg0._timerValue
				if f22_local7 then
					f22_local7 = f21_arg0._timerValue ~= f22_local3
				end
				local f22_local8 = f21_arg0._idPubVarString
				if f22_local8 then
					f22_local8 = f21_arg0._idPubVarString ~= f22_local4
				end
				local f22_local9 = event.categoryChanged
				local f22_local10
				if not f22_local5 then
					f22_local10 = f22_local5
				elseif not f22_local6 then
					f22_local10 = f22_local6
				elseif not f22_local7 then
					f22_local10 = f22_local7
				elseif not f22_local8 then
					f22_local10 = f22_local8
				else
					f22_local10 = f22_local9
				end
				if f22_local10 then
					f21_arg0( f21_arg0, f21_arg0, f21_arg0 )
					if f21_arg0.RowGrid:GetNumRows() ~= 1 then
						f21_arg0.RowGrid:SetNumRows( 1 )
					end
					if f21_arg0.RowGrid:GetNumColumns() ~= #f21_arg0.items then
						f21_arg0.RowGrid:SetNumColumns( #f21_arg0.items )
					end
					f21_arg0.RowGrid:RefreshContent()
					f21_arg0._timerValue = f22_local3
					f21_arg0._idPubVarString = f21_arg0.idPubVarString
					if f22_local5 or f22_local6 and f21_arg0.hasFirstPartyBundle then
						f21_arg0.RowGrid:processEvent( {
							name = "lose_focus"
						} )
						f21_arg0.RowGrid:SetFocusedPosition( {
							x = 0,
							y = 0
						}, true )
					end
				end
			end
			local f22_local1 = f21_arg0.items[1]
			if f22_local0 then
				if f22_local1.emptyCategory or f21_arg0._catalogStatus ~= InGameStoreCatalogStatus.READY then
					if f21_arg0._catalogStatus == InGameStoreCatalogStatus.FETCHING then
						ACTIONS.AnimateSequence( f21_arg0, "Fetching" )
					else
						ACTIONS.AnimateSequence( f21_arg0, "SoldOut" )
					end
				else
					ACTIONS.AnimateSequence( f21_arg0, "StorePopulated" )
				end
			end
			if f21_arg0.name then
				if f21_arg0.items[1].emptyCategory and f21_arg0._catalogStatus ~= InGameStoreCatalogStatus.FETCHING then
					f21_arg0.CategoryText:setText( ToUpperCase(), Engine[0xED84C33EC5F01EA]( "CAS/X_TO_Y", Engine[0xED84C33EC5F01EA]( f21_arg0.name ), Engine[0xED84C33EC5F01EA]( "MENU/SOLD_OUT" ) ) )
				elseif Dvar[0x9E5BE3B4BBA4E0E]( "#x3e18487f3c2aa939a" ) then
					f21_arg0.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f21_arg0.name, f21_arg0.firstBundleIndex, f21_arg0.lastBundleIndex ) ) )
				else
					f21_arg0.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( f21_arg0.name ) ) )
				end
			else
				f21_arg0.CategoryText:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( "MENU/SOLD_OUT" ) ) )
			end
		end )
		f21_arg0.RowGrid:SetNumRows( 1 )
		f21_arg0.RowGrid:SetNumColumns( #f21_local0.items )
		f21_arg0.RowGrid:RefreshContent()
	end
	
	f8_arg0.BundlesGrid:SetNumColumns( 1 )
	f8_arg0.BundlesGrid:SetNumRows( #f8_arg0._allCategoryData )
	f8_arg0.BundlesGrid:SetUseDelayedFocus( true )
	local self = LUI.UITimer.new( {
		interval = 250,
		event = {
			firstPartyCategoryIgnoreUpdate = true,
			name = "categoryTimerUpdate"
		}
	} )
	self.id = "timer"
	f8_arg0:addElement( self )
	local f8_local7 = LUI.UITimer.new( {
		event = "autoScrollTimerUpdate",
		interval = f0_local0
	} )
	f8_local7.id = "autoScrollTimer"
	f8_arg0:addElement( f8_local7 )
	f8_arg0._autoScrollEnabled = true
	f8_arg0:registerEventHandler( "autoScrollTimerUpdate", function ( element, event )
		local f20_local0 = LUI.IsLastInputMouseNavigation( f8_arg0 )
		if f20_local0 then
			f20_local0 = 0 < f8_arg0._gridChildMouseFocusCount
		end
		if f8_arg0._autoScrollEnabled and not f20_local0 and f8_arg0._selectedCategory and f8_arg0._selectedBundle and 0 < #f8_arg0._allCategoryData then
			local f20_local1 = f8_arg0._allCategoryData[f8_arg0._selectedCategory]
			local f20_local2 = f8_arg0._selectedBundle + 1
			if #f20_local1.items < f20_local2 then
				f20_local2 = 1
			end
			local f20_local3 = f8_arg0.BundlesGrid:GetElementAtPosition( 0, f8_arg0._selectedCategory - 1 )
			if f20_local3 then
				local f20_local4 = f20_local3.RowGrid
				f8_arg0._autoScroll = true
				f20_local4:SetFocusedPosition( {
					y = 0,
					x = f20_local2 - 1
				}, false )
				f8_arg0._autoScroll = false
			end
		end
	end )
	f8_arg0._autoScrollEnabledTimerHolder = LUI.UIElement.new()
	f8_arg0:addElement( f8_arg0._autoScrollEnabledTimerHolder )
	f8_arg0.DisableAutoScrollTimer = function ()
		f8_arg0._autoScrollEnabled = false
		local f18_local0 = f8_arg0._autoScrollEnabledTimerHolder:Wait( Dvar[0x22EAAB59AA27E9B]( "#x336eb441a42d716f" ), true )
		f18_local0.onComplete = function ()
			f18_local0._autoScrollEnabled = true
		end
		
	end
	
	
	local bindButton = LUI.UIBindButton.new()
	bindButton.id = "bindButton"
	f8_arg0:addElement( bindButton )
	f8_arg0.bindButton = bindButton
	
	f8_arg0.bindButton:addEventHandler( "button_alt1", function ( f17_arg0, f17_arg1 )
		if not f8_arg0._allCategoryData[f8_arg0._selectedCategory].isFirstPartyCategory then
			f8_arg0._startPurchaseImmediately = true
			f8_arg0:BillboardCategoryButtonAction( nil, nil, f8_arg0._allCategoryData[f8_arg0._selectedCategory] )
		end
	end )
	if CONDITIONS.IsFranchiseStoreEnabled() then
		f8_arg0.bindButton:addEventHandler( "button_alt2", function ( f16_arg0, f16_arg1 )
			QUARTERMASTER.RecordMenuBrowseEvent( f8_arg0, true )
			local f16_local0 = STORE.GoToStore
			local f16_local1 = f8_arg0
			local f16_local2 = f8_arg0:GetCurrentMenu()
			f16_local0( f16_local1, f16_local2.id, f16_arg0.id )
		end )
	end
	f8_arg0.bindButton:addEventHandler( "button_left_stick", function ( f15_arg0, f15_arg1 )
		if Dvar[0x9E5BE3B4BBA4E0E]( "#x3d9e89829c053d553" ) then
			f8_arg0( f8_arg0, f8_arg0 )
		end
	end )
	f8_arg0:addEventHandler( "gamepad_button", function ( f14_arg0, f14_arg1 )
		if f14_arg1.controller ~= f8_arg0 and (f14_arg1.button == "primary" or f14_arg1.button == "alt1" or f14_arg1.button == "alt2" or f14_arg1.button == "left" or f14_arg1.button == "right" or f14_arg1.button == "up" or f14_arg1.button == "down") then
			return true
		else
			
		end
	end )
	local f8_local10 = f8_arg0:Wait( 1 )
	f8_local10.onComplete = function ()
		f8_arg0._menu = f8_arg0.BundlesGrid:GetCurrentMenu()
		if CONDITIONS.IsFranchiseStoreEnabled() then
			f8_arg0._menu.HelperBar.ButtonHelperText:PushButtonPrompt( {
				side = "left",
				ignoreTooltipPrompt = true,
				button_ref = "button_alt2",
				helper_text = Engine[0xED84C33EC5F01EA]( "STORE/STORE_CAT_FRANCHISE" ),
				container = f8_arg0.FranchisePromptContainer,
				containerAlignment = LUI.Alignment.Right
			} )
		end
		if CONDITIONS.IsMTXDebugOverlayEnabled() then
			MTXDebugOverlayUtils.ShowOverlay( f8_arg0 )
			local f12_local0 = {}
			MTXDebugOverlayUtils.UpdateOverlayDetails( f8_arg0, MTXDebugOverlayUtils.Categories.STORE_BUNDLE, f12_local0 )
			f8_arg0:registerEventHandler( "updateMTXOverlay", function ( element, event )
				if event.data then
					MTXDebugOverlayUtils.UpdateInfo( f12_local0, MTXDebugOverlayUtils.Categories.STORE_BUNDLE, event.data )
				end
			end )
		end
		f8_arg0.BundlesGrid:SetRefreshChild( f8_arg0 )
		f8_arg0.BundlesGrid:RefreshContent()
		local f12_local0 = LUI.FlowManager.GetPerControllerPersistentData( f8_arg0 )
		if f12_local0._selectedCategory then
			f8_arg0.BundlesGrid:SetFocusedPosition( {
				x = 0,
				y = f12_local0._selectedCategory - 1
			}, false )
		else
			f8_arg0.BundlesGrid:GainFocus( {
				controllerIndex = f8_arg0
			} )
		end
	end
	
	f8_arg0:registerEventHandler( "restore_focus", function ( element, event )
		local f11_local0 = LUI.FlowManager.GetPerControllerPersistentData( f8_arg0._controllerIndex )
		if event.id == "Tabs" or f11_local0.creatorCodePopupActive or f11_local0.gameUpsellPopupActive or f11_local0.storeBundlePreview then
			f11_local0.creatorCodePopupActive = nil
			f11_local0.gameUpsellPopupActive = nil
			f11_local0.storeBundlePreview = nil
			if f11_local0.storeGameUpsell then
				element.BundlesGrid:SetFocusedPosition( {
					x = 0,
					y = 0
				}, true )
				f11_local0.storeGameUpsell = nil
			end
			return false
		elseif event.data and event.data.targetPosition then
			local f11_local1 = event.data.targetPosition
			element.BundlesGrid:SetFocusedPosition( {
				x = f11_local1.x,
				y = f11_local1.y
			}, true )
			return true
		else
			return true
		end
	end )
	f8_local10 = function ( f10_arg0, f10_arg1 )
		if f10_arg1.down and f10_arg1.qualifier == "mousewheel" then
			return f8_arg0.BundlesGrid:processEvent( f10_arg1 )
		else
			
		end
	end
	
	f8_arg0.BillboardItem.Image:addEventHandler( "gamepad_button", f8_local10 )
	f8_arg0.BundlesGrid._showNumbersAndArrowsKBM = true
	f8_arg0.BundlesGrid._updateArrowVisibilityOnRefresh = false
	f8_arg0.BundlesGrid._alwaysTrapMouseWheel = true
	f8_arg0.MouseScrollCatcher:SetHandleMouse( true )
	f8_arg0.MouseScrollCatcher:OverrideMouseCursorType( MouseCursorType.CURSOR_TYPE_ARROW_NORMAL )
	f8_arg0.MouseScrollCatcher:addEventHandler( "gamepad_button", f8_local10 )
	f8_arg0:registerEventHandler( "update_input_type", function ( element, event )
		if LUI.IsLastInputGamepad( event.controllerIndex ) then
			local f9_local0 = LUI.FlowManager.GetPerControllerPersistentData( f8_arg0 )
			if f9_local0._selectedCategory then
				element.BundlesGrid:SetFocusedPosition( {
					x = 0,
					y = element._selectedCategory - 1
				}, false )
				local f9_local1 = element.BundlesGrid:GetElementAtPosition( 0, element._selectedCategory - 1 )
				if f9_local1 then
					f9_local1.RowGrid:SetFocusedPosition( {
						y = 0,
						x = element._selectedBundle and element._selectedBundle - 1 or 0
					}, false )
				end
			else
				element.BundlesGrid:GainFocus( {
					controllerIndex = f8_arg0
				} )
			end
		end
	end )
end

function MPStoreBillboardGrid( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "MPStoreBillboardGrid"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local Background = nil
	
	Background = LUI.UIImage.new()
	Background.id = "Background"
	Background:SetRGBFromInt( 0, 0 )
	Background:SetVMin( 0.5, 0 )
	self:addElement( Background )
	self.Background = Background
	
	local MouseScrollCatcher = nil
	
	MouseScrollCatcher = LUI.UIImage.new()
	MouseScrollCatcher.id = "MouseScrollCatcher"
	MouseScrollCatcher:SetRGBFromInt( 0, 0 )
	MouseScrollCatcher:SetAlpha( 0, 0 )
	MouseScrollCatcher:setImage( RegisterMaterial( "widg_gradient_bottom_to_top" ), 0 )
	MouseScrollCatcher:SetVMin( 0.5, 0 )
	MouseScrollCatcher:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, _1080p * 200, _1080p * -85 )
	self:addElement( MouseScrollCatcher )
	self.MouseScrollCatcher = MouseScrollCatcher
	
	local BillboardItem = nil
	
	BillboardItem = MenuBuilder.BuildRegisteredType( "StoreBillboardItem", {
		controllerIndex = f1_local1
	} )
	BillboardItem.id = "BillboardItem"
	BillboardItem:SetAnchorsAndPosition( 0, 0, 0, 1, 0, 0, _1080p * 200, _1080p * 780 )
	self:addElement( BillboardItem )
	self.BillboardItem = BillboardItem
	
	local BundlesGrid = nil
	
	BundlesGrid = LUI.UIPeekingGrid.new( {
		maxVisibleRows = 2,
		maxVisibleColumns = 1,
		wrapY = false,
		wrapX = false,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "MPStoreBillboardGridRow", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f6_arg0, f6_arg1, f6_arg2 )
			
		end,
		spacingX = _1080p * 0,
		spacingY = _1080p * 0,
		columnWidth = _1080p * 1680,
		rowHeight = _1080p * 190
	} )
	BundlesGrid.id = "BundlesGrid"
	BundlesGrid:SetMaxVisibleRows( 2 )
	BundlesGrid:SetRowSpacing( 0 )
	BundlesGrid:setUseStencil( false )
	BundlesGrid:SetWraps( false, nil )
	BundlesGrid:SetWraps( nil, false )
	BundlesGrid:SetAnchorsAndPosition( 0, 0, 1, 0, _1080p * 127, _1080p * -113, _1080p * -370, 0 )
	self:addElement( BundlesGrid )
	self.BundlesGrid = BundlesGrid
	
	local GridMask = nil
	
	GridMask = LUI.UIImage.new()
	GridMask.id = "GridMask"
	GridMask:setImage( RegisterMaterial( "store_bundle_grid_mask" ), 0 )
	GridMask:SetAnchorsAndPosition( 0, 0, 1, 0, _1080p * 120, _1080p * -120, _1080p * -370, _1080p * -54 )
	self:addElement( GridMask )
	self.GridMask = GridMask
	
	local VerticalScrollbar = nil
	
	VerticalScrollbar = MenuBuilder.BuildRegisteredType( "VerticalScrollbar", {
		controllerIndex = f1_local1
	} )
	VerticalScrollbar.id = "VerticalScrollbar"
	VerticalScrollbar:SetAnchorsAndPosition( 1, 0, 1, 0, _1080p * -105, _1080p * -97, _1080p * -333, _1080p * -85 )
	self:addElement( VerticalScrollbar )
	self.VerticalScrollbar = VerticalScrollbar
	
	local NoMoreItemsMessage = nil
	
	NoMoreItemsMessage = MenuBuilder.BuildRegisteredType( "NoMoreItemsMessage", {
		controllerIndex = f1_local1
	} )
	NoMoreItemsMessage.id = "NoMoreItemsMessage"
	NoMoreItemsMessage:SetVisibility( LUI.Visibility.Hidden )
	NoMoreItemsMessage:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, _1080p * -512, _1080p * 512, _1080p * -90, _1080p * -10 )
	self:addElement( NoMoreItemsMessage )
	self.NoMoreItemsMessage = NoMoreItemsMessage
	
	local FetchingStoreInfo = nil
	
	FetchingStoreInfo = LUI.UIStyledText.new()
	FetchingStoreInfo.id = "FetchingStoreInfo"
	FetchingStoreInfo:SetVisibility( LUI.Visibility.Hidden )
	FetchingStoreInfo:SetRGBFromTable( SWATCHES.text.buttonTextDefault, 0 )
	FetchingStoreInfo:setText( Engine[0xED84C33EC5F01EA]( "LUA_MENU/RETRIEVING_INFO" ), 0 )
	FetchingStoreInfo:SetFont( FONTS.GetFont( FONT_STYLES.fontStyle_XLHeaderBold.font.File ) )
	FetchingStoreInfo:SetFontSize( FONT_STYLES.fontStyle_XLHeaderBold.size )
	FetchingStoreInfo:SetMinFontSize( FONT_STYLES.fontStyle_XLHeaderBold.minSize )
	FetchingStoreInfo:SetWordWrap( false )
	FetchingStoreInfo:SetAlignment( LUI.Alignment.Center )
	FetchingStoreInfo:SetAnchorsAndPosition( 0, 0, 0.5, 0.5, _1080p * 18, _1080p * -18, _1080p * -100, _1080p * -26 )
	self:addElement( FetchingStoreInfo )
	self.FetchingStoreInfo = FetchingStoreInfo
	
	local StoreEmpty = nil
	
	StoreEmpty = MenuBuilder.BuildRegisteredType( "EventBanner", {
		controllerIndex = f1_local1
	} )
	StoreEmpty.id = "StoreEmpty"
	StoreEmpty:SetAlpha( 0, 0 )
	StoreEmpty.Backer:SetRGBFromTable( SWATCHES.Store.NoItemBGAlt, 0 )
	StoreEmpty.Backer:SetAlpha( 1, 0 )
	StoreEmpty.Node:SetRGBFromTable( SWATCHES.Store.NoItemTimer, 0 )
	StoreEmpty:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 96, _1080p * 246, _1080p * 160, _1080p * 194 )
	self:addElement( StoreEmpty )
	self.StoreEmpty = StoreEmpty
	
	local SupportingCreatorCode = nil
	
	SupportingCreatorCode = MenuBuilder.BuildRegisteredType( "SupportingCreatorCode", {
		controllerIndex = f1_local1
	} )
	SupportingCreatorCode.id = "SupportingCreatorCode"
	SupportingCreatorCode:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 1172, _1080p * 1572, _1080p * 154, _1080p * 194 )
	self:addElement( SupportingCreatorCode )
	self.SupportingCreatorCode = SupportingCreatorCode
	
	local FranchisePromptContainer = nil
	FranchisePromptContainer = MenuBuilder.BuildRegisteredType( "ButtonPromptContainer", {
		controllerIndex = f1_local1
	} )
	FranchisePromptContainer.id = "FranchisePromptContainer"
	if CONDITIONS.AlwaysFalse() then
		FranchisePromptContainer.Label:setText( Engine[0xED84C33EC5F01EA]( "STORE/FRANCHISE_STORE_WITH_PROMPT" ), 0 )
	end
	if CONDITIONS.AlwaysFalse() then
		FranchisePromptContainer.Label:SetAlignment( LUI.Alignment.Right )
	end
	FranchisePromptContainer:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 1582, _1080p * 1814, _1080p * 159, _1080p * 189 )
	self:addElement( FranchisePromptContainer )
	self.FranchisePromptContainer = FranchisePromptContainer
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local14 = nil
	BundlesGrid:RegisterAnimationSequence( "Fetching", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		},
		{
			value = 0,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	NoMoreItemsMessage:RegisterAnimationSequence( "Fetching", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		},
		{
			value = 0,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	FetchingStoreInfo:RegisterAnimationSequence( "Fetching", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		},
		{
			value = 1,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	self._sequences.Fetching = function ()
		menu:AnimateSequence( "Fetching" )
		menu:AnimateSequence( "Fetching" )
		menu:AnimateSequence( "Fetching" )
	end
	
	self._sequenceLengths.Fetching = 100
	local f1_local15 = nil
	BundlesGrid:RegisterAnimationSequence( "SoldOut", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		},
		{
			value = 1,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	NoMoreItemsMessage:RegisterAnimationSequence( "SoldOut", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		},
		{
			value = 1,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	FetchingStoreInfo:RegisterAnimationSequence( "SoldOut", {
		{
			value = 0,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		},
		{
			duration = -28,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		}
	} )
	self._sequences.SoldOut = function ()
		menu:AnimateSequence( "SoldOut" )
		menu:AnimateSequence( "SoldOut" )
		menu:AnimateSequence( "SoldOut" )
	end
	
	self._sequenceLengths.SoldOut = 100
	local f1_local16 = nil
	BundlesGrid:RegisterAnimationSequence( "StorePopulated", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		},
		{
			value = 1,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	NoMoreItemsMessage:RegisterAnimationSequence( "StorePopulated", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		},
		{
			value = 0,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	FetchingStoreInfo:RegisterAnimationSequence( "StorePopulated", {
		{
			duration = -28,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		},
		{
			value = 0,
			duration = -28,
			property = TWEEN_PROPERTY.Alpha
		}
	} )
	self._sequences.StorePopulated = function ()
		menu:AnimateSequence( "StorePopulated" )
		menu:AnimateSequence( "StorePopulated" )
		menu:AnimateSequence( "StorePopulated" )
	end
	
	self._sequenceLengths.StorePopulated = 100
	local f1_local17 = LUI.UIScrollbar.new
	local f1_local18 = {
		direction = LUI.DIRECTION.vertical,
		eventListener = VerticalScrollbar,
		startCap = VerticalScrollbar.startCap,
		endCap = VerticalScrollbar.endCap,
		sliderArea = VerticalScrollbar.sliderArea
	}
	local f1_local19 = VerticalScrollbar.sliderArea
	if f1_local19 then
		f1_local19 = VerticalScrollbar.sliderArea.slider
	end
	f1_local18.slider = f1_local19
	f1_local19 = VerticalScrollbar.sliderArea
	if f1_local19 then
		f1_local19 = VerticalScrollbar.sliderArea.fixedSizeSlider
	end
	f1_local18.fixedSizeSlider = f1_local19
	BundlesGrid:AddScrollbar( f1_local17( f1_local18 ) )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "MPStoreBillboardGrid", MPStoreBillboardGrid )
LockTable( _M )
