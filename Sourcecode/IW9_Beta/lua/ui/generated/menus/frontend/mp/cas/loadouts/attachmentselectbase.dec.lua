-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
local f0_local0 = function ( f47_arg0, f47_arg1 )
	if f47_arg0.ArrowUp then
		f47_arg0.Attachments:AddArrow( f47_arg0.ArrowUp )
	end
	if f47_arg0.ArrowDown then
		f47_arg0.Attachments:AddArrow( f47_arg0.ArrowDown )
	end
	if f47_arg0.ListCount then
		f47_arg0.Attachments:AddItemNumbers( f47_arg0.ListCount )
	end
end

local f0_local1 = function ( f46_arg0, f46_arg1, f46_arg2, f46_arg3, f46_arg4 )
	return ATTACHMENT.GetTableWithCurrentAttachment( f46_arg0._weaponTable, f46_arg1, f46_arg2, f46_arg3, f46_arg4 )
end

local f0_local2 = function ( f45_arg0, f45_arg1, f45_arg2 )
	if not Engine[0x12586A3F4FB490E]() or not f45_arg0._weaponModel then
		return 
	else
		WEAPON.LoadAndSetModel( f45_arg1, f45_arg0._weaponModel, f45_arg2, {
			forceOffsetsAndRotations = true
		} )
	end
end

local f0_local3 = function ( f43_arg0, f43_arg1, f43_arg2, f43_arg3 )
	return function ()
		local f44_local0 = f43_arg0
		local f44_local1 = ATTACHMENT.perkCategory
		f44_local0 = REG9 and CSV.weaponOffsets.previewFile or CSV.weaponOffsets.attachmentFile
		FrontEndScene.HideWeaponModels()
		f43_arg0._weaponModel = WEAPON.GetWeaponModel( f43_arg0, FrontEndScene.ClientWeapons.Preview, CSV.weaponOffsets.attachmentFile )
		f43_arg0:addElement( f43_arg0._weaponModel )
		f44_local1 = f43_arg0._currentTable
		if CONDITIONS.IsIW9BetaBuildEnabled() and f43_arg0._focusedAttachmentData and (not f43_arg0._focusedAttachmentData.unlocked or f43_arg0._focusedAttachmentData.isClassified) then
			f44_local1 = f43_arg0( f43_arg0, f43_arg0, nil, f43_arg0._equippedAttach, f43_arg0._equippedVariant )
		end
		f43_arg0( f43_arg0, f43_arg0, f44_local1 )
	end
	
end

local f0_local4 = function ( f41_arg0, f41_arg1 )
	f41_arg0._weaponTable = WEAPON.GenerateWeaponTable( f41_arg0._weaponPlayerData )
	local f41_local0 = f41_arg0._weaponTable.attachments[f41_arg1]
	if f41_local0 then
		f41_local0 = f41_arg0._weaponTable.attachments[f41_arg1].ref
	end
	f41_arg0._equippedAttach = f41_local0
	f41_local0 = f41_arg0._weaponTable.attachments[f41_arg1]
	if f41_local0 then
		f41_local0 = f41_arg0._weaponTable.attachments[f41_arg1].variantID
	end
	f41_arg0._equippedVariant = f41_local0
	f41_arg0.Attachments:RefreshContent()
	f41_local0 = function ()
		return f41_arg0.Attachments:GetVisibleChildInFocus()
	end
	
	local f41_local1 = f41_arg0
	local f41_local2 = f41_arg0.processEvent
	local f41_local3 = {
		name = "update_showcase"
	}
	local f41_local4 = f41_local0()
	f41_local3.attachmentData = f41_local4:GetData()
	f41_local2( f41_local1, f41_local3 )
end

local f0_local5 = function ( f39_arg0, f39_arg1 )
	CLIENT_MODEL.ResetAmmoModelPosition( CLIENT_MODEL.GetClientModelIndex( CLIENT_MODEL.coreMPModels.AMMO_DISPLAY ) )
	local f39_local0 = f39_arg0.GunsmithDetails:Wait( 5 )
	f39_local0.onComplete = function ()
		GUNSMITH.UpdateAmmoModel( f39_arg0, f39_arg0, f39_arg0 )
	end
	
end

local f0_local6 = function ( f35_arg0, f35_arg1, f35_arg2 )
	local f35_local0 = {}
	if f35_arg0._weaponTable.lootID ~= LOOT.emptyID then
		f35_local0 = WEAPON.GetModificationAttachments( f35_arg1, f35_arg0._weaponTable.weapon, f35_arg0._weaponTable.lootID )
	end
	local f35_local1 = function ( f38_arg0, f38_arg1 )
		if f38_arg0._category == GL_HACK.RECEIVER_TYPE then
			if StringTable[0x2DCF0973239E909]( CSV.receiverTable.file, CSV.receiverTable.cols.receiverRef, f38_arg1.attachmentData.ref, CSV.receiverTable.cols.weaponRef ) ~= f35_arg0._weaponTable.weapon then
				f38_arg0._weaponCompareTable = GL_HACK.GetPreviewedAttachmentTable( f35_arg0, {
					receiverRef = f38_arg1.attachmentData.ref,
					weaponTable = f38_arg0._weaponTable,
					weaponPlayerData = f38_arg0._weaponPlayerData
				} )
				f35_arg0.EquipIndicatorFrame:SetAlpha( 1 )
				f35_arg0.EquipIndicatorFrame:SetupIndicators( f35_arg0, f38_arg0._weaponCompareTable, f35_arg0._weaponTable )
			else
				f35_arg0.EquipIndicatorFrame:SetAlpha( 0 )
			end
		end
	end
	
	f35_arg0:registerEventHandler( "update_showcase", function ( element, event )
		if event.attachmentData then
			local f36_local0 = 1 < #event.attachmentData.variants
			local f36_local1 = event.attachmentData.ref == element._equippedAttach
			local f36_local2 = event.attachmentData.isClassified and ATTACHMENT.none or event.attachmentData.ref
			local f36_local3 = ATTACHMENT.baseVariant
			if f36_local1 then
				f36_local3 = element._equippedVariant
			elseif f35_arg0[f36_local2] then
				f36_local3 = f35_arg0[f36_local2]
			end
			local f36_local4 = {}
			if f36_local1 then
				for f36_local5 = 1, #f35_arg0._weaponTable.attachments, 1 do
					if f35_arg0._weaponTable.attachments[f36_local5].ref == event.attachmentData.ref then
						f36_local4 = GUNSMITH.GetTableWithOnlyEquippedAttachment( f35_arg0._weaponTable.weapon, f35_arg0._weaponTable.attachments[f36_local5] )
						break
					end
				end
			end
			element._currentTable = f35_arg0( element, f35_arg0, event.attachmentData.blockedCategorySlot, f36_local2, f36_local3 )
			local f36_local5 = f35_arg0.GunsmithDetails
			local f36_local7 = f36_local5
			f36_local5 = f36_local5.Setup
			local f36_local8 = f35_arg0
			local f36_local9 = event.attachmentData
			local f36_local10 = f36_local1
			local f36_local11 = element._weaponTable
			local f36_local12
			if f36_local1 and not f36_local4 then
				f36_local12 = f36_local4
			else
				f36_local12 = element._currentTable
			end
			f36_local5( f36_local7, f36_local8, f36_local9, f36_local10, f36_local11, f36_local12, f36_local0, event.attachmentData.blockedCategorySlot, f36_local3 )
			element._focusedAttachmentData = event.attachmentData
			f36_local5 = f35_arg0._currentTable
			if CONDITIONS.IsIW9BetaBuildEnabled() and not f35_arg0._focusedAttachmentData.unlocked then
				f36_local5 = f35_arg0( f35_arg0, f35_arg0, nil, f35_arg0._equippedAttach, f35_arg0._equippedVariant )
			end
			f35_arg0( element, f35_arg0, f36_local5 )
			if CONDITIONS.InFrontend() and element._category == "gunperk" then
				f35_arg0( f35_arg0, f35_arg0 )
			end
			f35_arg0( element, event )
			if CONDITIONS.IsWaveGameType() then
				local f36_local6 = tonumber( event.attachmentData.survivalCost )
				f36_local7 = CP.CurrencyGet( f35_arg0 )
				f35_arg0.PurchaseWidget.CostValue:setText( Engine[0xED84C33EC5F01EA]( 0xDCA9D5990998D52, tostring( f36_local6 ) ) )
				if f36_local6 <= f36_local7 then
					ACTIONS.AnimateSequence( f35_arg0.PurchaseWidget, "CanBuy" )
				else
					ACTIONS.AnimateSequence( f35_arg0.PurchaseWidget, "NoBuy" )
				end
				f35_arg0:registerOmnvarHandler( "cp_open_cac", function ( f37_arg0, f37_arg1 )
					if f37_arg1.value == -2 and CONDITIONS.IsWaveGameType() then
						LUI.FlowManager.RequestCloseAllMenus()
					end
				end )
			end
		end
		return true
	end )
end

local f0_local7 = function ( f30_arg0, f30_arg1, f30_arg2 )
	f30_arg0:registerEventHandler( "try_equip_attachment", function ( element, event )
		local f32_local0 = WEAPON.GetWeaponModelName( element._currentTable.weapon, element._currentTable, {
			includeAttachments = true
		} )
		local f32_local1 = ClientWeapon[0xD3CE47FE2479379]( f30_arg0, f32_local0, Engine[0x603B6AC5797050A]( f32_local0, event.attachmentData.ref ) )
		local f32_local2 = LUI.FlowManager.GetScopedData( GL_HACK.GetGunsmithMenu() )
		local f32_local3 = f32_local2.attachmentData[GL_HACK.GetWeaponMPRef( f30_arg0._weaponTable.weapon )].attachments
		local f32_local4 = {}
		if f32_local1 then
			for f32_local16, f32_local17 in ipairs( element._currentTable.attachments ) do
				if f32_local17.ref ~= ATTACHMENT.none and f32_local17.ref ~= event.attachmentData.ref then
					local f32_local8 = false
					if f32_local1.blockedAttachmentCategories and LUI.IsItemInArray( f32_local1.blockedAttachmentCategories, f32_local17.category ) then
						table.insert( f32_local4, f32_local17 )
						f32_local8 = true
					end
					if not f32_local8 and f32_local1.blockedBaseTypes and 0 < #f32_local1.blockedBaseTypes then
						local f32_local9 = f32_local3[f32_local17.category]
						if f32_local9 then
							local f32_local10 = nil
							for f32_local14, f32_local15 in ipairs( f32_local9 ) do
								if f32_local15.ref == f32_local17 then
									f32_local10 = f32_local15
									break
								end
							end
						end
						if attachmentData and LUI.IsItemInArray( f32_local1.blockedBaseTypes, attachmentData.baseTypeName ) then
							table.insert( f32_local4, f32_local17 )
							f32_local8 = true
						end
					end
					if not f32_local8 and f32_local1.blockedAttachments and LUI.IsItemInArray( f32_local1.blockedAttachments, f32_local17.ref ) then
						table.insert( f32_local4, f32_local17 )
						f32_local8 = true
					end
				end
			end
		end
		local f32_local5 = function ( f34_arg0 )
			f34_arg0:dispatchEventToCurrentMenu( {
				name = "equip_attachment",
				attachmentData = element.attachmentData
			} )
		end
		
		if 0 < #f32_local4 then
			LUI.FlowManager.RequestPopupMenu( nil, "PopupYesNo", false, nil, false, {
				title = Engine[0xED84C33EC5F01EA]( 0xF22B2F336C8A05C ),
				message = Engine[0xED84C33EC5F01EA]( 0xA6B88FD8F6E0ED1, #f32_local4, ATTACHMENT.GetName( event.attachmentData.ref ) ),
				yesLabel = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 ),
				noLabel = Engine[0xED84C33EC5F01EA]( 0xDF4B921D6190715 ),
				yesAction = function ( f33_arg0, f33_arg1 )
					ACTIONS.LeaveMenu( f33_arg0 )
					for f33_local0 = 1, #element, 1 do
						GUNSMITH.EquipAttachment( f33_arg0, f33_arg1, ATTACHMENT.none, element._weaponPlayerData, {
							isNewAttachment = true,
							attachSlot = GUNSMITH.GetSelectedAttachIndexForCategory( element[f33_local0].category, element._weaponTable )
						} )
					end
					element( element )
				end
			}, nil, false, true )
		else
			f32_local5( element )
		end
	end )
	f30_arg0:registerEventHandler( "equip_attachment", function ( element, event )
		if element._category == GL_HACK.RECEIVER_TYPE then
			if GL_HACK.GetWeaponRefByRec( event.attachmentData.ref ) ~= element._weaponTable.weapon then
				local f31_local0 = {}
				for f31_local1 = 1, #element._weaponCompareTable, 1 do
					if element._weaponCompareTable[f31_local1].compareState == GUNSMITH.WEAPON_PART_COMPARE_STATE.PRESERVED then
						table.insert( f31_local0, element._weaponCompareTable[f31_local1].ref )
					end
				end
				GL_HACK.RequestEquippingRecAttachment( f30_arg0, {
					receiverRef = event.attachmentData.ref,
					weaponTable = element._weaponTable,
					weaponPlayerData = element._weaponPlayerData,
					preservedAttachmentTable = f31_local0
				} )
			end
			ACTIONS.LeaveMenu( element )
			return 
		elseif CONDITIONS.IsWaveGameType() then
			local f31_local4 = CP.CurrencyGet( f30_arg0 )
			local f31_local0 = tonumber( event.attachmentData.survivalCost )
			if event.attachmentData.ref == element._equippedAttach then
				Engine[0xC4146BA76D0F982]( 0xC434AA96E20B199 )
			elseif f31_local0 <= f31_local4 then
				if f30_arg0 ~= nil then
					f31_local4 = f31_local4 - f31_local0
					Engine[0xC4146BA76D0F982]( 0x7AA312B9A84F375 )
					CP.CurrencySubtract( f30_arg0, f31_local0 )
					Engine[0x6055C55456F05DF]( "attachment_purchased", f31_local0 )
				end
			else
				Engine[0xC4146BA76D0F982]( 0xC434AA96E20B199 )
			end
		end
		DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f30_arg0, DYN_ATTACHMENT.StreamedImageAction.REMOVE )
		local f31_local4 = event.attachmentData.ref
		local f31_local0 = event.attachmentData.category and event.attachmentData.category or ATTACHMENT.GetCategory( f31_local4 )
		local f31_local1 = GUNSMITH.IsAttachmentSetupFull( f31_local0, element._weaponPlayerData )
		local f31_local2
		if element._equippedAttach ~= nil and f31_local0 == ATTACHMENT.GetCategory( element._equippedAttach ) then
			f31_local2 = false
		else
			f31_local2 = true
		end
		local f31_local3 = f31_local4 ~= element._equippedAttach
		local f31_local5
		if f31_local1 then
			f31_local5 = f31_local1
		else
			f31_local5 = f31_local2
		end
		local f31_local6 = true
		if f31_local3 then
			local f31_local7 = GUNSMITH.EquipAttachment
			local f31_local8 = element
			local f31_local9 = f30_arg0
			local f31_local10 = f31_local4
			local f31_local11 = element._weaponPlayerData
			local f31_local12 = {
				menusToLeave = {
					LOADOUT.GetAttachmentSelectMenuRef()
				}
			}
			local f31_local13
			if f31_local5 then
				f31_local13 = event.attachmentData.blockedCategorySlot
				if not f31_local13 then
				
				else
					f31_local12.attachSlot = f31_local13
					f31_local12.isNewAttachment = f31_local3
					f31_local12.survivalCost = event.attachmentData.survivalCost
					f31_local6 = f31_local7( f31_local8, f31_local9, f31_local10, f31_local11, f31_local12 )
					if CONDITIONS.InGame() then
						Engine[0x6055C55456F05DF]( "equip_item_ingame", 1 )
					end
					DYN_ATTACHMENT.UpdateLoadoutWeaponStreamedImages( element, f30_arg0, DYN_ATTACHMENT.StreamedImageAction.ADD )
				end
			end
			f31_local13 = f30_arg0
		else
			LUI.FlowManager.RequestLeaveMenuByName( LOADOUT.GetAttachmentSelectMenuRef() )
		end
		if not f31_local6 then
			f30_arg0( element, f30_arg0 )
		end
		return true
	end )
end

local f0_local8 = function ( f29_arg0, f29_arg1, f29_arg2 )
	if not f29_arg2.weaponSlot then
		DebugPrint( "WARNING: Missing \"weaponSlot\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f29_arg2.weaponSlot = 0
	end
	if not f29_arg2.loadoutIndex then
		DebugPrint( "WARNING: Missing \"loadoutIndex\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f29_arg2.loadoutIndex = 0
	end
	if not f29_arg2.category then
		DebugPrint( "WARNING: Missing \"category\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f29_arg2.category = "rail"
	end
	if not f29_arg2.attachments then
		DebugPrint( "WARNING: Missing \"attachSlot\" option for AttachmentSelect menu. Only OK after a MyChanges." )
		f29_arg2.attachments = CSV.ReadRow( CSV.attachments, 3 )
	end
end

local f0_local9 = function ( f28_arg0, f28_arg1 )
	assert( f28_arg0.GLAttachmentsFrontend )
	assert( f28_arg0.GridMask )
	f28_arg0.Attachments = f28_arg0.GLAttachmentsFrontend
	f28_arg0.Attachments:SetMask( f28_arg0.GridMask )
	if CONDITIONS.InFrontend() then
		if f28_arg0.HelperBar then
			f28_arg0.HelperBar.Background:SetAlpha( 0 )
		end
		LUI.TextChat.SetupMenuForNoChat( f28_arg0 )
	end
	local f28_local0 = ACTIONS.AnimateSequence
	local f28_local1 = f28_arg0
	local f28_local2
	if CONDITIONS.IsSplitscreen() then
		f28_local2 = "Splitscreen"
	else
		f28_local2 = "Regular"
	end
	f28_local0( f28_local1, f28_local2 )
end

local f0_local10 = function ( f27_arg0, f27_arg1 )
	local f27_local0 = ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview )
	local f27_local1 = ""
	local f27_local2 = ""
	if f27_arg0._category == "gunperk" then
		f27_local1 = "ammo_display_origin"
		local f27_local3 = CLIENT_MODEL.GetClientModelIndex( CLIENT_MODEL.coreMPModels.AMMO_DISPLAY )
		local f27_local4 = ClientModel[0x9088CC2C1E6A1E9]( f27_local3, CLIENT_MODEL.coreMPModels.GUN_VISE_BASE.tagOrigin )
		local f27_local5 = ClientModel[0x7FE4C5AFE1F4377]( f27_local3 )
		f27_local2 = f27_local1 .. "," .. f27_local4.xPosition .. "," .. f27_local4.yPosition .. "," .. f27_local4.zPosition .. "," .. f27_local5.xAngle .. "," .. f27_local5.yAngle .. "," .. f27_local5.zAngle
	else
		f27_local1 = StringTable[0x2DCF0973239E909]( CSV.attachmentCategories.file, CSV.attachmentCategories.cols.ref, f27_arg0._category, CSV.attachmentCategories.cols.bone )
		local f27_local3 = Engine[0xC3B7925CCAC9430]( f27_arg1, f27_local0, f27_local1 )
		f27_local2 = f27_local1 .. "," .. f27_local3.xPosition .. "," .. f27_local3.yPosition .. "," .. f27_local3.zPosition .. "," .. f27_local3.xAngle .. "," .. f27_local3.yAngle .. "," .. f27_local3.zAngle
	end
	Engine[0x6055C55456F05DF]( f27_local2, 1 )
end

local f0_local11 = function ( f25_arg0, f25_arg1, f25_arg2 )
	if CONDITIONS.InGame() and not CONDITIONS.IsThirdGameMode() then
		if f25_arg0.HelperBar then
			f25_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
				clickable = true,
				priority = 5,
				ignoreTooltip = false,
				side = "left",
				kbmTooltipPromptOverload = "button_dismiss_pause_menu",
				button_ref = "button_start",
				helper_text = Engine[0xED84C33EC5F01EA]( 0xEF0F75B0AB08E35 )
			} )
		end
		f25_arg0.bindButton:addEventHandler( "button_start", function ( f26_arg0, f26_arg1 )
			LUI.FlowManager.RequestCloseAllMenus()
		end )
	end
end

local f0_local12 = function ( f24_arg0 )
	if f24_arg0.InGameMenuBackground then
		ACTIONS.ScaleFullscreen( f24_arg0.InGameMenuBackground )
	end
	if f24_arg0.Vignette then
		ACTIONS.ScaleFullscreen( f24_arg0.Vignette )
	end
	if f24_arg0.Gradient then
		ACTIONS.ScaleFullscreen( f24_arg0.Gradient )
	end
end

local f0_local13 = function ( f23_arg0, f23_arg1, f23_arg2, f23_arg3, f23_arg4 )
	if CONDITIONS.InFrontend( f23_arg0 ) then
		f0_local0( f23_arg0, f23_arg1 )
		ClientWeapon[0x59B77D6F41ED417]( FrontEndScene.ClientWeapons.Preview, false )
		MenuUtils.SetupSceneChangeCallback( f23_arg0, f0_local0( f23_arg0, f23_arg1, f23_arg3, f23_arg2.category ) )
	end
	if CONDITIONS.InFrontend( f23_arg0 ) and f23_arg2.category and GUNSMITH.GetAttachmentCategoryScene( f23_arg4, f23_arg0._weaponTable.variantID, f23_arg2.category ) then
		
	else
		
	end
end

local f0_local14 = function ( f22_arg0, f22_arg1, f22_arg2 )
	f22_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( ATTACHMENT.GetAttachmentCategoryName( f22_arg2 ) ) )
	if not CONDITIONS.IsMobileOrMobileSim() then
		f22_arg0.MenuTitle:SetupBackButton( f22_arg1 )
	end
end

local f0_local15 = function ( f21_arg0 )
	for f21_local0 = 1, #f21_arg0, 1 do
		local f21_local3 = ATTACHMENT.GetBundleByRef( f21_arg0[f21_local0].ref )
		if f21_local3 then
			f21_arg0[f21_local0].isClassified = f21_local3[0x42299CD50F5386E]
		end
	end
end

local f0_local16 = function ( f19_arg0 )
	table.sort( f19_arg0, function ( f20_arg0, f20_arg1 )
		if f20_arg0.ref == ATTACHMENT.none then
			return true
		elseif f20_arg0.isClassified ~= f20_arg1.isClassified then
			local f20_local0 = f20_arg1.isClassified
			if f20_local0 then
				f20_local0 = not f20_arg0.isClassified
			end
			return f20_local0
		elseif f20_arg0.isBlocked ~= f20_arg1.isBlocked then
			local f20_local0 = f20_arg1.isBlocked
			if f20_local0 then
				f20_local0 = not f20_arg0.isBlocked
			end
			return f20_local0
		elseif f20_arg0.unlocked ~= f20_arg1.unlocked then
			local f20_local0 = f20_arg0.unlocked
			if f20_local0 then
				f20_local0 = not f20_arg1.unlocked
			end
			return f20_local0
		elseif f20_arg0.uiOrder ~= f20_arg1.uiOrder then
			return f20_arg0.uiOrder < f20_arg1.uiOrder
		else
			
		end
	end )
end

local f0_local17 = function ( f18_arg0, f18_arg1, f18_arg2 )
	for f18_local0 = 1, #f18_arg2, 1 do
		f18_arg2[f18_local0].uiOrder = f18_local0
		f18_arg2[f18_local0].isBlocked = false
	end
	local f18_local0 = WEAPON.GetWeaponModelName( f18_arg0._weaponTable.weapon, f18_arg0._weaponTable, {
		includeAttachments = true
	} )
	for f18_local11, f18_local12 in ipairs( f18_arg0._weaponTable.attachments ) do
		if f18_local12.ref and f18_local12.ref ~= ATTACHMENT.none then
			local f18_local4 = ClientWeapon[0xD3CE47FE2479379]( f18_arg1, f18_local0, Engine[0x603B6AC5797050A]( f18_local0, f18_local12.ref ) )
			local f18_local5 = Engine[0xED84C33EC5F01EA]( 0xFA36F63F49F92E1, ATTACHMENT.GetName( f18_local12.ref ), ATTACHMENT.GetAttachmentCategoryName( f18_local12.category ) )
			if f18_local4 then
				if LUI.IsItemInArray( f18_local4.blockedAttachmentCategories, f18_arg0._category ) then
					for f18_local9, f18_local10 in ipairs( f18_arg2 ) do
						if f18_local10.ref ~= ATTACHMENT.none then
							f18_local10.isBlocked = true
							f18_local10.blockedBy = f18_local5
						end
					end
				end
				if f18_local4.blockedBaseTypes or f18_local4.blockedAttachments then
					for f18_local9, f18_local10 in ipairs( f18_arg2 ) do
						if f18_local10.ref ~= f18_arg0._equippedAttach and f18_local12.category ~= f18_local10.category then
							if f18_local4.blockedBaseTypes and LUI.IsItemInArray( f18_local4.blockedBaseTypes, f18_local10.baseTypeName ) then
								f18_local10.isBlocked = true
								f18_local10.blockedBy = f18_local5
							end
							if f18_local4.blockedAttachments and LUI.IsItemInArray( f18_local4.blockedAttachments, f18_local10.ref ) then
								f18_local10.isBlocked = true
								f18_local10.blockedBy = f18_local5
							end
						end
					end
				end
			end
		end
	end
end

local f0_local18 = function ( f4_arg0, f4_arg1, f4_arg2 )
	assert( f4_arg0.GunsmithDetails )
	assert( f4_arg0.bindButton )
	if Engine[0x2DA54CF5D6B7F02]() then
		f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	end
	f0_local0( f4_arg0, f4_arg1 )
	f0_local0( f4_arg0, f4_arg1 )
	assert( f4_arg2.weaponSlot )
	assert( f4_arg2.loadoutIndex )
	assert( f4_arg2.category )
	assert( f4_arg2.attachments )
	assert( f4_arg0.MenuTitle )
	assert( f4_arg0.MenuTitle.MenuTitle )
	local f4_local0 = LOADOUT.GetLoadoutSquadMember( f4_arg1 )
	f4_local0 = f4_local0.loadouts[f4_arg2.loadoutIndex]
	if CONDITIONS.IsWaveGameType() then
		local f4_local1 = PLAYER_DATA.IO( f4_arg1, LOADOUT.GetLoadoutStatsGroup() )
		f4_local0 = f4_local1.squadMembers.loadoutWaveMode
	end
	f4_arg0._category = f4_arg2.category
	f4_arg0._weaponPlayerData = f4_local0.weaponSetups[f4_arg2.weaponSlot]
	f4_arg0._weaponTable = WEAPON.GenerateWeaponTable( f4_arg0._weaponPlayerData )
	f4_arg0._weaponRef = f4_arg0._weaponTable.weapon
	if f4_arg0._category ~= ATTACHMENT.receiverCategory and 0 < #f4_arg2.attachments and f4_arg2.attachments[1].ref ~= ATTACHMENT.none then
		table.insert( f4_arg2.attachments, 1, {
			name = 0x582A97E6B28D01C,
			unlocked = true,
			image = nil,
			ref = ATTACHMENT.none,
			category = f4_arg0._category,
			variants = {},
			gunsmithAttach = {
				lootID = 4294967295,
				challengeID = {}
			}
		} )
	end
	f0_local0( f4_arg2.attachments )
	if CONDITIONS.InGame() then
		local f4_local1 = {}
		for f4_local2 = 1, #f4_arg2.attachments, 1 do
			if f4_arg2.attachments[f4_local2].unlocked == true and not f4_arg2.attachments.isClassified then
				table.insert( f4_local1, f4_arg2.attachments[f4_local2] )
			end
		end
		f4_arg2.attachments = f4_local1
	end
	f4_arg0._attachmentListData = f4_arg2.attachments
	local f4_local1 = f4_arg2.attachSlot
	if f4_local1 == nil then
		f4_local1 = GUNSMITH.GetAvailableAttachmentSetupIndex( f4_arg0._category, f4_arg0._weaponPlayerData )
		if f4_local1 == nil then
			f4_local1 = GUNSMITH.GetSelectedBlueprintAttachIndexForCategory( f4_arg0._category, f4_arg0._weaponTable )
		end
	end
	f4_arg0._attachmentVariants = {}
	local f4_local3 = {
		[f4_arg0._weaponRef] = true
	}
	Engine[0xD344B7DE66AFA81]( "Insert attachment mods" )
	for f4_local18, f4_local19 in ipairs( WEAPON.GetModifications( f4_arg1, {
		forceLoot = true,
		checkOwnership = true,
		byWeapons = f4_local3
	} ) ) do
		if f4_local19.allPossibleAttachments then
			for f4_local14, f4_local15 in ipairs( f4_local19.allPossibleAttachments ) do
				for f4_local11, f4_local12 in ipairs( f4_arg0._attachmentListData ) do
					if f4_local15.ref == f4_local12.baseRef then
						if f4_arg0._attachmentVariants[f4_local12.baseRef] == nil then
							f4_arg0._attachmentVariants[f4_local12.baseRef] = {}
						end
						table.insert( f4_arg0._attachmentVariants[f4_local12.baseRef], f4_local15.variantID )
					end
				end
			end
		end
	end
	Engine[0xC99CAB76F12E539]()
	f4_local5 = f4_arg0._weaponTable.attachments[f4_local1]
	if f4_local5 then
		f4_local5 = f4_arg0._weaponTable.attachments[f4_local1].ref
	end
	f4_arg0._equippedAttach = f4_local5
	f4_local5 = f4_arg0._weaponTable.attachments[f4_local1]
	if f4_local5 then
		f4_local5 = f4_arg0._weaponTable.attachments[f4_local1].variantID
	end
	f4_arg0._equippedVariant = f4_local5
	f0_local0( f4_arg0, f4_arg1, f4_arg0._attachmentListData )
	f0_local0( f4_arg0._attachmentListData )
	if f4_arg0._attachmentListData[1].ref == ATTACHMENT.none then
		f4_local5 = 1
	else
		f4_local5 = 0
	end
	if f4_arg0._equippedAttach ~= nil then
		for f4_local19, f4_local8 in ipairs( f4_arg0._attachmentListData ) do
			if f4_local8.ref ~= ATTACHMENT.none and f4_arg0._equippedAttach == f4_local8.ref then
				f4_local5 = f4_local19 - 1
			end
		end
	end
	f4_local6 = function ()
		local f17_local0 = f4_arg0._attachmentListData
		for f17_local1 = 1, #f17_local0, 1 do
			if 1 < #f17_local0[f17_local1].variants then
				return true
			end
		end
		return false
	end
	
	if Engine[0x12586A3F4FB490E]() and f4_local6() and not Onboarding.GunsmithCustoms.WasCompleted( f4_arg0, f4_arg1 ) then
		LUI.FlowManager.RequestPopupMenu( f4_arg0, "onboardingpopup", true, f4_arg1, false, ONBOARDING_DATA.GetOnboardingGunsmithCustomsData() )
		Onboarding.GunsmithCustoms.MarkCompleted( f4_arg0, f4_arg1 )
	end
	f4_local7 = function ()
		LUI.FlowManager.RequestAddMenu( "AttachmentAppearanceSelect", true, f4_arg0, false, {
			variantData = f4_arg0._focusedAttachmentData.variantData,
			weaponSlot = f4_arg0.weaponSlot,
			loadoutIndex = f4_arg0.loadoutIndex,
			attachSlot = f4_arg0 and f4_arg0 or f4_arg0._focusedAttachmentData.blockedCategorySlot,
			attachmentRef = f4_arg0._focusedAttachmentData.ref,
			blockedCategorySlot = f4_arg0._focusedAttachmentData.blockedCategorySlot,
			category = f4_arg0.category
		} )
	end
	
	f4_arg0.bindButton:addEventHandler( "button_alt1", function ( f15_arg0, f15_arg1 )
		if GUNSMITH.IsGunsmithCustomsAvailable( f4_arg0, f4_arg0._focusedAttachmentData.unlocked, f4_arg0._focusedAttachmentData.variantData, f4_arg0._weaponRef, f4_arg0.category ) then
			f4_arg0()
		end
	end )
	f4_local18 = #f4_arg0._attachmentListData
	f4_arg0.Attachments:SetNumChildren( f4_local18 )
	f4_arg0.Attachments:SetDefaultFocus( f4_arg0.Attachments:GetPositionForIndex( f4_local5, {
		relativePosition = false
	} ) )
	f4_arg0.Attachments:MouseSetActiveToDefaultFocusMenuCreate( f4_arg1 )
	f4_arg0.Attachments:SetRefreshChild( function ( f10_arg0, f10_arg1, f10_arg2 )
		local f10_local0 = f4_arg0._attachmentListData[f4_arg0.Attachments:GetContentIndex( f10_arg1, f10_arg2 ) + 1]
		Engine[0xD344B7DE66AFA81]( "Attachments:SetRefreshChild" )
		if f10_local0.baseRef then
			f10_local0.variantData = {}
			f10_local0.variantData[ATTACHMENT.baseVariant + 1] = {
				ref = f10_local0.baseRef,
				variantID = ATTACHMENT.baseVariant,
				name = f10_local0.name,
				lootImage = f10_local0.image,
				uiImage = f10_local0.image
			}
			local f10_local1 = Engine[0xD3946E1B3E34A42]( GL_HACK.GetWeaponMPRef( f4_arg0._weaponRef ), f10_local0.baseRef )
			if f4_arg0._attachmentVariants[f10_local0.baseRef] then
				for f10_local12, f10_local13 in ipairs( f4_arg0._attachmentVariants[f10_local0.baseRef] ) do
					for f10_local9, f10_local10 in ipairs( f10_local1 ) do
						if f10_local13 == f10_local9 and f10_local13 ~= ATTACHMENT.baseVariant and f10_local0.variantData[f10_local12 + 1] == nil then
							local f10_local5 = f10_local0.variantData
							local f10_local6 = f10_local12 + 1
							local f10_local7 = {
								ref = f10_local0.baseRef,
								variantID = f10_local13
							}
							local f10_local8
							if not LUI.StringIsNilOrEmpty( f10_local10[0x55F116BF695C8F6] ) then
								f10_local8 = f10_local10[0x55F116BF695C8F6]
								if not f10_local8 then
								
								else
									f10_local7.name = f10_local8
									f10_local7.lootImage = f10_local0.image
									f10_local7.uiImage = f10_local0.image
									f10_local5[f10_local6] = f10_local7
								end
							end
							f10_local8 = f10_local0.name
						end
					end
				end
			end
		end
		Engine[0xC99CAB76F12E539]()
		f10_arg0:Setup( f4_arg0, f10_local0, f10_local0.ref == f4_arg0._equippedAttach, f4_arg0._weaponTable, MatchRules[0x722F56788C744E9]( f10_local0.ref, f4_arg0._weaponRef ), f4_arg0, f4_arg0 )
		f10_arg0:SetupContextualMenu()
		f10_arg0:AddContextualMenuAction( {
			id = "chooseAppearance",
			actionName = Engine[0xED84C33EC5F01EA]( 0x894F428657B5CDD ),
			conditionFunction = function ()
				return GUNSMITH.IsGunsmithCustomsAvailable( f10_arg0, f10_arg0._focusedAttachmentData.unlocked, f10_arg0._focusedAttachmentData.variants, f10_arg0._weaponRef, f10_arg0.category )
			end,
			actionFunction = function ()
				f10_arg0()
			end
		} )
		if not f10_arg0._parentHandlersAdded then
			local f10_local4 = function ( f11_arg0, f11_arg1 )
				if CONDITIONS.InFrontend() and CONDITIONS.IsWeaponPreviewEnabled() then
					if f10_arg0.HelperBar then
						if f10_arg0._data.isClassified then
							f10_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
								button_ref = "button_r3"
							} )
						else
							f10_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
								side = "left",
								button_ref = "button_r3",
								priority = 10,
								helper_text = Engine[0xED84C33EC5F01EA]( 0xCBEAF62674E5E75 )
							} )
						end
					end
					f10_arg0.bindButton:addEventHandler( "button_right_stick", function ( f12_arg0, f12_arg1 )
						if f11_arg0._data.isClassified then
							return 
						end
						f11_arg0.weaponTable = f11_arg0._currentTable
						LUI.FlowManager.RequestAddMenu( "WeaponPreview", true, f11_arg0, false, f11_arg0, true )
						if f12_arg1.qualifier then
							Engine[0xC4146BA76D0F982]( CoD.SFX.MouseClick )
						end
					end )
				end
			end
			
			f10_arg0:addEventHandler( "button_over", f10_local4 )
			f10_arg0:addEventHandler( "button_over_disable", f10_local4 )
			f10_arg0._handlersAdded = true
		end
	end )
	f4_arg0.Attachments:SetNumColumns( #f4_arg2.attachments )
	f4_arg0.Attachments:SetNumRows( 1 )
	f4_arg0.Attachments:RefreshContent()
	f4_arg0:addEventHandler( "update_input_type", function ( f9_arg0, f9_arg1 )
		if LUI.IsLastInputGamepad( f9_arg1.controllerIndex ) and 0 < #f4_arg0.attachments then
			f9_arg0.Attachments:processEvent( {
				name = "gain_focus"
			} )
		end
	end )
	f4_arg0:addEventHandler( "menu_create", function ( f8_arg0, f8_arg1 )
		f8_arg0.Attachments:RefreshContent()
		if not f8_arg0.Attachments:GetFocusPositionIndex() then
			f8_arg0.Attachments:SetFocusedPosition( {
				y = 0,
				x = f4_arg0
			}, true )
		end
		if LUI.IsLastInputMouseNavigation( f4_arg0 ) then
			f8_arg0:processEvent( {
				name = "update_showcase",
				attachmentData = f4_arg0.attachments[f4_arg0 + 1]
			} )
		end
	end )
	f0_local0( f4_arg0, f4_arg1, f4_local1 )
	f0_local0( f4_arg0, f4_arg1, f4_local1 )
	f4_arg0._currentTable = f0_local0( f4_arg0, f4_local1 )
	f0_local0( f4_arg0, f4_arg1, f4_arg0._category )
	f0_local0( f4_arg0, f4_arg1, f4_arg2, f4_local1, f4_arg0._weaponRef )
	f0_local0( f4_arg0, f4_arg1, f4_arg2 )
	f0_local0( f4_arg0 )
	f4_local19 = f4_arg0.Attachments
	local f4_local8 = f4_arg0.SideArrows
	local f4_local9 = f4_arg0.MouseArea
	if f4_local19 and f4_local8 and f4_local9 then
		f4_local19:SetSnapOnScrollBarMouseDrag( true )
		f4_local8:SetupSideButtons( f4_local19, f4_local18, {
			useSetupRowHeight = false
		} )
		f4_local8:UpdateSideButtons()
		f4_local19._onNewTargetFocusPosition = function ( f7_arg0, f7_arg1 )
			if f4_arg0 then
				f4_arg0:AddScrollWatch()
			end
		end
		
		f4_local19:addEventHandler( "gamepad_button", function ( f6_arg0, f6_arg1 )
			if f4_arg0 and CONDITIONS.IsMouseWheelEvent( f6_arg1 ) and f6_arg1.down then
				return f4_arg0:ExternalScroll( f6_arg1 )
			else
				
			end
		end )
		f4_local9:addEventHandler( "gamepad_button", function ( f5_arg0, f5_arg1 )
			if CONDITIONS.IsMouseWheelEvent( f5_arg1 ) and f5_arg1.down then
				f5_arg1.forceScrollMove = true
				f4_arg0:processEvent( f5_arg1 )
			end
		end )
	end
end

local f0_local19 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.PostLoadShared = f0_local0
end

function AttachmentSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "AttachmentSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	if not self.bindButton then
		local f1_local3 = LUI.UIBindButton.new()
		f1_local3.id = "selfBindButton"
		self:addElement( f1_local3 )
		self.bindButton = f1_local3
	end
	self.bindButton:addEventHandler( "button_secondary", function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or menu
		ACTIONS.LeaveMenu( menu )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "AttachmentSelectBase", AttachmentSelectBase )
LockTable( _M )
