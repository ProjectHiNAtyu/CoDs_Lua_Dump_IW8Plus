-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
FenceStatsReset = LUI.Class( LUI.Fence )
FenceStatsReset.CODE_STATE = {
	RESET_STATS_REASON_GUEST = 3,
	RESET_STATS_NO_RESET = 0,
	RESET_STATS_REASON_NOT_FOUND = 1,
	RESET_STATS_REASON_ONLINE_STATS_RESET = 7,
	RESET_STATS_REASON_PIPELINE = 2,
	RESET_STATS_REASON_BAD_FILE_VERSION = 5,
	RESET_STATS_REASON_BAD_PLAYERDATA_VERSION = 6,
	RESET_STATS_REASON_CORRUPT = 4
}
FenceStatsReset.init = function ( f15_arg0 )
	FenceStatsReset.super.init( f15_arg0 )
end

FenceStatsReset.Start = function ( f14_arg0 )
	DebugPrint( "FenceStatsReset.Start" )
end

FenceStatsReset.Stop = function ( f13_arg0 )
	DebugPrint( "FenceStatsReset.Stop" )
	f13_arg0:CloseGettingDataPopup()
end

FenceStatsReset.PostFail = function ( f12_arg0 )
	if f12_arg0._state == LUI.Fence.STATE.fail then
		local f12_local0 = Engine[0x45B054C920178E9]()
		LUI.FlowManager.RequestPopupMenu( nil, "GettingDataErrorPopup", false, f12_local0, false, {
			controllerIndex = f12_local0,
			errorString = Engine[0xED84C33EC5F01EA]( "EXE/DEMONWARE_DISCONNECT" )
		}, nil, false, false )
	end
end

FenceStatsReset.UpdateState = function ( f8_arg0 )
	assert( f8_arg0._state ~= LUI.Fence.STATE.fail )
	f8_arg0._state = LUI.Fence.STATE.pass
	assert( f8_arg0._statsSource )
	for f8_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		local f8_local3 = Engine[0x10A5732AB1DAE9F]( f8_local0 )
		local f8_local4
		if f8_local3 then
			f8_local4 = f8_local3
		else
			f8_local4 = Engine[0x757E77CA15D6B8F]( f8_local0 )
		end
		if f8_local3 and not f8_local4 then
			if Fences[0x6C69CF6BF3AB0F5]( f8_local0, f8_arg0._statsSource ) ~= true then
				f8_arg0:OpenGettingDataPopup()
				f8_arg0._state = LUI.Fence.STATE.block
			end
			f8_arg0:CloseGettingDataPopup()
			local f8_local5 = Fences[0x9B2306E8EEA3E46]( f8_local0, f8_arg0._statsSource )
			if 0 < f8_local5 then
				if f8_arg0._declined then
					f8_arg0._state = LUI.Fence.STATE.fail
				end
				f8_arg0._state = LUI.Fence.STATE.block
				if not f8_arg0._warningOpen then
					f8_arg0._warningOpen = true
					DebugPrint( "FenceStatsReset.UpdateState codeState: " .. tostring( f8_local5 ) )
					local f8_local6 = {
						errorCode = f8_local5
					}
					if f8_local6.errorCode ~= FenceStatsReset.CODE_STATE.RESET_STATS_REASON_ONLINE_STATS_RESET and f8_local6.errorCode ~= FenceStatsReset.CODE_STATE.RESET_STATS_REASON_CORRUPT then
						local f8_local7 = Dvar[0x9E5BE3B4BBA4E0E]( "#x35fb9f743ed3bee34" )
					else
						local f8_local7 = true
					end
					if CONDITIONS.IsDemoBuildOrDevBuild() and (f8_local6.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION or f8_local6.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_CORRUPT) then
						local f8_local7 = true
					end
					if f8_arg0._statsSource == CoD.StatsSource.OFFLINE then
						local f8_local7 = true
					end
					if f8_local7 then
						f8_local6.controllerIndex = f8_local0
						f8_local6.onAccept = function ( f11_arg0, f11_arg1 )
							f8_arg0._warningOpen = false
							Fences[0x882C95F1B7BE433]( f11_arg1, f8_arg0._statsSource )
							LUI.FlowManager.RequestLeaveMenu( f11_arg0, nil )
						end
						
						f8_local6.onDecline = function ()
							f8_arg0._warningOpen = false
							f8_arg0._declined = true
						end
						
						LUI.FlowManager.RequestPopupMenu( unused, "StatsResetPopup", true, f8_local0, false, f8_local6, nil, true, true )
					else
						f8_local6.controllerIndex = f8_local0
						f8_local6.action = function ()
							f8_arg0._warningOpen = false
							f8_arg0._declined = true
						end
						
						LUI.FlowManager.RequestPopupMenu( unused, "StatsFailurePopup", true, f8_local0, false, f8_local6, nil, true, true )
					end
				end
			end
		end
	end
end

FenceStatsReset.OpenGettingDataPopup = function ( f6_arg0 )
	if not LUI.FlowManager.IsInStack( "GettingDataPopup" ) then
		LUI.FlowManager.RequestPopupMenu( nil, "GettingDataPopup", false, nil, false, {
			onCancel = function ( f7_arg0, f7_arg1 )
				DebugPrint( "Cancelling FenceStatsReset" )
				f7_arg0._declined = true
			end
		}, nil, true, true )
	end
end

FenceStatsReset.CloseGettingDataPopup = function ( f5_arg0 )
	if f5_arg0._openedWaitPopup then
		LUI.FlowManager.RequestLeaveMenuByName( "GettingDataPopup", true )
		f5_arg0._openedWaitPopup = false
	end
end

FenceOnlineStatsReset = LUI.Class( FenceStatsReset )
FenceOnlineStatsReset.init = function ( f4_arg0 )
	FenceOnlineStatsReset.super.init( f4_arg0 )
	f4_arg0._statsSource = CoD.StatsSource.ONLINE
end

LUI.Fence.Register( "onlineStatsReset", FenceOnlineStatsReset )
FenceOfflineStatsReset = LUI.Class( FenceStatsReset )
FenceOfflineStatsReset.init = function ( f3_arg0 )
	FenceOfflineStatsReset.super.init( f3_arg0 )
	f3_arg0._statsSource = CoD.StatsSource.OFFLINE
end

LUI.Fence.Register( "offlineStatsReset", FenceOfflineStatsReset )
function StatsFailurePopup( f2_arg0, f2_arg1 )
	assert( f2_arg1.errorCode )
	assert( f2_arg1.controllerIndex )
	local f2_local0 = Engine[0x15D98DF5F61904B]
	local f2_local1 = f2_arg1.controllerIndex
	local f2_local2 = "dlog_event_stats_failure_need_support"
	local f2_local3 = {}
	local f2_local4 = f2_arg1.errorCode
	if not f2_local4 then
		f2_local4 = FenceStatsReset.CODE_STATE.RESET_STATS_NO_RESET
	end
	f2_local3.error_code = f2_local4
	f2_local0( f2_local1, f2_local2, f2_local3 )
	f2_local0 = "MENU/STATS_FAILURE_CONTACT_SUPPORT"
	local f2_local5 = f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_CORRUPT
	if (f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION) or f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_PLAYERDATA_VERSION then
		f2_local0 = "MENU/STATS_VERSION_FAILURE_CONTACT_SUPPORT"
	end
	return MenuBuilder.BuildRegisteredType( "MessagePopup", {
		messageText = Engine[0xED84C33EC5F01EA]( f2_local0 ),
		headerText = Engine[0xED84C33EC5F01EA]( "MENU/ERROR" ),
		action = f2_arg1.action,
		controllerIndex = f2_arg1.controllerIndex or 0
	} )
end

function StatsResetPopup( f1_arg0, f1_arg1 )
	assert( f1_arg1.errorCode )
	assert( f1_arg1.onAccept )
	assert( f1_arg1.onDecline )
	assert( f1_arg1.controllerIndex )
	local f1_local0 = "MENU/CORRUPT_STATS_WARNING_ONLINE"
	if (f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION) or f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_PLAYERDATA_VERSION then
		f1_local0 = "MENU/STATS_WRONG_VERSION_WARNING"
	elseif f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_ONLINE_STATS_RESET then
		f1_local0 = "MENU/ONLINE_STATS_RESET"
	end
	local f1_local1 = MenuBuilder.BuildRegisteredType( "PopupYesNo", {
		headerText = Engine[0xED84C33EC5F01EA]( "MENU/ERROR" ),
		messageText = Engine[0xED84C33EC5F01EA]( f1_local0 ),
		yesAction = f1_arg1.onAccept,
		noAction = f1_arg1.onDecline,
		controllerIndex = f1_arg1.controllerIndex
	} )
	f1_local1.id = "StatsResetPopup"
	return f1_local1
end

MenuBuilder.registerType( "StatsResetPopup", StatsResetPopup )
MenuBuilder.registerType( "StatsFailurePopup", StatsFailurePopup )
LockTable( _M )
