-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
FenceSignIn = LUI.Class( LUI.Fence )
FenceSignIn.ACCOUNT_PICKER_STATE = {
	picking = 2,
	inactive = 1
}
FenceSignIn.init = function ( f18_arg0 )
	LUI.Fence.init( f18_arg0 )
	f18_arg0._perController = {}
	for f18_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		f18_arg0._perController[f18_local0] = {
			accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
		}
	end
end

FenceSignIn.Start = function ( f17_arg0 )
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x3CF47DFBAA3E8C ) and Engine[0x836C8AD984F14F6]() and 1 < Dvar[0x22EAAB59AA27E9B]( 0xE8C3FAE8A1097CC ) then
		Dvar[0x2414681ECAB880F]( 0xE8C3FAE8A1097CC, 1 )
	end
end

FenceSignIn.Stop = function ( f16_arg0 )
	
end

FenceSignIn.PostFail = function ( f15_arg0 )
	local f15_local0 = LUI.WebViewManager.Instance()
	if f15_local0:GetAndResetDeclinedEula() then
		return 
	end
	f15_local0 = Engine[0x45B054C920178E9]()
	if f15_arg0._state == LUI.Fence.STATE.fail then
		if CONDITIONS.IsPermanentOrTemporaryBan( f15_local0 ) then
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x89899570DE48485 ) and CONDITIONS.MobileIsBootPresentationEnabled() then
				Web[0xE5D144212B21563]()
			else
				LUI.FlowManager.RequestPopupMenu( nil, "popup_ban", false, f15_local0, false, {
					controllerIndex = f15_local0,
					noPremium = f15_arg0._noPremium
				}, nil, false, false )
			end
		else
			local f15_local1 = {
				isQuickAccessShortcutsDisabled = true,
				cancelClosesPopup = false
			}
			if not CONDITIONS.IsMenuInStack( "MainLockoutMenu" ) and not CONDITIONS.IsPC() then
				LUI.FlowManager.RequestAutomaticNavigation( PartyUIRoot.LOCKOUT_MENU )
				LUI.FlowManager.RequestSetStack( "MainLockoutMenu", {
					name = "MainLockoutMenu"
				} )
			end
			LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_error", false, f15_local0, not LUI.FlowManager.IsMenuOnTop( "MainLockoutMenu" ), f15_local1, nil, true, true )
		end
	end
end

function PopupSignInQueue( f13_arg0, f13_arg1 )
	local f13_local0 = {
		message = Engine[0xED84C33EC5F01EA]( 0xA479AD2705AC200 ),
		description = Engine[0xED84C33EC5F01EA]( 0x62EA86FE707A789 ),
		buttons = {
			label = Engine[0xED84C33EC5F01EA]( Engine[0x575E9C5B9AAB6F4]() and 0x4E76830223A336F or 0x3956F54E845F7DE ),
			alignment = LUI.Alignment.Center,
			action = function ()
				if Engine[0x575E9C5B9AAB6F4]() then
					Engine[0xDEE6107B26F8BB6]()
				else
					LUI.FlowManager.RequestLeaveMenu()
				end
			end
		}
	}
	local f13_local1 = f13_arg1.controllerIndex
	if not f13_local1 then
		f13_local1 = Engine[0x45B054C920178E9]()
	end
	f13_local0.controllerIndex = f13_local1
	f13_local1 = MenuBuilder.BuildRegisteredType( "FenceSigninQueueDialogPopup", f13_local0 )
	f13_local1.id = "popup_signin_queue"
	return f13_local1
end

FenceSignIn.OpenSignInQueuedPopup = function ( f11_arg0 )
	local f11_local0 = f11_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_signin_queue", false, nil, false, {
		onCancel = function ( f12_arg0, f12_arg1 )
			f11_arg0._perController[f12_arg1].isCancelling = true
		end
	}, nil, true, true )
	f11_arg0._openedWaitPopup = "popup_signin_queue"
end

FenceSignIn.ProcessingBattleNetSignIn = function ( f9_arg0 )
	local f9_local0 = 0
	if not Engine[0xD2813B521711C11]( f9_local0 ) then
		local f9_local1 = Engine[0x170DF85DCE182E7]()
		local f9_local2 = function ( f10_arg0 )
			if f9_arg0._openedWaitPopup and f9_arg0._openedWaitPopup ~= f10_arg0 then
				LUI.FlowManager.RequestLeaveMenuByName( f9_arg0._openedWaitPopup, true )
				f9_arg0._openedWaitPopup = nil
				return true
			elseif not f9_arg0._openedWaitPopup then
				return true
			else
				return false
			end
		end
		
		if f9_local1 then
			if f9_local2( "popup_signin_queue" ) then
				f9_arg0:OpenSignInQueuedPopup()
			end
		elseif f9_arg0._openedWaitPopup then
			LUI.FlowManager.RequestLeaveMenuByName( f9_arg0._openedWaitPopup, true )
			f9_arg0._openedWaitPopup = nil
		end
		local f9_local3 = Engine[0x2D5DC5650ED3A1E]( f9_local0 )
		if f9_local3 == BattleNetAuthState.NOT_SIGNED_IN and Engine[0xAF7EC673FFF4FE4]() ~= nil then
			f9_arg0._state = LUI.Fence.STATE.fail
		elseif f9_local3 ~= BattleNetAuthState.SIGNED_IN then
			f9_arg0._state = LUI.Fence.STATE.block
		end
	elseif f9_arg0._openedWaitPopup then
		LUI.FlowManager.RequestLeaveMenuByName( f9_arg0._openedWaitPopup, true )
		f9_arg0._openedWaitPopup = nil
	end
end

FenceSignIn.ProcessingSteamSignIn = function ( f8_arg0 )
	if not Engine[0x2DE6F7A69111B92]( 0 ) and Engine[0xAF7EC673FFF4FE4]() then
		f8_arg0._state = LUI.Fence.STATE.fail
	end
end

FenceSignIn.UpdateState = function ( f7_arg0 )
	f7_arg0._state = LUI.Fence.STATE.pass
	if Engine[0x21103F2ABD5B496]() then
		f7_arg0._state = LUI.Fence.STATE.pass
		return 
	elseif CONDITIONS.IsBattleNet() then
		f7_arg0:ProcessingBattleNetSignIn()
		return 
	elseif CONDITIONS.IsSteamGame() then
		f7_arg0:ProcessingSteamSignIn()
		return 
	elseif Engine[0xE457944EE65BCA1]() then
		f7_arg0._state = LUI.Fence.STATE.block
		return 
	end
	for f7_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f7_local0 ) and not Engine[0xD2813B521711C11]( f7_local0 ) and f7_arg0._perController[f7_local0].accountPickerState == FenceSignIn.ACCOUNT_PICKER_STATE.inactive then
			f7_arg0._state = LUI.Fence.STATE.block
			f7_arg0._perController[f7_local0].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.picking
			Engine[0x4DECC2B7654EAB1]( f7_local0, false )
			return 
		end
	end
	local f7_local0 = 0
	local f7_local1 = 0
	for f7_local2 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f7_local2 ) and Engine[0xD2813B521711C11]( f7_local2 ) then
			f7_local0 = f7_local0 + 1
			if not Engine[0x757E77CA15D6B8F]( f7_local2 ) then
				f7_local1 = f7_local1 + 1
			end
		end
	end
	local f7_local2 = false
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x3DDB961100B5F47 ) and Engine[0x1DCFAFA7CE6F8D0]() and 0 < f7_local0 then
		f7_local2 = true
	end
	if 0 < f7_local0 and 0 < f7_local1 then
		f7_local2 = true
	end
	if f7_local2 then
		for f7_local3 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			if Engine[0x10A5732AB1DAE9F]( f7_local3 ) and not Engine[0xD2813B521711C11]( f7_local3 ) then
				Engine[0x54DE5FB69D3BA90]( f7_local3 )
				f7_arg0._perController[f7_local3].accountPickerState = FenceSignIn.ACCOUNT_PICKER_STATE.inactive
			end
		end
	else
		f7_arg0._state = LUI.Fence.STATE.fail
	end
end

function PopupSignInError( f1_arg0, f1_arg1 )
	local f1_local0 = 0xD1ED4A270AD4A2F
	if Engine[0x1DCFAFA7CE6F8D0]() then
		f1_local0 = 0xC6EFCA78C461C6
	end
	if Engine[0x9258F49F515F97B]() then
		f1_local0 = 0x91298E49D2B36AC
	end
	local f1_local1 = f1_arg1
	f1_local1.title = Engine[0xED84C33EC5F01EA]( 0xBDAA9535F4F682B )
	f1_local1.message = Engine[0xED84C33EC5F01EA]( f1_local0 )
	f1_local1.buttons = {
		{
			label = Engine[0xED84C33EC5F01EA]( 0x5C33DA8F6CE65B0 ),
			action = function ()
				
			end
		}
	}
	if Engine[0x5575DCFF312365A]() or Engine[0x9DD5167C6D720F1]() or Engine[0x926B1DECE2B6039]() then
		f1_local1.message = Engine[0xAF7EC673FFF4FE4]()
		f1_local1.buttons[1].label = Engine[0xED84C33EC5F01EA]( 0x4E76830223A336F )
		f1_local1.buttons[1].action = function ()
			Engine[0xDEE6107B26F8BB6]()
		end
		
		if Engine[0xE46B11F69B0F4D5]() then
			f1_local1.useMessageContainer = true
			f1_local1.messageContainerHeight = 300
			table.insert( f1_local1.buttons, 1, {
				label = Engine[0xED84C33EC5F01EA]( 0xCEEE7DB3E04E2C1 ),
				action = function ()
					Engine[0xA265A859B7C189E]( f1_arg0.controllerIndex, 0, "https://account.blizzard.com/details#phone-number" )
					Engine[0xDEE6107B26F8BB6]()
				end
			} )
		end
		if Engine[0x6983E9F2847EAED]() then
			table.insert( f1_local1.buttons, {
				label = Engine[0xED84C33EC5F01EA]( 0x8010973A5846CDA ),
				action = function ( f3_arg0, f3_arg1 )
					Engine[0x34C623E28A1C5E7]( "" )
				end
			} )
		end
		if Engine[0xD87B38D9E227ECC]() then
			if CONDITIONS.IsLFPEnabled() then
				LFP.ForceEndPlayerLFPSession( {
					resetAllData = false,
					eventName = LFP.SEARCH_RESULTS.DISCONNECT
				} )
			end
			f1_local1.title = Engine[0xED84C33EC5F01EA]( 0xD5DFD124B6C28D2 )
		end
	end
	local f1_local2 = MenuBuilder.BuildRegisteredType( "PopupMessageAndButtons", f1_local1 )
	f1_local2.id = "popup_signin_error"
	f1_local2:registerEventHandler( "not_below_blocking_fence", function ( element, event )
		if Engine[0x9D348E40740E9A8]() then
			Engine[0xE49CE4BCE0701D5]( "Sign in fence failed" )
			Dvar[0x8EA06EEDB58D872]( 0xD360034020A5D7A, false )
		end
	end )
	return f1_local2
end

MenuBuilder.registerType( "popup_signin_queue", PopupSignInQueue )
MenuBuilder.registerType( "popup_signin_error", PopupSignInError )
LUI.Fence.Register( "signIn", FenceSignIn )
LockTable( _M )
