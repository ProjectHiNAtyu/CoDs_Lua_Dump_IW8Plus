-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
require( "ui.generated.widgets.buttons.mousebuttonarea" )
require( "ui.generated.widgets.frontend.dmzpersistentoperatorcardcontainer" )
local f0_local0 = function ( f28_arg0, f28_arg1 )
	for f28_local3, f28_local4 in ipairs( f28_arg0.m_references ) do
		local f28_local5 = f28_local4.DismissOperatorButton
		local f28_local6 = f28_local4.OperatorCard
		if LUI.IsLastInputGamepad( f28_arg1 ) then
			f28_local5:SetVisible( false )
		end
		if f28_local6.cardType == DMZ.PersistentOperatorCardType.OPEN then
			f28_local5:SetVisible( false )
		end
		if f28_local6.cardType == DMZ.PersistentOperatorCardType.FULL or f28_local6.cardType == DMZ.PersistentOperatorCardType.SELECT then
			if DMZ.GetFirstFilledOperatorSlotThatIsntSlot( f28_arg1, f28_local6.operatorIndex ) ~= -1 and f28_arg0._childInFocus and f28_arg0._childInFocus.id == f28_local4.id then
				f28_local5:SetVisible( true )
				f28_local4.DismissOperatorTooltip:SetVisible( false )
			else
				f28_local5:SetVisible( false )
				goto basicblock_15:
			end
		end
		if f28_local6.cardType == DMZ.PersistentOperatorCardType.UPSELL then
			f28_local5:SetVisible( false )
		end
	end
end

local f0_local1 = function ( f27_arg0, f27_arg1 )
	f27_arg0._shouldExitOnEquip = f27_arg1
end

local f0_local2 = function ( f26_arg0 )
	if OB.PlayBackgroundCinematic( f26_arg0, OB.Cinematics.BGLight, true ) then
		f26_arg0.Background:SetVisible( false )
	end
end

local f0_local3 = function ( f4_arg0, f4_arg1, f4_arg2 )
	f4_arg0.SetShouldExitOnEquip = f0_local0
	if CONDITIONS.IsOutbreakGametype() then
		f4_arg0:addEventHandler( LUI.TabManager.TAB_SWITCH_EVENT, function ( f25_arg0, f25_arg1 )
			if f25_arg1.newIndex ~= 0 then
				f4_arg0( f4_arg0 )
			end
		end )
		f0_local0( f4_arg0 )
	end
	local f4_local0, f4_local1 = DMZ.GetOperatorSlotsOwnedAndInUseCount( f4_arg1 )
	f4_arg0.OperatorCardGrid:SetRefreshChild( function ( f7_arg0, f7_arg1, f7_arg2 )
		local f7_local0, f7_local1, f7_local2, f7_local3 = nil
		local f7_local4 = {
			removeShadow = true,
			removeTextBacker = true,
			removeMask = true,
			removeEquipBanner = true,
			imageSize = "None",
			removeText = true,
			removeBorder = true,
			colorOverrides = {
				highlightEnable = SWATCHES[0x3E789DB0A12E313][0x13EA697443B185C]
			},
			hideHighlight = noAction
		}
		if f7_arg1 < f4_arg0 then
			if DMZ.IsOperatorSlotInUse( f4_arg0, f7_arg1 ) then
				f7_arg0.OperatorCard:SetupOperatorCard( {
					forSelect = true,
					operatorIndex = f7_arg1
				} )
				local f7_local5 = function ()
					Engine[0x3DACD106DDC0D71]()
					local f24_local0 = f7_arg0.OperatorCard.operatorIndex
					local f24_local1 = DMZ.GetOperatorDataForOperatorIndex( f7_arg0, f24_local0 )
					Engine[0xC4146BA76D0F982]( SOUND_SETS.ActiveDutyOperators.customize )
					OPERATOR.OpenOperatorSubMenu( f7_arg0, f7_arg0._controllerIndex, OPERATOR.CustomizationMenuRef, {
						isSoloOperatorSelect = true,
						shouldCreateSkinGrid = true,
						isFromCustomize = true,
						isFromDMZOperatorSelect = true,
						shouldCreateExecutionGrid = true,
						operatorData = f24_local1,
						persistentOperatorIndex = f24_local0,
						callerMenuName = LUI.FlowManager.FlowMenus[PartyUIRoot.OB_MAIN_MENU]
					} )
				end
				
				f7_local4.primaryActionText = Engine[0xED84C33EC5F01EA]( 0xCA07A93FADF9E95 )
				f7_local4.doubleAction = {
					text = 0xAFB88FBDAA55912,
					prompt = 0x21E44BE45534168,
					callback = f7_local5
				}
				f7_local0 = function ( f21_arg0, f21_arg1 )
					local f21_local0 = f7_arg0.OperatorCard.operatorIndex
					if f21_local0 ~= DMZ.GetActiveOperatorSlot( f7_arg0 ) then
						local f21_local1 = DMZ.AttemptToResolveBackpackForOperatorSlot( f7_arg0, f21_local0 )
						if f21_local1.offense then
							local f21_local2 = {
								offendingItems = f21_local1,
								manageCallback = function ()
									if CONDITIONS.IsOutbreakGametype() then
										MAINMENUTABS.FocusTabOnMenu( f21_arg0, "OBLoadoutManagementInternal" )
									else
										LUI.FlowManager.RequestLeaveMenu( f21_arg0, true )
									end
								end,
								cancelCallback = function ()
									f21_arg0:SetAlpha( 1 )
								end
							}
							if CONDITIONS.IsOutbreakGametype() then
								LUI.FlowManager.RequestAddMenu( "OBPersistentOperatorItemBurdenConfirmationPrompt", true, f21_arg1.controller, nil, f21_local2, true )
							else
								LUI.FlowManager.RequestPopupMenu( nil, "DMZPersistentOperatorItemBurdenConfirmationPrompt", false, f7_arg0, false, f21_local2, nil, false, false )
							end
							f7_arg0:SetAlpha( 0 )
						else
							DMZ.SetActiveOperatorSlot( f7_arg0, f21_local0 )
							DMZ.SetFavoriteOperator( f7_arg0, f21_local0 )
						end
					end
					Engine[0xC4146BA76D0F982]( SOUND_SETS.ActiveDutyOperators.equip )
					DMZ.ApplyInventoryUpdates( f7_arg0 )
					if f7_arg0._shouldExitOnEquip then
						LUI.FlowManager.RequestLeaveMenu( f7_arg0, true )
					else
						f7_arg0.OperatorCardGrid:RefreshContent()
					end
				end
				
				f7_local1 = function ( f20_arg0, f20_arg1 )
					f7_arg0()
				end
				
				f7_local3 = function ()
					local f17_local0 = f7_arg0.OperatorCard.operatorIndex
					if DMZ.GetFirstFilledOperatorSlotThatIsntSlot( f7_arg0, f17_local0 ) == -1 then
						
					else
						
					end
					LUI.FlowManager.RequestAddMenu( "DMZPersistentOperatorConfirmationPrompt", true, f7_arg0, nil, {
						replaceOperator = false,
						operatorIndex = f17_local0,
						confirmCallback = function ()
							if f17_local0 == DMZ.GetActiveOperatorSlot( f17_local0 ) then
								DMZ.SetActiveOperatorSlot( f17_local0, f17_local0 )
							end
							DMZ.RevokeOperatorSlot( f17_local0, f17_local0 )
							f17_local0:RemoveGamepadEventCallback( "button_alt1" )
							f17_local0:RemoveGamepadEventCallback( "button_alt2" )
							f17_local0.OperatorCardGrid:RefreshContent()
							f17_local0.OperatorCard:GainedFocus()
							f17_local0:SetAlpha( 1 )
							DMZ.ApplyInventoryUpdates( f17_local0 )
						end,
						cancelCallback = function ()
							f17_local0:SetAlpha( 1 )
						end
					}, true )
					f7_arg0:SetAlpha( 0 )
				end
				
				f7_local2 = function ( f16_arg0, f16_arg1 )
					Engine[0xC4146BA76D0F982]( SOUND_SETS.ActiveDutyOperators.dismiss )
					f7_arg0()
				end
				
			end
			f7_local4.primaryActionText = Engine[0xED84C33EC5F01EA]( 0x41DB11F74C1399 )
			f7_arg0.OperatorCard:SetupOperatorCardUnused( {
				forSelect = true,
				operatorIndex = f7_arg1
			} )
			f7_arg0.OperatorCard:SetEquipped( f4_arg0 )
			f7_local0 = function ( f15_arg0, f15_arg1 )
				Engine[0x3DACD106DDC0D71]()
				LUI.FlowManager.RequestAddMenu( "SoloOperatorSelectMenu", true, f15_arg1.controller, nil, {
					fromPersistentOperatorSelect = true,
					operatorIndex = f15_arg0.OperatorCard.operatorIndex,
					callerMenuName = LUI.FlowManager.FlowMenus[PartyUIRoot.OB_MAIN_MENU]
				}, true )
			end
			
		else
			f7_local4.primaryActionText = Engine[0xED84C33EC5F01EA]( 0x908817112D77DCC )
			f7_arg0.OperatorCard:SetupUpsellCard( f7_arg1 - f4_arg0 + 1 )
			f7_local0 = function ( f14_arg0, f14_arg1 )
				Engine[0xC4146BA76D0F982]( SOUND_SETS.ActiveDutyOperators.goToStore )
				f14_arg0.OperatorCard.CardUpsell:OpenBundlePreview()
			end
			
		end
		f7_arg0:SetupButton( f7_local4 )
		f7_arg0.buttonActionFunc = f7_local0
		f7_arg0.doubleActionFunc = f7_local1
		f7_arg0.tripleActionFunc = f7_local2
		if not f7_arg0._handlersAdded then
			f7_arg0._handlersAdded = true
			f7_arg0:registerEventHandler( "button_action", function ( element, event )
				if element:isInFocus() and element.buttonActionFunc then
					element:buttonActionFunc( event )
					return true
				else
					
				end
			end )
			f7_arg0:AddGamepadEventCallback( "button_alt1", function ( f12_arg0, f12_arg1 )
				if f12_arg0:isInFocus() and f12_arg1.down and f12_arg0.doubleActionFunc then
					f12_arg0:doubleActionFunc( f12_arg1 )
					return true
				else
					
				end
			end )
			f7_arg0:AddGamepadEventCallback( "button_alt2", function ( f11_arg0, f11_arg1 )
				if f11_arg0:isInFocus() and f11_arg1.down and f11_arg0.tripleActionFunc then
					f11_arg0:tripleActionFunc( f11_arg1 )
					return true
				else
					
				end
			end )
			f7_arg0:addEventHandler( "gain_focus", function ( f10_arg0, f10_arg1 )
				if DMZ.IsOperatorSlotInUse( f7_arg0, f10_arg0.OperatorCard.operatorIndex ) then
					f10_arg0.DismissOperatorTooltip:SetVisible( true )
					if DMZ.GetFirstFilledOperatorSlotThatIsntSlot( f7_arg0, f10_arg0.OperatorCard.operatorIndex ) ~= -1 then
						ACTIONS.AnimateSequence( f10_arg0.DismissOperatorTooltip, "Enabled" )
					else
						ACTIONS.AnimateSequence( f10_arg0.DismissOperatorTooltip, "Disabled" )
					end
				end
				f7_arg0( f10_arg0:getParent(), f7_arg0 )
			end )
			f7_arg0:addEventHandler( "lose_focus", function ( f9_arg0, f9_arg1 )
				f9_arg0.DismissOperatorTooltip:SetVisible( false )
			end )
			if CONDITIONS.IsPCDesktop() and CONDITIONS.InFrontend() then
				f7_arg0:SetupContextualMenu()
				f7_arg0:AddContextualMenuAction( {
					id = "dmzPersistentOperatorCardContainer",
					actionName = Engine[0xED84C33EC5F01EA]( 0xEE3CD76029B7727 ),
					actionFunction = f7_local3,
					conditionFunction = function ()
						local f8_local0 = f7_arg0
						if f8_local0 then
							f8_local0 = DMZ.IsOperatorSlotInUse( f7_arg0, f7_arg0.OperatorCard.operatorIndex )
							if f8_local0 then
								f8_local0 = DMZ.GetFirstFilledOperatorSlotThatIsntSlot( f7_arg0, f7_arg0.OperatorCard.operatorIndex ) ~= -1
							end
						end
						return f8_local0
					end
				} )
			end
		end
	end )
	f4_arg0.OperatorCardGrid:SetNumChildren( f4_local0 + DMZ.GetPersistentOperatorUpsellSlotCount( f4_arg1 ) )
	f4_arg0:AddGamepadEventCallback( "button_secondary", function ( f6_arg0, f6_arg1 )
		ACTIONS.LeaveMenu( f4_arg0 )
	end )
	f4_arg0.OperatorCardGrid:SetPosition( {
		y = 0,
		x = DMZ.GetActiveOperatorSlot( f4_arg1 )
	}, true )
	f4_arg0.OperatorCardGrid:SetSnapOnScrollBarMouseDrag( true )
	local f4_local2 = f4_arg0.MouseArea
	if f4_arg0.OperatorCardGrid and f4_local2 then
		f4_arg0.OperatorCardGrid:SetMouseScrollArea( f4_local2 )
	end
	f4_arg0:SubscribeToInputTypeModel( f4_arg1, function ( f5_arg0, f5_arg1 )
		if not LUI.IsLastInputMouseNavigation( f4_arg0 ) then
			ACTIONS.GainFocus( f5_arg1, f5_arg1.OperatorCardGrid.id, f4_arg0 )
		end
		f4_arg0( f5_arg1.OperatorCardGrid, f4_arg0 )
	end )
end

function DMZPersistentOperatorSelectInternal( f1_arg0, f1_arg1 )
	local f1_local0 = CONDITIONS
	local f1_local1 = LUI
	local f1_local2 = MenuBuilder
	local f1_local3 = f1_local1.UIElement.new()
	f1_local3:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
	f1_local3.id = "DMZPersistentOperatorSelectInternal"
	local f1_local4
	if f1_arg1 then
		f1_local4 = f1_arg1
	else
		f1_local4 = f1_arg1.controllerIndex
	end
	f1_local4 = f1_local1.ValidateControllerIndex( f1_local3, f1_local4 )
	local f1_local5 = nil
	f1_local5 = f1_local1.UIImage.new()
	f1_local5[0x8B72E07B55C3AC0] = "Background"
	ACTIONS.AspectRatioScaleAdjustment( f1_local3, f1_local5, LAYOUT.AspectRatioImageScalePct.FADEFRAME_STANDARD )
	f1_local5:SetVerticalPivot( f1_local1.VerticalPivot.Top )
	f1_local5:setImage( RegisterMaterial( 0xEFD44A2D080AE33 ), 0 )
	f1_local5:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
	f1_local3:addElement( f1_local5 )
	f1_local3[0xD4176E7CA246EDD] = f1_local5
	local f1_local6 = nil
	if f1_local0.IsOutbreakGametype() then
		f1_local6 = f1_local2.BuildRegisteredType( 0xBB93BEE689A4D0E, {
			controllerIndex = f1_local4
		} )
		f1_local6[0x8B72E07B55C3AC0] = "Cinematic"
		ACTIONS.AspectRatioScaleAdjustment( f1_local3, f1_local6, LAYOUT.AspectRatioImageScalePct.FADEFRAME_STANDARD )
		f1_local6:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
		f1_local3:addElement( f1_local6 )
		f1_local3[0xBB93BEE689A4D0E] = f1_local6
	end
	local f1_local7 = nil
	f1_local7 = f1_local2.BuildRegisteredType( 0x57C019E9FCB4F59, {
		controllerIndex = f1_local4
	} )
	f1_local7[0x8B72E07B55C3AC0] = "MouseArea"
	f1_local7:SetAnchorsAndPosition( 0, 0, 0, 0, 0, 0, 0, 0 )
	f1_local3:addElement( f1_local7 )
	f1_local3[0x44551FAD8A0DD55] = f1_local7
	local f1_local8 = nil
	f1_local8 = f1_local1.UIGrid.new( {
		scrollingThresholdX = 5.29462817E-315,
		maxVisibleColumns = 4,
		spacingX = 16,
		maxVisibleRows = 1,
		rowHeight = 842,
		alwaysShowGridCountArrows = true,
		scrollingThresholdY = 0,
		wrapY = false,
		columnWidth = 468,
		controllerIndex = f1_local4,
		buildChild = function ()
			return f1_arg0.BuildRegisteredType( 0xF58CFAE327A16F2, {
				controllerIndex = f1_arg0
			} )
		end,
		refreshChild = function ( f2_arg0, f2_arg1, f2_arg2 )
			
		end,
		primaryAxis = f1_local1.DIRECTION.horizontal,
		scrollType = Enum[0x92A69278394394][0xEDF5C0F5CCFACE1],
		horizontalAlignment = f1_local1.Alignment.Center,
		verticalAlignment = f1_local1.Alignment.Middle
	} )
	f1_local8[0x8B72E07B55C3AC0] = "OperatorCardGrid"
	f1_local8:setUseStencil( false )
	f1_local8:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, -864, 864, -460, 460 )
	f1_local3:addElement( f1_local8 )
	f1_local3[0x67167CFBB24971B] = f1_local8
	f0_local0( f1_local3, f1_local4, f1_arg1 )
	return f1_local3
end

MenuBuilder.registerType( 0x774B423E0C098A0, DMZPersistentOperatorSelectInternal )
LockTable( _M )
