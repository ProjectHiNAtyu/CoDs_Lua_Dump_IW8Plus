-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:42
module( ..., package.seeall )
local f0_local0 = function ( f5_arg0, f5_arg1, f5_arg2, f5_arg3 )
	local f5_local0 = f5_arg1.entityStates[f5_arg2]
	local f5_local1 = f5_arg1.extraStates[f5_arg2]
	local f5_local2 = f5_arg1.widgetName
	local f5_local3 = nil
	local f5_local4 = true
	if CONDITIONS.IsMultiplayer() then
		f5_local4 = f5_arg3 == Game[0x31144F2C09FF50C]( f5_arg0._controllerIndex )
	end
	if IsCodcaster() then
		if f5_local4 then
			f5_local2 = "ThermalVisionFriendlyDefault"
		else
			local f5_local5 = CODCASTER.GetTeamDataSource( CODCASTER.GetClientTeamId( f5_arg3 ) )
			local f5_local6 = f5_local5.colors.primary:GetValue( controllerIndex )
		end
	end
	local f5_local7 = MenuBuilder.BuildRegisteredType( f5_local2, {
		controllerIndex = f5_arg0._controllerIndex,
		entityState = f5_local0,
		extraState = f5_local1,
		isSelf = f5_local4
	} )
	f5_local7.id = "markerWidget." .. f5_arg1.widgetName .. "." .. f5_arg3
	f5_arg0:addElement( f5_local7 )
	if f5_local3 and f5_local7.Icon then
		f5_local7.Icon:SetRGBFromInt( f5_local3 )
	end
	f5_arg0._targetMarkerGroups[f5_arg1.widgetName][f5_arg3] = {}
	f5_arg0._targetMarkerGroups[f5_arg1.widgetName][f5_arg3].widget = f5_local7
	f5_arg0._targetMarkerGroups[f5_arg1.widgetName][f5_arg3].state = f5_local0
	f5_arg0._targetMarkerGroups[f5_arg1.widgetName][f5_arg3].extraState = f5_local1
	if not f5_local7.anchoredElementParams then
		f5_local7.anchoredElementParams = {}
	end
	f5_local7.anchoredElementParams.entityNum = f5_arg3
	f5_local7.anchoredElementParams.applyLensDistortion = true
	f5_local7:SetupAnchoredElement( f5_local7.anchoredElementParams )
end

local f0_local1 = function ( f4_arg0, f4_arg1, f4_arg2 )
	local f4_local0 = {}
	if not f4_arg2 then
		f4_local0 = Game[0xD1D74F24FA73B20]( f4_arg0._controllerIndex )
	end
	local f4_local1 = {}
	for f4_local11, f4_local12 in pairs( f4_local0 ) do
		local f4_local13 = f4_local12.widgetName
		f4_local1[f4_local13] = true
		if not f4_arg0._targetMarkerGroups[f4_local13] then
			f4_arg0._targetMarkerGroups[f4_local13] = {}
		end
		local f4_local5 = {}
		for f4_local9, f4_local10 in pairs( f4_local12.entityNumbers ) do
			f4_local5[f4_local10] = true
			if f4_arg0._targetMarkerGroups[f4_local13][f4_local10] then
				if f4_arg0._targetMarkerGroups[f4_local13][f4_local10].state ~= f4_local12.entityStates[f4_local9] then
					f4_arg0._targetMarkerGroups[f4_local13][f4_local10].state = f4_local12.entityStates[f4_local9]
					if f4_arg0._targetMarkerGroups[f4_local13][f4_local10].widget.OnStateChanged then
						f4_arg0._targetMarkerGroups[f4_local13][f4_local10].widget:OnStateChanged( f4_local12.entityStates[f4_local9] )
					end
				end
				if f4_arg0._targetMarkerGroups[f4_local13][f4_local10].extraState ~= f4_local12.extraStates[f4_local9] then
					f4_arg0._targetMarkerGroups[f4_local13][f4_local10].extraState = f4_local12.extraStates[f4_local9]
					if f4_arg0._targetMarkerGroups[f4_local13][f4_local10].widget.OnExtraStateChanged then
						f4_arg0._targetMarkerGroups[f4_local13][f4_local10].widget:OnExtraStateChanged( f4_local12.extraStates[f4_local9] )
					end
				end
			end
			f0_local0( f4_arg0, f4_local12, f4_local9, f4_local10 )
		end
		for f4_local9, f4_local10 in pairs( f4_arg0._targetMarkerGroups[f4_local13] ) do
			if not f4_local5[f4_local9] then
				f4_arg0._targetMarkerGroups[f4_local13][f4_local9].widget:closeTree()
				f4_arg0._targetMarkerGroups[f4_local13][f4_local9] = nil
			end
		end
	end
	f4_local2 = {}
	for f4_local12, f4_local13 in pairs( f4_arg0._targetMarkerGroups ) do
		if not f4_local1[f4_local12] then
			for f4_local8, f4_local9 in pairs( f4_local13 ) do
				f4_local13[f4_local8].widget:closeTree()
			end
			table.insert( f4_local2, f4_local12 )
		end
	end
	for f4_local12, f4_local13 in pairs( f4_local2 ) do
		f4_arg0._targetMarkerGroups[f4_local13] = nil
	end
end

local f0_local2 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._controllerIndex = f2_arg1
	f2_arg0._targetMarkerGroups = {}
	f2_arg0:registerAndCallEventHandler( "target_markers_update", f0_local0 )
	if CONDITIONS.IsMultiplayer( f2_arg0 ) then
		local f2_local0 = LUI.DataSourceFromOmnvar.new( "ui_clear_target_markers" )
		f2_arg0:SubscribeToModel( f2_local0:GetModel( f2_arg1 ), function ()
			f2_arg0( f2_arg0, nil, true )
		end, true )
	end
end

function TargetMarkers( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 128 * _1080p, 0, 128 * _1080p )
	self.id = "TargetMarkers"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	if not f1_local1 and not Engine[0x12586A3F4FB490E]() then
		f1_local1 = self:getRootController()
	end
	assert( f1_local1, "Missing controllerIndex!" )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "TargetMarkers", TargetMarkers )
LockTable( _M )
