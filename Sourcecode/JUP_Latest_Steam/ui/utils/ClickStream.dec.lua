-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:04
ClickStream = ClickStream or {}
ClickStream.Direction = {
	FORWARD = 2,
	BACKWARD = 1,
	NONE = 0
}
ClickStream.ActionType = {
	TELESCOPE_BUTTON_ACTION = 4,
	TELESCOPE_SKIP_ACTION = 5,
	STORE_PURCHASE_ACTION = 3,
	MENU_NAVIGATION = 1,
	BUTTON_ACTION = 2,
	NONE = 0
}
ClickStream.FindTabsAtMenu = function ( f7_arg0, f7_arg1 )
	if f7_arg1 and f7_arg1._tabsWidget then
		return f7_arg1._tabsWidget
	else
		local f7_local0 = LUI.FlowManager.FindTabsAtElement( f7_arg0, f7_arg1 )
		if f7_local0 then
			f7_arg1._tabsWidget = f7_local0
			return f7_local0
		else
			
		end
	end
end

ClickStream.IsPopupNeeded = function ( f6_arg0 )
	if String.IsNilOrEmpty( f6_arg0 ) then
		return false
	elseif CONDITIONS.IsMobileOrMobileSim() then
		return true
	end
	local f6_local0 = Engine[0x6093D047200548]( "clickstreampopup:clickstreampopuplist" )
	for f6_local4, f6_local5 in ipairs( f6_local0[0x6D977E15D062CEF] ) do
		if f6_local5[0xF079DB2540F342E] == f6_arg0 then
			return true
		end
	end
	return false
end

ClickStream.ScreenNone = "NA"
ClickStream.Tab = "#Tab"
ClickStream.Empty = ""
ClickStream.EmptyTab = "#EmptyTab"
ClickStream.EmptyScreenCurIngame = "Ingame HUD current screen"
ClickStream.EmptyScreenDestIngame = "Ingame HUD destination screen"
ClickStream.EmptyScreenCurFrontend = "No previous menu in stack"
ClickStream.EmptyScreenDestFrontend = "No destination menu in stack"
ClickStream.OnNavigation = function ( f5_arg0, f5_arg1, f5_arg2, f5_arg3, f5_arg4, f5_arg5 )
	if not ClickStream.IsEnabled() then
		return 
	end
	local f5_local0 = f5_arg4 == ClickStream.Direction.BACKWARD
	local f5_local1 = f5_arg4 == ClickStream.Direction.FORWARD
	if f5_arg5 == nil or not f5_arg5.isLayer then
		if f5_local0 then
			local f5_local2
			if 0 < #f5_arg0.menuInfoStack then
				f5_local2 = #f5_arg0.menuInfoStack - 1
				if not f5_local2 then
				
				else
					f5_arg2 = f5_arg0.menuInfoStack[f5_local2]
				end
			end
			f5_local2 = 0
		elseif f5_local1 then
			if not ClickStream.IsIncludingPopup() or not f5_arg3 then
				f5_arg3 = f5_arg0:GetFirstNonPopUpMenu()
			end
		end
	else
		if f5_arg3 then
			f5_arg3.name = f5_arg3.ID
		end
		if f5_arg2 then
			f5_arg2.name = f5_arg2.ID
		end
	end
	local f5_local2 = CONDITIONS.InGame() and ClickStream.EmptyScreenCurIngame or ClickStream.EmptyScreenCurFrontend
	local f5_local3 = CONDITIONS.InGame() and ClickStream.EmptyScreenDestIngame or ClickStream.EmptyScreenDestFrontend
	local f5_local4
	if f5_arg2 then
		f5_local4 = f5_arg2.name
		if not f5_local4 then
		
		else
			local f5_local5
			if f5_arg3 then
				f5_local5 = f5_arg3.name
				if not f5_local5 then
				
				else
					if f5_local4 == f5_local5 then
						return 
					end
					local f5_local6 = true
					if f5_arg2 and f5_arg2.isPopup then
						f5_local6 = ClickStream.IsIncludingPopup()
					end
					local f5_local7 = true
					if f5_arg3 and f5_arg3.isPopup then
						f5_local7 = ClickStream.IsIncludingPopup()
					end
					local f5_local8
					if not f5_local6 then
						f5_local8 = f5_local6
					else
						f5_local8 = f5_local7
					end
					local f5_local9 = 0
					local f5_local10 = Engine[0x3B8CFB6758EF57C]()
					local f5_local11 = 0
					if f5_local8 then
						if f5_arg3 then
							if f5_arg3.menuDurationTimeStamp == nil then
								f5_arg3.menuDurationTimeStamp = f5_local10
							end
							f5_local11 = f5_local10 - f5_arg3.menuDurationTimeStamp
							local f5_local12 = ClickStream.FindTabsAtMenu( f5_arg3.menu, f5_arg3.menu )
							if f5_local12 and LUI.TabManager.GetNumTabs( f5_local12 ) ~= nil and 0 < LUI.TabManager.GetNumTabs( f5_local12 ) then
								local f5_local13 = f5_local12:GetCurrentTab()
								local f5_local14
								if f5_local13 then
									f5_local14 = ClickStream.Tab .. " " .. (f5_local13.menuId and f5_local13.menuId or f5_local13.id)
									if not f5_local14 then
									
									else
										f5_local5 = f5_local5 .. "-" .. f5_local14
										if f5_local13 and f5_local13.tabDurationTimeStamp then
											local f5_local15 = f5_local10 - f5_local13.tabDurationTimeStamp
											if not f5_local15 then
												f5_local11 = f5_local15
											else
												
											end
										end
									end
								end
								f5_local14 = ClickStream.EmptyTab
							end
						end
						if f5_arg2 then
							f5_arg2.menuDurationTimeStamp = f5_local10
							local f5_local12 = ClickStream.FindTabsAtMenu( f5_arg2.menu, f5_arg2.menu )
							local f5_local13
							if f5_local12 then
								f5_local13 = f5_local12
							else
								f5_local13 = LUI.TabManager.GetNumTabs( f5_local12 )
							end
							local f5_local14
							if f5_local13 then
								f5_local14 = f5_local13
							else
								f5_local14 = 0 < f5_local13
							end
							if f5_local14 then
								local f5_local15 = f5_local12:GetDefaultTab()
								if not f5_local15 then
									f5_local15 = 0
								end
								if f5_local13 <= f5_local15 then
									f5_local15 = f5_local13 - 1
								end
								local f5_local16 = LUI.TabManager.GetTabAtIndex( f5_local12, f5_local15 + 1 )
								local f5_local17
								if f5_local16 then
									f5_local17 = ClickStream.Tab .. " " .. (f5_local16.menuId and f5_local16.menuId or f5_local16.id)
									if not f5_local17 then
									
									else
										f5_local4 = f5_local4 .. "-" .. f5_local17
										f5_arg2.currentTabName = f5_local17
									end
								end
								f5_local17 = ClickStream.EmptyTab
							elseif f5_arg2.currentTabName then
								local f5_local15 = f5_local4 .. "-" .. f5_arg2.currentTabName
								if not f5_local15 then
									f5_local4 = f5_local15
								else
									
								end
							end
						end
						local f5_local12 = LUI.WebViewManager.Instance()
						if f5_local12 then
							if f5_local0 then
								local f5_local15 = f5_local12
								local f5_local13 = f5_local12.IsDefaultFullScreen
								local f5_local16
								if f5_arg3 then
									f5_local16 = f5_arg3
								else
									f5_local16 = f5_arg3.name
								end
								if f5_local13( f5_local15, f5_local16 ) then
									f5_local13 = f5_local5
									local f5_local14 = "-"
									f5_local15 = f5_local12:GetCurrentContext()
									if not f5_local15 then
										f5_local15 = ""
									end
									f5_local5 = f5_local13 .. f5_local14 .. f5_local15
								elseif f5_local1 then
									local f5_local15 = f5_local12
									local f5_local13 = f5_local12.IsDefaultFullScreen
									local f5_local16
									if f5_arg2 then
										f5_local16 = f5_arg2
									else
										f5_local16 = f5_arg2.name
									end
									if f5_local13( f5_local15, f5_local16 ) then
										f5_local13 = f5_local4
										local f5_local14 = "-"
										f5_local15 = f5_local12:GetCurrentContext()
										if not f5_local15 then
											f5_local15 = ""
										end
										f5_local4 = f5_local13 .. f5_local14 .. f5_local15
									end
								end
							end
							elseif f5_local1 then
								local f5_local15 = f5_local12
								local f5_local13 = f5_local12.IsDefaultFullScreen
								local f5_local16
								if f5_arg2 then
									f5_local16 = f5_arg2
								else
									f5_local16 = f5_arg2.name
								end
								if f5_local13( f5_local15, f5_local16 ) then
									f5_local13 = f5_local4
									local f5_local14 = "-"
									f5_local15 = f5_local12:GetCurrentContext()
									if not f5_local15 then
										f5_local15 = ""
									end
									f5_local4 = f5_local13 .. f5_local14 .. f5_local15
								end
						end
						ClickStream.SendDlogEvent( f5_arg1, {
							actionType = ClickStream.ActionType.MENU_NAVIGATION,
							direction = f5_arg4,
							destinationScreen = f5_local4,
							currentScreen = f5_local5,
							duration = f5_local11
						} )
					end
				end
			end
			f5_local5 = f5_local2
		end
	end
	f5_local4 = f5_local3
end

ClickStream.SendDlogEvent = function ( f4_arg0, f4_arg1 )
	local f4_local0 = f4_arg1.destinationScreen
	if not f4_local0 then
		f4_local0 = ClickStream.ScreenNone
	end
	local f4_local1 = f4_arg1.currentScreen
	if not f4_local1 then
		f4_local1 = ClickStream.ScreenNone
	end
	local f4_local2 = f4_arg1.direction or 0
	local f4_local3 = f4_arg1.duration or 0
	local f4_local4 = f4_arg1.actionType
	if not f4_local4 then
		f4_local4 = ClickStream.ActionType.MENU_NAVIGATION
	end
	local f4_local5 = f4_arg1.buttonKey
	if not f4_local5 then
		f4_local5 = ClickStream.Empty
	end
	local f4_local6 = f4_arg1.buttonData
	if not f4_local6 then
		f4_local6 = ClickStream.Empty
	end
	local f4_local7 = f4_arg1.buttonId
	if not f4_local7 then
		f4_local7 = ClickStream.Empty
	end
	local f4_local8 = f4_arg1.inputType or 0
	local f4_local9 = f4_local4 == ClickStream.ActionType.MENU_NAVIGATION
	if f4_local9 then
		
	else
		
	end
	Engine[0x15D98DF5F61904B]( f4_arg0, "dlog_event_clickstream", {
		version = -2.3534382798346186E-185,
		isnavigation = f4_local9,
		destinationscreen = f4_local0,
		currentscreen = f4_local1,
		direction = f4_local2,
		duration = f4_local3,
		actiontype = f4_local4,
		buttonid = f4_local7,
		buttondata = f4_local6,
		buttonkey = f4_local5,
		inputtype = f4_local8
	} )
end

ClickStream.OnButtonEvent = function ( f3_arg0, f3_arg1 )
	local f3_local0 = f3_arg1.button
	local f3_local1 = f3_arg1.event
	local f3_local2 = f3_arg1.actionType
	if not f3_local2 then
		f3_local2 = ClickStream.ActionType.BUTTON_ACTION
	end
	if not f3_local0 or not f3_local1 then
		return 
	end
	local f3_local3 = ClickStream.Empty
	local f3_local4 = f3_local0:GetCurrentMenu()
	if f3_local4 and not String.IsNilOrEmpty( f3_local4.id ) then
		f3_local3 = f3_local4.id
	end
	ClickStream.SendDlogEvent( f3_arg0, {
		inputType = f3_arg1.inputType,
		currentScreen = f3_local3,
		buttonId = f3_local0.id,
		actionType = f3_local2,
		buttonKey = f3_local1.key
	} )
end

ClickStream.IsEnabled = function ()
	return not Dvar[0x9E5BE3B4BBA4E0E]( 0xCF18002D13E1B99 )
end

ClickStream.IsIncludingPopup = function ()
	if CONDITIONS.IsMobileOrMobileSim() then
		return true
	else
		return Dvar[0x9E5BE3B4BBA4E0E]( 0xFCB731EB9ED47C9 )
	end
end

