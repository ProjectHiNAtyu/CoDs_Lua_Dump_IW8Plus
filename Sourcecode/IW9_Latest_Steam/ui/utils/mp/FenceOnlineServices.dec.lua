-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:48
module( ..., package.seeall )
FenceOnlineServices = LUI.Class( LUI.Fence )
FenceOnlineServices.CODE_FENCE = "ONLINE"
FenceOnlineServices.CODE_STATE = {
	queued = 5,
	downloading = 2,
	registering = 6,
	inactive = 0,
	success = 3,
	requested = 1,
	failure = 4
}
FenceOnlineServices.REGISTRATION_STATE = {
	OTP_THROTTLED = 4,
	UPGRADING = 5,
	IDLE = 0,
	PENDING = 1,
	REGISTERING = 2,
	OTP_NEEDED = 3
}
FenceOnlineServices.AUTO_REGISTRATION_STATE = {
	SUCCESS = 2,
	IN_PROGRESS = 1,
	IDLE = 0,
	FAIL = 3
}
FenceOnlineServices.CONTROLLER_FENCE_STATE = {
	pass = 2,
	block = 3,
	fail = 4,
	inactive = 1
}
FenceOnlineServices.init = function ( f48_arg0, f48_arg1 )
	LUI.Fence.init( f48_arg0 )
	f48_arg0._perController = {}
	f48_arg0._noPremium = f48_arg1
	f48_arg0._registrationState = AccountRegistration[0x30C898D33E650B7]()
	local f48_local0 = CODACCOUNT.AccountRegistrationEnabled()
	if f48_local0 then
		f48_local0 = AccountRegistration[0x2FDA14ECB499A34]()
	end
	f48_arg0._autoRegistrationEnabled = f48_local0
	f48_arg0._autoRegistrationState = FenceOnlineServices.AUTO_REGISTRATION_STATE.IDLE
	for f48_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		f48_arg0._perController[f48_local0] = {
			isCancelling = false,
			fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.inactive
		}
		if Fences[0x2A0168FAF745ADF]( f48_local0 ) ~= FenceOnlineServices.CODE_STATE.success then
			Fences[0x30A2BFD9B34742]( f48_local0 )
		end
	end
	if f48_arg1 then
		DebugPrint( "FenceOnlineServices.Init with No Premium" )
	else
		DebugPrint( "FenceOnlineServices.Init with Premium" )
	end
end

FenceOnlineServices.Start = function ( f47_arg0 )
	DebugPrint( "FenceOnlineServices.Start" )
	f47_arg0._errorController = nil
	if Dvar[0x9E5BE3B4BBA4E0E]( 0xDEFCC2CE2C04AA6 ) then
		for f47_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			Engine[0x9694388D6DAC134]( "hasEverSeen_CODAccount", 0, f47_local0 )
			Engine[0xB81A5136C5503E4]( "updategamerprofile " .. f47_local0 )
		end
	end
	if LUI.WebViewManager.WebEULAEnabled() then
		local f47_local0 = LUI.WebViewManager.Instance()
		f47_local0:PrepareEulaTickEnvironment()
	end
end

FenceOnlineServices.Stop = function ( f46_arg0 )
	DebugPrint( "FenceOnlineServices.Stop" )
	if f46_arg0._openedWaitPopup then
		DebugPrint( "FenceOnlineServices.Stop closing: " .. f46_arg0._openedWaitPopup )
		LUI.FlowManager.RequestLeaveMenuByName( f46_arg0._openedWaitPopup, true )
		f46_arg0._openedWaitPopup = nil
		if CONDITIONS.IsMobileOrMobileSim() and not Dvar[0x9E5BE3B4BBA4E0E]( 0x62400405F9F3C0B ) then
			DebugPrint( "FenceOnlineServices.Stop re-opening due to disconnect " .. MainMenuMobileUtils.MAIN_MENU_REF )
			local f46_local0 = LUI.FlowManager.GetMenuByName( MainMenuMobileUtils.MAIN_MENU_REF )
			if f46_local0 and f46_local0.menu then
				local f46_local1 = LUI.FlowManager.GetFlowManager()
				f46_local1:CloseMenuInfo( f46_local0 )
			end
		end
	end
end

FenceOnlineServices.OpenOTPPopup = function ( f42_arg0 )
	if not f42_arg0._openedOTPPopup then
		local f42_local0 = {
			controllerIndex = f42_arg0._registeringController,
			onSuccess = function ()
				f42_arg0._openedOTPPopup = false
			end,
			onCancel = function ()
				f42_arg0._openedOTPPopup = false
			end,
			onError = function ()
				f42_arg0._openedOTPPopup = false
			end
		}
		if CODACCOUNT.AccountRegistrationEnabled() then
			LUI.FlowManager.RequestPopupMenu( nil, "CODAccountAuthentication", true, f42_arg0._registeringController, false, f42_local0, nil, true, true )
			f42_arg0._openedOTPPopup = true
		end
	end
end

FenceOnlineServices.OpenRegisteringPopup = function ( f38_arg0, f38_arg1 )
	if not f38_arg0._openedRegisteringPopup then
		local f38_local0 = {
			controllerIndex = f38_arg0._registeringController,
			isAnonymousAccount = f38_arg1,
			onSuccess = function ()
				f38_arg0._openedRegisteringPopup = false
				f38_arg0._registeringController = nil
				if f38_arg0 then
					f38_arg0._hasSeenGreeting = true
				else
					f38_arg0._openedWaitPopup = nil
				end
			end,
			onCancelRegister = function ()
				f38_arg0._openedRegisteringPopup = false
			end,
			onCancelFence = function ()
				f38_arg0._perController[f38_arg0._registeringController].isCancelling = true
				f38_arg0._registrationCancelled = true
				f38_arg0._registeringController = nil
				f38_arg0._openedRegisteringPopup = false
			end
		}
		if CODACCOUNT.AccountRegistrationEnabled() then
			local f38_local1
			if CONDITIONS.IsUsingMobileLayout() then
				f38_local1 = not CONDITIONS.MobileIsBootPresentationEnabled()
			else
				f38_local1 = true
			end
			if f38_local1 and not LUI.FlowManager.IsInStack( "CODAccountRegisterPopup" ) then
				LUI.FlowManager.RequestPopupMenu( nil, "CODAccountFencePopup", true, f38_arg0._registeringController, false, f38_local0, nil, true, true )
				f38_arg0._openedRegisteringPopup = true
			end
		else
			if not f38_arg1 then
				AccountRegistration[0x34E06AC87784A76]( f38_arg0._registeringController )
			end
			f38_local0.onSuccess()
		end
	end
end

FenceOnlineServices.OpenSummaryPopup = function ( f35_arg0 )
	if not f35_arg0._openedSummary and not LUI.FlowManager.IsInStack( "CODAccountRestartingPopup" ) then
		f35_arg0._openedSummary = true
		local f35_local0 = {
			fromBoot = true,
			controllerIndex = f35_arg0._summaryController,
			okButtonHandler = function ( f37_arg0, f37_arg1 )
				LUI.FlowManager.RequestLeaveMenuByName( "CODAccountSummary", true, true )
				local f37_local0 = true
				if f35_arg0._summaryController then
					f35_arg0:SetHasSeenCODAccount( f35_arg0._summaryController )
					if not Engine[0x1AE85ADF7F2BA4D]() and Engine[0x7B17D94988FD5D0]( "hasEverSeen_CODAccountOTP", f35_arg0._summaryController ) ~= 1 then
						local f37_local1 = not Dvar[0x9E5BE3B4BBA4E0E]( 0x2AD6B34F993A368 )
						if Dvar[0x9E5BE3B4BBA4E0E]( 0xA0D285D5AF3D531 ) or CONDITIONS.IsCIABuildEnabled() then
							f35_arg0:SetHasSeenCODAccountOTP( f35_arg0._summaryController )
						elseif not Engine[0x84287BE93239E99]() and f37_local1 and CODACCOUNT.AccountRegistrationEnabled() and not Engine[0x757E77CA15D6B8F]( f35_arg0._summaryController ) and not AccountRegistration[0xC1FEECD62DC80BA]( f35_arg0._summaryController ) then
							f37_local0 = false
							LUI.FlowManager.RequestPopupMenu( nil, "CODAccountAuthenticationAdv", true, f35_arg0._summaryController, false, {
								state = f35_arg0
							}, nil, true, true )
						else
							f35_arg0:SetHasSeenCODAccountOTP( f35_arg0._summaryController )
						end
					end
				end
				if f37_local0 then
					f35_arg0:SetHasSeenSummary()
				end
			end
		}
		if CODACCOUNT.AccountRegistrationEnabled() and not Dvar[0x9E5BE3B4BBA4E0E]( 0xBD5EF171527B9C ) and not Engine[0x757E77CA15D6B8F]( f35_arg0._summaryController ) and not CONDITIONS.IsMobileOrMobileSim() and not CONDITIONS.IsCIABuildEnabled() then
			local f35_local1 = Engine[0x5A049446C78B2A4]( f35_arg0._summaryController )
			local f35_local2
			if f35_local1 then
				f35_local2 = f35_local1
			else
				f35_local2 = Engine[0x8C5525AAE2164E3]( f35_arg0._summaryController, f35_local1 )
			end
			if Engine[0x9DD5167C6D720F1]() and (Dvar[0x9E5BE3B4BBA4E0E]( 0xED9B08B86396E90 ) or f35_local2) then
				LUI.FlowManager.RequestPopupMenu( nil, "CODAccountForceRenamePopup", true, f35_arg0._summaryController, false, {
					isUsername = true,
					title = Engine[0xED84C33EC5F01EA]( 0x88994B3B5F8D1E9 ),
					controller = f35_arg0._controllerIndex,
					confirmAction = function ( f36_arg0, f36_arg1 )
						if AccountRegistration[0x56732A0CF0D13F6]( f36_arg0, f36_arg1 ) then
							Engine[0x34C623E28A1C5E7]( "" )
						end
					end
				}, nil, true, true )
			else
				LUI.FlowManager.RequestPopupMenu( nil, "CODAccountSummary", true, f35_arg0._summaryController, false, f35_local0, nil, true, true )
			end
		else
			f35_local0.okButtonHandler()
		end
	end
end

FenceOnlineServices.OpenConnectingPopup = function ( f30_arg0, f30_arg1 )
	local f30_local0 = Engine[0xED84C33EC5F01EA]( 0x3BDEC1F7AF558E5 )
	LUI.FlowManager.RequestPopupMenu( nil, "popup_connecting", false, f30_arg1, false, {
		isNonCriticalPopup = true,
		onCancel = function ( f34_arg0, f34_arg1 )
			DebugPrint( "Cancelling FenceOnlineServices" )
			f30_arg0._perController[f34_arg1.controller].isCancelling = true
		end,
		onStatusUpdateCallback = function ( f33_arg0 )
			if Fences[0x24C28457BE3BBEC]( Enum[0xA0086E2C650E8B7][0xEA4A3ED24F5C151] ) then
				return Fences[0x7E779F6CED13F21]( f33_arg0, "ONLINE" )
			else
				
			end
		end,
		onMessageUpdateCallback = function ( f32_arg0 )
			if f30_arg0 then
				return Fences[0x16D16AAE1F86E41]( f32_arg0, f30_arg0.CODE_FENCE ) or f30_arg0
			else
				
			end
		end,
		onPrintStatusCallback = function ( f31_arg0 )
			if f30_arg0 then
				Fences[0x661C885A3C824C3]( f31_arg0, f30_arg0.CODE_FENCE, "FenceOnlineServices" )
			end
		end,
		controllerIndex = f30_arg1
	}, nil, true, true )
	f30_arg0._openedWaitPopup = "popup_connecting"
end

FenceOnlineServices.OpenQueuedPopup = function ( f28_arg0 )
	local f28_local0 = f28_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "popup_online_queue", false, nil, false, {
		onCancel = function ( f29_arg0, f29_arg1 )
			f28_arg0._perController[f29_arg1].isCancelling = true
		end
	}, nil, true, true )
	f28_arg0._openedWaitPopup = "popup_online_queue"
end

FenceOnlineServices.OnBackOut = function ( f27_arg0 )
	DebugPrint( "FenceOnlineServices.OnBackOut" )
	for f27_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		Fences[0x30A2BFD9B34742]( f27_local0 )
	end
	if not f27_arg0._noPremium then
		local f27_local0 = Engine[0x45B054C920178E9]()
		Dvar[0x8EA06EEDB58D872]( 0x62400405F9F3C0B, false )
		Engine[0xFD5CC176E60A5A9]()
		Engine[0xF8B2F41CC5CF158]( f27_local0, Enum[0x5BA77296D5B1B09][0x1F9B91EEF0E0752], "FenceOnlineServices.OnBackOut" )
		Engine[0x5DEE98AA6FB3C2]( f27_local0, CoD.LeavePartyMoveUI.NO, CoD.LeavePartyShowMessage.NO, "FenceOnlineServices.OnBackOut" )
	end
end

FenceOnlineServices.GetErrorString = function ( f26_arg0 )
	local f26_local0 = Fences[0xA7D80C060789546]( f26_arg0, FenceOnlineServices.CODE_FENCE )
	assert( f26_local0 )
	if f26_local0 then
		return Engine[0x7D3158A9539A355]( f26_local0 )
	else
		return Engine[0xED84C33EC5F01EA]( 0x669A0D844E00423 )
	end
end

FenceOnlineServices.PostFail = function ( f25_arg0 )
	if f25_arg0._state == LUI.Fence.STATE.fail then
		local f25_local0 = Engine[0x45B054C920178E9]()
		local f25_local1 = {
			controllerIndex = f25_local0,
			noPremium = f25_arg0._noPremium
		}
		if f25_arg0._errorController and not f25_arg0._perController[f25_arg0._errorController].isCancelling and Fences[0x65CBD83E503065E]( f25_local0 ) == Enum[0xF33D9C52E48F620][0xC0D17BAD169557B] then
			f25_local1.errorString = FenceOnlineServices.GetErrorString( f25_arg0._errorController )
			LUI.FlowManager.RequestPopupMenu( nil, "popup_connecting_error", false, f25_local0, false, f25_local1, nil, false, false )
		elseif CONDITIONS.IsPermanentOrTemporaryBan( f25_local0 ) then
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x89899570DE48485 ) and CONDITIONS.MobileIsBootPresentationEnabled() then
				Web[0xE5D144212B21563]()
			else
				LUI.FlowManager.RequestPopupMenu( nil, "popup_ban", false, f25_local0, false, f25_local1, nil, false, false )
			end
		else
			LUI.FlowManager.RequestPopupMenu( nil, "popup_connecting_cancelled", false, f25_local0, false, f25_local1, nil, false, false )
		end
		for f25_local2 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			f25_arg0._perController[f25_local2].isCancelling = false
		end
	end
end

FenceOnlineServices.ShouldBlockForRegistration = function ( f24_arg0, f24_arg1 )
	if (f24_arg0._registeringController ~= nil) or f24_arg1 == AccountRegistration[0xFAC8D846FC98123]() then
		if f24_arg0._registeringController == nil and not f24_arg0._registrationCancelled then
			f24_arg0._registeringController = f24_arg1
		end
		return true
	else
		return false
	end
end

FenceOnlineServices.ShouldAbortRegistration = function ( f23_arg0, f23_arg1 )
	local f23_local0 = false
	if Engine[0x5575DCFF312365A]() then
		if Engine[0x5B772BB3A07C3B5]() ~= BattlenetConnectionState.NOT_CONNECTED or Engine[0xAF7EC673FFF4FE4]() == nil then
			f23_local0 = f23_arg0._registrationCancelled
		else
			f23_local0 = true
		end
	elseif not CONDITIONS.IsMobileOrMobileSim() then
		if Engine[0xBE5345D3926D620]() then
			f23_local0 = f23_arg0._registrationCancelled
		else
			f23_local0 = true
		end
	end
	if f23_local0 then
		AccountRegistration[0x7E83EAA4B387E3B]( f23_arg1 )
		if f23_arg0._registrationCancelled then
			f23_arg0._registrationCancelled = false
		end
	end
	return f23_local0
end

FenceOnlineServices.ShouldBlockforSummary = function ( f22_arg0, f22_arg1 )
	local f22_local0 = Engine[0x1AE85ADF7F2BA4D]()
	if not f22_local0 then
		f22_local0 = Engine[0x7B17D94988FD5D0]( "hasEverSeen_CODAccount", f22_arg1 )
	end
	if not f22_local0 and not Dvar[0x9E5BE3B4BBA4E0E]( 0x244E1B9C23A167C ) then
		f22_arg0._summaryController = f22_arg1
		if f22_arg0._summaryController == f22_arg0._registeringController then
			f22_arg0._registeringController = nil
		end
		return true
	end
	local f22_local1 = Engine[0x1AE85ADF7F2BA4D]()
	if not f22_local1 then
		f22_local1 = Engine[0x7B17D94988FD5D0]( "hasEverSeen_CODAccountOTP", f22_arg1 )
	end
	if f22_local1 == 0 and not Dvar[0x9E5BE3B4BBA4E0E]( 0x244E1B9C23A167C ) then
		f22_arg0._summaryController = f22_arg1
		if f22_arg0._summaryController == f22_arg0._registeringController then
			f22_arg0._registeringController = nil
		end
		return true
	end
	return false
end

FenceOnlineServices.ShouldBlockForEula = function ( f21_arg0, f21_arg1 )
	if LUI.WebViewManager.WebEULAEnabled() and not IsCodAccountEulaAccepted( f21_arg1 ) then
		f21_arg0._eulaController = f21_arg1
		return true
	elseif f21_arg0._eulaController == f21_arg1 then
		f21_arg0._eulaController = nil
	end
	return false
end

FenceOnlineServices.ShouldBlockForCampaignMenu = function ( f20_arg0, f20_arg1 )
	if Engine[0x9DD5167C6D720F1]() then
		local f20_local0 = LUI.FlowManager.GetTopMostOpenMenuInfo( nil )
		if f20_local0 and f20_local0.buildData then
			local f20_local1 = f20_local0.buildData.isOnboardingMatureContent
			if not f20_local1 then
				f20_local1 = f20_local0.buildData.isCrossLaunchCampaignMenu
			end
			return f20_local1
		end
	end
	return false
end

FenceOnlineServices.SetHasSeenCODAccount = function ( f19_arg0, f19_arg1 )
	Engine[0x9694388D6DAC134]( "hasEverSeen_CODAccount", 1, f19_arg1 )
	Engine[0xB81A5136C5503E4]( "updategamerprofile " .. f19_arg1 )
end

FenceOnlineServices.SetHasSeenCODAccountOTP = function ( f18_arg0, f18_arg1 )
	Engine[0x9694388D6DAC134]( "hasEverSeen_CODAccountOTP", 1, f18_arg1 )
	Engine[0xB81A5136C5503E4]( "updategamerprofile " .. f18_arg1 )
end

FenceOnlineServices.SetHasSeenSummary = function ( f17_arg0 )
	f17_arg0._openedSummary = false
	f17_arg0._summaryController = nil
end

FenceOnlineServices.OpenAccountInformationPopup = function ( f16_arg0, f16_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "AccountInformationRequiredScreen", false, f16_arg1, false, {}, nil, true, true )
	f16_arg0._openedInterruptionPopup = "AccountInformationRequiredScreen"
end

FenceOnlineServices.OpenLogonInterruptPopup = function ( f15_arg0, f15_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "LogonInterruptScreen", false, f15_arg1, false, {}, nil, true, true )
	f15_arg0._openedInterruptionPopup = "LogonInterruptScreen"
end

FenceOnlineServices.OpenEmailVerificationPopup = function ( f14_arg0, f14_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "EmailVerificationScreen", false, f14_arg1, false, {}, nil, true, true )
	f14_arg0._openedInterruptionPopup = "EmailVerificationScreen"
end

FenceOnlineServices.CheckForInterruption = function ( f13_arg0, f13_arg1 )
	if AccountRegistration[0x3E491122BA1A321]() then
		f13_arg0._interruptionController = f13_arg1
		f13_arg0._interruptionType = AccountRegistration[0x7CCF962F97CBF24]()
	else
		f13_arg0._interruptionController = nil
		f13_arg0._interruptionType = nil
		f13_arg0._openedInterruptionPopup = nil
	end
end

FenceOnlineServices.UpdateState = function ( f11_arg0 )
	assert( f11_arg0._state ~= LUI.Fence.STATE.fail )
	local f11_local0 = nil
	f11_arg0._queued = false
	if f11_arg0._autoRegistrationEnabled and f11_arg0._autoRegistrationState <= FenceOnlineServices.AUTO_REGISTRATION_STATE.IN_PROGRESS then
		f11_arg0._autoRegistrationState = AccountRegistration[0xA9D16A466625AE6]()
	end
	for f11_local1 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f11_local1 ) then
			f11_local0 = Fences[0x2A0168FAF745ADF]( f11_local1 )
			if f11_local0 == FenceOnlineServices.CODE_STATE.inactive then
				Fences[0xCE25840730DD633]( f11_local1 )
				f11_local0 = Fences[0x2A0168FAF745ADF]( f11_local1 )
			end
			if f11_local0 == FenceOnlineServices.CODE_STATE.failure then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.fail
			elseif f11_local0 == FenceOnlineServices.CODE_STATE.queued then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
				f11_arg0._queued = true
			elseif f11_local0 == FenceOnlineServices.CODE_STATE.registering then
				f11_arg0._registrationState = AccountRegistration[0x30C898D33E650B7]()
				f11_arg0:CheckForInterruption( f11_local1 )
				if FenceOnlineServices.ShouldBlockForRegistration( f11_arg0, f11_local1 ) then
					if FenceOnlineServices.ShouldAbortRegistration( f11_arg0, f11_local1 ) then
						f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.fail
					else
						f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
					end
				else
					f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.pass
				end
			elseif f11_local0 ~= FenceOnlineServices.CODE_STATE.success then
				f11_arg0:CheckForInterruption( f11_local1 )
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
			elseif FenceOnlineServices.ShouldBlockforSummary( f11_arg0, f11_local1 ) then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
			elseif FenceOnlineServices.ShouldBlockForEula( f11_arg0, f11_local1 ) then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
			elseif FenceOnlineServices.ShouldBlockForCampaignMenu( f11_arg0, f11_local1 ) then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.block
			else
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.pass
			end
			if f11_arg0._perController[f11_local1].isCancelling then
				f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.fail
			end
		end
		f11_arg0._perController[f11_local1].fenceState = FenceOnlineServices.CONTROLLER_FENCE_STATE.inactive
		f11_arg0._perController[f11_local1].isCancelling = false
	end
	local f11_local1 = 0
	local f11_local2 = 0
	local f11_local3 = 0
	local f11_local4 = -1
	for f11_local5 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if f11_arg0._perController[f11_local5].fenceState == FenceOnlineServices.CONTROLLER_FENCE_STATE.pass then
			f11_local1 = f11_local1 + 1
		end
		if f11_arg0._perController[f11_local5].fenceState == FenceOnlineServices.CONTROLLER_FENCE_STATE.block then
			if f11_local4 == -1 then
				f11_local4 = f11_local5
			end
			f11_local2 = f11_local2 + 1
		end
		if f11_arg0._perController[f11_local5].fenceState == FenceOnlineServices.CONTROLLER_FENCE_STATE.fail then
			f11_local3 = f11_local3 + 1
		end
	end
	assert( 0 < f11_local3 + f11_local2 + f11_local1, "No active local clients" )
	local f11_local5 = Engine[0x45B054C920178E9]()
	if 0 < f11_local3 then
		for f11_local6 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			if f11_arg0._perController[f11_local6].fenceState == FenceOnlineServices.CONTROLLER_FENCE_STATE.fail then
				if 0 < f11_local1 and not Lobby[0xEA249848147F9EA]( f11_local6 ) then
					DebugPrint( "Controller #" .. tostring( f11_local6 ) .. " does not meet requirements for online play. Making client inactive." )
					f11_local5 = f11_local6
					f11_arg0._state = LUI.Fence.STATE.block
					Engine[0x54DE5FB69D3BA90]( f11_local6 )
					local f11_local9 = nil
					if f11_arg0._perController[f11_local6].isCancelling then
						f11_local9 = Engine[0xED84C33EC5F01EA]( 0x43673F234704666 )
					else
						f11_local9 = FenceOnlineServices.GetErrorString( f11_local6 )
					end
					LUI.FlowManager.RequestPopupMenu( nil, "popup_connecting_error", false, f11_local6, false, {
						errorString = f11_local9,
						controllerIndex = f11_local6
					}, nil, false, true )
				elseif not f11_arg0._perController[f11_local6].isCancelling then
					f11_arg0._errorController = f11_local6
				end
				f11_arg0._state = LUI.Fence.STATE.fail
				DebugPrint( "FenceOnlineServices FAILED" )
			end
		end
	elseif 0 < f11_local2 then
		if f11_local4 ~= -1 then
			f11_local5 = f11_local4
		end
		f11_arg0._state = LUI.Fence.STATE.block
	elseif 0 < f11_local1 then
		f11_arg0._state = LUI.Fence.STATE.pass
	else
		f11_arg0._state = LUI.Fence.STATE.block
	end
	if f11_arg0._state == LUI.Fence.STATE.block then
		local f11_local6 = function ( f12_arg0 )
			if f11_arg0._openedWaitPopup ~= nil and f11_arg0._openedWaitPopup ~= f12_arg0 then
				LUI.FlowManager.RequestLeaveMenuByName( f11_arg0._openedWaitPopup, true )
				f11_arg0._openedWaitPopup = nil
				return true
			elseif f11_arg0._openedWaitPopup == nil then
				return true
			else
				return false
			end
		end
		
		if f11_arg0._queued then
			if f11_local6( "popup_online_queue" ) then
				f11_arg0:OpenQueuedPopup()
			end
		else
			local f11_local7 = FenceOnlineServices.ShouldBlockForCampaignMenu( f11_arg0, controllerIndex )
			local f11_local8
			if f11_arg0._registeringController == nil and f11_arg0._summaryController == nil and f11_arg0._eulaController == nil then
				f11_local8 = f11_local7
			else
				f11_local8 = true
			end
			if f11_local8 then
				f11_local6( nil )
			elseif f11_local6( "popup_connecting" ) then
				f11_arg0:OpenConnectingPopup( f11_local5 )
			end
		end
		if f11_arg0._interruptionController ~= nil then
			if f11_arg0._interruptionType == Enum[0x6F8083021CF8567][0xEEA729FEC7D5B93] and f11_arg0._openedInterruptionPopup ~= "EmailVerificationScreen" then
				f11_arg0:OpenEmailVerificationPopup( f11_arg0._interruptionController )
			elseif f11_arg0._interruptionType == Enum[0x6F8083021CF8567][0x9FBA8F1399904C8] and f11_arg0._openedInterruptionPopup ~= "AccountInformationRequiredScreen" then
				f11_arg0:OpenAccountInformationPopup( f11_arg0._interruptionController )
			elseif f11_arg0._interruptionType == Enum[0x6F8083021CF8567][0x97C80EEE71DF04B] and f11_arg0._openedInterruptionPopup ~= "LogonInterruptScreen" then
				f11_arg0:OpenLogonInterruptPopup( f11_arg0._interruptionController )
			end
		elseif f11_arg0._registeringController ~= nil then
			if not f11_arg0._autoRegistrationEnabled or f11_arg0._autoRegistrationState == FenceOnlineServices.AUTO_REGISTRATION_STATE.FAIL then
				if not f11_arg0._openedRegisteringPopup then
					f11_arg0:OpenRegisteringPopup()
				end
				f11_local7 = CONDITIONS.IsMenuInStack( "CODAccountLogin" )
				if CONDITIONS.IsUsingMobileLayout() then
					f11_local7 = CONDITIONS.IsMenuInStack( "CODAccountFencePopup" )
				end
				local f11_local8
				if f11_arg0._registrationState ~= FenceOnlineServices.REGISTRATION_STATE.OTP_NEEDED and f11_arg0._registrationState ~= FenceOnlineServices.REGISTRATION_STATE.OTP_THROTTLED then
					f11_local8 = false
				else
					f11_local8 = true
				end
				if f11_local8 and f11_local7 and not f11_arg0._openedOTPPopup then
					f11_arg0:OpenOTPPopup()
					f11_arg0:SetHasSeenCODAccountOTP( f11_arg0._registeringController )
				end
				if f11_arg0._registrationState == FenceOnlineServices.REGISTRATION_STATE.REGISTERING and f11_local7 then
					if not f11_arg0._openedLoggingInPopup then
						LUI.FlowManager.RequestPopupMenu( unused, "CODAccountLoggingInPopup", true, f11_arg0._registeringController, false, {
							controllerIndex = f11_arg0._registeringController
						}, nil, true, true )
						f11_arg0._openedLoggingInPopup = true
					end
				elseif f11_arg0._openedLoggingInPopup then
					LUI.FlowManager.RequestLeaveMenuByName( "CODAccountLoggingInPopup", true, true )
					f11_arg0._openedLoggingInPopup = false
				end
			end
		elseif f11_arg0._summaryController ~= nil then
			if AccountRegistration ~= nil then
				f11_local7 = AccountRegistration[0xC1CAC2EF069C401]( f11_arg0._summaryController )
			else
				f11_local7 = false
			end
			local f11_local8
			if AccountRegistration ~= nil then
				f11_local8 = AccountRegistration[0xAE7E83248289443]( f11_arg0._summaryController )
			else
				f11_local8 = false
			end
			local f11_local10
			if AccountRegistration ~= nil then
				f11_local10 = CONDITIONS.IsMobileSoftAccount( f11_arg0._summaryController )
			else
				f11_local10 = false
			end
			if not f11_local8 and not f11_local10 and not f11_local7 and not f11_arg0._hasSeenGreeting and not Engine[0x757E77CA15D6B8F]( f11_arg0._summaryController ) then
				f11_arg0._registeringController = f11_arg0._summaryController
				f11_arg0:OpenRegisteringPopup( f11_local7 )
				return 
			end
			f11_arg0:OpenSummaryPopup()
		elseif f11_arg0._eulaController ~= nil and LUI.WebViewManager.WebEULAEnabled() then
			f11_local7 = LUI.WebViewManager.Instance()
			if f11_local7:EulaTick( f11_arg0._eulaController, LUI.WebViewManager.EULA_CODACCOUNT, LUI.WebViewManager.EulaSource.FenceOnlineService ) == LUI.WebViewManager.EulaTickResult.Declined and Engine[0xFB1B6E36ABE59B8]() then
				if Engine[0xCA404C71196D651]( f11_arg0._eulaController ) then
					Engine[0x5DEE98AA6FB3C2]( f11_arg0._eulaController, CoD.LeavePartyMoveUI.NO, CoD.LeavePartyShowMessage.NO, "Decline cod account eula" )
					Dvar[0x8EA06EEDB58D872]( 0x62400405F9F3C0B, false )
					Engine[0xE49CE4BCE0701D5]( "Decline cod account eula" )
					local f11_local8 = LUI.WebViewManager.Instance()
					f11_local8:SetDeclinedEula()
				else
					Engine[0x54DE5FB69D3BA90]( f11_arg0._eulaController )
				end
			end
		end
	end
end

function PopupConnecting( f10_arg0, f10_arg1 )
	local f10_local0 = assert
	local f10_local1
	if f10_arg1 then
		f10_local1 = f10_arg1
	else
		f10_local1 = f10_arg1.onCancel
	end
	f10_local0( f10_local1 )
	f10_local0 = {
		message = Engine[0xED84C33EC5F01EA]( 0x3BDEC1F7AF558E5 ),
		onStatusUpdateCallback = f10_arg1.onStatusUpdateCallback,
		onMessageUpdateCallback = f10_arg1.onMessageUpdateCallback,
		onPrintStatusCallback = f10_arg1.onPrintStatusCallback,
		controllerIndex = f10_arg1.controllerIndex,
		isNonCriticalPopup = f10_arg1.isNonCriticalPopup
	}
	if not CONDITIONS.IsMobileOrMobileSim() then
		f10_local0.onCancel = f10_arg1.onCancel
	end
	if Engine[0x5EA7EB683287036]( f10_arg1.controllerIndex ) then
		if not Engine[0x8B495DC361731F7]( f10_arg1.controllerIndex ) then
			f10_local0.imageOverride = "logo_wz_shadow"
		end
	else
		f10_local0.imageOverride = "logo_cod_warzone_mw_shadow"
	end
	local f10_local2 = MenuBuilder.BuildRegisteredType( "MainLockoutFence", f10_local0 )
	f10_local2.id = "popup_connecting"
	return f10_local2
end

function PopupConnectingError( f9_arg0, f9_arg1 )
	local f9_local0 = assert
	local f9_local1
	if f9_arg1 then
		f9_local1 = f9_arg1
	else
		f9_local1 = f9_arg1.errorString
	end
	f9_local0( f9_local1 )
	f9_local0 = {
		darkenerAlpha = 1,
		controllerIndex = f9_arg1.controllerIndex,
		title = Engine[0xED84C33EC5F01EA]( 0xC5EDD4448BD0942 ),
		message = f9_arg1.errorString
	}
	local f9_local2 = not Engine[0xCA404C71196D651]( f9_arg1.controllerIndex )
	if f9_local2 then
		f9_local0.message = Engine[0xED84C33EC5F01EA]( 0xDCA55EDC9CE2B6C, Engine[0x7D3158A9539A355]( Engine[0x29680E4E30C45C2]( f9_arg1.controllerIndex ) ), f9_local0.message )
	end
	if f9_local2 or f9_arg1.noPremium then
		f9_local0.buttons = BOOT.GetOkayPopupButtons()
	else
		f9_local1 = BOOT.GetRetryPopupButtons
		local f9_local3 = f9_arg1.controllerIndex
		local f9_local4 = CONDITIONS.IsPC()
		if not f9_local4 then
			f9_local4 = CONDITIONS.IsPCMSStore()
		end
		f9_local0.buttons = f9_local1( f9_local3, f9_local4 )
	end
	if Engine[0x5EA7EB683287036]( f9_arg1.controllerIndex ) then
		if not Engine[0x8B495DC361731F7]( f9_arg1.controllerIndex ) then
			f9_local0.imageOverride = "logo_wz_shadow"
		end
	else
		f9_local0.imageOverride = "logo_cod_warzone_mw_shadow"
	end
	f9_local1 = nil
	if CONDITIONS.IsMobileOrMobileSim() then
		if CONDITIONS.MobileIsBootPresentationEnabled() and Dvar[0x9E5BE3B4BBA4E0E]( 0xE8A6179AA3EFA7F ) then
			Web[0xE98F74F6BE5B05E]( "", f9_local0.message, f9_local0.title, "" )
		end
		f9_local1 = MenuBuilder.BuildRegisteredType( "PopupNoButtons", f9_local0 )
	else
		f9_local1 = MenuBuilder.BuildRegisteredType( "PopupMessageAndButtons", f9_local0 )
	end
	f9_local1.id = "popup_connecting_error"
	return f9_local1
end

function PopupBan( f6_arg0, f6_arg1 )
	assert( f6_arg1 )
	local f6_local0 = Fences[0x65CBD83E503065E]( f6_arg1.controllerIndex )
	local f6_local1 = nil
	if f6_local0 == Enum[0xF33D9C52E48F620][0x17EB089F60F5085] then
		f6_local1 = Engine[0xED84C33EC5F01EA]( 0x9E0FA6C9AB61727 )
	elseif f6_local0 == Enum[0xF33D9C52E48F620][0x5BD39F06F76D6BC] then
		f6_local1 = Engine[0xED84C33EC5F01EA]( 0x31FE31A35D72D13 )
	end
	local f6_local2 = {
		controllerIndex = f6_arg1.controllerIndex,
		title = Engine[0xED84C33EC5F01EA]( 0xD09E09A43DE9B80 ),
		message = f6_local1,
		buttons = BOOT.GetRetryPopupButtons( f6_arg1.controllerIndex, true )
	}
	table.insert( f6_local2.buttons, 1, {
		label = Engine[0xED84C33EC5F01EA]( 0x3E5499E615ADFE1 ),
		action = function ( f8_arg0, f8_arg1 )
			if Engine[0x9DD5167C6D720F1]() then
				Engine[0xB2C1E257ADEC051]( CODACCOUNT.AccountURL.AccountSettings )
			else
				Engine[0xA265A859B7C189E]( f6_arg0.controllerIndex, Enum[0xF1088316FF3F9][0xE9F94B4318205CC], CODACCOUNT.AccountURL.SecurityPolicy )
			end
			Engine[0xDEE6107B26F8BB6]()
		end,
		image = RegisterMaterial( 0x592B8209EECC27B )
	} )
	if Engine[0x5EA7EB683287036]( f6_arg1.controllerIndex ) then
		if not Engine[0x8B495DC361731F7]( f6_arg1.controllerIndex ) then
			f6_local2.imageOverride = "logo_wz_shadow"
		end
	else
		f6_local2.imageOverride = "logo_cod_warzone_mw_shadow"
	end
	local f6_local3 = nil
	if CONDITIONS.IsMobileOrMobileSim() then
		local f6_local4 = CONDITIONS.IsMobile()
		f6_local2.noCloseButton = true
		f6_local2.popup_title = Engine[0xED84C33EC5F01EA]( 0xD09E09A43DE9B80 )
		f6_local2.message_text = f6_local1
		if f6_local4 then
			f6_local2.button_text = Engine[0xED84C33EC5F01EA]( 0xFF233C843DAA940 )
			f6_local2.confirmation_action = function ( f7_arg0, f7_arg1 )
				CODACCOUNT.Logout( f7_arg1.controller )
			end
			
		end
		local f6_local5 = MenuBuilder.BuildRegisteredType
		local f6_local6
		if f6_local4 then
			f6_local6 = "generic_confirmation_popup"
		else
			f6_local6 = "PopupNoButtons"
		end
		f6_local3 = f6_local5( f6_local6, f6_local2 )
	else
		f6_local3 = MenuBuilder.BuildRegisteredType( "PopupMessageAndButtons", f6_local2 )
	end
	f6_local3.id = "popup_ban"
	return f6_local3
end

function PopupConnectingCancelled( f5_arg0, f5_arg1 )
	local f5_local0 = {
		controllerIndex = f5_arg1.controllerIndex,
		title = Engine[0xED84C33EC5F01EA]( 0xC5EDD4448BD0942 ),
		message = Engine[0xED84C33EC5F01EA]( 0x43673F234704666 )
	}
	local f5_local1 = BOOT.GetRetryPopupButtons
	local f5_local2 = f5_arg1.controllerIndex
	local f5_local3 = CONDITIONS.IsPC()
	if not f5_local3 then
		f5_local3 = CONDITIONS.IsPCMSStore()
	end
	f5_local0.buttons = f5_local1( f5_local2, f5_local3 )
	if Engine[0x5EA7EB683287036]( f5_arg1.controllerIndex ) then
		if not Engine[0x8B495DC361731F7]( f5_arg1.controllerIndex ) then
			f5_local0.imageOverride = "logo_wz_shadow"
		end
	else
		f5_local0.imageOverride = "logo_cod_warzone_mw_shadow"
	end
	f5_local1 = nil
	if CONDITIONS.IsMobileOrMobileSim() then
		if CONDITIONS.MobileIsBootPresentationEnabled() and Dvar[0x9E5BE3B4BBA4E0E]( 0xE8A6179AA3EFA7F ) then
			Web[0xE98F74F6BE5B05E]( "", f5_local0.message, f5_local0.title, "" )
		end
		f5_local1 = MenuBuilder.BuildRegisteredType( "PopupOK", f5_local0 )
	else
		f5_local1 = MenuBuilder.BuildRegisteredType( "PopupMessageAndButtons", f5_local0 )
	end
	f5_local1.id = "popup_connecting_cancelled"
	return f5_local1
end

function PopupOnlineQueue( f3_arg0, f3_arg1 )
	assert( f3_arg1 )
	local f3_local0 = {
		message = Engine[0xED84C33EC5F01EA]( 0xA479AD2705AC200 ),
		description = Engine[0xED84C33EC5F01EA]( 0x821FAC05C54DDCA )
	}
	local f3_local1 = f3_arg1.controllerIndex
	if not f3_local1 then
		f3_local1 = Engine[0x45B054C920178E9]()
	end
	f3_local0.controllerIndex = f3_local1
	if Engine[0x575E9C5B9AAB6F4]() then
		f3_local0.buttons = {
			label = Engine[0xED84C33EC5F01EA]( 0x4E76830223A336F ),
			alignment = LUI.Alignment.Center,
			action = function ()
				Engine[0xDEE6107B26F8BB6]()
			end
		}
	end
	f3_local1 = MenuBuilder.BuildRegisteredType( "FenceOnlineQueueDialogPopupWithDescription", f3_local0 )
	f3_local1.id = "popup_online_queue"
	return f3_local1
end

MenuBuilder.registerType( "popup_online_queue", PopupOnlineQueue )
MenuBuilder.registerType( "popup_connecting", PopupConnecting )
MenuBuilder.registerType( "popup_connecting_error", PopupConnectingError )
MenuBuilder.registerType( "popup_ban", PopupBan )
MenuBuilder.registerType( "popup_connecting_cancelled", PopupConnectingCancelled )
FenceOnlineServicesPremium = LUI.Class( FenceOnlineServices )
FenceOnlineServicesPremium.init = function ( f2_arg0 )
	FenceOnlineServicesPremium.super.init( f2_arg0, false )
end

LUI.Fence.Register( "onlineServices", FenceOnlineServicesPremium )
FenceOnlineServicesNoPremium = LUI.Class( FenceOnlineServices )
FenceOnlineServicesNoPremium.init = function ( f1_arg0 )
	FenceOnlineServicesNoPremium.super.init( f1_arg0, true )
end

LUI.Fence.Register( "onlineServicesNoPremium", FenceOnlineServicesNoPremium )
LockTable( _M )
