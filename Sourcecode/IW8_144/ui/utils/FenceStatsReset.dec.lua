-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 27-09-2025 22:41
module( ..., package.seeall )
FenceStatsReset = LUI.Class( LUI.Fence )
FenceStatsReset.CODE_STATE = {
	RESET_STATS_REASON_GUEST = 3,
	RESET_STATS_NO_RESET = 0,
	RESET_STATS_REASON_NOT_FOUND = 1,
	RESET_STATS_REASON_ONLINE_STATS_RESET = 7,
	RESET_STATS_REASON_PIPELINE = 2,
	RESET_STATS_REASON_BAD_FILE_VERSION = 5,
	RESET_STATS_REASON_BAD_PLAYERDATA_VERSION = 6,
	RESET_STATS_REASON_CORRUPT = 4
}
FenceStatsReset.init = function ( f11_arg0 )
	FenceStatsReset.super.init( f11_arg0 )
end

FenceStatsReset.Start = function ( f10_arg0 )
	DebugPrint( "FenceStatsReset.Start" )
end

FenceStatsReset.Stop = function ( f9_arg0 )
	DebugPrint( "FenceStatsReset.Stop" )
end

FenceStatsReset.UpdateState = function ( f5_arg0 )
	assert( f5_arg0._state ~= LUI.Fence.STATE.fail )
	f5_arg0._state = LUI.Fence.STATE.pass
	assert( f5_arg0._statsSource )
	for f5_local0 = 0, Engine.DCJGJDDEHE() - 1, 1 do
		local f5_local3 = Engine.BBHAECABBD( f5_local0 )
		local f5_local4
		if f5_local3 then
			f5_local4 = f5_local3
		else
			f5_local4 = Engine.DBAEJAHFGJ( f5_local0 )
		end
		if f5_local3 and not f5_local4 then
			local f5_local5 = Fences.CEEDFDDICC( f5_local0, f5_arg0._statsSource )
			if 0 < f5_local5 then
				if f5_arg0._declined then
					f5_arg0._state = LUI.Fence.STATE.fail
				else
					f5_arg0._state = LUI.Fence.STATE.block
					if not f5_arg0._warningOpen then
						f5_arg0._warningOpen = true
						local f5_local6 = {
							errorCode = f5_local5
						}
						local f5_local7
						if f5_local6.errorCode ~= FenceStatsReset.CODE_STATE.RESET_STATS_REASON_ONLINE_STATS_RESET then
							f5_local7 = Dvar.IBEGCHEFE( "MPTMQQNLNT" )
						else
							f5_local7 = true
						end
						if Engine.BHICADFIHA() and not f5_local7 then
							f5_local7 = f5_local6.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION
						end
						if f5_arg0._statsSource == CoD.StatsSource.OFFLINE then
							f5_local7 = true
						end
						if f5_local7 then
							f5_local6.onAccept = function ()
								f5_arg0._warningOpen = false
								Fences.EBIGGFFHD( f5_arg0, f5_arg0._statsSource )
							end
							
							f5_local6.onDecline = function ()
								f5_arg0._warningOpen = false
								f5_arg0._declined = true
							end
							
							LUI.FlowManager.RequestPopupMenu( unused, "StatsResetPopup", true, f5_local0, false, f5_local6, nil, true, true )
						else
							f5_local6.controllerIndex = f5_local0
							f5_local6.action = function ()
								f5_arg0._warningOpen = false
								f5_arg0._declined = true
							end
							
							LUI.FlowManager.RequestPopupMenu( unused, "StatsFailurePopup", true, f5_local0, false, f5_local6, nil, true, true )
						end
					end
				end
			end
		end
	end
end

FenceOnlineStatsReset = LUI.Class( FenceStatsReset )
FenceOnlineStatsReset.init = function ( f4_arg0 )
	FenceOnlineStatsReset.super.init( f4_arg0 )
	f4_arg0._statsSource = CoD.StatsSource.ONLINE
end

LUI.Fence.Register( "onlineStatsReset", FenceOnlineStatsReset )
FenceOfflineStatsReset = LUI.Class( FenceStatsReset )
FenceOfflineStatsReset.init = function ( f3_arg0 )
	FenceOfflineStatsReset.super.init( f3_arg0 )
	f3_arg0._statsSource = CoD.StatsSource.OFFLINE
end

LUI.Fence.Register( "offlineStatsReset", FenceOfflineStatsReset )
function StatsFailurePopup( f2_arg0, f2_arg1 )
	assert( f2_arg1.errorCode )
	assert( f2_arg1.controllerIndex )
	local f2_local0 = Engine.CEJJDJJHIJ
	local f2_local1 = f2_arg1.controllerIndex
	local f2_local2 = "dlog_event_stats_failure_need_support"
	local f2_local3 = {}
	local f2_local4 = f2_arg1.errorCode
	if not f2_local4 then
		f2_local4 = FenceStatsReset.CODE_STATE.RESET_STATS_NO_RESET
	end
	f2_local3.error_code = f2_local4
	f2_local0( f2_local1, f2_local2, f2_local3 )
	f2_local0 = "MENU/STATS_FAILURE_CONTACT_SUPPORT"
	local f2_local5 = f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_CORRUPT
	if (f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION) or f2_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_PLAYERDATA_VERSION then
		f2_local0 = "MENU/STATS_VERSION_FAILURE_CONTACT_SUPPORT"
	end
	f2_local4 = MenuBuilder.BuildRegisteredType( "PopupOK", {
		message = Engine.CBBHFCGDIC( f2_local0 ),
		title = Engine.CBBHFCGDIC( "MENU/ERROR" ),
		action = f2_arg1.action
	} )
	f2_local4.id = "StatsFailurePopup"
	return f2_local4
end

function StatsResetPopup( f1_arg0, f1_arg1 )
	assert( f1_arg1.errorCode )
	assert( f1_arg1.onAccept )
	assert( f1_arg1.onDecline )
	local f1_local0 = "MENU/CORRUPT_STATS_WARNING_ONLINE"
	if (f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_FILE_VERSION) or f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_BAD_PLAYERDATA_VERSION then
		f1_local0 = "MENU/STATS_WRONG_VERSION_WARNING"
	elseif f1_arg1.errorCode == FenceStatsReset.CODE_STATE.RESET_STATS_REASON_ONLINE_STATS_RESET then
		f1_local0 = "MENU/ONLINE_STATS_RESET"
	end
	local f1_local1 = MenuBuilder.BuildRegisteredType( "PopupYesNo", {
		title = Engine.CBBHFCGDIC( "MENU/ERROR" ),
		message = Engine.CBBHFCGDIC( f1_local0 ),
		yesAction = f1_arg1.onAccept,
		noAction = f1_arg1.onDecline
	} )
	f1_local1.id = "StatsResetPopup"
	return f1_local1
end

MenuBuilder.registerType( "StatsResetPopup", StatsResetPopup )
MenuBuilder.registerType( "StatsFailurePopup", StatsFailurePopup )
LockTable( _M )
