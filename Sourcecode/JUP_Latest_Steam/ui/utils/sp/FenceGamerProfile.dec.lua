-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
FenceGamerProfile = LUI.Class( LUI.Fence )
FenceGamerProfile.init = function ( f12_arg0 )
	LUI.Fence.init( f12_arg0 )
end

FenceGamerProfile.Start = function ( f11_arg0 )
	f11_arg0._languagePopupOpened = false
	f11_arg0._openedBrightnessMenu = false
	f11_arg0._setScreenBounds = false
	f11_arg0._openedEULA = false
	f11_arg0._IsPrivacyScreenAddedToBootFlow = false
	f11_arg0._regulationsFetchedOnce = false
	f11_arg0._bootSetupFlow = {}
	if LUI.WebViewManager.WebEULAEnabled() then
		f11_arg0._requiredEula = {
			LUI.WebViewManager.EULA_SOFTWARE
		}
		f11_arg0._requiredEulaAccessed = {
			nil,
			false
		}
		if EULAUtils.UseNewWorkflow() then
			EULAUtils.Init()
		end
	end
	if Dvar[0x9E5BE3B4BBA4E0E]( 0xDEFCC2CE2C04AA6 ) then
		for f11_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			Engine[0x9694388D6DAC134]( "acceptedEULA", 0, f11_local0 )
			Engine[0x9694388D6DAC134]( "hasEverPlayed_MainMenu", 0, f11_local0 )
			Engine[0x9694388D6DAC134]( "hasEverPlayed_SP", 0, f11_local0 )
			Engine[0x9694388D6DAC134]( "hasEverPlayed_MP", 0, f11_local0 )
			Engine[0x9694388D6DAC134]( "hasEverPlayed_MLG", 0, f11_local0 )
			Engine[0xB81A5136C5503E4]( "updategamerprofile" )
			Engine[0xB81A5136C5503E4]( "telescope_clear storage" )
		end
	end
	if not Engine[0x7B17D94988FD5D0]( "hasEverPlayed_MainMenu" ) and not CONDITIONS.IsCIABuildEnabled() and not CONDITIONS.IsJupPublicBetaBuildEnabled() then
		if not (not Engine[0x11F62BBBEC860F6]() or not Engine[0x6829A6E9399101B]()) or Dvar[0x9E5BE3B4BBA4E0E]( 0xB953D2AA370285B ) then
			if CONDITIONS.CanCalibrateHDR() then
				table.insert( f11_arg0._bootSetupFlow, {
					name = "BootHDRBlackPoint"
				} )
				table.insert( f11_arg0._bootSetupFlow, {
					name = "BootHDRWhitePoint"
				} )
			end
		else
			table.insert( f11_arg0._bootSetupFlow, {
				name = "BootBrightness"
			} )
		end
		if not Engine[0x575E9C5B9AAB6F4]() then
			table.insert( f11_arg0._bootSetupFlow, {
				name = "ScreenMargins"
			} )
		end
		if not CONDITIONS[0x8601D4FFBB8C991]() then
			table.insert( f11_arg0._bootSetupFlow, {
				name = "BootAudioMixPreset"
			} )
		end
		table.insert( f11_arg0._bootSetupFlow, {
			name = "BootAccessibilitySetting"
		} )
		if Engine[0x575E9C5B9AAB6F4]() and not CONDITIONS[0x8601D4FFBB8C991]() then
			table.insert( f11_arg0._bootSetupFlow, {
				name = "BootPCSettings"
			} )
		end
	end
end

FenceGamerProfile.Stop = function ( f10_arg0 )
	
end

FenceGamerProfile.OnBackOut = function ( f9_arg0 )
	Engine[0xDA3327C5229A9D0]()
	Engine[0x42793DA525D6AD0]()
end

FenceGamerProfile.OnPass = function ( f8_arg0 )
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x1A2F29C06CA71EA ) then
		for f8_local0 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
			if Engine[0x10A5732AB1DAE9F]( f8_local0 ) and Engine[0xCA404C71196D651]( f8_local0 ) then
				COLOR_BLIND.UpdateAllSwatches( f8_local0 )
			end
		end
	end
end

FenceGamerProfile.ProcessingEULA = function ( f7_arg0, f7_arg1 )
	if CONDITIONS.IsCIABuildEnabled() or CONDITIONS.IsJupPublicBetaBuildEnabled() then
		Engine[0xB81A5136C5503E4]( "profile_SetAcceptedEULA" )
		return false
	elseif LUI.WebViewManager.WebEULAEnabled() then
		if EULAUtils.UseNewWorkflow() then
			local f7_local0 = EULAUtils.Process( f7_arg1 )
			if f7_local0 == LUI.WebViewManager.EulaTickResult.Progress then
				f7_arg0._state = LUI.Fence.STATE.block
				return true
			elseif f7_local0 == LUI.WebViewManager.EulaTickResult.Declined then
				Engine[0xE49CE4BCE0701D5]( "Decline EULA" )
				f7_arg0._state = LUI.Fence.STATE.fail
				return true
			end
		else
			for f7_local4, f7_local5 in ipairs( f7_arg0._requiredEula ) do
				if f7_arg0._requiredEulaAccessed[f7_local4] == false then
					f7_arg0._requiredEulaAccessed[f7_local4] = true
					local f7_local3 = LUI.WebViewManager.Instance()
					f7_local3:PrepareEulaTickEnvironment( f7_arg1, f7_local5 )
				end
				local f7_local3 = LUI.WebViewManager.Instance()
				f7_local3 = f7_local3:EulaTick( f7_arg1, f7_local5, LUI.WebViewManager.EulaSource.FenceGamerProfile )
				if f7_local3 == LUI.WebViewManager.EulaTickResult.Progress then
					f7_arg0._state = LUI.Fence.STATE.block
					return true
				elseif f7_local3 == LUI.WebViewManager.EulaTickResult.Declined then
					Engine[0xE49CE4BCE0701D5]( "Decline eula: " .. f7_local5 )
					f7_arg0._state = LUI.Fence.STATE.fail
					return true
				end
			end
		end
		return false
	elseif not Engine[0x7B17D94988FD5D0]( "acceptedEULA", f7_arg1 ) and (not CONDITIONS.IsMobileOrMobileSim() or CONDITIONS.IsMobileLegalEnable()) and not CONDITIONS.InSPExec() then
		f7_arg0._state = LUI.Fence.STATE.block
		if not f7_arg0._openedEULA then
			f7_arg0._openedEULA = true
			BOOT.InitializeLegalBootPopupsSequence()
			local f7_local0 = BOOT.GetCurrentLegalBootPopupName()
			if f7_local0 then
				LUI.FlowManager.RequestPopupMenu( unused, f7_local0, false, f7_arg1, false, {}, nil, true, true )
			else
				f7_arg0._state = LUI.Fence.STATE.fail
			end
		end
		local f7_local0 = BOOT.GetCurrentLegalBootPopupName()
		if f7_local0 and not LUI.FlowManager.IsInStack( f7_local0 ) then
			f7_arg0._state = LUI.Fence.STATE.fail
		end
		return true
	else
		return false
	end
end

FenceGamerProfile.UpdateState = function ( f6_arg0 )
	f6_arg0._state = LUI.Fence.STATE.pass
	local f6_local0 = nil
	for f6_local1 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
		if Engine[0x10A5732AB1DAE9F]( f6_local1 ) then
			if Engine[0xCA404C71196D651]( f6_local1 ) then
				f6_local0 = f6_local1
			end
			if Engine[0x1DCFAFA7CE6F8D0]() and Engine[0xD010849D7396812]( f6_local1 ) then
				if not LUI.FlowManager.IsInStack( "popup_corrupt_data" ) then
					LUI.FlowManager.RequestPopupMenu( nil, "popup_corrupt_data", true, f6_local1, false, {}, nil, false, true )
				end
				f6_arg0._state = LUI.Fence.STATE.block
				return 
			elseif Engine[0x961ADE0742DBB36]( f6_local1 ) == #Languages then
				Engine[0x74FE0B006735E42]( f6_local1, Engine[0xF35D89342CF7712]() )
				if not Engine[0x575E9C5B9AAB6F4]() then
					Engine[0xB81A5136C5503E4]( "updategamerprofile" )
				end
			end
			if not f6_arg0._isGoreOptionSet and OPTIONS.IsCountryGermany() then
				f6_arg0._isGoreOptionSet = true
				if Engine[0x7B17D94988FD5D0]( "gore", f6_local1 ) then
					Engine[0x9694388D6DAC134]( "gore", false, f6_local1 )
				end
			end
		end
	end
	if f6_local0 and CONDITIONS.IsUserSignedInDemonware( f6_local0 ) and Dvar[0x9E5BE3B4BBA4E0E]( 0xD9253124D4809C9 ) then
		if Engine[0x8D175F4CE7F7F1B]() and not f6_arg0._regulationsFetchedOnce then
			f6_arg0._regulationsFetchedOnce = Regulations[0xB0226B59CCFC85E]( f6_local0 )
		end
		if not f6_arg0._IsPrivacyScreenAddedToBootFlow and Engine[0x8D175F4CE7F7F1B]() and Regulations[0xD4241445553170B]( f6_local0 ) then
			table.insert( f6_arg0._bootSetupFlow, 1, {
				name = "PrivacyChoices"
			} )
			f6_arg0._IsPrivacyScreenAddedToBootFlow = true
		end
	end
	if f6_local0 and Engine[0xD2813B521711C11]( f6_local0 ) and not Engine[0x3CE55FFE2E82102]( f6_local0 ) then
		local f6_local1 = Engine[0x961ADE0742DBB36]( f6_local0 )
		local f6_local2 = Engine[0xF35D89342CF7712]()
		if Dvar[0x9E5BE3B4BBA4E0E]( 0xBD5EF171527B9C ) or Dvar[0x9E5BE3B4BBA4E0E]( 0xA0D285D5AF3D531 ) then
			if EULAUtils.UseNewWorkflow() then
				if not Legal[0x86BAFB16A56F490]( f6_local0 ) then
					Legal[0x112EC9AA29AB642]( f6_local0, true )
				end
			elseif not Engine[0x7B17D94988FD5D0]( "acceptedEULA", f6_local0 ) then
				Engine[0xB81A5136C5503E4]( "profile_SetAcceptedEULA" )
				Engine[0xB81A5136C5503E4]( "updategamerprofile" )
			end
			if not CONDITIONS.IsMobileOrMobileSim() and not Engine[0x7B17D94988FD5D0]( "hasEverPlayed_MainMenu", f6_local0 ) then
				Engine[0xB81A5136C5503E4]( "profile_SetHasEverPlayed_MainMenu" )
				Engine[0xB81A5136C5503E4]( "updategamerprofile" )
			end
		end
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x244E1B9C23A167C ) then
			return 
		elseif Dvar[0x9E5BE3B4BBA4E0E]( 0x553AE2FB5AE7D5 ) == true then
			LUI.FlowManager.RequestPopupMenu( nil, "live_dialog_text_box", false, nil, false, {
				title = Engine[0xED84C33EC5F01EA]( 0x1CCA5C59ECE1EA6 ),
				message = Engine[0xED84C33EC5F01EA]( 0xB517A02D0B2114F )
			}, nil, false, true )
		elseif (not Engine[0x575E9C5B9AAB6F4]() or Engine[0x926B1DECE2B6039]()) and not Engine[0xE25E29D8ADE8F27]() and f6_local1 < #Languages and f6_local2 ~= f6_local1 then
			if Engine[0x88FBC854CDE6C22]( f6_local1 ) then
				if not f6_arg0._languagePopupOpened then
					f6_arg0._languagePopupOpened = true
					f6_local3 = {
						currentLanguage = f6_local2,
						preferredLanguage = f6_local1
					}
					if not LUI.FlowManager.IsInStack( "PopupLanguageRestart" ) then
						LUI.FlowManager.RequestPopupMenu( unused, "PopupLanguageRestart", true, f6_local0, false, f6_local3, nil, true, true )
					end
				end
			else
				Engine[0x74FE0B006735E42]( f6_local0, f6_local2 )
			end
			f6_arg0._state = LUI.Fence.STATE.block
		elseif f6_arg0:ProcessingEULA( f6_local0 ) then
			
		elseif not Engine[0x7B17D94988FD5D0]( "hasEverPlayed_MainMenu", f6_local0 ) and not CONDITIONS.IsMobileOrMobileSim() then
			if Engine[0xA9AFC4E601A350B]() then
				if not Engine[0x20B186F60BAEF07]() then
					f6_arg0._state = LUI.Fence.STATE.block
					return 
				elseif Engine[0x1D6AF8DD4196916]() then
					Engine[0xB81A5136C5503E4]( "profile_SetHasEverPlayed_MainMenu" )
					f6_arg0._state = LUI.Fence.STATE.pass
					return 
				end
			end
			f6_arg0._state = LUI.Fence.STATE.block
			if not DataSources.telescope.conflictfullscreenwebview:GetValue( f6_local0 ) then
				DataSources.telescope.conflictfullscreenwebview:SetValue( f6_local0, true )
			end
			for f6_local6, f6_local7 in ipairs( f6_arg0._bootSetupFlow ) do
				if not LUI.FlowManager.IsInStack( f6_local7.name ) then
					if not f6_local7.opened then
						f6_local7.opened = true
						LUI.FlowManager.RequestPopupMenu( unused, f6_local7.name, false, f6_local0, false, {
							isDefaultSequence = true,
							isBootOption = true,
							bootSetupFlow = f6_arg0._bootSetupFlow,
							pageId = f6_local6,
							pageCount = #f6_arg0._bootSetupFlow
						}, nil, true, true )
						return 
					end
				end
				return 
			end
			f6_arg0._state = LUI.Fence.STATE.pass
			Engine[0xB81A5136C5503E4]( "profile_SetHasEverPlayed_MainMenu" )
			if not Engine[0x575E9C5B9AAB6F4]() then
				Engine[0xB81A5136C5503E4]( "updategamerprofile" )
			end
		end
	end
end

function PopupCorruptData( f4_arg0, f4_arg1 )
	local f4_local0 = MenuBuilder.BuildRegisteredType( "generic_confirmation_popup", {
		popup_title = Engine[0xED84C33EC5F01EA]( 0xFB4A126E94F0B50 ),
		message_text = Engine[0xED84C33EC5F01EA]( 0x120FA37110BFA65 ),
		button_text = Engine[0xED84C33EC5F01EA]( 0x5C33DA8F6CE65B0 ),
		confirmation_action = function ( f5_arg0, f5_arg1 )
			Engine[0xC57F068D1F8FB67]( f5_arg1.controller )
			LUI.FlowManager.RequestLeaveMenuByName( "popup_corrupt_data", true )
		end
	} )
	f4_local0.id = "popup_corrupt_data"
	return f4_local0
end

MenuBuilder.registerType( "PopupLanguageRestart", function ( f1_arg0, f1_arg1 )
	local f1_local0 = MenuBuilder.BuildRegisteredType( "PopupYesNo", {
		title = Engine[0xED84C33EC5F01EA]( 0x1CCA5C59ECE1EA6 ),
		message = Engine[0xED84C33EC5F01EA]( 0xFCB7FDFBBDCCDCA, GetLanguageDisplayName( f1_arg1.currentLanguage ), GetLanguageDisplayName( f1_arg1.preferredLanguage ) ),
		yesAction = function ( f3_arg0, f3_arg1 )
			DCache[0xEA23CAA4B132C55]( f1_arg0.preferredLanguage )
			Engine[0x34C623E28A1C5E7]( "" )
		end,
		noAction = function ( f2_arg0, f2_arg1 )
			Engine[0x74FE0B006735E42]( f1_arg0.controllerIndex, f1_arg0.currentLanguage )
			Engine[0xB81A5136C5503E4]( "updategamerprofile" )
			f2_arg0:dispatchEventToRoot( {
				name = "seek_value",
				controllerIndex = f2_arg1
			} )
		end
	} )
	f1_local0.id = "PopupLanguageRestart"
	return f1_local0
end )
MenuBuilder.registerType( "popup_corrupt_data", PopupCorruptData )
LUI.Fence.Register( "gamerProfile", FenceGamerProfile )
LockTable( _M )
