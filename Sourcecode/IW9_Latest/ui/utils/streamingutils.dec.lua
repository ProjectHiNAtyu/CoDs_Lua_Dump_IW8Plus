-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
STREAMING = STREAMING or {}
STREAMING.ModelTypes = {
	Head = Enum[0x703D605148ADB91][0xC843D6F1BF4C6D9],
	Body = Enum[0x703D605148ADB91][0xFC7E61BDA84220B],
	HandView = Enum[0x703D605148ADB91][0x233EC364C330B98],
	WeaponWorld = Enum[0x703D605148ADB91][0x6AEEEA2BFB9AF53],
	WeaponView = Enum[0x703D605148ADB91][0xF8D1630783C706B],
	ClientModel = Enum[0x703D605148ADB91][0x39D2A38B9FFC82F],
	Animation = Enum[0x703D605148ADB91][0x9F6E971F0B7729B]
}
STREAMING.Queues = {
	[STREAMING.ModelTypes.ClientModel] = {},
	[STREAMING.ModelTypes.Head] = {},
	[STREAMING.ModelTypes.Body] = {},
	[STREAMING.ModelTypes.HandView] = {},
	[STREAMING.ModelTypes.WeaponWorld] = {},
	[STREAMING.ModelTypes.WeaponView] = {},
	[STREAMING.ModelTypes.Animation] = {}
}
STREAMING.QueueTypes = {
	Client = 1,
	Global = 0
}
STREAMING.GlobalPriority = 0
STREAMING.Priority = {
	High = 1,
	Low = 4294967295,
	General = 0
}
STREAMING.MenuSet = {}
STREAMING.MenusRegisteredForCleanup = {}
STREAMING.ModelTypeAttributes = {
	[STREAMING.ModelTypes.Head] = {
		modelLimit = 48,
		queueType = STREAMING.QueueTypes.Global,
		RequestFunction = Streaming[0x18B8E5AB5004CAE],
		HasFunction = Streaming[0xB419364AFE8EA47]
	},
	[STREAMING.ModelTypes.Body] = {
		modelLimit = 48,
		queueType = STREAMING.QueueTypes.Global,
		RequestFunction = Streaming[0x2692B1B59144830],
		HasFunction = Streaming[0x7AC12FC69537581]
	},
	[STREAMING.ModelTypes.HandView] = {
		modelLimit = 20,
		queueType = STREAMING.QueueTypes.Client,
		RequestFunction = Streaming[0x7668EB1A3FE3FB4],
		HasFunction = Streaming[0x43A7A19BC7D53B9]
	},
	[STREAMING.ModelTypes.WeaponWorld] = {
		modelLimit = -64,
		queueType = STREAMING.QueueTypes.Global,
		RequestFunction = Streaming[0x4E036CF79BBA158],
		HasFunction = Streaming[0x1FCAC710627207]
	},
	[STREAMING.ModelTypes.WeaponView] = {
		modelLimit = 24,
		queueType = STREAMING.QueueTypes.Client,
		RequestFunction = Streaming[0x74B584089FA8531],
		HasFunction = Streaming[0xBE636A91711ED30]
	},
	[STREAMING.ModelTypes.ClientModel] = {
		modelLimit = 32,
		queueType = STREAMING.QueueTypes.Client,
		RequestFunction = Streaming[0xC6CF6514F4ACB1F],
		HasFunction = Streaming[0xDBA0813A4480D56]
	},
	[STREAMING.ModelTypes.Animation] = {
		modelLimit = 32,
		queueType = STREAMING.QueueTypes.Client,
		RequestFunction = Streaming[0x570FEC8A2459FC8],
		HasFunction = Streaming[0xB1B9FEF484BA6DB]
	}
}
STREAMING.EnableStreaming = function ()
	if not Streaming[0x19E17A0E38F313A]() then
		Streaming[0xE493C1B436663F6]( true )
	end
end

STREAMING.Init = function ()
	STREAMING.EnableStreaming()
	for f11_local6, f11_local7 in pairs( STREAMING.ModelTypes ) do
		STREAMING.ModelTypeAttributes[f11_local7].modelLimit = Streaming[0xFC6A290A59B360C]( f11_local7 )
		if STREAMING.ModelTypeAttributes[f11_local7].queueType == STREAMING.QueueTypes.Client then
			for f11_local3 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
				STREAMING.Queues[f11_local7][f11_local3] = {}
			end
		end
	end
end

local f0_local0 = function ( f10_arg0, f10_arg1, f10_arg2 )
	if 0 < #f10_arg0 then
		local f10_local0 = {}
		local f10_local1 = STREAMING.ModelTypeAttributes[f10_arg1]
		local f10_local2 = math.min( #f10_arg0, f10_local1.modelLimit )
		if Dvar[0x9E5BE3B4BBA4E0E]( 0x97DE89FC39603 ) then
			DebugPrint( "==================Debug Streaming in UpdateRequests(), StreamingUtils.lua ====================================================================================" )
			DebugPrint( "modelType: " .. tostring( f10_arg1 ) )
			if f10_arg2 then
				DebugPrint( "controllerIndex: " .. tostring( f10_arg2 ) )
			end
		end
		for f10_local3 = 1, f10_local2, 1 do
			local f10_local6 = f10_local2 - f10_local3 + 1
			table.insert( f10_local0, f10_arg0[f10_local6].model )
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x97DE89FC39603 ) then
				local f10_local7 = f10_arg0[f10_local6]
				DebugPrint( tostring( f10_local3 ) .. ". priority: " .. tostring( f10_local7.priority ) .. "  menus:" .. table.concat( f10_local7.menuNames, "," ) .. " requestIds:" .. table.concat( f10_local7.requestIds, "," ) .. " model: " .. tostring( f10_local7.model ) )
			end
		end
		local f10_local3 = f10_local1.RequestFunction
		if f10_local1.queueType == STREAMING.QueueTypes.Global then
			f10_local3( f10_local0 )
		elseif f10_local1.queueType == STREAMING.QueueTypes.Client then
			f10_local3( f10_local0, f10_arg2 )
		end
	end
end

local f0_local1 = function ( f9_arg0, f9_arg1 )
	local f9_local0 = nil
	if STREAMING.ModelTypeAttributes[f9_arg0].queueType == STREAMING.QueueTypes.Global then
		if not STREAMING.Queues[f9_arg0] then
			STREAMING.Queues[f9_arg0] = {}
		end
		f9_local0 = STREAMING.Queues[f9_arg0]
	elseif STREAMING.ModelTypeAttributes[f9_arg0].queueType == STREAMING.QueueTypes.Client then
		if not STREAMING.Queues[f9_arg0][f9_arg1] then
			STREAMING.Queues[f9_arg0][f9_arg1] = {}
		end
		f9_local0 = STREAMING.Queues[f9_arg0][f9_arg1]
	end
	return f9_local0
end

local f0_local2 = function ( f8_arg0, f8_arg1 )
	for f8_local3, f8_local4 in ipairs( f8_arg1 ) do
		Table.RemoveSingleItemFromArray( f8_arg0, f8_local4 )
	end
	Table.AppendArray( f8_arg0, f8_arg1 )
end

local f0_local3 = function ( f7_arg0, f7_arg1 )
	for f7_local0 = #f7_arg0, 1, -1 do
		if f7_arg0[f7_local0].model == f7_arg1.model then
			f0_local0( f7_arg1.menuNames, f7_arg0[f7_local0].menuNames )
			f0_local0( f7_arg1.requestIds, f7_arg0[f7_local0].requestIds )
			table.remove( f7_arg0, f7_local0 )
		end
	end
	local f7_local0 = 1
	for f7_local1 = 1, #f7_arg0, 1 do
		if f7_arg0[f7_local1].priority <= f7_arg1.priority then
			f7_local0 = f7_local1
			break
		end
	end
	table.insert( f7_arg0, f7_local0, f7_arg1 )
end

local f0_local4 = function ( f6_arg0, f6_arg1 )
	for f6_local0 = #f6_arg0, 1, -1 do
		local f6_local3 = Table.FindItemIndexInArray( f6_arg0[f6_local0].menuNames, f6_arg1 )
		if f6_local3 then
			table.remove( f6_arg0[f6_local0].menuNames, f6_local3 )
			if #f6_arg0[f6_local0].menuNames == 0 then
				table.remove( f6_arg0, f6_local0 )
			end
		end
	end
end

local f0_local5 = function ( f5_arg0 )
	local f5_local0 = Streaming[0x19E17A0E38F313A]()
	Streaming[0xE493C1B436663F6]( true )
	for f5_local8, f5_local9 in pairs( STREAMING.ModelTypes ) do
		if STREAMING.ModelTypeAttributes[f5_local9].queueType == STREAMING.QueueTypes.Global then
			local f5_local4 = STREAMING.Queues[f5_local9]
			f0_local0( STREAMING.Queues[f5_local9], f5_arg0 )
			f0_local0( f5_local4, f5_local9 )
		end
		if STREAMING.ModelTypeAttributes[f5_local9].queueType == STREAMING.QueueTypes.Client then
			for f5_local4 = 0, Engine[0xB686A0A723E6442]() - 1, 1 do
				if Engine[0x10A5732AB1DAE9F]( f5_local4 ) then
					local f5_local7 = STREAMING.Queues[f5_local9]
					f0_local0( STREAMING.Queues[f5_local9][f5_local4], f5_arg0 )
					f0_local0( f5_local7, f5_local9, f5_local4 )
				end
			end
		end
	end
	Streaming[0xE493C1B436663F6]( f5_local0 )
end

STREAMING.RequestModels = function ( f3_arg0, f3_arg1 )
	assert( f3_arg1 )
	assert( f3_arg1.models )
	assert( f3_arg1.modelType )
	assert( f3_arg1.requesterWidget )
	STREAMING.EnableStreaming()
	local f3_local0 = f3_arg1.requesterWidget
	local f3_local1 = f3_arg1.modelType
	local f3_local2 = f3_arg1.models
	local f3_local3 = f3_local0:GetCurrentMenu()
	local f3_local4
	if f3_local3 ~= nil then
		f3_local4 = f3_local3.id
		if not f3_local4 then
		
		else
			local f3_local5 = f3_arg1.requestId or f3_local0.id
			if not STREAMING.MenuSet[f3_local4] then
				STREAMING.MenuSet[f3_local4] = true
				STREAMING.GlobalPriority = STREAMING.GlobalPriority + 1
				if not STREAMING.MenusRegisteredForCleanup[f3_local4] then
					STREAMING.MenusRegisteredForCleanup[f3_local4] = true
					LUI.FlowManager.RegisterStackPopBehaviour( f3_local4, function ()
						if STREAMING.MenuSet[f3_arg0] then
							f3_arg0( f3_arg0 )
							STREAMING.MenuSet[f3_arg0] = false
							STREAMING.GlobalPriority = STREAMING.GlobalPriority - 1
						end
					end )
				end
			end
			local f3_local6 = f3_arg1.priority
			if not f3_local6 then
				f3_local6 = STREAMING.Priority.General
			end
			local f3_local7 = STREAMING.GlobalPriority + LUI.clamp( f3_local6, STREAMING.Priority.Low, STREAMING.Priority.High )
			local f3_local8 = f0_local0( f3_local1, f3_arg0 )
			for f3_local12, f3_local13 in ipairs( f3_local2 ) do
				if f3_local13 and 0 < #f3_local13 then
					f0_local0( f3_local8, {
						model = f3_local13,
						priority = f3_local7,
						menuNames = {
							f3_local4
						},
						requestIds = {
							f3_local5
						}
					} )
				end
			end
			f0_local0( f3_local8, f3_local1, f3_arg0 )
		end
	end
	f3_local4 = f3_local0.id
end

STREAMING.CancelRequest = function ( f2_arg0, f2_arg1, f2_arg2 )
	assert( Streaming[0x19E17A0E38F313A]() )
	local f2_local0 = f0_local0( f2_arg1, f2_arg0 )
	for f2_local1 = #f2_local0, 1, -1 do
		local f2_local4 = f2_local0[f2_local1]
		local f2_local5 = Table.FindItemIndexInArray( f2_local4.requestIds, f2_arg2 )
		if f2_local5 then
			table.remove( f2_local4.requestIds, f2_local5 )
			if #f2_local4.requestIds == 0 then
				table.remove( f2_local0, f2_local1 )
			end
		end
	end
	f0_local0( f2_local0, f2_arg1, f2_arg0 )
end

STREAMING.AreXModelsReadyToDisplay = function ( f1_arg0, f1_arg1, f1_arg2 )
	assert( type( f1_arg2 ) == "table", "Model must be a table" )
	local f1_local0 = true
	for f1_local4, f1_local5 in ipairs( f1_arg2 ) do
		if not f1_local5.loaded then
			if f1_arg1 == nil or f1_arg1 == -1 then
				f1_local5.loaded = Streaming[0x15960C84AEC7C3C]( f1_local5.name, f1_local5.type )
			else
				f1_local5.loaded = Streaming[0x15960C84AEC7C3C]( f1_local5.name, f1_local5.type, f1_arg1 )
			end
			if f1_local0 then
				f1_local0 = f1_local5.loaded
			end
		end
	end
	return f1_local0
end

