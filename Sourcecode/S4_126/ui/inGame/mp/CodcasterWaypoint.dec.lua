-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.inGame.mp.CodcasterObjectiveContainer" )
require( "ui.inGame.mp.CodcasterObjectiveArrow" )
local f0_local0 = function ( f19_arg0 )
	return f19_arg0 == ObjectiveState.CURRENT
end

local f0_local1 = function ( f18_arg0, f18_arg1, f18_arg2 )
	local f18_local0
	if not (f18_arg2.sourceName == "codcaster_waypoint_update") then
		f18_local0 = f18_arg0._objectiveData
		if not f18_local0 then
		
		else
			local f18_local1 = false
			if f18_local0 then
				local f18_local2 = f18_arg2.dataSources
				f18_arg0._objectiveData = f18_local0
				local f18_local3 = f18_local2.spectatedClientNum:GetValue( f18_arg1 )
				local f18_local4
				if f18_local3 then
					f18_local4 = f18_local3
				else
					f18_local4 = f18_local3 ~= CODCASTER.INVALID_CLIENTNUM
				end
				local f18_local5 = f18_local2.cameraType:GetValue( f18_arg1 )
				local f18_local6
				if f18_local5 == CODCASTER.CAMERA_TYPES.AERIAL or f18_local5 == CODCASTER.CAMERA_TYPES.FREE or f18_local5 == CODCASTER.CAMERA_TYPES.ORBITAL then
					f18_local6 = false
				else
					f18_local6 = true
				end
				local f18_local7
				if f18_local4 then
					f18_local7 = not f18_local6
				else
					f18_local7 = true
				end
				f18_local0.fadeDisabled = f18_local7
				f18_local7 = f18_local0.pinned
				local f18_local8 = f0_local0( f18_local0.state )
				if not f18_arg0._isComplete and (not f18_local7 or f18_local5 == CODCASTER.CAMERA_TYPES.AERIAL) then
					f18_local1 = f18_local8
				else
					f18_local1 = false
				end
			end
			f18_arg0._showWaypoint = f18_local1
		end
	end
	f18_local0 = CODCASTER.PrepareObjectiveData( f18_arg1, f18_arg2 )
end

local f0_local2 = function ( f17_arg0, f17_arg1, f17_arg2 )
	f17_arg0.ObjectiveContainer:Update( f17_arg0._objectiveData )
end

local f0_local3 = function ( f16_arg0, f16_arg1 )
	f16_arg1.objectiveIndex = f16_arg0._objectiveIndex
	f16_arg0:processEventNoDispatch( {
		name = "codcaster_waypoint_update",
		objectiveData = f16_arg1
	} )
end

local f0_local4 = function ( f15_arg0 )
	
end

local f0_local5 = function ( f14_arg0 )
	f14_arg0._isComplete = true
end

local f0_local6 = function ( f7_arg0, f7_arg1, f7_arg2 )
	f7_arg0.Update = f0_local0
	f7_arg0.Reveal = f0_local0
	f7_arg0.Complete = f0_local0
	f7_arg0.Failed = f0_local0
	f7_arg2.arrowWidget = f7_arg0.Arrow
	f7_arg0._dataOverrides = CODCASTER.GetGameTypeObjectiveDataOverrides()
	OBJECTIVES.SetupObjectiveWidget( f7_arg0, f7_arg2 )
	OBJECTIVES.SetupAnchoring( f7_arg0, f7_arg1, f7_arg2, CODCASTER.GetGameTypeWaypointsAnchoringOptions() )
	OBJECTIVES.SetupDistanceWidget( f7_arg0, f7_arg0.Distance, f7_arg2, true )
	OBJECTIVES.SetupAnchorOnScreenHandler( f7_arg0, function ( f13_arg0, f13_arg1 )
		f13_arg0._isOnScreen = f13_arg1
		local f13_local0 = f13_arg0._arrowWidget
		local f13_local1 = f13_local0
		f13_local0 = f13_local0.SetVisibility
		local f13_local2
		if f13_arg1 then
			f13_local2 = LUI.Visibility.Hidden
			if not f13_local2 then
			
			else
				f13_local0( f13_local1, f13_local2 )
				f13_local0 = f13_arg0.Title
				f13_local1 = f13_local0
				f13_local0 = f13_local0.SetVisibility
				if f13_arg1 then
					f13_local2 = LUI.Visibility.Visible
					if not f13_local2 then
					
					else
						f13_local0( f13_local1, f13_local2 )
					end
				end
				f13_local2 = LUI.Visibility.Hidden
			end
		end
		f13_local2 = LUI.Visibility.Visible
	end )
	CODCASTER.SetupVisualStateHandler( f7_arg0, f7_arg1, {
		{
			refresh = true,
			name = "Visible",
			handle = true,
			visibilityEnum = LUI.Visibility.Visible,
			condition = function ( f12_arg0, f12_arg1, f12_arg2 )
				return f12_arg0._showWaypoint
			end,
			stateHandler = function ( f11_arg0, f11_arg1, f11_arg2 )
				local f11_local0 = f11_arg0._objectiveData
				OBJECTIVES.UpdateScreenCenterFade( f11_arg0, f11_local0 )
				OBJECTIVES.UpdateAnchoring( f11_arg0, f11_local0 )
				local f11_local1 = DataSources.inGame.MP.codcaster.spectatedPlayer.clientNum:GetValue( f11_arg1 )
				local f11_local2
				if f11_local1 then
					f11_local2 = f11_local1
				else
					f11_local2 = f11_local1 ~= CODCASTER.INVALID_CLIENTNUM
				end
				local f11_local3 = ""
				if f11_local2 or f11_local0.showFreecamLabel then
					local f11_local4 = f11_arg0._dataOverrides[CODCASTER.GetCurrentVisualState( f11_arg0.ObjectiveContainer )] or {}
					local f11_local5 = f11_local4.label
					if f11_local5 then
						local f11_local6 = CODCASTER.GetObjectiveLabelOverride( f11_arg1, f11_local0, f11_local5 )
						if not f11_local6 then
							f11_local3 = f11_local6
						else
							f11_local3 = f11_local0.label
						end
					end
					f11_local3 = f11_local0.label
				end
				f11_arg0.Title:setText( Engine[0xED84C33EC5F01EA]( f11_local3 ) )
				local f11_local7 = nil
				local f11_local4 = f11_arg2.dataSources
				local f11_local5 = f11_local0.showTimer
				local f11_local6 = f11_arg0._canShowTimer
				local f11_local8 = f11_local4.cameraType:GetValue( f11_arg1 )
				local f11_local9 = f11_local4.isObjectiveTimerLow:GetValue( f11_arg1 )
				local f11_local10 = f11_local4.isObjectiveTimerVisible:GetValue( f11_arg1 )
				local f11_local11 = CODCASTER.ShowAnimatedWaypointTimerForGameType()
				if f11_local11 then
					if not f11_arg0._isTimerLowAnimationStarted then
						f11_local11 = f11_local9
					else
						f11_local11 = false
					end
				end
				local f11_local12
				if f11_local8 == CODCASTER.CAMERA_TYPES.AERIAL or f11_local8 == CODCASTER.CAMERA_TYPES.FREE then
					f11_local12 = false
				else
					f11_local12 = true
				end
				if f11_local5 and f11_local6 and not (f11_local0.objectiveState == CODCASTER.OBJECTIVE_STATES.LOCKED) and f11_local10 then
					f11_local7 = "ShowTimer"
				elseif (not f11_local5 or f11_local6) and f11_local12 then
					f11_local7 = "ShowDistance"
				else
					f11_local7 = "HideInfo"
				end
				ACTIONS.AnimateSequence( f11_arg0, f11_local7 )
				if f11_local11 then
					ACTIONS.AnimateSequence( f11_arg0, "TimerColor" )
					f11_arg0._isTimerLowAnimationStarted = true
				end
			end
		},
		{
			handle = true,
			name = "Hidden",
			visibilityEnum = LUI.Visibility.Hidden,
			condition = function ( f10_arg0, f10_arg1, f10_arg2 )
				return true
			end
		}
	}, {
		dataSources = {
			spectatedClientNum = DataSources.inGame.MP.codcaster.spectatedPlayer.clientNum,
			cameraType = DataSources.inGame.MP.codcaster.cameras.currentType,
			isObjectiveTimerLow = DataSources.inGame.MP.codcaster.isObjectiveTimerLow,
			isObjectiveTimerVisible = DataSources.inGame.MP.codcaster.isWaypointTimerVisible
		},
		events = {
			nil,
			"codcaster_waypoint_update",
			"codcaster_waypoint_timer_timeout",
			"anchor_on_screen",
			"anchor_off_screen"
		}
	}, {
		preState = f0_local0,
		onState = f0_local0
	} )
	CODCASTER.SetCustomFormatForCountdownObject( f7_arg0.Timer )
	f7_arg0.Timer:SubscribeToModel( DataSources.inGame.MP.codcaster.objectiveTimer:GetModel( f7_arg1 ), function ( f9_arg0 )
		local f9_local0 = DataModel[0x614D394F6F9A18D]( f9_arg0 )
		if f9_local0 then
			f7_arg0._canShowTimer = true
			f7_arg0.Timer:setEndTime( f9_local0 )
		end
	end )
	f7_arg0.Timer:addEventHandler( "timeout", PackedFunctionWrapper( {
		parent = f7_arg0
	}, function ( f8_arg0, f8_arg1, f8_arg2 )
		local f8_local0 = f8_arg0.parent
		if f8_local0 then
			f8_local0._canShowTimer = false
			f8_local0:processEventNoDispatch( {
				name = "codcaster_waypoint_timer_timeout"
			} )
		end
	end ) )
end

function CodcasterWaypoint( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 150 * _1080p, 0, 150 * _1080p )
	self.id = "CodcasterWaypoint"
	self._animationSets = self._animationSets or {}
	self._sequences = self._sequences or {}
	self._sequenceLengths = self._sequenceLengths or {}
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local Timer = nil
	
	Timer = MenuBuilder.BuildRegisteredType( "UICountdown", {
		controllerIndex = f1_local1
	} )
	Timer.id = "Timer"
	Timer:SetFont( FONTS.GetFont( FONTS.EsportsRoboto.File ) )
	Timer:SetFontSize( 18 * _PT )
	Timer:SetMinFontSize( 18 * _PT )
	Timer:SetWordWrap( true )
	Timer:SetAlignment( LUI.Alignment.Center )
	Timer:SetVerticalAlignment( LUI.Alignment.Bottom )
	Timer:SetShadowMinDistance( -0.4, 0 )
	Timer:SetShadowMaxDistance( 0.4, 0 )
	Timer:setEndTime( 0 )
	Timer:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -75, _1080p * 75, _1080p * -26, 0 )
	self:addElement( Timer )
	self.Timer = Timer
	
	local Distance = nil
	
	Distance = LUI.UIStyledText.new()
	Distance.id = "Distance"
	Distance:SetVisibility( LUI.Visibility.Hidden )
	Distance:setText( "", 0 )
	Distance:SetFont( FONTS.GetFont( FONTS.EsportsRoboto.File ) )
	Distance:SetFontSize( 18 * _PT )
	Distance:SetMinFontSize( 18 * _PT )
	Distance:SetWordWrap( true )
	Distance:SetAlignment( LUI.Alignment.Center )
	Distance:SetVerticalAlignment( LUI.Alignment.Bottom )
	Distance:SetShadowMinDistance( -0.4, 0 )
	Distance:SetShadowMaxDistance( 0.4, 0 )
	Distance:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -75, _1080p * 75, _1080p * -26, 0 )
	self:addElement( Distance )
	self.Distance = Distance
	
	local ObjectiveContainer = nil
	
	ObjectiveContainer = MenuBuilder.BuildRegisteredType( "CodcasterObjectiveContainer", {
		controllerIndex = f1_local1
	} )
	ObjectiveContainer.id = "ObjectiveContainer"
	ObjectiveContainer:SetScale( -0.2, 0 )
	ObjectiveContainer:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, _1080p * -32, _1080p * 32, _1080p * -32, _1080p * 32 )
	self:addElement( ObjectiveContainer )
	self.ObjectiveContainer = ObjectiveContainer
	
	local Title = nil
	
	Title = LUI.UIStyledText.new()
	Title.id = "Title"
	Title:setText( "", 0 )
	Title:SetFont( FONTS.GetFont( FONTS.EsportsRobotoBold.File ) )
	Title:SetFontSize( 22 * _PT )
	Title:SetMinFontSize( 22 * _PT )
	Title:SetWordWrap( false )
	Title:SetTracking( 1 * _1080p, 0 )
	Title:SetAlignment( LUI.Alignment.Center )
	Title:SetShadowMinDistance( -0.4, 0 )
	Title:SetShadowMaxDistance( 0.4, 0 )
	Title:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -180, _1080p * 180, 0, _1080p * 26 )
	self:addElement( Title )
	self.Title = Title
	
	local Arrow = nil
	
	Arrow = MenuBuilder.BuildRegisteredType( "CodcasterObjectiveArrow", {
		controllerIndex = f1_local1
	} )
	Arrow.id = "Arrow"
	Arrow:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, _1080p * -38, _1080p * 38, _1080p * -38, _1080p * 38 )
	self:addElement( Arrow )
	self.Arrow = Arrow
	
	self._sequences.DefaultSequence = function ()
		
	end
	
	self._sequenceLengths.DefaultSequence = 0
	local f1_local8 = nil
	Timer:RegisterAnimationSequence( "ShowDistance", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		}
	} )
	Distance:RegisterAnimationSequence( "ShowDistance", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		}
	} )
	self._sequences.ShowDistance = function ()
		menu:AnimateSequence( "ShowDistance" )
		menu:AnimateSequence( "ShowDistance" )
	end
	
	self._sequenceLengths.ShowDistance = 0
	local f1_local9 = nil
	Timer:RegisterAnimationSequence( "ShowTimer", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Visible
		}
	} )
	Distance:RegisterAnimationSequence( "ShowTimer", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		}
	} )
	self._sequences.ShowTimer = function ()
		menu:AnimateSequence( "ShowTimer" )
		menu:AnimateSequence( "ShowTimer" )
	end
	
	self._sequenceLengths.ShowTimer = 0
	local f1_local10 = nil
	Timer:RegisterAnimationSequence( "HideInfo", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		}
	} )
	Distance:RegisterAnimationSequence( "HideInfo", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.Visibility,
			value = LUI.Visibility.Hidden
		}
	} )
	self._sequences.HideInfo = function ()
		menu:AnimateSequence( "HideInfo" )
		menu:AnimateSequence( "HideInfo" )
	end
	
	self._sequenceLengths.HideInfo = 0
	local f1_local11 = nil
	Timer:RegisterAnimationSequence( "TimerColor", {
		{
			duration = 0,
			property = TWEEN_PROPERTY.RGB,
			value = SWATCHES.HUDWarnings.danger
		},
		{
			duration = 500,
			property = TWEEN_PROPERTY.RGB,
			value = SWATCHES.HUD.normal
		},
		{
			duration = 500,
			property = TWEEN_PROPERTY.RGB,
			value = SWATCHES.HUDWarnings.danger
		}
	} )
	self._sequences.TimerColor = function ()
		menu:AnimateLoop( "TimerColor" )
	end
	
	self._sequenceLengths.TimerColor = 1000
	if not CODCASTER_CONDITIONS.IsCDLClient() then
		ACTIONS.SetFont( self.Timer, FONTS.MainRegular )
		ACTIONS.SetFontSize( self.Timer, 22 )
		ACTIONS.SetFontMinSize( self.Timer, 22 )
	end
	if not CODCASTER_CONDITIONS.IsCDLClient() then
		ACTIONS.SetFont( self.Distance, FONTS.MainRegular )
		ACTIONS.SetFontSize( self.Distance, 22 )
		ACTIONS.SetFontMinSize( self.Distance, 22 )
	end
	if not CODCASTER_CONDITIONS.IsCDLClient() then
		ACTIONS.SetFont( self.Title, FONTS.MainBold )
		ACTIONS.SetFontSize( self.Title, 24 )
		ACTIONS.SetFontMinSize( self.Title, 24 )
	end
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "CodcasterWaypoint", CodcasterWaypoint )
LockTable( _M )
