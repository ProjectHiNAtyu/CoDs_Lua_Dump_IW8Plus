-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
QUARTERMASTER = QUARTERMASTER or {}
QUARTERMASTER.storeSession = {}
QUARTERMASTER.itemData = {}
QUARTERMASTER.dlogEnabled = Dvar[0x9E5BE3B4BBA4E0E]( 0x83CB8EEA5E59813 )
QUARTERMASTER._logForDirectPurchase = false
QUARTERMASTER.GetMenuSource = function ( f18_arg0 )
	if f18_arg0 == "BladeMenu" then
		return f18_arg0
	elseif LUI.FlowManager.IsMenuOnTop( "BRMainMenu" ) then
		return "BRStore"
	else
		local f18_local0
		if Engine[0xCA085C21FCBD7CA]() then
			f18_local0 = "CPStore"
		else
			f18_local0 = "MPStore"
		end
	end
	return f18_local0
end

QUARTERMASTER.RefreshStoreSession = function ( f17_arg0, f17_arg1 )
	if Engine[0x8B495DC361731F7]( f17_arg0 ) then
		QUARTERMASTER.storeSession.storeName = Dvar[0x54084D7CA2317BB]( 0x64110B2B092E8FA )
	else
		QUARTERMASTER.storeSession.storeName = Dvar[0x54084D7CA2317BB]( 0x5015D57F0DB76C1 )
	end
	QUARTERMASTER.storeSession.storeRegion = Engine[0x2553ADACEC3D1C]()
	QUARTERMASTER.storeSession.storeLayout = f17_arg1.storeLayout or 0
	local f17_local0 = QUARTERMASTER.storeSession
	local f17_local1 = f17_arg1.recommendationData
	if f17_local1 then
		f17_local1 = f17_arg1.recommendationData.isEnabled
	end
	f17_local0.recommendationsEnabled = f17_local1
	QUARTERMASTER.storeSession.recommendedItems = f17_arg1.recommendationData and f17_arg1.recommendationData.items or "none"
end

QUARTERMASTER.RecordStoreEnterEvent = function ( f16_arg0, f16_arg1, f16_arg2, f16_arg3, f16_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.storeSession = {}
		QUARTERMASTER.storeSession.id = Engine[0x863AA6457598928]()
		local f16_local0 = QUARTERMASTER.GetMenuSource( f16_arg3 )
		QUARTERMASTER.RefreshStoreSession( f16_arg0, {
			storeLayout = f16_arg1
		} )
		local f16_local1 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f16_arg0, "dlog_event_item_shop_entry", {
			recommended_items = nil,
			recommendations_enabled = false,
			store_name = f16_local1.storeName,
			store_session_id = f16_local1.id,
			source = f16_local0,
			region = f16_local1.storeRegion,
			store_layout = f16_local1.storeLayout,
			is_premium = Engine[0x8B495DC361731F7]( f16_arg0 ) or false,
			categories = QUARTERMASTER.categories or "",
			is_entered = f16_arg4
		} )
		QUARTERMASTER.storeSession = f16_local1
		SOCIAL.GeneratePlayerSocialContextInstrumentation( f16_arg0, "dlog_event_player_social_context_store" )
	end
end

QUARTERMASTER.RecordFocusPurchaseCPItemEvent = function ( f15_arg0, f15_arg1 )
	if not f15_arg1 then
		return 
	elseif QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f15_arg0, {
			storeLayout = 0
		} )
		local f15_local0 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f15_arg0, "dlog_event_store_item_browse", {
			store_name = f15_local0.storeName,
			store_session_id = f15_local0.id,
			source = QUARTERMASTER.GetMenuSource(),
			region = f15_local0.storeRegion,
			store_layout = f15_local0.storeLayout,
			item_id = f15_arg1.productId,
			item_name = f15_arg1.title,
			bundle_id = f15_arg1.productId,
			item_slot_in_category = f15_arg1.itemIndex
		} )
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.RecordRowChanged = function ( f14_arg0, f14_arg1, f14_arg2, f14_arg3, f14_arg4, f14_arg5, f14_arg6, f14_arg7 )
	if not f14_arg1 then
		return 
	end
	local f14_local0, f14_local1, f14_local2, f14_local3 = STORE.Bundles.Price( f14_arg0, f14_arg1 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f14_arg0, {
			storeLayout = 0
		} )
		local f14_local4 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f14_arg0, "dlog_event_store_qm_row_revealed", {
			store_name = f14_local4.storeName,
			store_session_id = f14_local4.id,
			source = QUARTERMASTER.GetMenuSource(),
			region = f14_local4.storeRegion,
			store_layout = f14_local4.storeLayout,
			category_index = f14_arg2,
			category_name = f14_arg3,
			item_id = STORE.Bundles.GetProductID( f14_arg1 ),
			item_name = STORE.Bundles.GetName( f14_arg1 ),
			bundle_id = f14_local2,
			item_slot_in_category = f14_arg4,
			tile_size = f14_arg5,
			num_items_shown = f14_arg6,
			sku_list = f14_arg7
		} )
		QUARTERMASTER.itemData = nil
	end
end

local f0_local0 = nil
QUARTERMASTER.RecordFocusStoreBundleEventStart = function ( f13_arg0, f13_arg1 )
	f0_local0 = {
		start_time = CoD.GetUTC(),
		bundle = f13_arg1
	}
end

QUARTERMASTER.RecordFocusStoreBundleEventEnd = function ( f12_arg0 )
	if not f0_local0 then
		return 
	end
	local f12_local0 = f0_local0.bundle
	local f12_local1, f12_local2 = STORE.UI.GetCategoryNameAndIndexForBundle( f12_arg0, f12_local0 )
	local f12_local3, f12_local4, f12_local5, f12_local6 = STORE.Bundles.Price( f12_arg0, f12_local0 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f12_arg0, {
			storeLayout = 0
		} )
		local f12_local7 = QUARTERMASTER.storeSession
		Engine[0x15D98DF5F61904B]( f12_arg0, "dlog_event_store_item_shop_item_browse", {
			store_name = f12_local7.storeName,
			store_session_id = f12_local7.id,
			source = QUARTERMASTER.GetMenuSource(),
			category_index = STORE.Category.GetOrderNumber( f12_arg0, f12_local1 ),
			category_name = f12_local1,
			region = f12_local7.storeRegion,
			store_layout = f12_local7.storeLayout,
			item_id = STORE.Bundles.GetProductID( f12_local0 ),
			item_name = STORE.Bundles.GetName( f12_local0 ),
			bundle_id = f12_local5,
			item_slot_in_category = f12_local2,
			start_time = f0_local0.start_time,
			end_time = CoD.GetUTC()
		} )
		QUARTERMASTER.itemData = nil
	end
	f0_local0 = nil
end

QUARTERMASTER.BeginMenuBrowseEvent = function ( f11_arg0, f11_arg1, f11_arg2, f11_arg3, f11_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f11_arg0, {
			storeLayout = f11_arg3,
			recommendationData = f11_arg4
		} )
		local f11_local0 = QUARTERMASTER.storeSession
		QUARTERMASTER.itemData = {}
		QUARTERMASTER.itemData.sessionId = f11_local0.id
		QUARTERMASTER.itemData.start_time = os.time()
		QUARTERMASTER.itemData.category_index = f11_arg1.categoryIndex
		QUARTERMASTER.itemData.category_name = f11_arg1.name
		QUARTERMASTER.itemData.item_id = f11_arg2.id or 0
		QUARTERMASTER.itemData.item_name = f11_arg2.name
		QUARTERMASTER.itemData.position_in_grid = f11_arg2.positionInGrid or 0
	end
end

QUARTERMASTER.RecordMenuBrowseEvent = function ( f10_arg0, f10_arg1, f10_arg2 )
	if QUARTERMASTER.dlogEnabled then
		local f10_local0 = QUARTERMASTER.storeSession
		if QUARTERMASTER.itemData and f10_local0.id == QUARTERMASTER.itemData.sessionId then
			local f10_local1 = QUARTERMASTER.GetMenuSource( f10_arg2 )
			local f10_local2 = QUARTERMASTER.itemData
			Engine[0x15D98DF5F61904B]( f10_arg0, "dlog_event_store_qm_menu_browse", {
				store_name = f10_local0.storeName,
				store_session_id = f10_local0.id,
				source = f10_local1,
				region = f10_local0.storeRegion,
				store_layout = f10_local0.storeLayout,
				category_index = f10_local2.category_index,
				category_name = f10_local2.category_name,
				item_id = f10_local2.item_id,
				item_name = f10_local2.item_name,
				start_time = f10_local2.start_time,
				end_time = os.time(),
				interacted = f10_arg1,
				item_slot_in_category = f10_local2.position_in_grid
			} )
		end
		QUARTERMASTER.itemData = nil
	end
end

QUARTERMASTER.SetDirectPurchaseLogging = function ( f9_arg0, f9_arg1 )
	QUARTERMASTER._logForDirectPurchase = f9_arg1
end

QUARTERMASTER.SetEventPurchaseLogging = function ( f8_arg0, f8_arg1 )
	QUARTERMASTER._logForEventPurchase = f8_arg1
end

QUARTERMASTER.RecordEnterDirectPurchase = function ( f7_arg0 )
	if not QUARTERMASTER.dlogEnabled then
		return 
	else
		Engine[0x15D98DF5F61904B]( f7_arg0, "dlog_event_store_direct_purchase_entry", {
			ts = os.time(),
			previous_menu = LUI.FlowManager.GetMenuNameAtIndex( -1 ),
			try_a_gun_enabled = CONDITIONS.IsTryAGunEnabled(),
			is_try_a_gun_region = CONDITIONS.IsTryAGunRegion()
		} )
	end
end

QUARTERMASTER.InteractionType = {
	ATTEMPT_TO_PURCHASE = 2,
	OPEN_PREVIEW = 1
}
QUARTERMASTER.RecordInteraction = function ( f6_arg0, f6_arg1, f6_arg2 )
	if not QUARTERMASTER.dlogEnabled then
		return 
	else
		local f6_local0, f6_local1, f6_local2 = STORE.Bundles.Price( f6_arg0, f6_arg1 )
		Engine[0x15D98DF5F61904B]( f6_arg0, "dlog_event_store_item_interact", {
			sku_id = f6_local2,
			item_id = STORE.Bundles.GetProductID( f6_arg1 ),
			item_name = STORE.Bundles.GetName( f6_arg1 ),
			interaction_type = f6_arg2
		} )
	end
end

QUARTERMASTER.RecordPurchaseConfirmEvent = function ( f5_arg0, f5_arg1, f5_arg2, f5_arg3, f5_arg4 )
	if QUARTERMASTER.dlogEnabled then
		QUARTERMASTER.RefreshStoreSession( f5_arg0, f5_arg4 )
		local f5_local0 = QUARTERMASTER.storeSession
		local f5_local1 = false
		local f5_local2 = {
			store_name = f5_local0.storeName,
			store_session_id = f5_local0.id or 0,
			source = QUARTERMASTER.GetMenuSource( f5_arg4.source ),
			region = f5_local0.storeRegion,
			store_layout = f5_local0.storeLayout,
			category_index = f5_arg4.categoryIndex,
			category_name = f5_arg4.categoryName,
			item_id = f5_arg4.itemID,
			item_name = f5_arg4.itemName,
			current_menu = LUI.FlowManager.GetMenuNameAtIndex( -1 )
		}
		local f5_local3
		if not f5_arg1 then
			f5_local3 = f5_arg1
		else
			f5_local3 = ""
		end
		f5_local2.previous_menu = f5_local3
		f5_local2.purchased = f5_arg2
		if not f5_local1 then
			f5_local3 = f5_local1
		else
			f5_local3 = f5_arg3
		end
		f5_local2.err = f5_local3
		f5_local2.item_slot_in_category = f5_arg4.positionInGrid or 0
		f5_local2.try_a_gun_enabled = CONDITIONS.IsTryAGunEnabled()
		f5_local2.is_try_a_gun_region = CONDITIONS.IsTryAGunRegion()
		if QUARTERMASTER._logForDirectPurchase then
			Engine[0x15D98DF5F61904B]( f5_arg0, "dlog_event_item_shop_direct_purchase_upsell", f5_local2 )
		elseif QUARTERMASTER._logForEventPurchase then
			f5_local2.purchased_from_events = true
			Engine[0x15D98DF5F61904B]( f5_arg0, "dlog_event_ui_event_page_delta_purchase_bundles", f5_local2 )
		else
			Engine[0x15D98DF5F61904B]( f5_arg0, "dlog_event_store_qm_item_purchase", f5_local2 )
		end
	end
end

QUARTERMASTER.FlushData = function ( f4_arg0 )
	QUARTERMASTER.RecordMenuBrowseEvent( f4_arg0, false )
end

QUARTERMASTER.RecordCategories = function ( f3_arg0, f3_arg1 )
	QUARTERMASTER.categories = f3_arg1
end

QUARTERMASTER.RecordStorefrontEvent = function ( f2_arg0, f2_arg1 )
	if QUARTERMASTER.dlogEnabled then
		Engine[0x15D98DF5F61904B]( f2_arg0, "dlog_event_storefront_loaded", {
			category_name = f2_arg1.name,
			num_items_shown = f2_arg1.numItemsShown,
			sku_list = f2_arg1.skuList,
			tile_size = f2_arg1.tileSize,
			response_time_ms = f2_arg1.responseTime,
			task_time_ms = f2_arg1.taskTime
		} )
	end
end

QUARTERMASTER.RecordStorefrontErrorEvent = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3, f1_arg4, f1_arg5 )
	if QUARTERMASTER.dlogEnabled then
		Engine[0x15D98DF5F61904B]( f1_arg0, "dlog_event_storefront_error", {
			err_code = f1_arg1,
			type = f1_arg2,
			response_code = f1_arg3,
			response_time_ms = f1_arg4,
			error = f1_arg5
		} )
	end
end

