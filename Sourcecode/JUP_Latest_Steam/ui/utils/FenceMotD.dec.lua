-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
module( ..., package.seeall )
CoD.PrintModuleLoad( _NAME )
FenceMotD = LUI.Class( LUI.Fence )
FenceMotD.init = function ( f10_arg0 )
	LUI.Fence.init( f10_arg0 )
end

FenceMotD.HasFencedForConsoleOrPC = function ( f9_arg0 )
	return DataSources.alwaysLoaded.motdFenceResult:GetValue( Engine[0x45B054C920178E9]() ) ~= nil
end

FenceMotD.StartForConsoleOrPC = function ( f8_arg0 )
	if LUI.WebViewManager.MotdEnabled() then
		if not Dvar[0x9E5BE3B4BBA4E0E]( 0xEF7A1FAC7B6759F ) then
			return 
		elseif FenceMotD.HasFencedForConsoleOrPC( f8_arg0 ) then
			return 
		end
		local f8_local0 = LUI.WebViewManager.Instance()
		f8_local0:PreloadMotd()
		if f8_arg0._motdWaitTimeoutSecond == nil then
			f8_arg0._motdWaitTimeoutSecond = tonumber( Engine[0x3B8CFB6758EF57C]() ) + (Dvar[0x22EAAB59AA27E9B]( 0xA85E490ABBAAF7A ) or 10) + 1
		end
	end
end

FenceMotD.Start = function ( f7_arg0 )
	if not CONDITIONS.IsMobileOrMobileSim() then
		FenceMotD.StartForConsoleOrPC( f7_arg0 )
	end
end

FenceMotD.Stop = function ( f6_arg0 )
	
end

FenceMotD.UpdateStateForMobileOrMobileSim = function ( f5_arg0 )
	f5_arg0._state = LUI.Fence.STATE.block
	local f5_local0
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x987DB379A93FA5C ) ~= nil then
		f5_local0 = LUI.WebViewManager.MotdEnabled()
	else
		f5_local0 = true
	end
	if not Web[0xE050A07236E162A]() and not DataSources.frontEnd.mobile.ftue.gradualUnlock.motdDisabled:GetValue( FTUE.GetControllerIndex() ) and f5_local0 then
		Web[0xE73BCEAFFB49F6C]()
		return 
	else
		f5_arg0._state = LUI.Fence.STATE.pass
	end
end

FenceMotD.UpdateStateForConsoleOrPC = function ( f3_arg0 )
	f3_arg0._state = LUI.Fence.STATE.pass
	local f3_local0 = function ( f4_arg0, f4_arg1 )
		if f4_arg1 and not LUI.FlowManager.IsInStack( "PreloadMotdFencePopup" ) then
			LUI.FlowManager.RequestPopupMenu( nil, "PreloadMotdFencePopup", false, f4_arg0, false, {}, nil, true, true )
		end
		if not f4_arg1 and LUI.FlowManager.IsInStack( "PreloadMotdFencePopup" ) then
			LUI.FlowManager.RequestLeaveMenuByName( "PreloadMotdFencePopup", true, true )
		end
	end
	
	if LUI.WebViewManager.MotdEnabled() and Dvar[0x9E5BE3B4BBA4E0E]( 0xEF7A1FAC7B6759F ) then
		local f3_local1 = Engine[0x45B054C920178E9]()
		local f3_local2 = DataSources.alwaysLoaded.motdFenceResult
		if FenceMotD.HasFencedForConsoleOrPC( f3_arg0 ) then
			f3_local0( f3_local1, false )
			return 
		end
		local f3_local3 = LUI.WebViewManager.Instance()
		f3_local3 = f3_local3:GetPreloadMotdResult()
		if f3_local3 == LUI.WebViewManager.PreloadMotdResult.Complete_Present or f3_local3 == LUI.WebViewManager.PreloadMotdResult.Complete_Not_Present then
			f3_local2:SetValue( f3_local1, f3_local3 )
			f3_local0( f3_local1, false )
			return 
		elseif f3_arg0._motdWaitTimeoutSecond <= tonumber( Engine[0x3B8CFB6758EF57C]() ) then
			f3_local2:SetValue( f3_local1, LUI.WebViewManager.PreloadMotdResult.Complete_Not_Present )
			f3_local0( f3_local1, false )
			return 
		end
		f3_local0( f3_local1, true )
		f3_arg0._state = LUI.Fence.STATE.block
	end
end

FenceMotD.UpdateState = function ( f2_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		FenceMotD.UpdateStateForMobileOrMobileSim( f2_arg0 )
	else
		FenceMotD.UpdateStateForConsoleOrPC( f2_arg0 )
	end
end

LUI.Fence.Register( "motd", FenceMotD )
MenuBuilder.registerType( "PreloadMotdFencePopup", function ( f1_arg0, f1_arg1 )
	local f1_local0 = MenuBuilder.BuildRegisteredType( "FenceDialogPopup", {
		disableIntro = true,
		message = Engine[0xED84C33EC5F01EA]( 0x31AFF59C3AD465C ),
		controllerIndex = f1_arg1.controllerIndex
	} )
	f1_local0.id = "PreloadMotdFencePopup"
	return f1_local0
end )
LockTable( _M )
