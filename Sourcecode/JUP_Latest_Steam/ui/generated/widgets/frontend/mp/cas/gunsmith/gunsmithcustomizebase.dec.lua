-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:04
module( ..., package.seeall )
local f0_local0 = 2
local f0_local1 = 3
local f0_local2 = "wait_weapon_loaded_timer"
local f0_local3 = 1000
local f0_local4 = function ( f12_arg0, f12_arg1, f12_arg2, f12_arg3 )
	local f12_local0 = function ()
		if ClientWeapon[0x984089312AA4BB3]( f12_arg0, f12_arg0, ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview ) ) then
			f12_arg0( f12_arg0 )
			f12_arg0:RemoveEventTimer( f12_arg0 )
		end
	end
	
	f12_arg0:RemoveEventTimer( f0_local0 )
	f12_arg0:CreateEventTimer( f0_local0, f0_local0, {
		callbackFunc = f12_local0
	} )
	f12_arg0:addEventHandler( "menu_close", function ( f13_arg0, f13_arg1 )
		f13_arg0:RemoveEventTimer( f12_arg0 )
	end )
end

local f0_local5 = function ( f10_arg0, f10_arg1, f10_arg2 )
	local f10_local0 = f10_arg0._weaponPlayerData.weapon:get()
	f10_arg0.weaponModel = WEAPON.GetWeaponModel( f10_arg1, FrontEndScene.ClientWeapons.Preview )
	f10_arg0:addElement( f10_arg0.weaponModel )
	local f10_local1 = WEAPON.GenerateWeaponTable( f10_arg0._weaponPlayerData )
	local f10_local2 = WEAPON.GetMaxStickerSlotsForWeapon( f10_local0, f10_local1.lootID )
	f10_local1.stickers = {
		nil,
		"iw9_placement_sticker_1",
		"iw9_placement_sticker_2",
		"iw9_placement_sticker_3",
		"iw9_placement_sticker_4"
	}
	if WEAPON.GetWeaponClass( f10_local1.weapon ) ~= WEAPON.pistolClass then
		table.insert( f10_local1.stickers, "iw9_placement_sticker_5" )
	end
	f0_local0( f10_arg0, f10_arg1, WEAPON.GetWeaponModelName( f10_local0, f10_local1, {
		includeCamos = true,
		includeAttachments = true,
		includeStickers = 0 < f10_local2,
		controllerIndex = f10_arg1
	} ), function ()
		local f11_local0 = true
		if CONDITIONS[0x2F9F94DF6F92292]() then
			f11_local0 = ClientWeapon[0xAADDC5F39D2F2D3]( f10_arg0, f10_arg0, ClientWeapon[0x5DD69014A9C290]( FrontEndScene.ClientWeapons.Preview ) )
			if not f11_local0 then
				LUI.FlowManager.RequestDevErrorPopup( "ERROR", "Sticker Validation failed for weapon " .. f10_arg0 )
			end
		end
		if f11_local0 and CONDITIONS.InFrontend() then
			local f11_local1 = WEAPON.GenerateWeaponTable( f10_arg0._weaponPlayerData )
			local f11_local2 = WEAPON.GetEquippedStickers( f10_arg0._weaponPlayerData )
			if f11_local2 ~= nil then
				for f11_local3 = LOADOUT.STICKER_1_SLOT, f10_arg0, 1 do
					local f11_local6 = f11_local2[f11_local3]
					if String.IsNilOrEmpty( f11_local6 ) or f11_local6 == WEAPON.StickerNoneValue then
						f11_local1.stickers[f11_local3] = GUNSMITH.STICKER_PLACEMENT_STICKER_REFS[f11_local3]
					else
						f11_local1.stickers[f11_local3] = f11_local6
					end
				end
			end
			local f11_local3 = WEAPON.GetWeaponModelName( f11_local1.weapon, f11_local1, {
				includeCamos = true,
				includeAttachments = true,
				includeStickers = true,
				controllerIndex = f10_arg0
			} )
			FrontEndScene.RequestWeaponViewModels( {
				f11_local3
			}, f10_arg0 )
			WEAPON.SetModelIfLoaded( f10_arg0, f10_arg0.weaponModel, f11_local3 )
		end
		f10_arg0.WeaponCustomizeButtons:SetStickerSlotState( f11_local0 )
	end )
end

local f0_local6 = function ( f9_arg0, f9_arg1 )
	local f9_local0 = WEAPON.GetGunscreenDataForRef( f9_arg1.cosmeticAttachment:get() )
	if f9_local0 ~= WEAPON.CharmNoneValue and not String.IsNilOrEmpty( f9_local0[0x287C1DA96264CE6] ) then
		local f9_local1 = f9_local0[0x287C1DA96264CE6]
		if f9_local0[0x1656AA6615672BF] then
			local f9_local2 = f9_local0[0x1656AA6615672BF]
			local f9_local3 = f9_local0[0x1656AA6615672BF]
		end
		local f9_local4 = f9_local2 and f9_local3 or 512
		if f9_local0[0x683F393A1693D22] then
			local f9_local5 = f9_local0[0x683F393A1693D22]
			local f9_local6 = f9_local0[0x683F393A1693D22]
		end
		local f9_local7 = f9_local5 and f9_local6 or 512
		if not String.IsNilOrEmpty( f9_local1 ) then
			f9_arg0.screenUI = MenuBuilder.BuildRegisteredType( f9_local1, {
				controllerIndex = f9_arg0._controllerIndex,
				gunscreenRef = f9_arg0._equippedCharm
			} )
			f9_arg0.screenUI.id = "screen"
			f9_arg0.screenUI:SetupRenderTarget( Enum[0xED23F1B1636DBC5][0x68C6C6BB1EEBFA0], f9_local4, f9_local7, 1, 0, 0, 0, 0, f9_arg0._controllerIndex )
			f9_arg0.screenUI:SetAnchorsAndPosition( 0, 1, 0, 1, 0, f9_local4, 0, f9_local7 )
			f9_arg0.screenUI:ActivateDirtyCheck( false )
			f9_arg0:addElement( f9_arg0.screenUI )
		end
	end
end

local f0_local7 = function ( f8_arg0, f8_arg1, f8_arg2 )
	if f8_arg2 == GUNSMITH.BlockedWarningType.Stickers then
		local f8_local0 = WEAPON.IsPistolWeapon( WEAPON.GetWeaponClass( f8_arg0.WeaponCustomizeButtons.weaponRef ) )
		local f8_local1 = f8_arg0.BlockedDetails
		local f8_local2 = f8_local1
		f8_local1 = f8_local1.setText
		local f8_local3 = Engine[0xED84C33EC5F01EA]
		local f8_local4 = 0x7BC4DD74FDB65ED
		local f8_local5
		if f8_local0 then
			f8_local5 = f0_local0
			if not f8_local5 then
			
			else
				f8_local1( f8_local2, f8_local3( f8_local4, f8_local5 ) )
				f8_local1 = ACTIONS.AnimateSequence
				f8_local2 = f8_arg0
				if f8_arg1 then
					f8_local3 = "ShowStickerWarning"
				else
					f8_local3 = "HideStickerWarning"
				end
				f8_local1( f8_local2, f8_local3 )
			end
		end
		f8_local5 = f0_local0
	elseif f8_arg2 == GUNSMITH.BlockedWarningType.Charm or f8_arg2 == GUNSMITH.BlockedWarningType.Gunscreen then
		local f8_local0 = ACTIONS.AnimateSequence
		local f8_local6 = f8_arg0
		local f8_local2
		if f8_arg1 then
			f8_local2 = "ShowCharmWarning"
		else
			f8_local2 = "HideCharmWarning"
		end
		f8_local0( f8_local6, f8_local2 )
	end
end

local f0_local8 = function ( f6_arg0, f6_arg1 )
	if not f6_arg0.waitForLoadedWeaponTimer then
		f6_arg0.waitForLoadedWeaponTimer = LUI.UITimer.new( {
			interval = 50,
			event = "waitForLoadedWeapon"
		} )
		f6_arg0:addElement( f6_arg0.waitForLoadedWeaponTimer )
	end
	f6_arg0:registerEventHandler( "waitForLoadedWeapon", function ( element, event )
		if Game[0x28624DEF6F708C8]( f6_arg0, "frontend_weapon_position_updated" ) then
			GUNSMITH.SetAreInGunsmithScene( false )
			if f6_arg0.waitForLoadedWeaponTimer then
				f6_arg0.waitForLoadedWeaponTimer:closeTree()
				f6_arg0.waitForLoadedWeaponTimer = nil
			end
		end
	end )
end

local f0_local9 = function ( f4_arg0, f4_arg1, f4_arg2 )
	if f4_arg2.addBackoutAction then
		f4_arg0:AddGamepadEventCallback( "button_secondary", function ( f5_arg0, f5_arg1 )
			local f5_local0 = f5_arg1.controller or f4_arg0
			ACTIONS.LeaveMenu( f5_arg0 )
		end )
	end
end

local f0_local10 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdateBlockedWarning = f0_local0
	if Engine[0x2DA54CF5D6B7F02]() then
		if not f3_arg2.loadoutIndex then
			f3_arg2.loadoutIndex = 0
		end
		if not f3_arg2.weaponSlot then
			f3_arg2.weaponSlot = 0
		end
	end
	Engine[0x805D0407BF691DA]()
	f3_arg0._loadoutIndex = f3_arg2.loadoutIndex
	f3_arg0._weaponSlot = f3_arg2.weaponSlot
	GUNSMITH.SetupWeaponData( f3_arg0, f3_arg1, f3_arg0._weaponSlot, f3_arg2.forShowcase )
	ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, 0, 0, 0 )
	f3_arg0._selectedWeapon = f3_arg0._weaponPlayerData.weapon:get()
	if f3_arg0._weaponTable and WEAPON.IsMeleeWeapon( WEAPON.GetWeaponClass( f3_arg0._selectedWeapon ) ) then
		local f3_local0 = WEAPON.GetFrontendSceneOffsets( f3_arg1, f3_arg0._weaponTable.lootID, WEAPON.PREVIEW_SCENE )
		ClientWeapon[0x8B8A4E0355DF0C0]( FrontEndScene.ClientWeapons.Preview, f3_local0.xOffset, f3_local0.yOffset, f3_local0.zOffset )
	end
	if GUNSMITH.WasInGunsmithScene() then
		f0_local0( f3_arg0, f3_arg1 )
	end
	f0_local0( f3_arg0, f3_arg1, f3_arg0._weaponPlayerData )
	GUNSMITH.SetAreInWeaponPreviewScene( true )
	WEAPON.SetCustomizeSceneForWeapon( f3_arg0._selectedWeapon )
	f0_local0( f3_arg0, f3_arg0._weaponPlayerData )
	f3_arg0.WeaponCustomizeButtons:SetupButtons( f3_arg1, f3_arg2.weaponSlot, f3_arg2.loadoutIndex, f3_arg2.forShowcase )
	GUNSMITH.SetupSaveWeaponPopup( f3_arg0, f3_arg1, f3_arg2 )
	GUNSMITH.AddHelperBarSaveWeaponButton( f3_arg0, f3_arg1, f3_arg2.forShowcase )
	if CONDITIONS.IsDMZMatch() then
		f3_arg0._equippedWeaponSlot = f3_arg2.equippedWeaponSlot
		f3_arg0:addEventHandler( "menu_close", GUNSMITH.OnGunsmithMenuCloseEventHandler )
	end
end

local f0_local11 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function GunsmithCustomizeBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIElement.new()
	f1_local1:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920, 0, 1080 )
	f1_local1.id = "GunsmithCustomizeBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f1_local2 = f1_local0.ValidateControllerIndex( f1_local1, f1_local2 )
	local f1_local3 = f1_local1
	GUNSMITH.SetupGunsmithMenu( f1_local1, f1_local2, f1_arg1 )
	f0_local0( f1_local1, f1_local2, f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0x825429A2C86AD8E, GunsmithCustomizeBase )
LockTable( _M )
