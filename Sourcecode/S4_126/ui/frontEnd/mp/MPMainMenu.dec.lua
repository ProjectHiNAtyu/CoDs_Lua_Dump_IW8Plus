-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
module( ..., package.seeall )
require( "ui.frontEnd.MPTabsMenu" )
require( "ui.frontEnd.IGRXPBonusTip" )
local f0_local0 = "swatch"
local f0_local1 = "value"
local f0_local2 = {
	{
		[f0_local0] = "highlight.vDefaultHighlight",
		[f0_local1] = function ()
			local f22_local0 = Dvar[0x1FAB6D9A30481F8]( "#x39a4291162c5f187e" )
			if f22_local0 then
				f22_local0 = Dvar[0x9E5BE3B4BBA4E0E]( "#x39a4291162c5f187e" )
			end
			if f22_local0 then
				return Dvar[0x54084D7CA2317BB]( "#x36aa7e53aa03eae39" )
			else
				return Dvar[0x54084D7CA2317BB]( "#x3d0bd85e2eb0b45b6" )
			end
		end
	},
	{
		[f0_local0] = "highlight.vDefaultDarken",
		[f0_local1] = function ()
			return Dvar[0x54084D7CA2317BB]( "#x38fb366f574a52585" )
		end
	},
	{
		[f0_local0] = "text.buttonTextDefault",
		[f0_local1] = function ()
			local f20_local0 = Dvar[0x1FAB6D9A30481F8]( "#x39a4291162c5f187e" )
			if f20_local0 then
				f20_local0 = Dvar[0x9E5BE3B4BBA4E0E]( "#x39a4291162c5f187e" )
			end
			if f20_local0 then
				return Dvar[0x54084D7CA2317BB]( "#x3606a29f564029d76" )
			else
				return Dvar[0x54084D7CA2317BB]( "#x32dcc04887a71b78d" )
			end
		end
	}
}
local f0_local3 = function ()
	local f19_local0 = Lobby[0xF1D2956B0C99DF6]()
	local f19_local1
	if f19_local0 and Lobby[0x867E2628CAA1981]() then
		f19_local1 = IsPrivateMatch()
		if not f19_local1 then
			if not f19_local0 then
				f19_local1 = Lobby[0x6957722EF74F5D2]()
			else
				f19_local1 = false
			end
		end
	elseif not f19_local0 then
		f19_local1 = Lobby[0x6957722EF74F5D2]()
	else
		f19_local1 = false
	end
	if f19_local1 then
		MLG.ResetMatchRulesData()
	end
end

local f0_local4 = function ()
	MP_COMMON.RefreshDataForFirstController()
	Dvar[0x8EA06EEDB58D872]( "#x310c28bb5d64c8c6d", false )
	Dvar[0x8EA06EEDB58D872]( "#x3d10b51f37916e157", false )
	WipeGlobalModelsAtPath( "menu.spltscreenDisplay.controllerIndex" )
end

if CONDITIONS.IsPublicAlphaEnabled() then
	LUI.FlowManager.RegisterFenceGroup( "MPMainMenu", {
		nil,
		"koreanRating",
		"bootCheck",
		"signIn",
		"gamerProfile",
		"shaderUpload",
		"multiLogin",
		"onlineServices",
		"patch",
		"onlineStatsReset",
		"mainOnlineData",
		"crossPlayEnable",
		"platformServices",
		"exchange",
		"dailyReward",
		"churnReward",
		"contracts",
		"premium",
		"onlineServiceSubscription",
		"mp",
		"mpInstall",
		"mpOnlineData",
		"shaderUpload",
		"fnf",
		"contracts",
		"fenceSpinner",
		"playlists",
		"newTU"
	} )
else
	LUI.FlowManager.RegisterFenceGroup( "MPMainMenu", {
		nil,
		"premiumOrTrialActive",
		"onlineServiceSubscription",
		"scenarioMissingMP",
		"scenarioInstallingMP",
		"mp",
		"mpOnlineData",
		"shaderUpload",
		"fnf",
		"contracts",
		"fenceSpinner",
		"playlists",
		"catalog",
		"newTU"
	} )
end
LUI.FlowManager.RequestSetStack( "MPMainMenu", {
	{
		name = "MainLockoutMenu"
	},
	{
		name = "MainMenu"
	}
} )
local f0_local5 = function ( f16_arg0, f16_arg1 )
	MP_COMMON.SetupParty()
	MissionUtils.SetFlowState( MissionUtils.FlowState.PRE_INIT )
	if Dvar[0x9E5BE3B4BBA4E0E]( "#x355590a653bbcb06b" ) then
		Dvar[0x8EA06EEDB58D872]( "#x355590a653bbcb06b", false )
		f16_arg0:processEvent( {
			eventID = "lobby_welcome",
			name = "show_commander_message"
		} )
	end
	if CONDITIONS.IsArenaEvoGameType() and Dvar[0x22EAAB59AA27E9B]( "#x31fe043ca748125eb" ) == AAR.MagmaSummaryState.ARENA_EVO_SUMMARY_READY and Dvar[0x9E5BE3B4BBA4E0E]( "#x32add9cc9e0c920a1" ) then
		DebugPrint( "$$$ A Desire to open the AAR once the data arrives has been made." )
		local f16_local0 = f16_arg0:Wait( Dvar[0x22EAAB59AA27E9B]( "#x37a461af773e4fc6f" ) )
		f16_local0.onComplete = function ( f17_arg0 )
			PostGameFanfare:start()
		end
		
	elseif Dvar[0x9E5BE3B4BBA4E0E]( "#x33c2e0c8902f051c0" ) and Dvar[0x9E5BE3B4BBA4E0E]( "#x32add9cc9e0c920a1" ) then
		PostGameFanfare:start()
	else
		DebugPrint( "$$$ DO NOT OPEN CH AAR Parade" )
	end
	Dvar[0x8EA06EEDB58D872]( "#x32add9cc9e0c920a1", false )
	if 2 < Dvar[0x22EAAB59AA27E9B]( "#x332cafec0768ee" ) then
		Dvar[0x2414681ECAB880F]( "#x332cafec0768ee", 0 )
		f16_arg0:processEvent( {
			eventID = "lobby_leave",
			name = "show_commander_message"
		} )
	end
	if Dvar[0x9E5BE3B4BBA4E0E]( "#x3ca979bdfc4610484" ) then
		f16_arg0:processEvent( {
			eventID = "mt_join_up",
			name = "show_commander_message"
		} )
		Dvar[0x8EA06EEDB58D872]( "#x3ca979bdfc4610484", false )
	elseif Dvar[0x9E5BE3B4BBA4E0E]( "#x355fd8013b855c9dc" ) then
		f16_arg0:processEvent( {
			eventID = "mt_welcome_back",
			name = "show_commander_message"
		} )
		Dvar[0x8EA06EEDB58D872]( "#x355fd8013b855c9dc", false )
	end
	if not Engine[0xCBCF315DE9B8AC6]() then
		Lobby[0x44F7F2F6C939138]( f16_arg1 )
	end
	Lobby[0x2043FF221ED6A77]( PartyUIRoot.MP_MAIN_MENU )
end

local f0_local6 = function ( f14_arg0, f14_arg1 )
	Dvar[0xE3CB005036E0C0F]( "#x31ae6dd9404f46ae3", "0" )
	Dvar[0x8EA06EEDB58D872]( "#x33aeecee18be07d15", false )
	local f14_local0 = f14_arg1.controller
	if not f14_local0 then
		f14_local0 = Engine[0x45B054C920178E9]()
	end
	Lobby.CheckTURequirement( f14_arg0, f14_local0 )
	Engine[0xB81A5136C5503E4]( MPConfig.default_online, f14_local0 )
	f14_arg0:registerEventHandler( "not_below_blocking_fence", function ( element, event )
		Dvar[0x8EA06EEDB58D872]( "#x377990b442f9f487e", false )
		if not MLG[0xD4C7EF52D11CB46]() then
			local f15_local0 = true
			if CONDITIONS.ArePartiesEnabledInMainMenu() and Engine[0xCBCF315DE9B8AC6]() then
				f15_local0 = false
			end
			if f15_local0 then
				DebugPrint( "MPMainMenu::OnMenuCreate" )
				Lobby[0x44F7F2F6C939138]( f14_arg0 )
			end
		end
	end )
	DYN_ATTACHMENT.SetupLoadoutWeaponAttachmentStreamer( f14_arg0, f14_local0 )
	local f14_local1 = Dvar[0x9E5BE3B4BBA4E0E]( "#x3816522b6b2012a71" )
	local f14_local2 = false
	local f14_local3 = PlayerData[0x8B73907B55C4D71]( f14_local0, CoD.StatsGroup.Ranked )
	if f14_local3 and f14_local3.mpInGameFtueComplete then
		f14_local2 = f14_local3.mpInGameFtueComplete:get() == 1
		if CONDITIONS.ForceFtuePopup() then
			f14_local2 = false
		end
	end
	if Engine[0x16276045DCB1E41] and Engine[0x16276045DCB1E41]( "mp_m_ftue" ) and CONDITIONS.FTUEPopupEnabled() and (f14_local1 or not f14_local2) then
		Dvar[0x8EA06EEDB58D872]( "#x3bdb40f8695cfc72a", false )
		Dvar[0x8EA06EEDB58D872]( "#x3816522b6b2012a71", false )
		local f14_local4 = {}
		if f14_local1 then
			f14_local4.completed = true
		end
		LUI.FlowManager.RequestPopupMenu( f14_arg0, "LobbyFtueTutorial", true, f14_local0, false, f14_local4 )
		return 
	elseif BATTLEPASS.ShouldShowFreeTierUpsell( f14_local0 ) then
		LUI.FlowManager.RequestPopupMenu( f14_arg0, "BattlePassFreeTierUpsell", true, f14_local0, false, {
			sourceMenu = f14_arg0
		} )
		return 
	else
		CRM.OpenCRMWindows( f14_arg0 )
	end
end

local f0_local7 = function ( f13_arg0, f13_arg1 )
	f13_arg0:dispatchEventToRoot( {
		enabled = false,
		name = "track_idle_enabled"
	} )
	OPERATOR.ClearOperatorCharacterCache()
end

local f0_local8 = function ()
	for f12_local5, f12_local6 in ipairs( f0_local0 ) do
		local f12_local3
		if type( f12_local6[f0_local0] ) == "function" then
			f12_local3 = f12_local6[f0_local0]()
		else
			f12_local3 = false
		end
		if f12_local3 and #f12_local3 == 7 then
			local f12_local4 = LUI.Split( f12_local6[f0_local0], "." )
			assert( #f12_local4 == 2 )
			SWATCHES[f12_local4[1]][f12_local4[2]] = COLORS_UTILS.HexToRGB( f12_local3 )
		end
	end
end

local f0_local9 = function ( f11_arg0, f11_arg1, f11_arg2 )
	if not LUI.FlowManager.IsInStack( "GameBattlesMatchLobby" ) and MLG[0x6F1CEE91DAA0B95]( f11_arg1 ) ~= GAMEBATTLES.INVALID_MATCH_ID then
		GAMEBATTLES.RemoveSubscriptions( f11_arg1 )
		MLG.ResetGameBattleMatchId( f11_arg1 )
		Dvar[0x8EA06EEDB58D872]( "#x377990b442f9f487e", false )
	end
	PROGRESSION.PrestreamGamemodeIcons( f11_arg0 )
	MLG.ArbitrarilySetCDLRuleset( f11_arg1 )
	local f11_local0 = LUI.PrivateMatchManagementLayer.GetInstance()
	if f11_local0 and f11_local0.activeAndInitialised then
		f11_local0:CloseLobby( f11_arg1 )
	end
	f0_local0()
end

local f0_local10 = function ( f3_arg0, f3_arg1, f3_arg2 )
	if Engine[0x575E9C5B9AAB6F4]() and OnlineABTesting[0xE4B4D10D03EE257]( f3_arg1 ) and Dvar[0x9E5BE3B4BBA4E0E]( "#x35d0cb82d20766408" ) and not Dvar[0x9E5BE3B4BBA4E0E]( "#x32408510baf970806" ) then
		Engine[0x367F2673E2FED1]( f3_arg1 )
		Dvar[0x8EA06EEDB58D872]( "#x32408510baf970806", true )
	end
	if OnlineABTesting[0xE4B4D10D03EE257]( f3_arg1 ) then
		if not Engine[0x7B17D94988FD5D0]( "hasPlayerChangedAimAssistSetting", f3_arg1 ) and not Engine[0x7B17D94988FD5D0]( "hasEnrolledInAimAssistExperiment", f3_arg1 ) then
			local f3_local0 = DataModel[0x40E824FE270E174]( DataModel[0x4DF5CFBC1771947]( f3_arg1 ), "abtesting.aimassist.value" )
			if f3_local0 then
				local f3_local1 = DataModel[0x614D394F6F9A18D]( f3_local0 )
				if f3_local1 then
					Engine[0x9694388D6DAC134]( "aimAssistType", f3_local1, f3_arg1 )
					Engine[0x9694388D6DAC134]( "hasEnrolledInAimAssistExperiment", 1, f3_arg1 )
				end
			end
		end
	end
	Engine[0x9694388D6DAC134]( "initialGameMode", MAIN_MENU.BladeKeys.MP, f3_arg1 )
	Engine[0x9694388D6DAC134]( "isMPNew", 0, f3_arg1 )
	Engine[0x7C75E608EA39B5C]( "updategamerprofile" )
	f3_arg0.isSignInMenu = true
	f3_arg0.signoutSplitscreen = true
	f3_arg0:SetAlpha( 0, 0 )
	f3_arg0:SetAlpha( 1, 400, LUI.EASING.outQuadratic )
	MP_COMMON.SetupStreaming( f3_arg0, f3_arg1 )
	Engine[0x8CEE785C0D63D7E]( "music_mainmenu_mp" )
	f3_arg0.MPTabsMenu:registerEventHandler( "focus_tab_changed", function ( element, event )
		local f10_local0 = event.tabName
		if CONDITIONS.IsInKoreanIGRPaidSession( f3_arg0 ) then
			local f10_local1 = false
			if f10_local0 == "MPPlayMenu" then
				f10_local1 = true
				ACTIONS.AnimateSequence( f3_arg0.IGRXPBonusTip, "RankXPBonus" )
			elseif f10_local0 == "MPWeaponMenu" then
				f10_local1 = true
				ACTIONS.AnimateSequence( f3_arg0.IGRXPBonusTip, "WeaponXPBonus" )
			elseif f10_local0 == "BattlePassMenu" then
				f10_local1 = true
				ACTIONS.AnimateSequence( f3_arg0.IGRXPBonusTip, "BattlePassXPBonus" )
			end
			local f10_local2 = f3_arg0.IGRXPBonusTip
			local f10_local3 = f10_local2
			f10_local2 = f10_local2.SetAlpha
			local f10_local4
			if f10_local1 then
				f10_local4 = 1
			else
				f10_local4 = 0
			end
			f10_local2( f10_local3, f10_local4, 0 )
		end
		f3_arg0:dispatchEventToRoot( {
			name = "track_idle_enabled",
			enabled = f10_local0 == "MPPlayMenu"
		} )
	end )
	MP_COMMON.SetupOnline()
	f0_local0( f3_arg0, f3_arg1 )
	f3_arg0:addEventHandler( "menu_create", f0_local0 )
	f3_arg0:addEventHandler( "menu_close", f0_local0 )
	f3_arg0:addEventHandler( "menu_close_all", f0_local0 )
	assert( f3_arg0.bindButton )
	if not CONDITIONS.IsInternalAlphaEnabled( f3_arg0 ) then
		f3_arg0.MPTabsMenu:SetupBackButtonHandler( function ( f8_arg0, f8_arg1 )
			if Lobby[0xF1D2956B0C99DF6]() then
				
			else
				
			end
			local f8_local0 = f3_arg0:Wait( 50 )
			f8_local0.onComplete = function ( f9_arg0 )
				if Lobby[0xF1D2956B0C99DF6]() then
					return 
				else
					MP_COMMON.TriggerLeaveMainGamemodeMenu( f9_arg0, f8_arg0 )
				end
			end
			
		end )
	end
	if f3_arg2 and f3_arg2.isBR then
		Dvar[0xE3CB005036E0C0F]( "#x3a30c33efc8281eb1", "br" )
	end
	local f3_local2 = nil
	if CONDITIONS.IsMagmaGameMode() then
		f3_local2 = TAB.Layouts.BRPlayMenu
	elseif CONDITIONS.IsCoreMultiplayer() then
		if not Dvar[0x9E5BE3B4BBA4E0E]( "#x33c2e0c8902f051c0" ) then
			f3_local2 = TAB.Layouts.MPPlayMenu
		else
			f3_local2 = TAB.Layouts.LPPlayMenu
		end
	elseif CONDITIONS.IsThirdGameMode() then
		f3_local2 = TAB.Layouts.CPPlayMenu
	end
	f3_arg0.MPTabsMenu:SetupTabs( f3_arg1, {
		tabLayout = f3_local2
	} )
	local f3_local3 = LUI.FlowManager.GetScopedData( f3_arg0 )
	if CONDITIONS.IsTrialLicense() and not f3_local3.trialPopupShown then
		f3_local3.trialPopupShown = true
		LUI.FlowManager.RequestPopupMenu( f3_arg0, "TrialFullWindow", true, f3_arg1, false )
	end
	f3_arg0:addEventHandler( "update_new_items_toggle", function ( f6_arg0, f6_arg1 )
		f3_arg0._hasNewItems = f3_arg0.MPTabsMenu:CurrentTabHasNewItems( f3_arg0 )
		if f3_arg0._hasNewItems and not f3_arg0.newItemsVisible then
			NewUnlockIndicatorUtils.PushButtonPrompt( f3_arg0.HelperBar )
			if not f3_arg0._handlerSet then
				NewUnlockIndicatorUtils.SetupButtonHandler( f3_arg0, f3_arg0.bindButton, f3_arg0, function ( f7_arg0, f7_arg1 )
					if f6_arg0._hasNewItems then
						ACTIONS.ToggleNewItemsMode( f7_arg0, f7_arg1 )
					end
				end )
				f3_arg0._handlerSet = true
			end
			f3_arg0.newItemsVisible = true
		elseif not f3_arg0._hasNewItems and f3_arg0.newItemsVisible then
			NewUnlockIndicatorUtils.PopButtonPrompt( f3_arg0.HelperBar )
			f3_arg0.newItemsVisible = false
		end
	end )
	SURVEY.OpenPostGameSurveyIfRequired( f3_arg1, true )
	if CONDITIONS.IsLeaguePlay() then
		f3_arg0:addEventHandler( "leagueplay_league_processed", LEAGUE_PLAY.HandleLeagueEvent )
		f3_arg0:addEventHandler( "leagueplay_season_processed", LEAGUE_PLAY.HandleSeasonEndEvent )
		LEAGUE_PLAY.SetupTop250Events( f3_arg1 )
		f3_arg0:addEventHandler( "top250_validated", LEAGUE_PLAY.InitLPDatasources )
		f3_arg0:addEventHandler( "leagueplay_ae_update_sr", LEAGUE_PLAY.HandleSRUpdateEvent )
	end
	if CONDITIONS.IsInternalAlphaEnabled( f3_arg0 ) and Engine[0x575E9C5B9AAB6F4]() and f3_arg0.HelperBar and f3_arg0.HelperBar.ButtonHelperText then
		f3_arg0.bindButton:addEventHandler( "button_secondary", function ( f5_arg0, f5_arg1 )
			LUI.FlowManager.RequestPopupMenu( f3_arg0, "QuitPopup", false, f5_arg1.controller )
			return true
		end )
		f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			clickable = true,
			priority = 0,
			side = "left",
			button_ref = "button_secondary",
			helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/QUIT_DESKTOP" )
		} )
	end
	if CONDITIONS.IsUserSignedInDemonware( f3_arg1 ) then
		LOOT.CheckCustomizationsShouldBeEquipped( f3_arg1 )
		WEAPON.CheckWeaponsShouldBeEquipped( f3_arg1 )
		OPERATOR.CheckCustomizationsShouldBeEquipped( f3_arg1 )
	end
	f3_arg0:addEventHandler( "update_publisher_variables", function ( f4_arg0, f4_arg1 )
		EMERGENCY_MESSAGING.HandleEmergencyMessaging( f3_arg0 )
	end )
	EMERGENCY_MESSAGING.HandleEmergencyMessaging( f3_arg1 )
	SEQUENCEPRESETS.RegisterAnimation( f3_arg0, LUI.Transition.TransFrom, "OutDepthForward", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f3_arg0, LUI.Transition.TransTo, "InDepthForward", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f3_arg0, LUI.Transition.TransBackFrom, "OutDepthBack", 0 )
	SEQUENCEPRESETS.RegisterAnimation( f3_arg0, LUI.Transition.TransBackTo, "InDepthBack", 0 )
end

function MPMainMenu( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "MPMainMenu"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	f0_local0( self, f1_local1, controller )
	self.HelperBar = MenuBuilder.BuildRegisteredType( "ButtonHelperBar", {
		controllerIndex = f1_local1
	} )
	self.HelperBar.id = "HelperBar"
	self.HelperBar:SetAnchorsAndPosition( 0, 0, 1, 0, 0, 0, _1080p * -85, 0 )
	self.HelperBar:setPriority( 10 )
	self:addElement( self.HelperBar )
	local f1_local2 = self
	local MPTabsMenu = nil
	
	MPTabsMenu = MenuBuilder.BuildRegisteredType( "MPTabsMenu", {
		controllerIndex = f1_local1
	} )
	MPTabsMenu.id = "MPTabsMenu"
	MPTabsMenu:SetAnchorsAndPosition( 0, 1, 0, 0, 0, _1080p * 1920, 0, 0 )
	self:addElement( MPTabsMenu )
	self.MPTabsMenu = MPTabsMenu
	
	local f1_local4 = nil
	if CONDITIONS.IsInKoreanIGRPaidSession() then
		f1_local4 = MenuBuilder.BuildRegisteredType( "IGRXPBonusTip", {
			controllerIndex = f1_local1
		} )
		f1_local4.id = "IGRXPBonusTip"
		f1_local4:SetAnchorsAndPosition( 0.5, 0.5, 1, 0, _1080p * -224, _1080p * 576, _1080p * -70, 0 )
		self:addElement( f1_local4 )
		self.IGRXPBonusTip = f1_local4
	end
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		button_ref = "button_secondary",
		helper_text = Engine[0xED84C33EC5F01EA]( "MENU/BACK" )
	} )
	self.HelperBar.ButtonHelperText:PushButtonPrompt( {
		side = "left",
		priority = -29,
		kbmTooltipPromptOverload = "button_quick_options",
		button_ref = "button_start",
		helper_text = Engine[0xED84C33EC5F01EA]( "LUA_MENU/OPTIONS" )
	} )
	if not self.bindButton then
		local f1_local5 = LUI.UIBindButton.new()
		f1_local5.id = "selfBindButton"
		self:addElement( f1_local5 )
		self.bindButton = f1_local5
	end
	self.bindButton:addEventHandler( "button_start", function ( f2_arg0, f2_arg1 )
		local f2_local0 = f2_arg1.controller or menu
		if menu.MPTabsMenu:GetCurrentTabName() == "MPStoreMenu" and Engine[0x836C8AD984F14F6]() then
			InGameStore.ShowStoreIcon( false )
		end
		ACTIONS.OpenOptionsMenu( f2_local0, "", "" )
	end )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "MPMainMenu", MPMainMenu )
LUI.FlowManager.RegisterStackPushBehaviour( "MPMainMenu", f0_local4 )
LUI.FlowManager.RegisterStackPopBehaviour( "MPMainMenu", f0_local3 )
LockTable( _M )
