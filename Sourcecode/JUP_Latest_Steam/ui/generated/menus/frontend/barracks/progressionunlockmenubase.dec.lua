-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:03
module( ..., package.seeall )
local f0_local0 = 1
local f0_local1 = 2
local f0_local2 = 3
local f0_local3 = 9257
local f0_local4 = 9225
local f0_local5 = "ProressionUnlockMenu -> CurrentXP: %s,    CurrentRank: %s \n"
local f0_local6 = "button_dpad_down"
local f0_local7 = "button_alt2"
local f0_local8 = {
	[PROGRESSION.GameModeToCode[LOOT.GameModeFilterString.OB]] = Engine[0xED84C33EC5F01EA]( 0x4E4B264DF1D0AC ),
	[PROGRESSION.GameModeToCode[LOOT.GameModeFilterString.MP]] = Engine[0xED84C33EC5F01EA]( 0x487AD90AF40AEA5 ),
	[PROGRESSION.GameModeToCode[LOOT.GameModeFilterString.BR]] = Engine[0xED84C33EC5F01EA]( 0x34DE6C2DC4BFFF9 )
}
local f0_local9 = function ( f23_arg0, f23_arg1 )
	return PROGRESSION.GetMaxRank() + (f23_arg0._cachedPrestigeWithUnlockChallenges and f23_arg0._cachedPrestigeWithUnlockChallenges[f23_arg0._cachedElderRankWithSeasonIndex[f23_arg1]] or 0)
end

local f0_local10 = function ( f21_arg0, f21_arg1 )
	f21_arg0.ProgressionGrid:SetTargetColumn( f21_arg1, false, true )
	local f21_local0 = f21_arg0:Wait( 100, true )
	f21_local0.onComplete = function ( f22_arg0 )
		f22_arg0.ProgressionGrid:SetFocusedPosition( {
			y = 0,
			x = f21_arg0
		}, true, true )
		f22_arg0:UpdateDescriptions( f21_arg0 )
	end
	
end

local f0_local11 = function ( f20_arg0, f20_arg1 )
	local f20_local0 = f20_arg0.ProgressionGrid:GetFocusPositionIndex()
	for f20_local1 = 1, f20_arg0._lastSeasonNum, 1 do
		local f20_local4 = f0_local0( f20_arg0, f20_local1 )
		if f20_local0 < f20_local4 and f20_arg1 then
			f20_arg0._currentSwitchedSeason = f20_local1 - 1
			break
		elseif f20_local0 <= f20_local4 then
			f20_arg0._currentSwitchedSeason = f20_local1
			break
		end
	end
end

local f0_local12 = function ( f19_arg0 )
	f0_local0( f19_arg0, true )
	f19_arg0._currentSwitchedSeason = f19_arg0._currentSwitchedSeason + 1
	f19_arg0._currentSwitchedSeason = LUI.clamp( f19_arg0._currentSwitchedSeason, f19_arg0._firstSeasonNum, f19_arg0._lastSeasonNum )
	f0_local0( f19_arg0, f0_local0( f19_arg0, f19_arg0._currentSwitchedSeason ) )
end

local f0_local13 = function ( f18_arg0 )
	f0_local0( f18_arg0, false )
	f18_arg0._currentSwitchedSeason = f18_arg0._currentSwitchedSeason - 1
	local f18_local0 = 0
	if 0 < f18_arg0._currentSwitchedSeason then
		f18_local0 = f0_local0( f18_arg0, f18_arg0._currentSwitchedSeason )
	else
		f18_arg0._currentSwitchedSeason = 0
	end
	f0_local0( f18_arg0, f18_local0 )
end

local f0_local14 = function ( f17_arg0, f17_arg1 )
	if f17_arg0.HelperBar and not String.IsNilOrEmpty( f17_arg1 ) and f17_arg0.HelperBar.ButtonHelperText:GetPromptByButtonRef( f17_arg1 ) then
		f17_arg0.HelperBar.ButtonHelperText:RemoveButtonPrompt( f17_arg1 )
	end
end

local f0_local15 = function ( f16_arg0, f16_arg1 )
	if f16_arg1.showFriendsPrompt then
		f16_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 3,
			helper_text = Engine[0xED84C33EC5F01EA]( 0xBEDB689C2D47604 ),
			button_ref = f0_local0,
			helper_definition = Engine[0xED84C33EC5F01EA]( 0xBEDB689C2D47604 )
		}, {
			replaceTop = true
		} )
	else
		f0_local0( f16_arg0, f0_local0 )
	end
	if f16_arg1.showZombiePrompt and not CONDITIONS.IsJupPublicBetaBuildEnabled() then
		f16_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
			side = "left",
			priority = 4,
			helper_text = Engine[0xED84C33EC5F01EA]( 0xE0886386E832C52 ),
			button_ref = f0_local0,
			helper_definition = Engine[0xED84C33EC5F01EA]( 0xE0886386E832C52 )
		}, {
			replaceTop = true
		} )
	else
		f0_local0( f16_arg0, f0_local0 )
	end
end

local f0_local16 = function ( f13_arg0 )
	f13_arg0:addEventHandler( "gamepad_button", function ( f15_arg0, f15_arg1 )
		if not f15_arg1.down then
			return 
		elseif CONDITIONS.ButtonAltTwo( f15_arg0, f15_arg1 ) then
			f15_arg0:processEvent( {
				name = "expand_friends_popup",
				focusedTile = f15_arg0.ProgressionGrid:GetFocusPositionIndex()
			} )
			return true
		elseif CONDITIONS.ButtonDown( f15_arg0, f15_arg1 ) or CONDITIONS.ButtonDpadDown( f15_arg0, f15_arg1 ) then
			f15_arg0:processEvent( {
				name = "toggle_zombie_tile",
				focusedTile = f15_arg0.ProgressionGrid:GetFocusPositionIndex()
			} )
		elseif f15_arg0._lastSeasonNum and 1 <= f15_arg0._lastSeasonNum then
			if CONDITIONS.ButtonLeftTrigger( f15_arg0, f15_arg1 ) then
				f13_arg0( f15_arg0 )
				return true
			elseif CONDITIONS.ButtonRightTrigger( f15_arg0, f15_arg1 ) then
				f13_arg0( f15_arg0 )
				return true
			end
		end
	end )
	f13_arg0:registerEventHandler( "update_helper_bar_prompts", function ( element, event )
		f13_arg0( element, event )
		return true
	end )
end

local f0_local17 = function ( f12_arg0, f12_arg1 )
	return f12_arg0._cachedPrestigeWithUnlockChallenges[f12_arg1]
end

local f0_local18 = function ( f11_arg0, f11_arg1, f11_arg2 )
	local f11_local0 = false
	if f11_arg0.currentRank then
		f11_local0 = f11_arg1 <= f11_arg0.currentRank
	end
	local f11_local1
	if not f11_arg2 then
		f11_local1 = f11_arg2
	else
		f11_local1 = AAR.GetRankupUnlockPackage( f11_arg0._controllerIndex, f11_arg1, f11_arg0._progressionGameMode )
	end
	f11_arg0.rewardPackage = f11_local1
	f11_local1 = #f11_arg0.rewardPackage
	local f11_local2 = f11_arg1 > PROGRESSION.GetMaxRank()
	f11_arg0.GhostRankNumber:setText( MarkLocalized( PROGRESSION.FormatNumber( f11_arg1 + 1 ) ) )
	if 2 < f11_local1 then
		ACTIONS.AnimateSequence( f11_arg0, "ThreeRewards" )
	elseif 1 < f11_local1 then
		ACTIONS.AnimateSequence( f11_arg0, "TwoRewards" )
	elseif 0 < f11_local1 then
		ACTIONS.AnimateSequence( f11_arg0, "OneReward" )
	else
		f11_arg0[0x8E91DE29B19CD69]:setText( f0_local0[f11_arg0._progressionGameMode] )
		ACTIONS.AnimateSequence( f11_arg0, "NoRewards" )
	end
	local f11_local3 = ACTIONS.AnimateSequence
	local f11_local4 = f11_arg0
	local f11_local5
	if f11_local0 then
		f11_local5 = "RankUnlocked"
	else
		f11_local5 = "RankLocked"
	end
	f11_local3( f11_local4, f11_local5 )
	if not f11_local0 then
		if f11_local2 then
			f11_arg0.RankCriteriaLabel:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( 0xFBE3D6E2802042C, f11_arg1 - PROGRESSION.GetPlayerRank( f11_arg0._controllerIndex ) ) ) )
		else
			f11_arg0.RankCriteriaLabel:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( 0x720B4540EF9A7BC, PROGRESSION.GetRankMinXP( f11_arg1 ) - f11_arg0.XP ) ) )
		end
	end
	f11_local3 = f11_arg0.rewardPackage[f0_local0]
	local f11_local6 = f11_arg0.rewardPackage[f0_local0]
	f11_local4 = f11_arg0.rewardPackage[f0_local0]
	if f11_local2 then
		f11_local5 = f0_local0( f11_arg0, f11_arg1 )
		if not f11_local5 then
		
		else
			local f11_local7 = f11_arg0._cachedPrestigeWithBattlepassRewards and f11_arg0._cachedPrestigeWithBattlepassRewards[f11_arg1] or nil
			local f11_local8 = false
			if f11_local3 then
				if f11_local3.lootType ~= LOOT.itemTypes.PLAYERCARD and f11_local3.lootType ~= LOOT.itemTypes.WEAPON then
					f11_local8 = false
				else
					f11_local8 = true
				end
			end
			local f11_local9 = false
			if f11_local6 then
				if f11_local6.lootType ~= LOOT.itemTypes.PLAYERCARD and f11_local6.lootType ~= LOOT.itemTypes.WEAPON then
					f11_local9 = false
				else
					f11_local9 = true
				end
			end
			if f11_local3 then
				local f11_local10 = nil
				if LUI.IsGamepadActiveInputMethodForPrompts( f11_arg0._controllerIndex ) then
					if f11_local3.lootID == f0_local0 then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0x9CCCEBC6FC6BBCE )
					elseif f11_local3.lootID == f0_local0 then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0x28CBD733B529687 )
					end
				elseif LUI.IsLastInputKeyboardMouse( f11_arg0._controllerIndex ) then
					if f11_local3.lootID == f0_local0 then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0xC1041AFAF4E1706 )
					elseif f11_local3.lootID == f0_local0 then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0x20AAE95D8A457FB )
					end
				end
				if f11_local2 then
					if f11_local3.lootType == LOOT.itemTypes.PLAYERCARD then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0xFBC885B58B734F0 )
						f11_local3.challengeDesc = f11_arg0._filteredPrestigeChallenges[f11_local5]
						f11_local3.unlockRank = f11_arg1
					elseif f11_local0 then
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0x74C28011D5E2D73 )
					else
						f11_local3.desc = Engine[0xED84C33EC5F01EA]( 0xE86C881F8C4436C, f11_arg0._cachedPrestigeWithUnlockChallenges[f11_arg1] )
					end
				end
				f11_arg0.DescLeft:SetupDescription( f11_local3, f11_local0, f11_local7, f11_local1, f11_arg0._controllerIndex, false )
			end
			if f11_local6 then
				if f11_local2 then
					f11_local6.desc = Engine[0xED84C33EC5F01EA]( 0xFBC885B58B734F0 )
					f11_local6.challengeDesc = f11_arg0._filteredPrestigeChallenges[f11_local5]
					f11_local6.unlockRank = f11_arg1
				end
				if f11_local6.unlockRank == PROGRESSION.GetPlayerLifeTimeMaxRank() then
					f11_local6.lootTypeName = Engine[0xED84C33EC5F01EA]( 0x25D1F4E55101CB3 )
					if f11_local0 then
						f11_local6.desc = ""
					else
						f11_local6.desc = Engine[0xED84C33EC5F01EA]( 0xE86C881F8C4436C, f11_arg0._cachedPrestigeWithUnlockChallenges[f11_arg1] )
					end
					f11_local6.isMaxLevel = true
				end
				f11_arg0.DescRight:SetupDescription( f11_local6, f11_local0, f11_local7, f11_local1, f11_arg0._controllerIndex, f11_local8 )
			end
			if f11_local4 then
				local f11_local10 = f11_arg0.DescThird
				local f11_local11 = f11_local10
				f11_local10 = f11_local10.SetupDescription
				local f11_local12 = f11_local4
				local f11_local13 = f11_local0
				local f11_local14 = f11_local7
				local f11_local15 = f11_local1
				local f11_local16 = f11_arg0._controllerIndex
				local f11_local17
				if not f11_local8 then
					f11_local17 = f11_local8
				else
					f11_local17 = f11_local9
				end
				f11_local10( f11_local11, f11_local12, f11_local13, f11_local14, f11_local15, f11_local16, f11_local17 )
			end
		end
	end
	f11_local5 = nil
end

local f0_local19 = function ( f10_arg0 )
	local f10_local0 = 1
	local f10_local1 = 999999
	for f10_local2 = 1, #f10_arg0._cachedElderRankWithUnlockChallenges, 1 do
		local f10_local5 = math.abs( f10_arg0._cachedElderRankWithUnlockChallenges[f10_local2] - f10_arg0.currentRank )
		if f10_local5 < f10_local1 then
			f10_local1 = f10_local5
			f10_local0 = f10_local2
		end
	end
	return f10_local0
end

local f0_local20 = function ( f9_arg0, f9_arg1 )
	local f9_local0 = 1
	local f9_local1 = 999999
	if f9_arg1 <= PROGRESSION.GetMaxRank() then
		return f9_arg1
	end
	for f9_local2 = 1, #f9_arg0._cachedElderRankWithUnlockChallenges, 1 do
		local f9_local5 = f9_arg0._cachedElderRankWithUnlockChallenges[f9_local2]
		if math.abs( f9_local5 - f9_arg1 ) < f9_local1 then
			f9_local1 = math.abs( f9_local5 - f9_arg1 )
			f9_local0 = f9_local5
		end
	end
	return f9_local0
end

local f0_local21 = function ( f8_arg0, f8_arg1 )
	return f8_arg0._cachedElderRankWithUnlockChallenges[f8_arg1]
end

local f0_local22 = function ( f7_arg0, f7_arg1 )
	return f7_arg0._cachedElderRankWithSeasonStart[f7_arg1] ~= nil
end

local f0_local23 = function ( f6_arg0, f6_arg1 )
	return f6_arg0._cachedElderRankWithSeason[f6_arg1]
end

local f0_local24 = function ( f5_arg0, f5_arg1 )
	f5_arg0._cachedElderRankWithUnlockChallenges = {}
	f5_arg0._cachedPrestigeWithUnlockChallenges = {}
	f5_arg0._cachedElderRankWithSeason = {}
	f5_arg0._cachedElderRankWithSeasonStart = {}
	f5_arg0._cachedElderRankWithSeasonIndex = {}
	f5_arg0._cachedStartOfTheSeasonColumn = {}
	f5_arg0._cachedPrestigeWithBattlepassRewards = {}
	local f5_local0 = AAR.GAME_MODE_FILTER_REWARDS_STRING[f5_arg1]
	local f5_local1 = CSV.progressionItems.GetFile()
	local f5_local2 = StringTable[0xFD4E49A34DD43AE]( f5_local1 )
	local f5_local3 = SEASON.GetCurrentSeason()
	f5_arg0._filteredPrestigeChallenges = {}
	for f5_local8, f5_local9 in ipairs( f5_arg0.prestigeChallenges ) do
		local f5_local7
		if f5_local9 then
			f5_local7 = f5_local9.options.season
			if not f5_local7 then
			
			elseif f5_local7 then
				if f5_local3 < f5_local7 then
					break
				elseif f5_local0 and string.find( f5_local9.masteryChallenge.ref, f5_local0 ) then
					table.insert( f5_arg0._filteredPrestigeChallenges, f5_local9 )
				end
			end
		end
		f5_local7 = nil
	end
	f5_local4 = 1
	f5_local5 = 0
	f5_local6 = false
	for f5_local8 = 0, f5_local2 - 1, 1 do
		local f5_local10 = StringTable[0x6E34EAC0192FA9F]( f5_local1, f5_local8 )
		if not String.IsNilOrEmpty( f5_local10[CSV.progressionItems.cols.unlockedChallenges + 1] ) then
			if f5_local6 then
				if CONDITIONS.IsJup() or CONDITIONS[0x4A020C7B018B3BA]() then
					local f5_local11 = f5_arg0._filteredPrestigeChallenges[f5_local4]
					local f5_local12
					if f5_local11 then
						f5_local12 = f5_local11.options.season
						if not f5_local12 then
						
						elseif f5_local12 then
							if f5_local3 < f5_local12 then
								break
							end
							f5_arg0._cachedElderRankWithSeason[f5_local8] = f5_local12
							if f5_local5 < f5_local12 then
								f5_arg0._cachedElderRankWithSeasonStart[f5_local8] = f5_local12
								f5_arg0._cachedElderRankWithSeasonIndex[f5_local12] = f5_local8
								f5_arg0._cachedStartOfTheSeasonColumn[PROGRESSION.GetMaxRank() + PROGRESSION.GetElderTier( f5_local8 )] = true
							end
							f5_local5 = f5_local12
						else
							f5_arg0.maxRankIndex = PROGRESSION.GetMaxRank() + #f5_arg0._cachedElderRankWithUnlockChallenges + 1
							f5_arg0.currentRankIndex = PROGRESSION.GetMaxRank() + f0_local0( f5_arg0 )
						end
					end
					f5_local12 = nil
				end
				table.insert( f5_arg0._cachedElderRankWithUnlockChallenges, f5_local8 )
				f5_arg0._cachedPrestigeWithUnlockChallenges[f5_local8] = f5_local4
				f5_local4 = f5_local4 + 1
				local f5_local11 = 1
				local f5_local12 = CSV.progressionItems.cols.firstItem
				if f5_local12 then
					local f5_local13 = f5_local10[f5_local12 + f5_local11]
				end
			end
			f5_local6 = true
		end
	end
	f5_arg0.maxRankIndex = PROGRESSION.GetMaxRank() + #f5_arg0._cachedElderRankWithUnlockChallenges + 1
	f5_arg0.currentRankIndex = PROGRESSION.GetMaxRank() + f0_local0( f5_arg0 )
end

local f0_local25 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0.UpdateDescriptions = f0_local0
	f3_arg0.GetElderRankClosestRank = f0_local0
	f3_arg0.GetElderRankToSend = f0_local0
	f3_arg0.GetSeasonByElderRank = f0_local0
	f3_arg0.IsElderRankStartOfSeason = f0_local0
	f3_arg0.SetProgressionTileFocus = f0_local0
	f3_arg0.CacheElderRankWithUnlockedChallenges = f0_local0
	f3_arg0._navigateLeft = 7
	f3_arg0._navigateRight = 11
	f3_arg0._bigJumpAmount = 5
	f3_arg0._currentSwitchedSeason = 0
	f3_arg0.maxRankIndex = PROGRESSION.GetMaxRank() + 1
	f3_arg0.XP = PROGRESSION.GetPlayerLifeTimeXP( f3_arg1 )
	f3_arg0.currentRank = PROGRESSION.GetRankByXP( f3_arg0.XP )
	if f3_arg0.currentRank == f3_arg0.maxRankIndex then
		f3_arg0.percentage = 1
	else
		local f3_local0 = PROGRESSION.GetRankMinXP( f3_arg0.currentRank )
		f3_arg0.percentage = (f3_arg0.XP - f3_local0) / (PROGRESSION.GetRankMaxXP( f3_arg0.currentRank ) - f3_local0)
	end
	f3_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( 0xADF517D84B9BD12 ) )
	local f3_local0 = {}
	f3_arg0.currentRankIndex = f3_arg0.currentRank
	if PROGRESSION.IsElder( f3_arg1 ) then
		if CONDITIONS.IsJup() or CONDITIONS[0x4A020C7B018B3BA]() then
			f3_arg0.prestigeChallenges = CallingCardUtils.GenerateCallingCardPrestigeData( f3_arg1, false )
		end
		f0_local0( f3_arg0, PROGRESSION.GameModeToCode[LOOT.GameModeFilterString.MP] )
		f3_arg0._firstSeasonNum = 1
		f3_arg0._lastSeasonNum = #f3_arg0._cachedElderRankWithSeasonIndex
		if f3_arg0.HelperBar and 1 <= f3_arg0._lastSeasonNum then
			f3_arg0:SubscribeToInputTypeModel( f3_arg0._controllerIndex, function ( f4_arg0, f4_arg1 )
				f3_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
					button_ref = "button_left_trigger"
				} )
				f3_arg0.HelperBar.ButtonHelperText:PopButtonPrompt( {
					button_ref = "button_right_trigger"
				} )
				if CONDITIONS.IsKbm( f4_arg1._controllerIndex ) then
					f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
						kbm_only = true,
						priority = 1,
						side = "left",
						button_ref = "button_left_trigger",
						helper_text = Engine[0xED84C33EC5F01EA]( 0xBB4FCE5E32C74F9 ),
						helper_definition = Engine[0xED84C33EC5F01EA]( 0x35AC3819CE0426A )
					} )
					f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
						kbm_only = true,
						priority = 2,
						side = "left",
						button_ref = "button_right_trigger",
						helper_text = Engine[0xED84C33EC5F01EA]( 0x23E7641308235CA ),
						helper_definition = Engine[0xED84C33EC5F01EA]( 0x4129939F3CD3C96 )
					} )
				else
					f3_arg0.HelperBar.ButtonHelperText:PushButtonPrompt( {
						priority = 1,
						side = "left",
						button_ref2 = "button_right_trigger",
						gamepad_only = true,
						button_ref = "button_left_trigger",
						helper_text = Engine[0xED84C33EC5F01EA]( 0xA762C076278F56 )
					} )
				end
			end )
		end
	end
	if f3_arg0.HelperBar then
		f0_local0( f3_arg0 )
	end
	if not f3_arg0._currentTileFocused then
		f3_arg0._currentTileFocused = {
			rank = 0,
			fakeWidget = true
		}
	end
	f3_arg0:UpdateDescriptions( f3_arg0._currentTileFocused.rank )
end

local f0_local26 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function ProgressionUnlockMenuBase( f1_arg0, f1_arg1 )
	local f1_local0 = LUI
	local f1_local1 = f1_local0.UIMenu.new()
	f1_local1.id = "ProgressionUnlockMenuBase"
	local f1_local2
	if f1_arg1 then
		f1_local2 = f1_arg1
	else
		f1_local2 = f1_arg1.controllerIndex
	end
	f1_local2 = f1_local0.ValidateControllerIndex( f1_local1, f1_local2 )
	local f1_local3 = f1_local1
	f0_local0( f1_local1, f1_local2, f1_arg1 )
	return f1_local1
end

MenuBuilder.registerType( 0xBA327BF1013FAA6, ProgressionUnlockMenuBase )
LockTable( _M )
