-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 04-10-2025 21:43
LUI.UIScrollbar = LUI.Class()
LUI.UIScrollbar.init = function ( f20_arg0, f20_arg1 )
	local f20_local0 = f20_arg0
	if not f20_arg1 then
		f20_arg1 = {}
	end
	f20_arg0._eventListener = f20_arg1.eventListener
	f20_arg0._sliderArea = f20_arg1.sliderArea
	f20_arg0._slider = f20_arg1.slider
	f20_arg0._fixedSizeSlider = f20_arg1.fixedSizeSlider
	local f20_local1 = f20_arg1.animationDuration
	if not f20_local1 then
		f20_local1 = 80
	end
	f20_arg0._animationDuration = f20_local1
	f20_local1 = f20_arg1.direction
	if not f20_local1 then
		f20_local1 = LUI.DIRECTION.vertical
	end
	f20_arg0._direction = f20_local1
	f20_local1 = assert
	local f20_local2
	if f20_arg0._direction ~= LUI.DIRECTION.vertical and f20_arg0._direction ~= LUI.DIRECTION.horizontal then
		f20_local2 = false
	else
		f20_local2 = true
	end
	f20_local1( f20_local2 )
	f20_arg0._eventListener:SetNotifyOnLayoutInit( true )
	f20_arg0._eventListener:addEventHandler( "layout_initialized", function ()
		if f20_arg0._source then
			f20_arg0:ResizeScrollbar()
		end
	end )
	if f20_arg0._fixedSizeSlider then
		f20_local1, f20_local3, f20_local2, f20_local4 = f20_arg0._fixedSizeSlider:getLocalRect()
		if f20_arg0._direction == LUI.DIRECTION.horizontal then
			f20_arg0._initialFixedWidth = f20_local2 - f20_local1
		else
			f20_arg0._initialFixedHeight = f20_local4 - f20_local3
		end
		f20_arg0._fixedSizeSlider.m_requireFocusType = FocusType.MouseOver
	end
	f20_arg0._eventListener:addEventHandler( "transition_ended", function ()
		if f20_arg0._source ~= nil then
			f20_arg0:ResizeScrollbar( true )
		end
	end )
	if f20_arg0._sliderArea then
		f20_arg0._sliderArea.m_requireFocusType = FocusType.MouseOver
	end
	if f20_arg0._slider then
		f20_arg0._slider.m_requireFocusType = FocusType.MouseOver
	end
	if f20_arg1.startCap then
		f20_arg1.startCap:addEventHandler( "button_action", function ( f31_arg0, f31_arg1 )
			if f20_arg0._source then
				return f20_arg0._source:processEvent( {
					name = "scrollbar_previous",
					scrollbar = f20_arg0
				} )
			else
				
			end
		end )
		f20_arg1.startCap:addEventHandler( "leftmousedown", function ( f30_arg0, f30_arg1 )
			return true
		end )
	end
	if f20_arg1.endCap then
		f20_arg1.endCap:addEventHandler( "button_action", function ( f29_arg0, f29_arg1 )
			if f20_arg0._source then
				return f20_arg0._source:processEvent( {
					name = "scrollbar_next",
					scrollbar = f20_arg0
				} )
			else
				
			end
		end )
		f20_arg1.endCap:addEventHandler( "leftmousedown", function ( f28_arg0, f28_arg1 )
			return true
		end )
	end
	if f20_arg1.sliderArea and (f20_arg1.slider or f20_arg1.fixedSizeSlider) then
		f20_local1 = {}
		local f20_local3 = false
		f20_local2 = function ( f27_arg0, f27_arg1 )
			if not f20_arg0:IsKBMStyle() then
				return 
			elseif not f27_arg0:IsDisabled() then
				local f27_local0 = f20_arg0._sliderArea:getWidth()
				local f27_local1 = f20_arg0._sliderArea:getHeight()
				local f27_local2, f27_local3, f27_local4, f27_local5 = f20_arg0._sliderArea:getRect()
				f27_local2, f27_local3 = f27_arg1.root:PixelsToUnits( f27_local2, f27_local3 )
				local f27_local6, f27_local7 = f27_arg1.root:PixelsToUnits( f27_arg1.x, f27_arg1.y )
				if f27_arg1.name == "leftmousedown" then
					local f27_local8, f27_local9, f27_local10, f27_local11 = f27_arg0:getRect()
					local f27_local12, f27_local13 = f27_arg1.root:PixelsToUnits( f27_local8, f27_local9 )
					f27_local9 = f27_local13
					f20_arg0.x = f27_local6 - f27_local12
					f20_arg0.y = f27_local7 - f27_local9
				end
				f27_local6 = f27_local6 - f20_arg0.x
				f27_local7 = f27_local7 - f20_arg0.y
				local f27_local8 = LUI.clamp( (f27_local6 - f27_local2) / f27_local0, 0, 1 )
				local f27_local9 = LUI.clamp( (f27_local7 - f27_local3) / f27_local1, 0, 1 )
				if f20_arg0._source then
					f20_arg0._source:processEvent( {
						name = "scrollbar_drag",
						targetX = f27_local8,
						targetY = f27_local9,
						dragStart = f27_arg1.name == "leftmousedown",
						scrollbar = f20_arg0
					} )
					if f27_arg1.name == "mousedrag" then
						f20_arg0 = true
					end
				end
				return true
			else
				
			end
		end
		
		local f20_local4 = function ( f26_arg0, f26_arg1 )
			if not f20_arg0:IsKBMStyle() then
				return 
			elseif not f26_arg0:IsDisabled() and f20_arg0._source then
				f20_arg0._source:processEvent( {
					name = "scrollbar_mouse_up",
					scrollbarWasDragged = f20_arg0,
					scrollbar = f20_arg0
				} )
			end
			f20_arg0 = false
		end
		
		local f20_local5 = function ( f25_arg0, f25_arg1 )
			local f25_local0 = f25_arg1
			if UseMouseMoveEventOptimizedSystem then
				f25_local0 = f25_arg0:PreMouseDragEvent( f25_local0 )
				if f25_local0 == nil then
					return false
				end
			end
			local f25_local1 = f20_arg0( f25_arg0, f25_local0 )
			if UseMouseMoveEventOptimizedSystem then
				f25_arg0:PostMouseDragEvent( f25_local0 )
			end
			return f25_local1
		end
		
		local f20_local6 = function ( f24_arg0, f24_arg1 )
			if not f20_arg0:IsKBMStyle() then
				return 
			elseif not f24_arg0:IsDisabled() then
				local f24_local0 = f20_arg0._sliderArea:getWidth()
				local f24_local1 = f20_arg0._sliderArea:getHeight()
				local f24_local2, f24_local3, f24_local4, f24_local5 = f20_arg0._sliderArea:getRect()
				f24_local2, f24_local3 = f24_arg1.root:PixelsToUnits( f24_local2, f24_local3 )
				local f24_local6, f24_local7 = f24_arg1.root:PixelsToUnits( f24_arg1.x, f24_arg1.y )
				local f24_local8 = LUI.clamp( (f24_local6 - f24_local2) / f24_local0, 0, 1 )
				local f24_local9 = LUI.clamp( (f24_local7 - f24_local3) / f24_local1, 0, 1 )
				if f20_arg0._source then
					f20_arg0._source:processEvent( {
						name = "scrollbar_set",
						targetX = f24_local8,
						targetY = f24_local9,
						scrollbar = f20_arg0
					} )
					return true
				end
			end
		end
		
		local f20_local7 = function ( f23_arg0, f23_arg1 )
			Engine[0xD1619221CBAF878]( true )
			f20_arg0( f23_arg0, f23_arg1 )
			return true
		end
		
		local f20_local8 = function ( f22_arg0, f22_arg1 )
			Engine[0xD1619221CBAF878]( false )
			f20_arg0( f22_arg0, f22_arg1 )
			return true
		end
		
		local f20_local9 = f20_arg1.slider
		if not f20_local9 then
			f20_local9 = f20_arg1.fixedSizeSlider
		end
		f20_local9:registerEventHandler( "leftmousedown", f20_local7 )
		f20_local9:registerEventHandler( "leftmouseup", f20_local8 )
		f20_local9:registerEventHandler( "mouse_capture_lost", f20_local8 )
		f20_local9:registerEventHandler( "mousedrag", f20_local5 )
		f20_arg1.sliderArea:registerEventHandler( "leftmousedown", f20_local6 )
		f20_local9:addEventHandler( "gamepad_button", function ( f21_arg0, f21_arg1 )
			if f21_arg1.qualifier == "mousewheel" and f21_arg0.mouseWheelTarget then
				return f21_arg0.mouseWheelTarget:processEvent( f21_arg1 )
			else
				
			end
		end )
	end
end

LUI.UIScrollbar.ResizeScrollbar = function ( f18_arg0, f18_arg1 )
	if not f18_arg0._source then
		
	else
		
	end
	if f18_arg0._direction == LUI.DIRECTION.vertical then
		local f18_local0, f18_local1, f18_local2, f18_local3 = f18_arg0._eventListener:getCurrentGlobalRect()
		local f18_local4, f18_local5, f18_local6, f18_local7 = f18_arg0._source:getCurrentGlobalRect()
		local f18_local8 = f18_arg0._source:GetScale()
		local f18_local9 = function ( f19_arg0, f19_arg1, f19_arg2, f19_arg3, f19_arg4 )
			local f19_local0 = {
				x = f19_arg0,
				y = f19_arg2
			}
			local f19_local1 = {
				x = f19_arg1,
				y = f19_arg2
			}
			local f19_local2 = {
				x = f19_arg0 + math.abs( f19_arg0 - f19_arg1 ) / 2,
				y = f19_arg2 - math.abs( f19_arg2 - f19_arg3 ) / 2
			}
			local f19_local3 = math.sqrt( math.pow( f19_local1.x - f19_local2.x, 2 ) + math.pow( f19_local1.y - f19_local2.y, 2 ) ) * f19_arg4
			return f19_arg0 - f19_local3, f19_arg1 + f19_local3
		end
		
		if f18_local4 ~= nil and f18_local0 ~= nil and (f18_arg1 or not f18_arg0._cachedGridWidth or math.abs( f18_arg0._cachedGridWidth - f18_local6 - f18_local4 ) > LUI.UIGrid.GRID_EPSILON) then
			f18_arg0._cachedGridWidth = f18_local6 - f18_local4
			f18_local4, f18_local6 = f18_local9( f18_local4, f18_local6, f18_local5, f18_local7, f18_local8 )
			local f18_local10, f18_local11, f18_local12, f18_local13 = f18_arg0._eventListener:getLocalRect()
			local f18_local14 = f18_local12 - f18_local10
			local f18_local15 = f18_local0 < f18_local4
			if f18_local15 then
				f18_arg0._eventListener:SetRight( f18_local12 + f18_local4 - f18_local2 )
			else
				f18_arg0._eventListener:SetLeft( f18_local10 - f18_local0 - f18_local6 )
			end
			f18_arg0:UpdateSliderAreaVertical( f18_local15 )
		end
	end
	f18_arg0:UpdateScrolling()
end

LUI.UIScrollbar.UpdateSliderAreaVertical = function ( f17_arg0, f17_arg1 )
	local f17_local0, f17_local1, f17_local2, f17_local3 = f17_arg0._sliderArea:getLocalRect()
	if f17_arg1 then
		f17_arg0._sliderArea:SetAnchorsAndPosition( 0, 1, 0, 0, 0, math.abs( f17_local2 ) + math.abs( f17_local0 ), 0, 0 )
	else
		f17_arg0._sliderArea:SetAnchorsAndPosition( 1, 0, 0, 0, -(math.abs( f17_local2 ) + math.abs( f17_local0 )), 0, 0, 0 )
	end
end

LUI.UIScrollbar.UpdateScrolling = function ( f16_arg0 )
	if not f16_arg0._source then
		return 
	end
	assert( f16_arg0._source )
	f16_arg0:UpdateSlider()
	if f16_arg0._eventListener then
		local f16_local0 = f16_arg0._source:GetContentSize( f16_arg0._direction )
		if not f16_local0 then
			return 
		end
		local f16_local1 = f16_arg0._source:GetContentVisibleSize( f16_arg0._direction )
		assert( f16_local1 )
		if f16_local0 <= f16_local1 then
			f16_arg0._eventListener:processEvent( {
				name = "scrollbar_all_visible"
			} )
			f16_arg0._eventListener:SetMouseFocusBlocker( true )
			f16_arg0.isVisible = false
		else
			f16_arg0._eventListener:processEvent( {
				name = "scrollbar_not_all_visible"
			} )
			f16_arg0._eventListener:SetMouseFocusBlocker( false )
			f16_arg0.isVisible = true
		end
	end
end

local f0_local0 = function ( f15_arg0, f15_arg1 )
	if f15_arg0._sliderArea then
		f15_arg0._sliderArea:processEvent( {
			name = "expand",
			controller = f15_arg1,
			focusType = FocusType.MouseOver
		} )
	end
end

local f0_local1 = function ( f14_arg0, f14_arg1 )
	if f14_arg0._sliderArea then
		f14_arg0._sliderArea:processEvent( {
			name = "shrink",
			controller = f14_arg1,
			focusType = FocusType.MouseOver
		} )
	end
end

LUI.UIScrollbar.Unlink = function ( f13_arg0 )
	f13_arg0._source = nil
end

LUI.UIScrollbar.LinkTo = function ( f12_arg0, f12_arg1 )
	f12_arg0._source = f12_arg1
	f12_arg0:ResizeScrollbar()
end

LUI.UIScrollbar.MouseEnterSource = function ( f11_arg0, f11_arg1 )
	f0_local0( f11_arg0, f11_arg1 )
end

LUI.UIScrollbar.MouseLeaveSource = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	if not f10_arg0._eventListener:IsPositionInside( f10_arg2, f10_arg3 ) then
		f0_local0( f10_arg0, f10_arg1 )
	end
end

LUI.UIScrollbar.GainFocusSource = function ( f9_arg0, f9_arg1 )
	f0_local0( f9_arg0, f9_arg1 )
end

LUI.UIScrollbar.LoseFocusSource = function ( f8_arg0, f8_arg1 )
	f0_local0( f8_arg0, f8_arg1 )
end

LUI.UIScrollbar.SizeUpdatedSource = function ( f7_arg0 )
	f7_arg0:ResizeScrollbar()
end

LUI.UIScrollbar.GetDirection = function ( f6_arg0 )
	return f6_arg0._direction
end

LUI.UIScrollbar.GetWidget = function ( f5_arg0 )
	return f5_arg0._eventListener
end

LUI.UIScrollbar.SetLinkedGridDataSource = function ( f4_arg0, f4_arg1 )
	
end

LUI.UIScrollbar.IsKBMStyle = function ( f3_arg0 )
	if not f3_arg0._source then
		return true
	end
	local f3_local0 = f3_arg0._KBMStyle
	if not f3_local0 then
		if f3_arg0._fixedSizeSlider then
			f3_local0 = f3_arg0._source._controllerIndex
			if f3_local0 then
				f3_local0 = LUI.IsLastInputKeyboardMouse( f3_arg0._source._controllerIndex )
			end
		else
			f3_local0 = true
		end
	end
	return f3_local0
end

LUI.UIScrollbar.SetKBMStyle = function ( f2_arg0, f2_arg1 )
	f2_arg0._KBMStyle = f2_arg1
end

LUI.UIScrollbar.UpdateSlider = function ( f1_arg0 )
	if not f1_arg0._source then
		return 
	end
	local f1_local0 = f1_arg0._slider or f1_arg0._fixedSizeSlider
	if not f1_local0 then
		return 
	end
	local f1_local1 = f1_arg0._source:GetContentSize( f1_arg0._direction )
	if not f1_local1 then
		return 
	end
	local f1_local2 = f1_arg0._source:GetContentVisibleSize( f1_arg0._direction )
	assert( f1_local2 )
	f1_local2 = math.min( f1_local2, f1_local1 )
	local f1_local3, f1_local4 = nil
	local f1_local5 = f1_arg0._source._controllerIndex
	if not (not f1_arg0:IsKBMStyle() or f1_arg0._KBMStyle ~= nil) or f1_arg0._KBMStyle == true then
		local f1_local6 = f1_arg0._source:GetContentOffset( f1_arg0._direction )
		if not f1_local6 then
			f1_local6 = 0
			f1_local2 = 1
			f1_local1 = 1
		end
		local f1_local7 = f1_local2 / f1_local1
		f1_local3 = f1_local6 / f1_local1
		f1_local4 = f1_local3 + f1_local7
		f1_local3 = LUI.clamp( f1_local3, 0, 1 - f1_local7 )
		f1_local4 = LUI.clamp( f1_local4, f1_local7, 1 )
	else
		local f1_local6 = f1_arg0._source:GetFocusPosition( f1_arg0._direction )
		if not f1_local6 or f1_local6 < 0 then
			f1_local6 = 0
		end
		f1_local1 = f1_arg0._source:GetContentCount( f1_arg0._direction )
		local f1_local7 = assert
		local f1_local8
		if f1_local6 - f1_local1 >= 0.01 and f1_local1 ~= 0 then
			f1_local8 = false
		else
			f1_local8 = true
		end
		f1_local7( f1_local8 )
		f1_local7 = f1_arg0._direction
		local f1_local9 = LUI.DIRECTION.horizontal
		f1_local7 = REG15 and f1_arg0._initialFixedWidth or f1_arg0._initialFixedHeight
		f1_local9 = f1_arg0._sliderArea
		if not f1_local9 then
			f1_local9 = f1_local0:getParent()
		end
		if f1_arg0._direction == LUI.DIRECTION.horizontal then
			f1_local8 = f1_local9:getWidth()
			if not f1_local8 then
			
			elseif f1_local1 <= 1 or f1_local8 <= 1 then
				f1_local3 = 0
				f1_local4 = 0
			else
				f1_local3 = f1_local6 / (f1_local1 - 1) * (f1_local8 - f1_local7) / f1_local8
				f1_local4 = f1_local3 + f1_local7 / f1_local8
			end
		end
		f1_local8 = f1_local9:getHeight()
	end
	local f1_local6 = false
	if not f1_arg0._lastContentSize or not f1_arg0._lastContentVisibleSize or f1_arg0._lastContentSize <= f1_arg0._lastContentVisibleSize then
		f1_local6 = true
	end
	local f1_local7
	if f1_local6 then
		f1_local7 = 0
	else
		f1_local7 = f1_arg0._animationDuration
	end
	if f1_arg0._direction == LUI.DIRECTION.horizontal then
		f1_local0:SetLeftAnchor( f1_local3, f1_local7, LUI.EASING.outCubic )
		f1_local0:SetRightAnchor( 1 - f1_local4, f1_local7, LUI.EASING.outCubic )
		f1_local0:SetLeft( 0, f1_local7 )
		f1_local0:SetRight( 0, f1_local7 )
	else
		f1_local0:SetTopAnchor( f1_local3, f1_local7, LUI.EASING.outCubic )
		f1_local0:SetBottomAnchor( 1 - f1_local4, f1_local7, LUI.EASING.outCubic )
		f1_local0:SetTop( 0, f1_local7 )
		f1_local0:SetBottom( 0, f1_local7 )
	end
	f1_arg0._lastContentSize = f1_local1
	f1_arg0._lastContentVisibleSize = f1_local2
end

