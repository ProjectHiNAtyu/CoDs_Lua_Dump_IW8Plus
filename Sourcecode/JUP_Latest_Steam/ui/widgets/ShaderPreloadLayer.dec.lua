-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
LUI.ShaderPreloadLayer = LUI.Class( LUI.UIElement )
local f0_local0 = 800
local f0_local1 = 60
local f0_local2 = 300
local f0_local3 = 100
local f0_local4 = {}
LUI.ShaderPreloadLayer.States = {
	ABORTED = 5,
	PENDING = 1,
	COMPLETED = 4,
	IN_PROGRESS = 2,
	PAUSED = 3
}
LUI.ShaderPreloadLayer.PreloadPSOReasonStringRef = {
	[CoD.PreloadPSORebuildReason.PRELOADPSO_DETERMINING] = "",
	[CoD.PreloadPSORebuildReason.PRELOADPSO_NOCONFIG] = Engine[0xED84C33EC5F01EA]( 0x2DF45A56BE44BBB ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_FORCED] = Engine[0xED84C33EC5F01EA]( 0x5031552B767C7EB ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_FILECHANGED] = Engine[0xED84C33EC5F01EA]( 0x28B7EF4025919FB ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_NEWFILE] = Engine[0xED84C33EC5F01EA]( 0x28B7EF4025919FB ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_DRIVERVERSION] = Engine[0xED84C33EC5F01EA]( 0xC1CF23FE960F3E4 ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_HARDWARECHANGED] = Engine[0xED84C33EC5F01EA]( 0x561DFCE1E9C1226 ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_OTHEREXEC] = Engine[0xED84C33EC5F01EA]( 0xCCDC24CF89E8F9F ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_OSVERSION] = Engine[0xED84C33EC5F01EA]( 0xD51B3DF90608B34 ),
	[CoD.PreloadPSORebuildReason.PRELOADPSO_UNKNOWN] = ""
}
LUI.ShaderPreloadLayer.PSOToastData = {
	[LUI.ShaderPreloadLayer.States.PENDING] = {
		toastTitle = Engine[0xED84C33EC5F01EA]( 0xCDEB1619404EFD ),
		toastDescription = Engine[0xED84C33EC5F01EA]( 0x354F8F662AF22C1 ),
		toastEffect = LUI.ToastManager.ToastVisualEffect.Error
	},
	[LUI.ShaderPreloadLayer.States.IN_PROGRESS] = {
		toastTitle = Engine[0xED84C33EC5F01EA]( 0x46CFF7C99E5DA34 ),
		toastEffect = LUI.ToastManager.ToastVisualEffect.Standard
	},
	[LUI.ShaderPreloadLayer.States.PAUSED] = {
		toastTitle = Engine[0xED84C33EC5F01EA]( 0xCDEB1619404EFD ),
		toastDescription = Engine[0xED84C33EC5F01EA]( 0x354F8F662AF22C1 ),
		toastEffect = LUI.ToastManager.ToastVisualEffect.Error
	},
	[LUI.ShaderPreloadLayer.States.COMPLETED] = {
		toastTitle = Engine[0xED84C33EC5F01EA]( 0xA38954817716314 ),
		toastDescription = Engine[0xED84C33EC5F01EA]( 0x902BC53F1F15BCB ),
		toastEffect = LUI.ToastManager.ToastVisualEffect.Positive
	}
}
LUI.ShaderPreloadLayer.init = function ( f23_arg0, f23_arg1 )
	LUI.UIElement.init( f23_arg0 )
	local f23_local0 = f23_arg1.controllerIndex
	if not f23_local0 then
		f23_local0 = Engine[0x45B054C920178E9]()
	end
	f23_arg0._controllerIndex = f23_local0
	f23_arg0.id = "ShaderPreloadLayer"
	f23_arg0._isShaderPreloadingVisible = false
end

LUI.ShaderPreloadLayer.ShouldBeVisible = function ( f22_arg0 )
	local f22_local0 = Engine[0xEE6F69FEA944B13]()
	f22_local0 = f22_local0.flowManager:GetStackTop()
	local f22_local1
	if f22_local0 then
		f22_local1 = f22_local0
	else
		f22_local1 = f22_local0.name == "CinematicFullscreen"
	end
	local f22_local2 = Engine[0x721BC4A85447B1D]()
	if f22_local2 then
		f22_local2 = Dvar[0x9E5BE3B4BBA4E0E]( 0xCBEBF14DDD4B7D8 )
	end
	if not f22_arg0._isShaderPreloadingVisible then
		local f22_local3 = ShaderUpload[0x11014FCF5F64C7B]()
		if not f22_local3 then
			f22_local3 = Dvar[0x9E5BE3B4BBA4E0E]( 0x6B27397E57381C5 )
		end
		f22_arg0._isShaderPreloadingVisible = f22_local3
	end
	local f22_local3 = ShaderUpload[0x7AD77359C50A1B9]()
	if f22_local3 then
		f22_local3 = Engine[0x12586A3F4FB490E]()
		if f22_local3 then
			if not f22_local2 then
				f22_local3 = f22_arg0._isShaderPreloadingVisible
				if f22_local3 then
					f22_local3 = not f22_local1
				end
			else
				f22_local3 = false
			end
		end
	end
	if f22_local3 and CONDITIONS.IsMobileOrMobileSim() then
		local f22_local4
		if f22_local0 then
			f22_local4 = f22_local0
		else
			f22_local4 = not f22_local0.fenced
		end
		return f22_local4
	else
		return f22_local3
	end
end

LUI.ShaderPreloadLayer.GetCurrentState = function ( f21_arg0 )
	local f21_local0 = f21_arg0._currentState
	if not f21_local0 then
		f21_local0 = LUI.ShaderPreloadLayer.States.NONE
	end
	return f21_local0
end

LUI.ShaderPreloadLayer.SetLayerPending = function ( f20_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		f20_arg0.shaderPreloadContainer:SetTop( -f0_local0, f0_local0 )
		f20_arg0.shaderPreloadContainer:SetBottom( 0, f0_local0 )
	end
	f20_arg0._currentState = LUI.ShaderPreloadLayer.States.PENDING
end

LUI.ShaderPreloadLayer.SetLayerInProgress = function ( f19_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		f19_arg0.shaderPreloadContainer:SetTop( 0, f0_local0 )
		f19_arg0.shaderPreloadContainer:SetBottom( f0_local0, f0_local0 )
		ACTIONS.AnimateSequence( f19_arg0.shaderPreloadContainer.ContentInternal, "InProgress" )
	end
	f19_arg0:UpdateProgress()
	f19_arg0._currentState = LUI.ShaderPreloadLayer.States.IN_PROGRESS
	if CONDITIONS.IsMobileOrMobileSim() then
		f19_arg0.shaderPreloadContainer:UpdateLayout( f19_arg0._currentState )
		METRICS.MobileStartShaderPreloadTimer( f19_arg0 )
	end
end

LUI.ShaderPreloadLayer.SetLayerPaused = function ( f18_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		f18_arg0.shaderPreloadContainer.ContentInternal.Text:setText( Engine[0xED84C33EC5F01EA]( 0x354F8F662AF22C1 ) )
		ACTIONS.AnimateSequence( f18_arg0.shaderPreloadContainer.ContentInternal, "Paused" )
	end
	f18_arg0._currentState = LUI.ShaderPreloadLayer.States.PAUSED
	if CONDITIONS.IsMobileOrMobileSim() then
		f18_arg0.shaderPreloadContainer:UpdateLayout( f18_arg0._currentState )
	end
end

LUI.ShaderPreloadLayer.SetLayerAborted = function ( f17_arg0, f17_arg1 )
	f17_arg0._currentState = LUI.ShaderPreloadLayer.States.ABORTED
	LUI.ToastManager.CreateToast( f17_arg1, LUI.ToastManager.StandardEmphasisToast( Engine[0xED84C33EC5F01EA]( 0xF7DCCABAAA2C8F ), Engine[0xED84C33EC5F01EA]( 0x3C2110FB5D96973 ), LUI.ToastManager.ToastNotificationType.PSO, FRIENDS.CrossTitleGameIDs.TITLE_NONE, false, LUI.ToastManager.ToastVisualEffect.Warning ) )
end

LUI.ShaderPreloadLayer.SetLayerComplete = function ( f16_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		f16_arg0.shaderPreloadContainer:CompleteSequence()
		METRICS.MobileShaderPreloadCompleted( Engine[0x45B054C920178E9](), true )
	end
	f16_arg0._currentState = LUI.ShaderPreloadLayer.States.COMPLETED
	if CONDITIONS.IsMobileOrMobileSim() then
		f16_arg0.shaderPreloadContainer:UpdateLayout( f16_arg0._currentState )
		f16_arg0._isShaderPreloadingVisible = false
	else
		f16_arg0:dispatchEventToRoot( {
			name = "telemetry_shaders_update",
			controllerIndex = f16_arg0._controllerIndex,
			currentLayerState = f16_arg0._currentState
		} )
	end
	if ShaderUpload[0x7AD77359C50A1B9]() then
		DataSources.frontEnd.psoPreload.psoPreloading:SetValue( f16_arg0._controllerIndex, false )
	end
end

LUI.ShaderPreloadLayer.SetShaderPreloadingVisible = function ( f15_arg0 )
	local f15_local0 = Engine[0xEE6F69FEA944B13]()
	f15_local0.shaderPreloadLayer._isShaderPreloadingVisible = f15_arg0
end

LUI.ShaderPreloadLayer.WarningPauseShadersToast = function ( f14_arg0 )
	Dvar[0x8EA06EEDB58D872]( 0xC252901C89DCBCB, false )
	ShaderUpload[0xF1F52191DB2BCC5]()
	if not CONDITIONS.IsSingleplayer() then
		local f14_local0 = LUI.ShaderPreloadLayer.GetLayer()
		if f14_local0 and f14_local0.UpdateProgress then
			f14_local0:UpdateProgress()
		end
	end
end

LUI.ShaderPreloadLayer.CreatePCToast = function ( f11_arg0, f11_arg1, f11_arg2 )
	local f11_local0 = f11_arg0._currentState
	local f11_local1 = LUI.ShaderPreloadLayer.PSOToastData[f11_local0]
	local f11_local2 = f11_local0 == LUI.ShaderPreloadLayer.States.COMPLETED
	if f11_local1 then
		local f11_local3 = f11_local1.toastTitle
		local f11_local4 = f11_local1.toastDescription
		local f11_local5 = f11_local1.toastEffect
		if not f11_local4 then
			f11_local4 = Engine[0xED84C33EC5F01EA]( f11_arg2 )
		end
		local f11_local6 = LUI.ToastManager.StandardEmphasisToast( f11_local3, f11_local4, LUI.ToastManager.ToastNotificationType.PSO, nil, nil, f11_local5 )
		local f11_local7 = LUI.ToastManager.ToastAction( Engine[0xED84C33EC5F01EA]( 0x216CF592197F653 ), function ( f13_arg0 )
			LUI.FlowManager.RequestAddMenu( "FullscreenPopupFrame", true, f11_arg0, false, {
				infosWidgetName = "PreloadingShadersInfos",
				title = Engine[0xED84C33EC5F01EA]( 0x2B3FA0DA88329A0 )
			} )
		end, true )
		local f11_local8
		if f11_local2 then
			f11_local8 = f0_local0
			if not f11_local8 then
			
			else
				local f11_local9 = {
					clusterID = "psoToast",
					psoColorExtend = true,
					stackingID = f11_arg2,
					dismissAction = function ()
						f11_arg0._shouldDisplayToast = false
					end
				}
				local f11_local10
				if f11_local2 then
					f11_local10 = f11_local2
				else
					f11_local10 = Engine[0xED84C33EC5F01EA]( 0x712FDA8F0FABD02, f11_local8 )
				end
				f11_local9.psoPercentage = f11_local10
				LUI.ToastManager.CreateToast( f11_arg1, f11_local6, f11_local7, nil, f11_local9 )
			end
		end
		f11_local8 = f11_arg0._percentageCompletion
	end
end

local f0_local5 = function ( f10_arg0 )
	local f10_local0 = ShaderUpload[0xC00366D65DAD0D7]()
	local f10_local1 = CONDITIONS.IsPC() and CONDITIONS.ShowShaderToastNotification() or CONDITIONS.IsMobileOrMobileSim()
	local f10_local2 = f10_local1
	if f10_local0 ~= f10_arg0._previousProcessingMode or f10_local1 then
		f10_arg0._previousProcessingMode = f10_local0
	end
	local f10_local3 = f0_local0[f10_local0]
	if CONDITIONS.IsMagmaEnabled() and not Engine[0x8B495DC361731F7]( f10_arg0._controllerIndex ) then
		if f10_local3 == 0x3E9E3379D61207E then
			f10_local3 = 0x2C94C46ED2AF0D
		elseif f10_local3 == 0x671A5C4D2BD2DDC then
			f10_local3 = 0x2C91C46ED2A9F4
		elseif f10_local3 == 0xD9FCD2E52D6DBD6 then
			f10_local3 = 0x2C92C46ED2ABA7
		end
	end
	return f10_local3, f10_local2
end

local f0_local6 = function ( f9_arg0 )
	local f9_local0, f9_local1 = f0_local0( f9_arg0 )
	local f9_local2 = LUI.DataSourceInGlobalModel.new( "frontEnd.psoPreload.PSOPreloadReason" )
	local f9_local3 = LUI.ShaderPreloadLayer.PreloadPSOReasonStringRef[f9_local2:GetValue( f9_arg0._controllerIndex )]
	if CONDITIONS.IsPC() and not CONDITIONS.IsMobileOrMobileSim() then
		local f9_local4 = f9_arg0._currentState
		local f9_local5 = f9_local4 ~= f9_arg0._lastStateDisplayed
		local f9_local6 = f9_local4 == LUI.ShaderPreloadLayer.States.IN_PROGRESS
		if f9_arg0._shouldDisplayToast == nil or f9_local5 then
			f9_arg0._shouldDisplayToast = not f9_local6
			f9_arg0._currentGameMode = f9_local0
		end
		if f9_arg0._shouldDisplayToast then
			LUI.ShaderPreloadLayer.CreatePCToast( f9_arg0, f9_arg0._controllerIndex, f9_local0 )
			f9_arg0._lastStateDisplayed = f9_arg0._currentState
		end
	else
		LUI.ToastManager.CreateToast( f9_arg0._controllerIndex, LUI.ToastManager.StandardEmphasisToast( Engine[0xED84C33EC5F01EA]( 0xE6A071E00CE2703, f9_local0 ), f9_local3, LUI.ToastManager.ToastNotificationType.PSO ) )
	end
end

local f0_local7 = function ( f8_arg0 )
	local f8_local0, f8_local1 = f0_local0( f8_arg0 )
	local f8_local2 = ShaderUpload[0x9B29261CA833723]()
	local f8_local3 = f8_arg0._currentState == LUI.ShaderPreloadLayer.States.COMPLETED
	f8_arg0._percentageCompletion = LUI.Round( f8_local2 * 100, 0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		f8_arg0.shaderPreloadContainer:UpdateProgress( f8_local0, f8_arg0._percentageCompletion )
	end
	if f8_local1 or f8_local3 then
		f0_local0( f8_arg0 )
		if CONDITIONS.IsMobileOrMobileSim() then
			f8_arg0.shaderPreloadContainer:UpdateLayout( LUI.ShaderPreloadLayer.GetCurrentState( f8_arg0 ) )
		end
	end
end

LUI.ShaderPreloadLayer.InPartyOrLobby = function ()
	local f7_local0 = 1 < #Social[0xE30C6358EF728A1]()
	local f7_local1 = Engine[0x26F7462AEAB0A8F]()
	if f7_local1 then
		f7_local1 = Tournament[0x7E86050E6607699]()
		if not f7_local1 then
			f7_local1 = LUI.FlowManager.IsInStack( "TournamentLoadingScreen" )
		end
	end
	local f7_local2 = Lobby[0xF1D2956B0C99DF6]()
	if not f7_local2 then
		f7_local2 = IsPrivateMatch() or f7_local1
	end
	local f7_local3
	if not f7_local0 then
		f7_local3 = f7_local0
	else
		f7_local3 = f7_local2
	end
	return f7_local3
end

local f0_local8 = function ( f5_arg0 )
	local self = LUI.UITimer.new( {
		event = "update_layer",
		interval = 200
	} )
	self.id = "timer"
	f5_arg0:addElement( self )
	local f5_local1
	if CONDITIONS.IsPC() and not CONDITIONS.IsMobileOrMobileSim() and not f5_arg0 then
		f5_local1 = f5_arg0
	else
		f5_local1 = f5_arg0.shaderPreloadContainer
	end
	f5_local1:registerEventHandler( "update_layer", function ( element, event )
		if f5_arg0._isShaderPreloadingVisible then
			local f6_local0 = LUI.ShaderPreloadLayer.GetCurrentState( f5_arg0 )
			local f6_local1 = ShaderUpload[0x235D0443F9C8321]()
			local f6_local2 = ShaderUpload[0x11014FCF5F64C7B]()
			if not f6_local1 and not f6_local2 then
				LUI.ShaderPreloadLayer.SetLayerComplete( f5_arg0 )
				f5_arg0:UpdateProgress()
			elseif f6_local1 and f6_local2 then
				if f6_local0 ~= LUI.ShaderPreloadLayer.States.IN_PROGRESS then
					LUI.ShaderPreloadLayer.SetLayerInProgress( f5_arg0 )
				end
				if CONDITIONS.IsPC() and not CONDITIONS.IsMobileOrMobileSim() then
					element:dispatchEventToRoot( {
						name = "telemetry_shaders_update",
						controllerIndex = f5_arg0._controllerIndex,
						currentLayerState = LUI.ShaderPreloadLayer.GetCurrentState( element )
					} )
				end
				f5_arg0:UpdateProgress()
			elseif not CONDITIONS.IsMobileOrMobileSim() and ShaderUpload[0xE5B87EBD95D1F60]() then
				if LUI.ShaderPreloadLayer.GetCurrentState( f5_arg0 ) ~= LUI.ShaderPreloadLayer.States.ABORTED then
					LUI.ShaderPreloadLayer.SetLayerAborted( f5_arg0, f5_arg0._controllerIndex )
				end
			else
				local f6_local3
				if f6_local0 == LUI.ShaderPreloadLayer.States.PENDING then
					f6_local3 = LUI.ShaderPreloadLayer.InPartyOrLobby()
				else
					f6_local3 = false
				end
				if f6_local0 == LUI.ShaderPreloadLayer.States.IN_PROGRESS or f6_local3 then
					if f6_local2 then
						LUI.ShaderPreloadLayer.SetLayerPaused( f5_arg0, f6_local3 )
					else
						LUI.ShaderPreloadLayer.SetLayerComplete( f5_arg0 )
					end
					if CONDITIONS.IsPC() and not CONDITIONS.IsMobileOrMobileSim() then
						f5_arg0:UpdateProgress()
						element._currentGameMode = nil
						element:dispatchEventToRoot( {
							name = "telemetry_shaders_update",
							controllerIndex = element._controllerIndex,
							currentLayerState = LUI.ShaderPreloadLayer.GetCurrentState( element )
						} )
					end
				end
			end
			if Dvar[0x9E5BE3B4BBA4E0E]( 0x6B27397E57381C5 ) ~= nil then
				DataSources.frontEnd.psoPreload.psoPreloading:SetValue( f5_arg0._controllerIndex, Dvar[0x9E5BE3B4BBA4E0E]( 0x6B27397E57381C5 ) )
				LUI.ShaderPreloadLayer.SetLayerInProgress( f5_arg0 )
			end
		end
	end )
end

LUI.ShaderPreloadLayer.InitLayer = function ( f4_arg0 )
	if CONDITIONS.IsMobileOrMobileSim() then
		local f4_local0 = MenuBuilder.BuildRegisteredType( "PreloadingShadersContentMobile", {
			controllerIndex = f4_arg0._controllerIndex
		} )
		f4_local0.id = "PreloadingShadersContent"
		f4_local0:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, -f0_local0 / 2, f0_local0 / 2, -f0_local0, 0 )
		f4_arg0:addElement( f4_local0 )
		f4_arg0.shaderPreloadContainer = f4_local0
	end
	LUI.ShaderPreloadLayer.SetLayerPending( f4_arg0 )
	f0_local0( f4_arg0 )
	f0_local0[CoD.PlayMode.Core] = 0x3E9E3379D61207E
	f0_local0[CoD.PlayMode.Aliens] = 0x671A5C4D2BD2DDC
	f0_local0[CoD.PlayMode.SP] = 0x671A5C4D2BD2DDC
	f4_arg0._previousProcessingMode = ShaderUpload[0xC00366D65DAD0D7]()
	f0_local0( f4_arg0 )
	f4_arg0.UpdateProgress = f0_local0
	if ShaderUpload[0x7AD77359C50A1B9]() then
		DataSources.frontEnd.psoPreload.psoPreloading:SetValue( f4_arg0._controllerIndex, true )
	end
end

LUI.ShaderPreloadLayer.ClearLayer = function ( f2_arg0, f2_arg1 )
	if f2_arg0._currentState ~= LUI.ShaderPreloadLayer.States.PENDING and f2_arg0.clearLayerTimer == nil then
		LUI.ShaderPreloadLayer.SetLayerPending( f2_arg0 )
		
		local clearLayerTimer = LUI.UITimer.new( {
			event = "clear_layer",
			interval = f0_local0
		} )
		f2_arg0:addElement( clearLayerTimer )
		f2_arg0.clearLayerTimer = clearLayerTimer
		
		f2_arg0:registerEventHandler( "clear_layer", function ()
			if f2_arg0.clearLayerTimer ~= nil then
				f2_arg0.clearLayerTimer:closeTree()
				f2_arg0.clearLayerTimer = nil
			end
			if f2_arg0.shaderPreloadContainer then
				f2_arg0:closeChildren()
				f2_arg0.shaderPreloadContainer = nil
			end
		end )
	end
end

LUI.ShaderPreloadLayer.GetLayer = function ()
	local f1_local0 = Engine[0xEE6F69FEA944B13]()
	return f1_local0.shaderPreloadLayer
end

