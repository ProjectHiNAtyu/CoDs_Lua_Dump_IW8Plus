-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 13-10-2025 14:16
module( ..., package.seeall )
local f0_local0 = 330
local f0_local1 = 200
local f0_local2 = 184
local f0_local3 = 30
local f0_local4 = 300
local f0_local5 = f0_local1
local f0_local6 = f0_local2 - f0_local3
local f0_local7 = 94
local f0_local8 = 84
local f0_local9 = 424
local f0_local10 = 337
local f0_local11 = f0_local5 - 463 + 453
local f0_local12 = 490
local f0_local13 = 424
local f0_local14 = 357
local f0_local15 = 460
local f0_local16 = 300
local f0_local17 = {
	nil,
	6,
	10,
	16
}
local f0_local18 = {
	nil,
	6,
	10,
	16
}
local f0_local19 = function ( f28_arg0, f28_arg1 )
	for f28_local3, f28_local4 in ipairs( f28_arg0._progressionRows ) do
		if f28_local4._weaponRef == f28_arg1 then
			return f28_local3
		end
	end
end

local f0_local20 = function ( f27_arg0, f27_arg1 )
	local f27_local0 = f27_arg0._WeaponLists[f27_arg1]
	if f27_arg0._currentFocus then
		f27_arg0._currentFocus.ProgressionList:dispatchEventToChildren( {
			isFocused = false,
			name = "gunsmith_update_focus"
		} )
		f27_arg0._currentFocus.ProgressionList:FocusFirstItem()
		f27_arg0._currentFocus.GunsmithProgressionWeapon:SetFocus( false )
		f27_arg0._currentFocus:processEvent( {
			name = "lose_focus"
		} )
	end
	f27_local0.ProgressionList:dispatchEventToChildren( {
		isFocused = true,
		name = "gunsmith_update_focus"
	} )
	f27_local0.GunsmithProgressionWeapon:SetFocus( true )
	f27_local0:processEvent( {
		name = "gain_focus"
	} )
	f27_arg0._currentFocus = f27_local0
end

local f0_local21 = function ( f26_arg0, f26_arg1 )
	if f26_arg1 < 1 or f26_arg0._weaponCount < f26_arg1 then
		return 
	end
	local f26_local0 = f26_arg0._progressionRows[f26_arg1]._weaponRef
	local f26_local1 = {}
	for f26_local5, f26_local6 in pairs( f26_arg0._parentWeaponRefs ) do
		if f26_local6 == f26_local0 then
			table.insert( f26_local1, f26_local5 )
		end
	end
	f26_local2 = f26_arg0._parentWeaponRefs[f26_local0]
	for f26_local3 = 1, #f26_arg0._progressionRows, 1 do
		if f26_arg1 - 2 >= f26_local3 or f26_local3 >= f26_arg1 + 2 or not LUI.Visibility.Visible then
			local f26_local7 = LUI.Visibility.Hidden
		end
		if LUI.IsItemInArray( f26_local1, f26_arg0._progressionRows[f26_local3]._weaponRef ) then
			local f26_local8 = LUI.Visibility.Visible
			if not f26_local8 then
				local f26_local7 = f26_local8
			else
				
			end
		end
		if f26_arg0._progressionRows[f26_local3]._weaponRef == f26_local2 then
			local f26_local8 = LUI.Visibility.Visible
			if not f26_local8 then
				local f26_local7 = f26_local8
			else
				
			end
		end
		f26_arg0._progressionRows[f26_local3]:SetVisibility( f26_local7 )
	end
end

local f0_local22 = function ( f25_arg0, f25_arg1, f25_arg2, f25_arg3, f25_arg4 )
	local f25_local0, f25_local1, f25_local2, f25_local3 = f25_arg0._progressionRows[f25_arg0._currentRow]:getLocalRect()
	if f0_local0 < f25_local0 + f25_arg2 or f25_local2 + f25_arg2 < f0_local0 + f0_local0 + f0_local0 - f0_local0 then
		return 
	elseif f25_arg0 and f25_arg0._progressionRows then
		for f25_local4 = 1, #f25_arg0._progressionRows, 1 do
			local f25_local7 = f25_arg0._progressionRows[f25_local4]
			local f25_local8, f25_local9, f25_local10, f25_local11 = f25_local7:getLocalRect()
			local f25_local12 = f25_local7
			local f25_local13 = f25_local7.SetAnchorsAndPosition
			local f25_local14 = 0
			local f25_local15 = 1
			local f25_local16 = 0
			local f25_local17 = 1
			local f25_local18 = f25_local8 + f25_arg2
			local f25_local19 = f25_local10 + f25_arg2
			local f25_local20 = f25_local9 + f25_arg3
			local f25_local21 = f25_local11 + f25_arg3
			local f25_local22
			if not f25_arg4 then
				f25_local22 = f25_arg4
			else
				f25_local22 = 0
			end
			f25_local13( f25_local12, f25_local14, f25_local15, f25_local16, f25_local17, f25_local18, f25_local19, f25_local20, f25_local21, f25_local22 )
		end
	end
end

local f0_local23 = function ( f21_arg0, f21_arg1 )
	local f21_local0 = function ( f24_arg0, f24_arg1 )
		if f24_arg0._drag then
			f24_arg0._curMouseUnitX, f24_arg0._curMouseUnitY = f24_arg1.root:PixelsToUnits( f24_arg1.x, f24_arg1.y )
			local f24_local0 = f24_arg0._curMouseUnitX - f24_arg0._preMouseUnitX
			local f24_local1 = f24_arg0._curMouseUnitY - f24_arg0._preMouseUnitY
			f21_arg0( f24_arg0, f21_arg0, f24_local0, 0 )
			f24_arg0._preMouseUnitX = f24_arg0._curMouseUnitX
			f24_arg0._preMouseUnitY = f24_arg0._curMouseUnitY
		elseif f24_arg0._down then
			f24_arg0._curMouseUnitX, f24_arg0._curMouseUnitY = f24_arg1.root:PixelsToUnits( f24_arg1.x, f24_arg1.y )
			f24_arg0._preMouseUnitX, f24_arg0._preMouseUnitY = f24_arg1.root:PixelsToUnits( f24_arg1.x, f24_arg1.y )
			f24_arg0._drag = true
		end
	end
	
	local f21_local1 = function ( f23_arg0, f23_arg1 )
		f23_arg0._down = true
	end
	
	local f21_local2 = function ( f22_arg0, f22_arg1 )
		f22_arg0._down = false
		f22_arg0._drag = false
	end
	
	f21_arg0:SetHandleMouse( true )
	f21_arg0:registerEventHandler( "leftmousedown", f21_local1 )
	f21_arg0:registerEventHandler( "leftmouseup", f21_local2 )
	f21_arg0:registerEventHandler( "mouse_capture_lost", f21_local2 )
	f21_arg0:registerEventHandler( "mousedrag", f21_local0 )
end

local f0_local24 = function ( f20_arg0, f20_arg1 )
	for f20_local7, f20_local8 in pairs( f20_arg0._WeaponLists ) do
		local f20_local9 = f20_arg0._parentWeaponRefs[f20_local7]
		if f20_local9 then
			local f20_local3 = f0_local0 * _1080p
			if f20_arg1 then
				local f20_local4 = f20_local8
				local f20_local5 = f20_local8.SetLeft
				local f20_local6 = f20_local8:GetAnchorsAndPosition()
				f20_local5( f20_local4, f20_local6.left + f20_local3 )
				if not f20_arg0._parentWeaponRefs[f20_local9] then
					f20_local5 = f20_local8.GunsmithProgressionWeapon.UnlockLines
					f20_local4 = f20_local5
					f20_local5 = f20_local5.SetRight
					f20_local6 = f20_local8.GunsmithProgressionWeapon.UnlockLines:GetAnchorsAndPosition()
					f20_local5( f20_local4, f20_local6.right - f20_local3 )
				end
			end
			local f20_local4 = f20_local8
			local f20_local5 = f20_local8.SetLeft
			local f20_local6 = f20_local8:GetAnchorsAndPosition()
			f20_local5( f20_local4, f20_local6.left - f20_local3 )
			if not f20_arg0._parentWeaponRefs[f20_local9] then
				f20_local5 = f20_local8.GunsmithProgressionWeapon.UnlockLines
				f20_local4 = f20_local5
				f20_local5 = f20_local5.SetRight
				f20_local6 = f20_local8.GunsmithProgressionWeapon.UnlockLines:GetAnchorsAndPosition()
				f20_local5( f20_local4, f20_local6.right + f20_local3 )
			end
		end
	end
end

local f0_local25 = function ( f19_arg0, f19_arg1, f19_arg2 )
	local f19_local0 = f19_arg2.weaponRef
	local f19_local1 = f19_arg2.yOffset
	local f19_local2 = nil
	f19_local2 = MenuBuilder.BuildRegisteredType( "GunsmithProgressionRow", {
		controllerIndex = f19_arg1
	} )
	f19_local2.id = "GunsmithProgressionRow" .. f19_arg0._weaponCount
	f19_local2:SetProgressionRowData( f19_local0, f19_arg2.progressionUnlocks, f19_local1 )
	f19_arg0:addElement( f19_local2 )
	local f19_local3 = f19_local2.GunsmithProgressionWeapon
	local f19_local4 = f19_arg2.weaponUnlockLayoutNum or 0
	local f19_local5 = f19_arg2.xOffset + (f19_local4 * f0_local0 + f19_local4 * 16) / 2 + f0_local0
	local f19_local6 = #f19_local2._progressionUnlocks * f0_local0 + (#f19_local2._progressionUnlocks - 1) * 16
	f19_local2:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * (f0_local0 + f19_local5), _1080p * (f0_local0 + f19_local5 + f19_local6), _1080p * (f0_local0 + f19_local1), _1080p * (f0_local0 + f0_local0 + f19_local1) )
	local f19_local7 = f19_local2.ProgressionList
	local f19_local8 = f19_local7
	f19_local7 = f19_local7.SetRight
	local f19_local9 = f19_local2.ProgressionList:GetAnchorsAndPosition()
	f19_local7( f19_local8, f19_local9.left + f19_local6 * _1080p )
	f19_local7 = f19_local2.ProgressBar
	f19_local8 = f19_local7
	f19_local7 = f19_local7.SetRight
	f19_local9 = f19_local2.ProgressionList:GetAnchorsAndPosition()
	f19_local7( f19_local8, f19_local9.left + f19_local6 * _1080p )
	if f19_local4 == 0 then
		f19_local3.UnlockLines:SetVisible( false )
	end
	f19_local7 = f19_local3.UnlockLines:GetAnchorsAndPosition()
	f19_local7 = f19_local7.left + (f19_local4 * f0_local0 + f19_local4 * 16) / 2 - 30
	local f19_local10
	if f19_arg2.isLineUp then
		f19_local10 = -1
	else
		f19_local10 = 1
	end
	if not f19_arg2.isLineUp then
		ACTIONS.AnimateSequence( f19_local3, "UnlockedFromUnder" )
		ACTIONS.AnimateSequence( f19_local3, "UnFocusedFromUnder" )
		f19_local3._unlockedFromUnder = true
	end
	f19_local3.UnlockLines:SetRight( f19_local7 * _1080p )
	f19_local8 = f19_local3.UnlockLines
	local f19_local11 = f19_local8
	f19_local8 = f19_local8.SetTop
	local f19_local12 = _1080p
	local f19_local13
	if f19_arg2.isLineUp then
		f19_local13 = 0
	else
		f19_local13 = 150
	end
	f19_local8( f19_local11, f19_local12 * (f19_local13 + f19_local10 * f0_local0 / 1.55) )
	f19_local8 = f19_local4
	f19_local9 = f19_arg0["weaponRef" .. f19_arg2.parentIndex]
	f19_arg0._parentWeaponRefs[f19_local0] = f19_local9
	f19_local3:Setup( f19_arg1, f19_local0, f19_arg2.isWeaponLocked, f19_local9, f19_arg2.weaponUnlockLevel )
	f19_arg0._WeaponLists[f19_local0] = f19_local2
	table.insert( f19_arg0._progressionRows, f19_local2 )
	f19_local11 = PROGRESSION.GetMaxWeaponLevel( f19_local0 )
	f19_local12 = PROGRESSION.GetWeaponProgress( f19_arg1, f19_local0 )
	if f19_local12 then
		f19_local13 = f19_local12.xp
		if not f19_local13 then
		
		else
			local f19_local14 = PROGRESSION.GetWeaponLevelMinXP( f19_arg1, f19_local0, f19_local11 )
			f19_local2.ProgressBar.curWeaponProgression = f19_local13
			f19_local2.ProgressBar.maxWeaponProgression = f19_local14
			f19_local2.ProgressBar:SetImmediateProgress( LUI.clamp( f19_local13 / f19_local14, 0, 1 ) )
			return f19_local5, f19_local1, f19_arg0._weaponCount
		end
	end
	f19_local13 = 0
end

local f0_local26 = function ( f17_arg0, f17_arg1 )
	table.sort( f17_arg0._progressionRows, function ( f18_arg0, f18_arg1 )
		return f18_arg0._yOffset < f18_arg1._yOffset
	end )
end

local f0_local27 = function ( f15_arg0, f15_arg1, f15_arg2 )
	f15_arg0._inVerticalTransition = true
	f0_local0( f15_arg0, f15_arg1 )
	local f15_local0, f15_local1, f15_local2, f15_local3 = f15_arg0._progressionRows[f15_arg0._currentRow]:getLocalRect()
	f0_local0( f15_arg0, f15_arg2, f0_local0 - f15_local0, f0_local0 - f15_local1, f0_local0 )
	local f15_local4 = f15_arg0:Wait( f0_local0, true )
	f15_local4.onComplete = function ()
		f15_arg0._inVerticalTransition = false
		f15_arg0._isMouseWheelNavBlocked = false
	end
	
end

local f0_local28 = function ( f14_arg0, f14_arg1, f14_arg2 )
	f14_arg0._defaultIndex = 1
	for f14_local0 = 1, #f14_arg0._progressionRows, 1 do
		if f14_arg2 == f14_arg0._progressionRows[f14_local0]._weaponRef then
			f14_arg0._defaultIndex = f14_local0
		end
	end
	f14_arg0._currentRow = f14_arg0._defaultIndex
	f0_local0( f14_arg0, f14_arg2, f14_arg1 )
	f0_local0( f14_arg0, f14_arg0._defaultIndex )
end

local f0_local29 = function ( f13_arg0 )
	f13_arg0:dispatchEventToParent( {
		unlockLevel = 0,
		name = "progression_button_over",
		weaponRef = f13_arg0._progressionRows[f13_arg0._currentRow]._weaponRef
	} )
end

local f0_local30 = function ( f12_arg0, f12_arg1, f12_arg2 )
	f12_arg0._weaponCount = f12_arg0._weaponCount + 1
	f12_arg0["weaponRef" .. f12_arg0._weaponCount] = f12_arg2.weaponRef
	return f0_local0( f12_arg0, f12_arg1, f12_arg2 )
end

local f0_local31 = function ( f9_arg0, f9_arg1 )
	local f9_local0 = function ( f10_arg0, f10_arg1 )
		if f9_arg0._enabled then
			local f10_local0 = f9_arg0._progressionRows[f10_arg0._currentRow]
			local f10_local1 = f10_local0.ProgressionList
			local f10_local2 = f10_local0.GunsmithProgressionWeapon
			local f10_local3 = f10_local1:GetFocusPositionIndex()
			if f10_arg1.down then
				local f10_local4 = false
				local f10_local5 = false
				local f10_local6 = false
				local f10_local7 = Dvar[0x9E5BE3B4BBA4E0E]( 0x55F73AE8B3D94CA )
				local f10_local8
				if f10_local7 then
					f10_local8 = f10_local7
				else
					f10_local8 = LUI.IsLastInputMouseNavigation( f9_arg0 )
					if f10_local8 then
						f10_local8 = CONDITIONS.IsMouseWheelEvent( f10_arg1 )
					end
				end
				if f10_local7 and CONDITIONS.IsMouseWheelEvent( f10_arg1 ) and not f10_arg0._isMouseWheelNavBlocked then
					if f10_arg1.button == "up" then
						f10_local6 = true
					elseif f10_arg1.button == "down" then
						f10_local5 = true
					end
					f10_arg0._isMouseWheelNavBlocked = true
					local f10_local9 = f10_arg0:Wait( f9_arg0, true )
					f10_local9.onComplete = function ()
						f10_arg0._isMouseWheelNavBlocked = false
						f10_arg0._inVerticalTransition = false
					end
					
				elseif f10_arg1.button == "left" and f10_local3 and f10_local3 == 0 then
					f10_local2:processEvent( {
						name = "gain_focus"
					} )
					f10_local1:processEvent( {
						name = "lose_focus"
					} )
				elseif f10_arg1.button == "left" and f10_local3 then
					for f10_local12, f10_local13 in pairs( f9_arg0 ) do
						if f10_local13 == f10_local3 then
							f10_local6 = true
						end
					end
				elseif f10_arg1.button == "right" and f10_local3 then
					for f10_local12, f10_local13 in pairs( f9_arg0 ) do
						if f10_local13 == f10_local3 then
							f10_local5 = true
						end
					end
				elseif f10_arg1.button == "down" and not f10_local8 and not f10_arg0._inVerticalTransition then
					if f9_arg0._currentRow < f9_arg0._weaponCount then
						f9_arg0._currentRow = f9_arg0._currentRow + 1
						f10_local4 = true
					end
				elseif f10_arg1.button == "up" and not f10_local8 and not f10_arg0._inVerticalTransition and 1 < f9_arg0._currentRow then
					f9_arg0._currentRow = f9_arg0._currentRow - 1
					f10_local4 = true
				end
				if f10_local4 then
					f9_arg0( f10_arg0, f9_arg0._progressionRows[f10_arg0._currentRow]._weaponRef, f9_arg0 )
					f9_arg0( f9_arg0, f9_arg0._currentRow )
				end
				if f10_local5 then
					f9_arg0( f10_arg0, f9_arg0, -500, 0, f9_arg0 )
				end
				if f10_local6 then
					f9_arg0( f10_arg0, f9_arg0, 500, 0, f9_arg0 )
				end
				f9_arg0( f10_arg0 )
			end
		end
	end
	
	f9_arg0:addEventHandler( "gamepad_button", f9_local0 )
	if Dvar[0x9E5BE3B4BBA4E0E]( 0x55F73AE8B3D94CA ) then
		f9_arg0:addEventHandler( "gunsmith_mouse_nav", f9_local0 )
	end
end

local f0_local32 = function ( f7_arg0, f7_arg1 )
	f7_arg0:addEventHandler( "OnMiniNavBarButtonAction", function ( f8_arg0, f8_arg1 )
		if f7_arg0._enabled then
			f7_arg0._currentRow = f7_arg0( f8_arg0, f8_arg1.weaponRef )
			f7_arg0( f8_arg0, f8_arg1.weaponRef, f7_arg0 )
			f7_arg0( f8_arg0, f8_arg0._currentRow )
			f7_arg0:dispatchEventToRoot( {
				name = "UpdateGunsmithNavArrows"
			} )
			local f8_local0 = f7_arg0._currentRow == 1
			local f8_local1 = f7_arg0._currentRow == f7_arg0._weaponCount
			local f8_local2 = f7_arg0:getParent()
			f8_local2.PreviousNav:SetVisible( not f8_local0 )
			f8_local2.PreviousNav:SetMouseFocusBlocker( f8_local0 )
			f8_local2.NextNav:SetVisible( not f8_local1 )
			f8_local2.NextNav:SetMouseFocusBlocker( f8_local1 )
		else
			f7_arg0:dispatchEventToCurrentMenu( {
				menuType = 2,
				name = "progression_switch_menus",
				weaponRef = f8_arg1.weaponRef
			} )
		end
		return true
	end )
end

local f0_local33 = function ( f6_arg0, f6_arg1 )
	f6_arg0._enabled = f6_arg1
end

local f0_local34 = function ( f4_arg0, f4_arg1 )
	f4_arg0:SubscribeToInputTypeModel( f4_arg1, function ( f5_arg0, f5_arg1 )
		if f5_arg1._currentFocus and not LUI.IsLastInputMouseNavigation( f4_arg0 ) then
			ACTIONS.GainFocus( f5_arg1, "_currentFocus", f4_arg0 )
			local f5_local0 = f5_arg1:getParent()
			if f5_local0 then
				local f5_local1 = f5_local0.PreviousNav
				local f5_local2 = f5_local0.NextNav
				ACTIONS.LoseFocus( f5_local1, f5_local1.id, f4_arg0 )
				ACTIONS.LoseFocus( f5_local2, f5_local2.id, f4_arg0 )
			end
		end
	end )
end

local f0_local35 = function ( f3_arg0 )
	for f3_local3, f3_local4 in ipairs( f3_arg0._progressionRows ) do
		f3_local4:Initialize()
	end
end

local f0_local36 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0._weaponCount = 0
	f2_arg0._progressionRows = {}
	f2_arg0._WeaponLists = {}
	f2_arg0._parentWeaponRefs = {}
	f2_arg0.SetupProgressionUnlocks = f0_local0
	f2_arg0.SetupDefaultFocus = f0_local0
	f2_arg0.SortProgressionUnlocksElements = f0_local0
	f2_arg0.SetEnabled = f0_local0
	f2_arg0.InitRows = f0_local0
	f2_arg0.ApplyAdditionalOffsetToProgressionRows = f0_local0
	f0_local0( f2_arg0, f2_arg1 )
	f0_local0( f2_arg0, f2_arg1 )
	if not Dvar[0x9E5BE3B4BBA4E0E]( 0x55F73AE8B3D94CA ) or CONDITIONS.IsMobileOrMobileSim() then
		f0_local0( f2_arg0, f2_arg1 )
	else
		f2_arg0:SetHandleMouse( true )
	end
	f0_local0( f2_arg0, f2_arg1 )
end

function GunsmithProgressionPanel( menu, controller )
	local self = LUI.UIElement.new()
	self:SetAnchorsAndPosition( 0, 1, 0, 1, 0, 1920 * _1080p, 0, 1080 * _1080p )
	self.id = "GunsmithProgressionPanel"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	self:setUseStencil( true )
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "GunsmithProgressionPanel", GunsmithProgressionPanel )
LockTable( _M )
