-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 27-09-2025 22:41
LUI.ShaderPreloadLayer = LUI.Class( LUI.UIElement )
local f0_local0 = 800
local f0_local1 = 40
local f0_local2 = 300
local f0_local3 = {}
LUI.ShaderPreloadLayer.States = {
	COMPLETED = 4,
	IN_PROGRESS = 2,
	PAUSED = 3,
	PENDING = 1
}
LUI.ShaderPreloadLayer.init = function ( f16_arg0, f16_arg1 )
	LUI.UIElement.init( f16_arg0 )
	local f16_local0 = f16_arg1.controllerIndex
	if not f16_local0 then
		f16_local0 = Engine.IJEBHJIJF()
	end
	f16_arg0._controllerIndex = f16_local0
	f16_arg0.id = "ShaderPreloadLayer"
	f16_arg0._isShaderPreloadingVisible = false
end

LUI.ShaderPreloadLayer.ShouldBeVisible = function ( f15_arg0 )
	local f15_local0 = Engine.DBFFAEEFGJ()
	f15_local0 = f15_local0.flowManager:GetStackTop()
	local f15_local1
	if f15_local0 then
		f15_local1 = f15_local0
	else
		f15_local1 = f15_local0.name == "CinematicFullscreen"
	end
	local f15_local2 = Engine.DIEEIEFCFF()
	if f15_local2 then
		f15_local2 = Dvar.IBEGCHEFE( "MRTNMPRLKR" )
	end
	if not f15_arg0._isShaderPreloadingVisible then
		f15_arg0._isShaderPreloadingVisible = ShaderUpload.CEIBACCEAF()
	end
	local f15_local3 = Engine.CGABICJHAI()
	if f15_local3 then
		f15_local3 = Engine.DDJFBBJAIG()
		if f15_local3 then
			if not f15_local2 then
				f15_local3 = f15_arg0._isShaderPreloadingVisible
				if f15_local3 then
					f15_local3 = not f15_local1
				end
			else
				f15_local3 = false
			end
		end
	end
	return f15_local3
end

LUI.ShaderPreloadLayer.GetCurrentState = function ( f14_arg0 )
	local f14_local0 = f14_arg0._currentState
	if not f14_local0 then
		f14_local0 = LUI.ShaderPreloadLayer.States.NONE
	end
	return f14_local0
end

LUI.ShaderPreloadLayer.SetLayerPending = function ( f13_arg0 )
	local f13_local0 = Engine.DBFFAEEFGJ()
	f13_arg0.shaderPreloadContainer:SetTop( -f0_local0 * _1080p, f0_local0 )
	f13_arg0.shaderPreloadContainer:SetBottom( 0, f0_local0 )
	if f13_local0.clearCacheLayer then
		local f13_local1 = f13_local0.clearCacheLayer.clearCacheProgressBanner
		if f13_local1 and f13_local1.isClearCacheBannerVisible then
			f13_local1:MoveBanner( CLEAR_CACHE_BANNER.HEIGHT * _1080p, 2 * CLEAR_CACHE_BANNER.HEIGHT * _1080p, CLEAR_CACHE_BANNER.SLIDE_IN_OUT_TIME )
		end
	end
	f13_arg0._currentState = LUI.ShaderPreloadLayer.States.PENDING
end

LUI.ShaderPreloadLayer.SetLayerInProgress = function ( f12_arg0 )
	f12_arg0.shaderPreloadContainer:SetTop( 0, f0_local0 )
	f12_arg0.shaderPreloadContainer:SetBottom( f0_local0 * _1080p, f0_local0 )
	ACTIONS.AnimateSequence( f12_arg0.shaderPreloadContainer.ContentInternal, "InProgress" )
	f12_arg0:UpdateProgress()
	f12_arg0._currentState = LUI.ShaderPreloadLayer.States.IN_PROGRESS
	f12_arg0.shaderPreloadContainer:UpdateLayout( f12_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetLayerPaused = function ( f11_arg0 )
	f11_arg0.shaderPreloadContainer.ContentInternal.Text:setText( Engine.CBBHFCGDIC( "LUA_MENU_PC/SHADER_DURING_GAMEPLAY" ) )
	ACTIONS.AnimateSequence( f11_arg0.shaderPreloadContainer.ContentInternal, "Paused" )
	f11_arg0._currentState = LUI.ShaderPreloadLayer.States.PAUSED
	f11_arg0.shaderPreloadContainer:UpdateLayout( f11_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetLayerComplete = function ( f10_arg0 )
	f10_arg0.shaderPreloadContainer:CompleteSequence()
	f10_arg0._currentState = LUI.ShaderPreloadLayer.States.COMPLETED
	f10_arg0.shaderPreloadContainer:UpdateLayout( f10_arg0._currentState )
end

LUI.ShaderPreloadLayer.SetShaderPreloadingVisible = function ( f9_arg0 )
	local f9_local0 = Engine.DBFFAEEFGJ()
	f9_local0.shaderPreloadLayer._isShaderPreloadingVisible = f9_arg0
end

local f0_local4 = function ( f8_arg0 )
	local f8_local0 = ShaderUpload.DIHHGIFAIB()
	local f8_local1 = false
	if f8_local0 ~= f8_arg0._previousProcessingMode then
		f8_arg0._previousProcessingMode = f8_local0
		f8_local1 = true
	end
	local f8_local2 = f0_local0[f8_local0]
	if CONDITIONS.IsMagmaEnabled() and not Engine.CFHBIHABCB( f8_arg0._controllerIndex ) then
		if f8_local2 == "MENU/MULTIPLAYER" then
			f8_local2 = "LUA_MENU/PACK1"
		elseif f8_local2 == "MENU/CAMPAIGN" then
			f8_local2 = "LUA_MENU/PACK2"
		elseif f8_local2 == "LUA_MENU/TAC_OPS" then
			f8_local2 = "LUA_MENU/PACK3"
		end
	end
	return f8_local2, f8_local1
end

local f0_local5 = function ( f7_arg0 )
	local f7_local0, f7_local1 = f0_local0( f7_arg0 )
	f7_arg0.shaderPreloadContainer:UpdateProgress( f7_local0, LUI.Round( ShaderUpload.EAACFJBCIB() * 100, 0 ) )
	if f7_local1 then
		f7_arg0.shaderPreloadContainer:UpdateLayout( LUI.ShaderPreloadLayer.GetCurrentState( f7_arg0 ) )
	end
end

local f0_local6 = function ( f5_arg0 )
	local self = LUI.UITimer.new( {
		event = "update_layer",
		interval = 200
	} )
	self.id = "timer"
	f5_arg0:addElement( self )
	f5_arg0.shaderPreloadContainer:registerEventHandler( "update_layer", function ( element, event )
		if f5_arg0._isShaderPreloadingVisible then
			if ShaderUpload.DDBFFCFJJJ() then
				if LUI.ShaderPreloadLayer.GetCurrentState( f5_arg0 ) ~= LUI.ShaderPreloadLayer.States.IN_PROGRESS then
					LUI.ShaderPreloadLayer.SetLayerInProgress( f5_arg0 )
				end
				f5_arg0:UpdateProgress()
			elseif not ShaderUpload.DDBFFCFJJJ() and LUI.ShaderPreloadLayer.GetCurrentState( f5_arg0 ) == LUI.ShaderPreloadLayer.States.IN_PROGRESS then
				if ShaderUpload.CEIBACCEAF() then
					LUI.ShaderPreloadLayer.SetLayerPaused( f5_arg0 )
				else
					LUI.ShaderPreloadLayer.SetLayerComplete( f5_arg0 )
				end
			end
		end
	end )
end

LUI.ShaderPreloadLayer.InitLayer = function ( f4_arg0 )
	local shaderPreloadContainer = MenuBuilder.BuildRegisteredType( "PreloadingShadersContent", {
		controllerIndex = f4_arg0._controllerIndex
	} )
	shaderPreloadContainer.id = "PreloadingShadersContent"
	shaderPreloadContainer:SetAnchorsAndPosition( 0.5, 0.5, 0, 1, _1080p * -f0_local0 / 2, _1080p * f0_local0 / 2, -f0_local0 * _1080p, 0 )
	f4_arg0:addElement( shaderPreloadContainer )
	f4_arg0.shaderPreloadContainer = shaderPreloadContainer
	
	LUI.ShaderPreloadLayer.SetLayerPending( f4_arg0 )
	f0_local0( f4_arg0 )
	f0_local0[CoD.PlayMode.Core] = "MENU/MULTIPLAYER"
	f0_local0[CoD.PlayMode.Aliens] = "LUA_MENU/TAC_OPS"
	f0_local0[CoD.PlayMode.SP] = "MENU/CAMPAIGN"
	f4_arg0._previousProcessingMode = ShaderUpload.DIHHGIFAIB()
	f4_arg0.UpdateProgress = f0_local0
end

LUI.ShaderPreloadLayer.ClearLayer = function ( f2_arg0, f2_arg1 )
	if f2_arg0.shaderPreloadContainer then
		LUI.ShaderPreloadLayer.SetLayerPending( f2_arg0 )
		
		local clearLayerTimer = LUI.UITimer.new( {
			event = "clear_layer",
			interval = f0_local0
		} )
		f2_arg0:addElement( clearLayerTimer )
		f2_arg0.clearLayerTimer = clearLayerTimer
		
		f2_arg0:registerEventHandler( "clear_layer", function ()
			if f2_arg0.clearLayerTimer ~= nil then
				f2_arg0.clearLayerTimer:closeTree()
				f2_arg0.clearLayerTimer = nil
			end
			f2_arg0:closeChildren()
			f2_arg0.shaderPreloadContainer = nil
		end )
	end
end

LUI.ShaderPreloadLayer.GetLayer = function ()
	local f1_local0 = Engine.DBFFAEEFGJ()
	return f1_local0.shaderPreloadLayer
end

