-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 02-09-2025 10:42
module( ..., package.seeall )
FencePlaylists = LUI.Class( LUI.Fence )
FencePlaylists.state = {
	UP_TO_DATE = 2,
	NEED_UPDATE = 0,
	UPDATING = 1
}
FencePlaylists.init = function ( f9_arg0 )
	FencePlaylists.super.init( f9_arg0 )
end

FencePlaylists.Start = function ( f8_arg0 )
	DebugPrint( "FencePlaylists.Start" )
	f8_arg0._userCancelled = false
end

FencePlaylists.Stop = function ( f7_arg0 )
	DebugPrint( "FencePlaylists.Stop" )
	LUI.FlowManager.RequestLeaveMenuByName( "UpdatingPlaylists", true )
	LUI.FlowManager.RequestLeaveMenuByName( "OutdatedPlaylists", true )
end

FencePlaylists.PostFail = function ( f6_arg0 )
	if f6_arg0._state == LUI.Fence.STATE.fail and not f6_arg0._userCancelled then
		local f6_local0 = Engine.IJEBHJIJF()
		if CONDITIONS.IsInGameBattlesMatch() then
			GAMEBATTLES.LeaveGameBattlesMenu( f6_local0 )
		end
		LUI.FlowManager.RequestAddMenu( "MainMenu", true, f6_local0 )
		Matchmaking.BGCIDACCCJ()
		Tournament.DCEADJJC()
		Engine.DAGFFDGFII( "xstopparty 0" )
		LUI.FlowManager.RequestPopupMenu( nil, "OutdatedPlaylists", false, nil, false, {}, nil, false, false )
	end
end

FencePlaylists.OpenUpdatingPopup = function ( f4_arg0 )
	f4_arg0._openedPopup = true
	local f4_local0 = f4_arg0
	LUI.FlowManager.RequestPopupMenu( nil, "UpdatingPlaylists", false, nil, false, {
		onCancel = function ( f5_arg0, f5_arg1 )
			DebugPrint( "Cancelling FencePlaylists" )
			f4_arg0._state = LUI.Fence.STATE.fail
			f4_arg0._userCancelled = true
		end
	}, nil, true, true )
end

FencePlaylists.UpdateState = function ( f3_arg0 )
	assert( f3_arg0._state ~= LUI.Fence.STATE.fail )
	local f3_local0 = Fences.CDGIDCIBID()
	if f3_local0 == FencePlaylists.state.NEED_UPDATE then
		if not f3_arg0._passed then
			f3_arg0._state = LUI.Fence.STATE.block
		else
			f3_arg0._state = LUI.Fence.STATE.fail
		end
	elseif f3_local0 == FencePlaylists.state.UPDATING then
		f3_arg0._state = LUI.Fence.STATE.block
	elseif f3_local0 == FencePlaylists.state.UP_TO_DATE then
		f3_arg0._state = LUI.Fence.STATE.pass
		f3_arg0._passed = true
	else
		f3_arg0._state = LUI.Fence.STATE.fail
		assert( false, "Unexpected state for playlists fence" )
	end
	if f3_arg0._state == LUI.Fence.STATE.block and not f3_arg0._openedPopup then
		f3_arg0:OpenUpdatingPopup()
	end
end

local f0_local0 = function ( f2_arg0, f2_arg1 )
	local f2_local0 = assert
	local f2_local1
	if f2_arg1 then
		f2_local1 = f2_arg1
	else
		f2_local1 = f2_arg1.onCancel
	end
	f2_local0( f2_local1 )
	f2_local0 = {
		message = Engine.CBBHFCGDIC( "MP_FRONTEND_ONLY/UPDATING_PLAYLISTS" ),
		cancel_func = f2_arg1.onCancel
	}
	local f2_local2 = "live_dialog_text_box"
	if Dvar.IBEGCHEFE( "LRMTMPNPRK" ) then
		f2_local2 = "live_dialog_text_box_with_cancel"
	end
	f2_local1 = MenuBuilder.BuildRegisteredType( f2_local2, f2_local0 )
	f2_local1.id = "UpdatingPlaylists"
	return f2_local1
end

local f0_local1 = function ()
	local f1_local0 = MenuBuilder.BuildRegisteredType( "PopupOK", {
		message = Engine.CBBHFCGDIC( "MPUI/DOWNLOADPLAYLIST" )
	} )
	f1_local0.id = "OutdatedPlaylists"
	return f1_local0
end

MenuBuilder.registerType( "UpdatingPlaylists", f0_local0 )
MenuBuilder.registerType( "OutdatedPlaylists", f0_local1 )
LUI.Fence.Register( "playlists", FencePlaylists )
LockTable( _M )
