-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:49
module( ..., package.seeall )
local f0_local0 = false
FILTER_BUTTON_REF = "button_right_trigger"
local f0_local1 = function ( f26_arg0, f26_arg1 )
	if f26_arg1 then
		for f26_local3, f26_local4 in ipairs( f26_arg0._camoTable ) do
			if f26_local4.ref == f26_arg1 then
				return f26_local3 - 1
			end
		end
	end
	return 0
end

local f0_local2 = function ( f25_arg0, f25_arg1 )
	f25_arg0._previewOptions = {}
	f25_arg0._previewOptions.lootID = f25_arg1.lootID
	if f25_arg1.lootID ~= 0 then
		f25_arg0._previewOptions.lootID = f25_arg1.lootID
		f25_arg0._previewOptions.storePreviewItemType = LOOT.GetTypeForID( f25_arg0._previewOptions.lootID )
		f25_arg0._previewOptions.lootType = LOOT.GetTypeForID( f25_arg0._previewOptions.lootID )
		f25_arg0._previewOptions.itemRef = LOOT.GetItemRef( f25_arg0._previewOptions.lootID )
		if f25_arg1.vehicleRef == "default" then
			f25_arg0._previewOptions.isDefault = true
			f25_arg0._previewOptions.showcaseImage = f25_arg1.showcaseImage
		end
	else
		f25_arg0._previewOptions = f25_arg1
		f25_arg0._previewOptions.isDefault = true
	end
end

local f0_local3 = function ( f24_arg0, f24_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "VehiclePreview", true, f24_arg1, nil, f24_arg0._previewOptions, true )
end

local f0_local4 = function ( f22_arg0, f22_arg1, f22_arg2, f22_arg3 )
	f22_arg2:SetupContextualMenu()
	f22_arg2:AddContextualMenuAction( {
		id = "vehicleCamoPreview",
		button = "button_l3",
		actionName = Engine[0xED84C33EC5F01EA]( 0x723B50246C20EF6 ),
		actionFunction = function ()
			f22_arg0( f22_arg0, f22_arg0 )
		end
	} )
end

local f0_local5 = function ( f21_arg0 )
	f21_arg0.CamoGrid:RefreshContent()
	f21_arg0._unlockCamoNum = 0
	if f21_arg0.FavoritePrompt then
		f21_arg0.FavoritePrompt:UpdateText( isFavorite, f21_arg0._favoriteVehicleCamos.count )
	end
	local f21_local0 = #f21_arg0._camoTable
	local f21_local1 = 0 and f21_local0 - 1 or 0
	for f21_local2 = f21_local0, 2, -1 do
		if f21_arg0._camoTable[f21_local2].isUnlocked == true then
			f21_arg0._unlockCamoNum = f21_arg0._unlockCamoNum + 1
		end
	end
	if f21_arg0.UnlockCount then
		f21_arg0.UnlockCount:UpdateCount( f21_arg0._unlockCamoNum, f21_local1, false, ToUpperCase( Engine[0xED84C33EC5F01EA]( "MENU/COLLECTED" ) ) )
	end
end

local f0_local6 = function ( f20_arg0 )
	local f20_local0 = f20_arg0.CamoGrid
	local f20_local1 = f20_arg0._camoTable
	local f20_local2 = VEHICLE.SetFavoriteItem( f20_arg0, f20_local0, f20_local1, LOOT.itemTypes.VEHICLE_CAMO, f20_arg0._favoriteVehicleCamos )
	if f20_local2 and f20_local1[f20_local0:GetFocusPositionIndex() + 1].ref ~= VEHICLE.DEFAULT_REF then
		f20_arg0._favoriteVehicleCamos = f20_local2
		f0_local0( f20_arg0 )
	end
end

local f0_local7 = function ( f19_arg0 )
	local f19_local0 = MenuUtils.GetSortPromptText( f19_arg0, true )
	local f19_local1 = f19_arg0.CamoGridControls.ButtonHelperText
	f19_local1:PopButtonPrompt( {
		button_ref = FILTER_BUTTON_REF
	} )
	f19_local1:PushButtonPrompt( {
		side = "right",
		priority = 1,
		ignoreTooltipPrompt = true,
		useTextButtons = true,
		helper_text = f19_local0,
		button_ref = FILTER_BUTTON_REF
	} )
end

local f0_local8 = function ( f17_arg0, f17_arg1 )
	local f17_local0 = PLAYER_DATA.IO( f17_arg1, CoD.StatsGroup.NonGame )
	f17_local0 = f17_local0.sortPreferences.vehicleSortPreference.camoActiveFilter
	table.sort( f17_arg0._camoTable, function ( f18_arg0, f18_arg1 )
		if f18_arg0.index == 0 or f18_arg1.index == 0 then
			return f18_arg0.index < f18_arg1.index
		elseif f17_arg0 == VEHICLE.Filter.FAVORITES and f17_arg0._favoriteVehicleCamos[f18_arg0.ref] ~= f17_arg0._favoriteVehicleCamos[f18_arg1.ref] then
			local f18_local0 = f17_arg0._favoriteVehicleCamos[f18_arg0.ref]
			if f18_local0 then
				f18_local0 = not f17_arg0._favoriteVehicleCamos[f18_arg1.ref]
			end
			return f18_local0
		elseif f17_arg0 == VEHICLE.Filter.COLLECTED and f18_arg0.isUnlocked ~= f18_arg1.isUnlocked then
			local f18_local0 = f18_arg0.isUnlocked
			if f18_local0 then
				f18_local0 = not f18_arg1.isUnlocked
			end
			return f18_local0
		elseif f17_arg0 == VEHICLE.Filter.FROM_BATTLE_PASS and f18_arg0.isFromBattlePass ~= f18_arg1.isFromBattlePass then
			local f18_local0 = f18_arg0.isFromBattlePass
			if f18_local0 then
				f18_local0 = not f18_arg1.isFromBattlePass
			end
			return f18_local0
		elseif f17_arg0 == VEHICLE.Filter.FROM_STORE_BUNDLE and f18_arg0.isFromStoreBundle ~= f18_arg1.isFromStoreBundle then
			local f18_local0 = f18_arg0.isFromStoreBundle
			if f18_local0 then
				f18_local0 = not f18_arg1.isFromStoreBundle
			end
			return f18_local0
		else
			local f18_local0 = Engine[0xED84C33EC5F01EA]( f18_arg0.name or 0x0 )
			local f18_local1 = Engine[0xED84C33EC5F01EA]( f18_arg1.name or 0x0 )
			if f18_local0 ~= f18_local1 then
				return f18_local0 < f18_local1
			else
				return false
			end
		end
	end )
	f17_arg0.CamoGrid:RemoveFocusFromChild()
	f17_arg0.CamoGrid:SetNumChildren( #f17_arg0._camoTable )
	f17_arg0.CamoGrid:RefreshContent()
	if f17_arg0.CamoGridControls then
		f0_local0( f17_arg0 )
	end
end

local f0_local9 = function ( f16_arg0, f16_arg1, f16_arg2 )
	local f16_local0 = f16_arg0._camoTable[f16_arg2 * f16_arg0.CamoGrid:GetNumColumns() + f16_arg1 + 1]
	local f16_local1 = VEHICLE.GetDefaultCamo()
	if f16_local0.ref == f16_local1.ref then
		f16_local0.isUnlocked = true
	else
		local f16_local2 = f16_local0.isUnlocked
		if not f16_local2 then
			f16_local2 = LOOT.IsUnlockedWithID( f16_arg0._controllerIndex, f16_local0.lootID )
		end
		f16_local0.isUnlocked = f16_local2
	end
	f16_local0.isSelected = f16_local0.ref == f16_arg0._equippedCamo.ref
	f16_local0.isFavorite = f16_arg0._favoriteVehicleCamos[f16_local0.ref]
	return f16_local0
end

local f0_local10 = function ( f14_arg0, f14_arg1 )
	f14_arg0.CamoGrid:SetRefreshChild( function ( f15_arg0, f15_arg1, f15_arg2 )
		local f15_local0 = f14_arg0( f14_arg0, f15_arg1, f15_arg2 )
		f15_arg0:SetupButton( f14_arg0.GetCamoButtonConfig( f15_local0 ) )
		f15_arg0._itemData = f15_local0
		if not CONDITIONS.IsMobileOrMobileSim() and f15_local0.lootID == 0 then
			f15_arg0:SetEquipped( false )
			f15_arg0:SetNegative( true )
		else
			f15_arg0:SetFavorite( f15_local0.isFavorite )
			f15_arg0:SetEquipped( f15_local0.isSelected )
			f15_arg0:SetDisabled( not f15_local0.isUnlocked )
		end
		f14_arg0( f14_arg0, f14_arg0, f15_arg0, f15_local0.name )
		f14_arg0.SetupCamoButton( f15_arg0, f15_local0 )
	end )
end

local f0_local11 = function ( f12_arg0, f12_arg1 )
	local f12_local0 = function ( f13_arg0 )
		if CONDITIONS.IsMobileOrMobileSim() and not f13_arg0.IsUnlocked and f13_arg0.unlockType == "CHALLENGE" then
			return false
		elseif f13_arg0.isUnlocked or not String.IsNilOrEmpty( f13_arg0.unlockString ) then
			return true
		elseif not Dvar[0x9E5BE3B4BBA4E0E]( 0xBBF84FBDC361CAF ) then
			return false
		end
		local f13_local0 = f13_arg0.lootID
		if f13_local0 then
			f13_local0 = STORE.Bundles.GetFirstBundleWithLootId( f12_arg0, f13_arg0.lootID ) ~= nil
		end
		local f13_local1 = f13_arg0.lootID
		if f13_local1 then
			f13_local1 = BATTLEMAP.IsReward( f12_arg0, f13_arg0.lootID )
		end
		local f13_local2
		if not f13_local0 then
			f13_local2 = f13_local0
		else
			f13_local2 = f13_local1
		end
		return f13_local2
	end
	
	local f12_local1 = {}
	for f12_local5, f12_local6 in ipairs( f12_arg1 ) do
		if f12_local6.ref ~= VEHICLE.DEFAULT_REF and not f12_local0( f12_local6 ) then
			table.insert( f12_local1, f12_local5 )
		end
	end
	for f12_local2 = #f12_local1, 1, -1 do
		table.remove( f12_arg1, f12_local1[f12_local2] )
	end
end

local f0_local12 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0.UpdateSorting = f0_local0
	f3_arg0.FavoriteItem = f0_local0
	local f3_local0 = f3_arg2.vehicleInfo
	local f3_local1 = f3_arg2.vehicleInfo.ref
	f3_arg0._camoTable = VEHICLE.GetVehicleCamos( f3_arg1, f3_local1 )
	f0_local0( f3_arg1, f3_arg0._camoTable )
	f3_arg0.CamoGrid:SetNumChildren( #f3_arg0._camoTable )
	f3_arg0._vehiclePlayerData = VEHICLE.GetPlayerData( f3_arg1, f3_local1 )
	f3_arg0._equippedCamo = VEHICLE.GetEquippedCamo( f3_arg1, f3_local1 )
	f3_arg0._favoriteVehicleCamos = LOOT.GetFavoritesForType( LOOT.itemTypes.VEHICLE_CAMO )
	local f3_local2 = CONDITIONS.IsMobileOrMobileSim()
	f3_arg0._controllerIndex = f3_arg1
	if f3_local2 then
		f3_arg0.ItemDetails:UpdateDetails( f3_arg0._equippedCamo )
	else
		f3_arg0.ItemDetails:SetupForVehicles()
	end
	f3_arg0:UpdateSorting( f3_arg1 )
	f0_local0( f3_arg0, f3_arg1 )
	if not f3_local2 then
		f3_arg0.FullImage:setImage( RegisterMaterial( f3_arg0._equippedCamo.showcaseImage ) )
	else
		local f3_local3 = f3_arg0._equippedCamo.showcaseImage
		if f3_local3 == f3_local0.defaultImage then
			f3_local3 = f3_local0.defaultShowcaseImage
		end
		f3_arg0.FullImage:setImage( RegisterMaterial( f3_local3 ) )
	end
	f3_arg0:addEventHandler( "loot_button_over", function ( f11_arg0, f11_arg1 )
		local f11_local0 = f11_arg1.itemData
		local f11_local1 = STORE.Bundles.GetFirstBundleWithLootId( f3_arg0, f11_local0.lootID ) ~= nil
		local f11_local2 = BATTLEMAP.IsReward( f3_arg0, f11_local0.lootID )
		if f11_local1 then
			f11_local0.unlockText = Engine[0xED84C33EC5F01EA]( 0xFF2BB87EDFA49 )
		elseif f11_local2 then
			f11_local0.unlockText = Engine[0xED84C33EC5F01EA]( 0xBF89C15728EBC78 )
		elseif f11_local0.unlockType == "CHALLENGE" then
			f11_local0.unlockText = f11_local0.unlockString
		else
			f11_local0.unlockText = nil
		end
		f11_local0.isCamo = true
		f11_local0.desc = f11_local0.flavorText and f11_local0.flavorText or ""
		f11_local0.isFavorite = f3_arg0._favoriteVehicleCamos[f11_local0.ref]
		f11_local0.isEquipped = f11_local0.isSelected
		f3_arg0.ItemDetails:UpdateDetails( f11_local0 )
		local f11_local3 = f11_local0.ref
		local f11_local4 = VEHICLE.DEFAULT_REF
		f3_arg0.FullImage:setImage( RegisterMaterial( REG16 and f11_local0.showcaseImage or f3_arg0.defaultShowcaseImage ) )
		if f3_arg0.BundleUpsellButton then
			if f11_local1 then
				f3_arg0.BundleUpsellButton:SetupUpsellButtonWithLootID( f3_arg0, f11_local0.lootID )
			else
				f3_arg0.BundleUpsellButton:HideButton()
			end
		end
		if f11_local0.vehicleRef == "default" then
			f11_local0.showcaseImage = f3_arg0.defaultShowcaseImage
		end
		f3_arg0( f3_arg0, f11_local0 )
		if f3_arg0.FavoritePrompt then
			if f11_local0.isUnlocked and f11_local0.lootID ~= 0 and f11_local0.ref ~= VEHICLE.DEFAULT_REF then
				f3_arg0.FavoritePrompt:SetAlpha( 1 )
				f3_arg0.FavoritePrompt:UpdateText( f3_arg0._favoriteVehicleCamos[f11_local0.ref], f3_arg0._favoriteVehicleCamos.count )
			else
				f3_arg0.FavoritePrompt:SetAlpha( 0 )
			end
		end
	end )
	local f3_local3 = VEHICLE.GetEquippedCamo( f3_arg1, f3_local1 )
	local f3_local4 = f3_arg0.CamoGrid:GetPositionForIndex( f0_local0( f3_arg0, f3_local3.ref ) )
	if not f3_local2 then
		f3_arg0.CamoGrid:SetFocusedPosition( f3_local4, true )
	else
		f3_arg0.CamoGrid:TouchMouseSetActiveToDefaultFocusMenuCreate( f3_arg1 )
		f3_arg0.CamoGrid:SetDefaultFocus( f3_local4 )
	end
	f0_local0( f3_arg0 )
	f3_arg0:addEventHandler( "loot_button_action", function ( f10_arg0, f10_arg1 )
		local f10_local0 = f10_arg1.itemData
		f3_arg0._vehiclePlayerData.camo:set( f10_local0.playerDataIndex and f10_local0.playerDataIndex or 0 )
		f3_arg0._equippedCamo = f10_local0
		f3_arg0.CamoGrid:RefreshContent()
		f10_local0.isCamo = true
		f10_local0.desc = f10_local0.flavorText and f10_local0.flavorText or ""
		f10_local0.isFavorite = f3_arg0._favoriteVehicleCamos[f10_local0.ref]
		f10_local0.isEquipped = f10_local0.isSelected
		f3_arg0.ItemDetails:UpdateDetails( f10_local0 )
	end )
	f3_arg0:AddGamepadEventCallback( "button_left_stick", function ( f9_arg0, f9_arg1 )
		if not CONDITIONS.IsIW9BetaBuildEnabled() then
			f3_arg0( f9_arg0, f9_arg1.controller or f3_arg0 )
		end
	end )
	if CONDITIONS.IsUserSignedInDemonware( f3_arg1 ) then
		f3_arg0:AddGamepadEventCallback( "button_alt2", function ( f8_arg0, f8_arg1 )
			local f8_local0 = f8_arg0.CamoGrid
			local f8_local1 = f8_arg0._camoTable
			local f8_local2 = f8_local0
			if f8_local1[f8_local0:GetFocusPositionIndex() + 1].ref ~= VEHICLE.DEFAULT_REF then
				f3_arg0( f8_arg0 )
				return true
			else
				
			end
		end )
	end
	f3_arg0:AddGamepadEventCallback( "button_right_trigger", function ( f7_arg0, f7_arg1 )
		local f7_local0 = f7_arg1.controller or f3_arg0
		if f3_arg0 then
			LUI.FlowManager.RequestPopupMenu( nil, "VehiclesFilterPopupLayout", true, f7_local0, false, {
				menuDescription = 0xBA4110736267DDD,
				menuTitleRef = 0x44C248608099C2C,
				controllerIndex = f7_local0,
				menu = f7_arg0,
				shouldSkipFilters = {
					VEHICLE.Filter.UNLOCKED
				},
				type = VEHICLE.FilterType.CAMO_FILTER
			} )
		end
	end )
	LAYOUT.SetupGenericGridViewInputAnimations( f3_arg0, f3_arg0.CamoGrid, {
		gridChangeToGridViewAnimOverride = "GridView",
		gridChangeToDetailViewAnimOverride = "NormalView"
	} )
	if f3_arg0.CamoGridControls then
		f3_arg0.CamoGrid:SetGridViewAction( f3_arg0, f3_arg0.CamoGridControls.ButtonHelperText, f3_arg0.CamoGrid:GetNumColumns() )
		f3_arg0.CamoGrid:RegisterGamepadEventHandlers( f3_arg0, f3_arg0.CamoGridControls, f3_arg0.CamoGridControls.ButtonHelperText, {
			condensedRows = 1,
			expandedRows = 3
		} )
		f3_arg0.CamoGridControls.ButtonHelperText:addEventHandler( "grid_view_prompt_refreshed", function ( f6_arg0, f6_arg1 )
			f3_arg0( f3_arg0, f3_arg0 )
		end )
	end
	f3_arg0:addAndCallEventHandler( "restore_focus", function ( f5_arg0, f5_arg1 )
		f3_arg0:UpdateSorting( f3_arg0 )
	end )
	local f3_local5 = Engine[0x3B8CFB6758EF57C]()
	local f3_local6 = f3_arg0._equippedCamo
	local f3_local7 = f3_arg0._equippedCamo.lootID
	f3_arg0:addEventHandler( "menu_close", function ( f4_arg0, f4_arg1 )
		local f4_local0 = f3_arg0._equippedCamo
		METRICS.VehicleUsageSendDLogEvent( f3_arg0.id, f3_arg0, f3_arg0, f3_arg0, f3_arg0._equippedCamo.lootID )
		LOOT.SendDlogLootEquipped( f3_arg0, LOOT.itemTypes.VEHICLE_CAMO, f3_arg0, f4_local0 )
	end )
	if not f3_local2 then
		MenuUtils.SetupSideArrows( f3_arg0, f3_arg0.CamoGrid, true )
	end
end

local f0_local13 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
	f2_arg0._controllerIndex = f2_arg1
end

function VehicleCamoSelectBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "VehicleCamoSelectBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "VehicleCamoSelectBase", VehicleCamoSelectBase )
LockTable( _M )
