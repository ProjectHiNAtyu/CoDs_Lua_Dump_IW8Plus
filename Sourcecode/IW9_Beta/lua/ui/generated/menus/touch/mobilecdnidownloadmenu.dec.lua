-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 12-11-2025 23:02
module( ..., package.seeall )
require( "ui.generated.widgets.touch.mobilecdnidownloaditem" )
require( "ui.generated.widgets.wzm.mobileprimarynavtab" )
require( "ui.generated.widgets.wzm.mobileprimarynavtabspacer" )
require( "ui.generated.widgets.wzm.mobilealtheader" )
local f0_local0 = {
	Language = 1,
	Scenario = 2,
	Mandatory = 0
}
local f0_local1 = {
	Pending = 2,
	Paused = 3,
	Finished = 4,
	Downloading = 1,
	None = 0
}
local f0_local2 = {
	[f0_local1.None] = 0xA45CEB1558F2F2F,
	[f0_local1.Downloading] = 0x93575CF012A738B,
	[f0_local1.Pending] = 0xD0019D21DBD9640,
	[f0_local1.Paused] = 0x4F30DAF0CFF2197,
	[f0_local1.Finished] = 0xE48B3B9C80B8E37
}
local f0_local3 = {
	[f0_local0.Language] = {
		visible = true,
		name = 0x8652B9D730015A8
	},
	[f0_local0.Scenario] = {
		visible = true,
		name = 0xA902A7FC0566A8
	}
}
local f0_local4 = function ( f14_arg0 )
	local f14_local0 = 1024
	local f14_local1 = 1024 * f14_local0
	local f14_local2 = 1024 * f14_local1
	local f14_local3 = "B"
	if f14_local2 < f14_arg0 then
		f14_arg0 = f14_arg0 / f14_local2
		f14_local3 = "GB"
	elseif f14_local1 < f14_arg0 then
		f14_arg0 = f14_arg0 / f14_local1
		f14_local3 = "MB"
	elseif f14_local0 < f14_arg0 then
		f14_arg0 = f14_arg0 / f14_local0
		f14_local3 = "KB"
	end
	return string.format( "%.2f", f14_arg0 ) .. f14_local3
end

local f0_local5 = function ( f10_arg0 )
	local f10_local0 = CDNI[0xDC16AA707E46963]()
	local f10_local1 = {}
	local f10_local2 = {}
	for f10_local6, f10_local7 in ipairs( f10_local0 ) do
		if f10_local7.type == f0_local0.Language then
			table.insert( f10_local1, f10_local7 )
		end
		if f10_local7.type == f0_local0.Scenario then
			table.insert( f10_local2, f10_local7 )
		end
	end
	f10_arg0.tasks = {
		languages = f10_local1,
		scenarios = f10_local2
	}
	if f10_arg0.selectedTab == f0_local0.Language then
		f10_arg0.GridLayout:SetNumChildren( #f10_arg0.tasks.languages )
	elseif f10_arg0.selectedTab == f0_local0.Scenario then
		f10_arg0.GridLayout:SetNumChildren( #f10_arg0.tasks.scenarios )
	end
	f10_arg0.GridLayout:SetRefreshChild( function ( f11_arg0, f11_arg1, f11_arg2 )
		local f11_local0 = f10_arg0.GridLayout:GetContentIndex( f11_arg1, f11_arg2 )
		f11_arg0.index = f11_local0
		local f11_local1, f11_local2 = nil
		if f10_arg0.selectedTab == f10_arg0.Language then
			f11_local1 = f10_arg0.tasks.languages[f11_local0 + 1]
			f11_local2 = StringTable[0x6E34EAC0192FA9F]( CSV.cdniOptionalContents.file, StringTable[0x8073B436CDE1BF]( CSV.cdniOptionalContents.file, CSV.cdniOptionalContents.cols.ref, 0x0 .. Languages[f11_local1.language] ) )
			f11_arg0.Name:setText( GetLanguageDisplayName( f11_local1.language ) )
			f11_arg0.IconText:setText( "LANG" )
		elseif f10_arg0.selectedTab == f10_arg0.Scenario then
			f11_local1 = f10_arg0.tasks.scenarios[f11_local0 + 1]
			f11_local2 = StringTable[0x6E34EAC0192FA9F]( CSV.cdniOptionalContents.file, StringTable[0x8073B436CDE1BF]( CSV.cdniOptionalContents.file, CSV.cdniOptionalContents.cols.ref, f11_local1.scenario ) )
			f11_arg0.Name:setText( Engine[0xED84C33EC5F01EA]( f11_local2[CSV.cdniOptionalContents.cols.title + 1] ) )
		end
		f11_arg0.SizeText:setText( "" .. f10_arg0( f11_local1.downloadedSize ) .. "/" .. f10_arg0( f11_local1.totalSize ) )
		local f11_local3
		if f11_local1.totalSize == 0 then
			f11_local3 = 1
		else
			f11_local3 = f11_local1.downloadedSize / f11_local1.totalSize
		end
		f11_arg0.PercentageText:setText( math.floor( f11_local3 * 100 ) .. "%" )
		local f11_local4 = f11_arg0.ProgressBarBg:GetAnchorsAndPosition()
		local f11_local5 = (f11_local4.right - f11_local4.left) * f11_local3
		local f11_local6 = f11_arg0.ProgressBar:GetAnchorsAndPosition()
		f11_arg0.ProgressBar:SetAnchorsAndPosition( f11_local6.leftAnchor, f11_local6.rightAnchor, f11_local6.topAnchor, f11_local6.bottomAnchor, f11_local6.left, f11_local6.left + f11_local5, f11_local6.top, f11_local6.bottom )
		f11_arg0.StatusText:setText( Engine[0xED84C33EC5F01EA]( f10_arg0[f11_local1.status] ) )
		if f11_local1.status ~= f10_arg0.None then
			f11_arg0.CancelButton:SetButtonDisabled( false )
			f11_arg0.CancelButton:registerEventHandler( "button_action", function ( element, event )
				CDNI[0xE7C73E75CB0A166]( f11_arg0.index )
			end )
		else
			f11_arg0.CancelButton:SetButtonDisabled( true )
		end
		local f11_local7 = Engine[0xF35D89342CF7712]()
		if f11_local1.status == f10_arg0.Finished then
			f11_arg0.ActionButton:SetButtonDisabled( true )
			f11_arg0.ActionButton.Text:setText( Engine[0xED84C33EC5F01EA]( 0xE48B3B9C80B8E37 ) )
			f11_arg0.ActionButton.Text:SetVisible( true )
			f11_arg0.ActionButton.Icon:SetVisible( false )
			f11_arg0.StatusText:SetVisible( false )
			if f11_local1.language == f11_local7 then
				f11_arg0.CancelButton:SetButtonDisabled( true )
			end
		else
			f11_arg0.ActionButton:SetButtonDisabled( false )
			f11_arg0.ActionButton.Icon:SetVisible( true )
			f11_arg0.ActionButton.Text:SetVisible( false )
			f11_arg0.StatusText:SetVisible( true )
			f11_arg0.ActionButton:registerEventHandler( "button_action", function ( element, event )
				if f11_arg0.status == f11_arg0.None or f11_arg0.status == f11_arg0.Paused then
					CDNI[0xBB1FFB3E09A5B49]( f11_arg0.index )
				elseif f11_arg0.status == f11_arg0.Downloading or f11_arg0.status == f11_arg0.Pending then
					f11_arg0.ActionButton.Icon:setImage( RegisterMaterial( 0x5B5AE9A448E7774 ), 0 )
					CDNI[0x9C06347C66BA4F0]( f11_arg0.index )
				end
			end )
		end
	end )
end

local f0_local6 = function ( f6_arg0, f6_arg1, f6_arg2 )
	f6_arg0:addEventHandler( "menu_create", function ( f8_arg0, f8_arg1 )
		local f8_local0 = {}
		for f8_local4, f8_local5 in ipairs( f6_arg0 ) do
			table.insert( f8_local0, {
				name = Engine[0xED84C33EC5F01EA]( f8_local5.name ),
				hasDefaultFocus = f8_local4 == 1,
				focusFunction = function ( f9_arg0, f9_arg1, f9_arg2, f9_arg3 )
					f8_arg0.selectedTab = f9_arg2 + 1
					f8_arg0( f8_arg0 )
				end
			} )
		end
		f6_arg0.Tabs:SetTabs( f8_local0 )
	end )
	f6_arg0:registerEventHandler( "cdni_update_download_tasks", function ( element, event )
		f6_arg0( element )
	end )
end

function MobileCDNiDownloadMenu( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "MobileCDNiDownloadMenu"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	local BG = nil
	
	BG = LUI.UIFixedAspectRatioImage.new()
	BG.id = "BG"
	BG:setImage( RegisterMaterial( 0x8B0C1CFA5D0A9EE ), 0 )
	BG:setStretchedDimension( LUI.UIFixedAspectRatioImage.Dimensions.FILL_SCREEN )
	BG:SetAnchorsAndPosition( 0.5, 0.5, 0.5, 0.5, _1080p * -1170, _1080p * 1170, _1080p * -540, _1080p * 540 )
	self:addElement( BG )
	self.BG = BG
	
	local GridLayout = nil
	
	GridLayout = LUI.UIGrid.new( {
		maxVisibleRows = 10,
		maxVisibleColumns = 1,
		controllerIndex = f1_local1,
		buildChild = function ()
			return MenuBuilder.BuildRegisteredType( "MobileCDNiDownloadItem", {
				controllerIndex = menu
			} )
		end,
		refreshChild = function ( f4_arg0, f4_arg1, f4_arg2 )
			
		end,
		spacingX = _1080p * 5,
		spacingY = _1080p * 5,
		columnWidth = _1080p * 1920,
		rowHeight = _1080p * 200
	} )
	GridLayout.id = "GridLayout"
	GridLayout:SetMaxVisibleRows( 10 )
	GridLayout:SetRowSpacing( 5 )
	GridLayout:setUseStencil( true )
	GridLayout:SetAnchorsAndPosition( 0, 1, 0, 1, _1080p * 1.61, _1080p * 1919.61, _1080p * 270, _1080p * 1080 )
	self:addElement( GridLayout )
	self.GridLayout = GridLayout
	
	local Tabs = nil
	
	Tabs = LUI.TabManager.new( {
		spacing = 0,
		wrap = false,
		tabHeight = _1080p * 152,
		buildTab = function ()
			return MenuBuilder.BuildRegisteredType( "MobilePrimaryNavTab", {
				controllerIndex = menu
			} )
		end,
		buildSpacer = function ()
			return MenuBuilder.BuildRegisteredType( "MobilePrimaryNavTabSpacer", {
				controllerIndex = menu
			} )
		end,
		controllerIndex = f1_local1
	} )
	Tabs.id = "Tabs"
	Tabs:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 1920, _1080p * 116, _1080p * 268 )
	self:addElement( Tabs )
	self.Tabs = Tabs
	
	local Header = nil
	
	Header = MenuBuilder.BuildRegisteredType( "MobileAltHeader", {
		controllerIndex = f1_local1
	} )
	Header.id = "Header"
	Header.MenuTitle:setText( Engine[0xED84C33EC5F01EA]( 0x390E5AFF98476AA ), 0 )
	Header:SetAnchorsAndPosition( 0, 1, 0, 1, 0, _1080p * 1920, _1080p * -4, _1080p * 116 )
	self:addElement( Header )
	self.Header = Header
	
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "MobileCDNiDownloadMenu", MobileCDNiDownloadMenu )
LockTable( _M )
