-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 21-11-2025 08:49
module( ..., package.seeall )
local f0_local0 = 1
local f0_local1 = 2
local f0_local2 = 9257
local f0_local3 = 9225
local f0_local4 = "ProressionUnlockMenu -> CurrentXP: %s,    CurrentRank: %s \n"
local f0_local5 = function ( f9_arg0, f9_arg1 )
	return f9_arg0._cachedPrestigeWithUnlockChallenges[f9_arg1]
end

local f0_local6 = function ( f8_arg0, f8_arg1 )
	local f8_local0 = f8_arg1 <= f8_arg0.currentRank
	f8_arg0.rewardPackage = AAR.GetRankupUnlockPackage( f8_arg0._controllerIndex, f8_arg1 )
	local f8_local1 = ACTIONS.AnimateSequence
	local f8_local2 = f8_arg0
	local f8_local3
	if 1 < #f8_arg0.rewardPackage then
		f8_local3 = "TwoRewards"
	else
		f8_local3 = "OneReward"
	end
	f8_local1( f8_local2, f8_local3 )
	f8_local1 = ACTIONS.AnimateSequence
	f8_local2 = f8_arg0
	if f8_local0 then
		f8_local3 = "RankUnlocked"
	else
		f8_local3 = "RankLocked"
	end
	f8_local1( f8_local2, f8_local3 )
	if not f8_local0 then
		f8_arg0.RankCriteriaLabel:setText( ToUpperCase( Engine[0xED84C33EC5F01EA]( 0x720B4540EF9A7BC, PROGRESSION.GetRankMinXP( f8_arg1 ) - f8_arg0.XP ) ) )
	end
	f8_local1 = f8_arg0.rewardPackage[f0_local0]
	local f8_local4 = f8_arg0.rewardPackage[f0_local0]
	if f8_local1 then
		f8_local2 = nil
		if LUI.IsGamepadActiveInputMethodForPrompts( f8_arg0._controllerIndex ) then
			if f8_local1.lootID == f0_local0 then
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0x9CCCEBC6FC6BBCE )
			elseif f8_local1.lootID == f0_local0 then
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0x28CBD733B529687 )
			end
		elseif LUI.IsLastInputKeyboardMouse( f8_arg0._controllerIndex ) then
			if f8_local1.lootID == f0_local0 then
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0xC1041AFAF4E1706 )
			elseif f8_local1.lootID == f0_local0 then
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0x20AAE95D8A457FB )
			end
		end
		if f8_arg1 > PROGRESSION.GetMaxRank() then
			if f8_local0 then
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0x74C28011D5E2D73 )
			else
				f8_local1.desc = Engine[0xED84C33EC5F01EA]( 0xE86C881F8C4436C, f8_arg0._cachedPrestigeWithUnlockChallenges[f8_arg1] )
			end
		end
		f8_arg0.DescLeft:SetupDescription( f8_local1, f8_local0, f8_arg0._cachedPrestigeWithBattlepassRewards and f8_arg0._cachedPrestigeWithBattlepassRewards[f8_arg1] or nil )
	end
	if f8_local4 then
		if f8_local4.unlockRank == PROGRESSION.GetPlayerLifeTimeMaxRank() then
			f8_local4.desc = Engine[0xED84C33EC5F01EA]( 0x1FAC8067AD0BA71 )
		elseif f8_arg1 > PROGRESSION.GetMaxRank() then
			f8_local4.desc = Engine[0xED84C33EC5F01EA]( 0xFBC885B58B734F0 )
		end
		f8_arg0.DescRight:SetupDescription( f8_local4, f8_local0 )
	end
	f8_arg0.GhostRankNumber:setText( MarkLocalized( PROGRESSION.FormatNumber( f8_arg1 + 1 ) ) )
end

local f0_local7 = function ( f7_arg0 )
	local f7_local0 = 1
	local f7_local1 = 999999
	for f7_local2 = 1, #f7_arg0._cachedElderRankWithUnlockChallenges, 1 do
		local f7_local5 = math.abs( f7_arg0._cachedElderRankWithUnlockChallenges[f7_local2] - f7_arg0.currentRank )
		if f7_local5 < f7_local1 then
			f7_local1 = f7_local5
			f7_local0 = f7_local2
		end
	end
	return f7_local0
end

local f0_local8 = function ( f6_arg0, f6_arg1 )
	local f6_local0 = 1
	local f6_local1 = 999999
	if f6_arg1 <= PROGRESSION.GetMaxRank() then
		return f6_arg1
	end
	for f6_local2 = 1, #f6_arg0._cachedElderRankWithUnlockChallenges, 1 do
		local f6_local5 = f6_arg0._cachedElderRankWithUnlockChallenges[f6_local2]
		if math.abs( f6_local5 - f6_arg1 ) < f6_local1 then
			f6_local1 = math.abs( f6_local5 - f6_arg1 )
			f6_local0 = f6_local5
		end
	end
	return f6_local0
end

local f0_local9 = function ( f5_arg0, f5_arg1 )
	return f5_arg0._cachedElderRankWithUnlockChallenges[f5_arg1]
end

local f0_local10 = function ( f4_arg0 )
	f4_arg0._cachedElderRankWithUnlockChallenges = {}
	f4_arg0._cachedPrestigeWithUnlockChallenges = {}
	f4_arg0._cachedPrestigeWithBattlepassRewards = {}
	local f4_local0 = CSV.progressionItems.GetFile()
	local f4_local1 = StringTable[0xFD4E49A34DD43AE]( f4_local0 )
	local f4_local2 = 1
	for f4_local3 = 0, f4_local1 - 1, 1 do
		local f4_local6 = StringTable[0x6E34EAC0192FA9F]( f4_local0, f4_local3 )
		if not String.IsNilOrEmpty( f4_local6[CSV.progressionItems.cols.unlockedChallenges + 1] ) then
			table.insert( f4_arg0._cachedElderRankWithUnlockChallenges, f4_local3 )
			f4_arg0._cachedPrestigeWithUnlockChallenges[f4_local3] = f4_local2
			f4_local2 = f4_local2 + 1
			local f4_local7 = f4_local6[CSV.progressionItems.cols.firstItem + 1]
		end
	end
end

local f0_local11 = function ( f3_arg0, f3_arg1, f3_arg2 )
	f3_arg0._controllerIndex = f3_arg1
	f3_arg0.UpdateDescriptions = f0_local0
	f3_arg0.GetElderRankClosestRank = f0_local0
	f3_arg0.GetElderRankToSend = f0_local0
	f3_arg0._navigateLeft = 7
	f3_arg0._navigateRight = 11
	f3_arg0._bigJumpAmount = 5
	f3_arg0.maxRankIndex = PROGRESSION.GetMaxRank()
	f3_arg0.XP = PROGRESSION.GetPlayerLifeTimeXP( f3_arg1 )
	f3_arg0.currentRank = PROGRESSION.GetRankByXP( f3_arg0.XP )
	if f3_arg0.currentRank == f3_arg0.maxRankIndex then
		f3_arg0.percentage = 1
	else
		local f3_local0 = PROGRESSION.GetRankMinXP( f3_arg0.currentRank )
		f3_arg0.percentage = (f3_arg0.XP - f3_local0) / (PROGRESSION.GetRankMaxXP( f3_arg0.currentRank ) - f3_local0)
	end
	DebugPrint( string.format( f0_local0, tostring( f3_arg0.XP ), tostring( f3_arg0.currentRank ) ) )
	f3_arg0.MenuTitle:SetTitle( Engine[0xED84C33EC5F01EA]( 0xADF517D84B9BD12 ) )
	f3_arg0.currentRankIndex = f3_arg0.currentRank
	if PROGRESSION.IsElder( f3_arg1 ) then
		f0_local0( f3_arg0 )
		f3_arg0.maxRankIndex = f3_arg0.maxRankIndex + #f3_arg0._cachedElderRankWithUnlockChallenges
		f3_arg0.currentRankIndex = PROGRESSION.GetMaxRank() + f0_local0( f3_arg0 )
	end
end

local f0_local12 = function ( f2_arg0, f2_arg1, f2_arg2 )
	f2_arg0.PostLoadShared = f0_local0
end

function ProgressionUnlockMenuBase( menu, controller )
	local self = LUI.UIElement.new()
	self.id = "ProgressionUnlockMenuBase"
	local f1_local1
	if controller then
		f1_local1 = controller
	else
		f1_local1 = controller.controllerIndex
	end
	f1_local1 = LUI.ValidateControllerIndex( self, f1_local1 )
	local f1_local2 = self
	f0_local0( self, f1_local1, controller )
	return self
end

MenuBuilder.registerType( "ProgressionUnlockMenuBase", ProgressionUnlockMenuBase )
LockTable( _M )
