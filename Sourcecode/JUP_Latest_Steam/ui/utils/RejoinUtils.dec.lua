-- Generated by CoDLuaDecompiler
-- Version: 2.4.2
-- Date: 30-11-2025 17:02
RejoinUtils = RejoinUtils or {}
RejoinUtils.Achievements = {
	name = "iw9_rejoin",
	csv = CSV.rejoinAchievements
}
RejoinUtils.REJOIN_POPUP_TYPE = {
	GENERIC = 2,
	RANKED = 1
}
RejoinUtils.RejoinProcessFunctions = {
	[RejoinUtils.REJOIN_POPUP_TYPE.RANKED] = {
		lobbyActiveFunc = function ( f50_arg0, f50_arg1, f50_arg2, f50_arg3 )
			RejoinUtils.ProcessRankedPlayRejoinForActiveLobby( f50_arg0, f50_arg1, f50_arg2, f50_arg3 )
		end,
		lobbyInactiveFunc = function ( f49_arg0, f49_arg1 )
			RejoinUtils.ProcessRankedPlayRejoinForInactiveLobby( f49_arg0, f49_arg1 )
		end
	},
	[RejoinUtils.REJOIN_POPUP_TYPE.GENERIC] = {
		lobbyActiveFunc = function ( f48_arg0, f48_arg1, f48_arg2, f48_arg3 )
			RejoinUtils.ProcessGenericRejoin( f48_arg0, f48_arg1, f48_arg2, f48_arg3 )
		end
	}
}
RejoinUtils.SEPARATORS = {
	COMMA = ","
}
local f0_local0 = function ( f47_arg0, f47_arg1 )
	local f47_local0 = ""
	for f47_local4, f47_local5 in ipairs( f47_arg0 ) do
		f47_local0 = f47_local0 .. tostring( f47_local5 ) .. RejoinUtils.SEPARATORS.COMMA
	end
	DataSources.inGame.HUD.rejoin.disconnectedMayRejoinXuids:SetValue( f47_arg1, f47_local0 )
end

local f0_local1 = function ( f46_arg0 )
	return String.Split( DataSources.inGame.HUD.rejoin.disconnectedMayRejoinXuids:GetValue( f46_arg0 ) or "", RejoinUtils.SEPARATORS.COMMA )
end

RejoinUtils.IsXuidInDisconnectedMayRejoinArray = function ( f45_arg0, f45_arg1 )
	return Table.IsItemIndexInArray( f0_local0( f45_arg1 ), f45_arg0 )
end

RejoinUtils.AddXuidToDisconnectedArray = function ( f44_arg0, f44_arg1 )
	local f44_local0 = f0_local0( f44_arg1 )
	if not Table.FindItemIndexInArray( f44_local0, f44_arg0 ) then
		table.insert( f44_local0, f44_arg0 )
	end
	f0_local0( f44_local0, f44_arg1 )
end

RejoinUtils.RemoveXuidFromDisconnectArray = function ( f43_arg0, f43_arg1 )
	local f43_local0 = f0_local0( f43_arg1 )
	local f43_local1 = Table.FindItemIndexInArray( f43_local0, f43_arg0 )
	if f43_local1 then
		table.remove( f43_local0, f43_local1 )
	end
	f0_local0( f43_local0, f43_arg1 )
end

RejoinUtils.SubscribeToDisconnectedMayRejoin = function ( f41_arg0, f41_arg1, f41_arg2, f41_arg3 )
	if f41_arg0._disconnectedRejoinSubscription then
		f41_arg0:UnsubscribeFromModel( f41_arg0._disconnectedRejoinSubscription )
		f41_arg0._disconnectedRejoinSubscription = nil
		if f41_arg3 then
			f41_arg3()
		end
	end
	if DataSources.inGame.HUD.rejoin.disconnectedMayRejoinXuids ~= nil then
		f41_arg0._disconnectedRejoinSubscription = f41_arg0:SubscribeToModel( DataSources.inGame.HUD.rejoin.disconnectedMayRejoinXuids:GetModel( f41_arg1 ), function ()
			f41_arg0( f41_arg0, f41_arg0 )
		end, true )
	end
end

RejoinUtils.PopupFunctions = {}
RejoinUtils.PopupFunctions.ConfirmQuitAcceptFunction = function ( f40_arg0 )
	RejoinUtils.SendRejoinSeenEvent( f40_arg0 )
end

RejoinUtils.PopupFunctions.OpenRejoinMatchPopup = function ( f36_arg0, f36_arg1 )
	local f36_local0 = nil
	if f36_arg1 == RejoinUtils.REJOIN_POPUP_TYPE.RANKED then
		f36_local0 = LeaguePlayUtils.GetPenaltyData( f36_arg0 )
	end
	local f36_local1 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.rejoinExpiryTimestamp" )
	local f36_local2 = f36_local1:GetValue( f36_arg0 )
	if f36_local2 <= 0 then
		
	else
		
	end
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f36_arg0, false, {
		_isRejoinState = true,
		_rejoinType = f36_arg1,
		_penaltyData = f36_local0,
		_rejoinExpiry = f36_local2,
		_button1Action = function ()
			RejoinUtils.PopupFunctions.OpenRejoinAttemptPopup( f36_arg0, f36_arg0 )
		end,
		_button2Action = function ()
			RejoinUtils.PopupFunctions.OpenConfirmQuitPopup( f36_arg0, f36_arg0 )
		end,
		_timerEndAction = function ()
			RejoinUtils.PopupFunctions.OpenRejoinTimerExpiredPopup( f36_arg0, f36_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenRejoinAttemptPopup = function ( f34_arg0, f34_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinConfirmPopup", true, f34_arg0, false, {
		_isRejoinAttempt = true,
		_button2Action = function ()
			RejoinUtils.PopupFunctions.OpenRejoinMatchPopup( f34_arg0, f34_arg0 )
		end
	} )
	Lobby[0x6AF379898C13E99]( f34_arg0 )
end

local f0_local2 = function ( f33_arg0 )
	LUI.ToastManager.CreateToast( f33_arg0, LUI.ToastManager.StandardEmphasisToast( Engine[0xED84C33EC5F01EA]( 0xF235F4BC6410A83 ), Engine[0xED84C33EC5F01EA]( 0x8846DB22F4BC615 ), LUI.ToastManager.ToastNotificationType.Warnings, FRIENDS.CrossTitleGameIDs.TITLE_NONE, false, LUI.ToastManager.ToastVisualEffect.Standard ), nil, nil, {
		displayTime = LeaguePlayUtils.RejoinReject.ToastDisplayTime
	} )
end

local f0_local3 = function ( f32_arg0 )
	RejoinUtils.SendRejoinSeenEvent( f32_arg0 )
	LUI.ToastManager.CreateToast( f32_arg0, LUI.ToastManager.StandardEmphasisToast( Engine[0xED84C33EC5F01EA]( 0xF56CBDA50483430 ), Engine[0xED84C33EC5F01EA]( 0x300C4C434CDEE98 ), LUI.ToastManager.ToastNotificationType.Warnings, FRIENDS.CrossTitleGameIDs.TITLE_NONE, false, LUI.ToastManager.ToastVisualEffect.Standard ), nil, nil, {
		displayTime = LeaguePlayUtils.RejoinReject.ToastDisplayTime
	} )
end

local f0_local4 = function ( f31_arg0 )
	LUI.ToastManager.CreateToast( f31_arg0, LUI.ToastManager.StandardEmphasisToast( Engine[0xED84C33EC5F01EA]( 0x1DA655C5093FBA5 ), Engine[0xED84C33EC5F01EA]( 0x34BA70C16E4C361 ), LUI.ToastManager.ToastNotificationType.Warnings, FRIENDS.CrossTitleGameIDs.TITLE_NONE, false, LUI.ToastManager.ToastVisualEffect.Standard ), nil, nil, {
		displayTime = LeaguePlayUtils.RejoinCheck.ToastDisplayTime
	} )
end

RejoinUtils.PopupFunctions.OpenRejoinRejectedWaitPopup = function ( f28_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f28_arg0, false, {
		_isRejoinReject = true,
		_waitTime = LeaguePlayUtils.RejoinReject.WaitTime,
		_interval = LeaguePlayUtils.RejoinReject.IntervalTime,
		_intervalAction = function ( f30_arg0, f30_arg1 )
			local f30_local0 = RejoinUtils.GetLastLobbyDisconnectedReasonAchievement( f28_arg0 )
			if RejoinUtils.TempRejoinStateReason then
				if not RejoinUtils.TempRejoinStateReason.CanCheckForValidRejoinRejectState and f30_local0 == LeaguePlayUtils.RejoinStateReason.CLIENT_REJECTED_REJOIN then
					RejoinUtils.TempRejoinStateReason = {
						CanCheckForValidRejoinRejectState = true,
						StateId = f30_local0
					}
				elseif RejoinUtils.TempRejoinStateReason.CanCheckForValidRejoinRejectState and f30_local0 == LeaguePlayUtils.DisconnectReason.NONE then
					f28_arg0( f28_arg0 )
					ACTIONS.NonImmediateLeaveMenu( f30_arg0 )
				end
			end
		end,
		_timerEndAction = function ()
			f28_arg0( f28_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenRejoinCheckWaitPopup = function ( f25_arg0 )
	RejoinUtils.TempRejoinCheckState = nil
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f25_arg0, false, {
		_isRejoinCheckWait = true,
		_waitTime = LeaguePlayUtils.RejoinCheck.WaitTime,
		_interval = LeaguePlayUtils.RejoinCheck.IntervalTime,
		_intervalAction = function ( f27_arg0, f27_arg1 )
			local f27_local0 = RejoinUtils.GetLastLobbyDisconnectedReasonAchievement( f25_arg0 )
			if f27_local0 == LeaguePlayUtils.DisconnectReason.NONE then
				if not RejoinUtils.TempRejoinCheckState and f27_arg1 <= LeaguePlayUtils.RejoinCheck.RejectTriggerTime then
					RejoinUtils.TempRejoinCheckState = {
						RejoinRejectInitiated = true,
						StateId = f27_local0
					}
					RejoinUtils.SendRejoinSeenEvent( f25_arg0 )
				elseif RejoinUtils.TempRejoinCheckState then
					f25_arg0( f25_arg0 )
					ACTIONS.NonImmediateLeaveMenu( f27_arg0 )
				end
			elseif LUI.RejoinManager.IsDataFetchCompleted() and RejoinUtils.IsLobbyDisconnectReasonRejoinable( f27_local0 ) then
				ACTIONS.NonImmediateLeaveMenu( f27_arg0 )
				RejoinUtils.UpdateRejoinState( f25_arg0 )
				return 
			end
		end,
		_timerEndAction = function ()
			f25_arg0( f25_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenConfirmQuitPopup = function ( f22_arg0, f22_arg1 )
	local f22_local0 = nil
	if f22_arg1 == RejoinUtils.REJOIN_POPUP_TYPE.RANKED then
		f22_local0 = LeaguePlayUtils.GetPenaltyData( f22_arg0 )
	end
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinConfirmPopup", true, f22_arg0, false, {
		_isConfirmQuitMatch = true,
		_penaltyData = f22_local0,
		_confirmQuitType = f22_arg1,
		_button1Action = function ()
			RejoinUtils.PopupFunctions.ConfirmQuitAcceptFunction( f22_arg0 )
			RejoinUtils.TempRejoinStateReason = {
				StateId = 0,
				CanCheckForValidRejoinRejectState = false
			}
			RejoinUtils.PopupFunctions.OpenRejoinRejectedWaitPopup( f22_arg0 )
		end,
		_button2Action = function ()
			RejoinUtils.PopupFunctions.OpenRejoinMatchPopup( f22_arg0, f22_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenMatchEndedNoPenaltyPopup = function ( f20_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f20_arg0, false, {
		_isMatchEndedNoPenalty = true,
		_button1Action = function ()
			RejoinUtils.SendRejoinSeenEvent( f20_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenDisconnectedPopup = function ( f18_arg0, f18_arg1 )
	local f18_local0 = LeaguePlayUtils.GetPenaltyData( f18_arg0 )
	f18_local0.disconnectReason = f18_arg1
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f18_arg0, false, {
		_isDisconnected = true,
		_penaltyData = f18_local0,
		_button1Action = function ()
			RejoinUtils.SendRejoinSeenEvent( f18_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenSuspensionRecievedPopup = function ( f16_arg0, f16_arg1 )
	local f16_local0 = LeaguePlayUtils.GetPenaltyData( f16_arg0 )
	f16_local0.disconnectReason = f16_arg1
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f16_arg0, false, {
		_isSuspensionReceived = true,
		_penaltyData = f16_local0,
		_button1Action = function ()
			RejoinUtils.SendRejoinSeenEvent( f16_arg0 )
		end
	} )
end

RejoinUtils.PopupFunctions.OpenRejoinTimerExpiredPopup = function ( f14_arg0, f14_arg1 )
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f14_arg0, false, {
		_isRejoinTimerExpired = true,
		_button1Action = function ()
			if f14_arg0 == RejoinUtils.REJOIN_POPUP_TYPE.RANKED then
				RejoinUtils.PopupFunctions.OpenSuspensionRecievedPopup( f14_arg0 )
			end
		end
	} )
end

RejoinUtils.PopupFunctions.OpenTooManyDisconnectPenaltyPopup = function ( f12_arg0 )
	LUI.FlowManager.RequestPopupMenu( nil, "LobbyRejoinPopup", true, f12_arg0, false, {
		_isTooManyDisconnectPenalty = true,
		_penaltyData = LeaguePlayUtils.GetPenaltyData( f12_arg0 ),
		_button1Action = function ()
			RejoinUtils.SendRejoinSeenEvent( f12_arg0 )
		end
	} )
end

RejoinUtils.CheckAndOpenRejoinWaitPopup = function ( f11_arg0 )
	if CONDITIONS.IsRejoinEnabled() and OnlineRejoin[0x12C317C0631D9E2]( f11_arg0 ) then
		RejoinUtils.PopupFunctions.OpenRejoinCheckWaitPopup( f11_arg0 )
	end
end

RejoinUtils.GetRejoinAchievementProgression = function ( f10_arg0, f10_arg1, f10_arg2, f10_arg3 )
	local f10_local0 = OnlineChallenges[0x1EEE6570EF4BB8B]( f10_arg0, StringTable[0x2DCF0973239E909]( f10_arg3.file, f10_arg3.cols.aeName, f10_arg2, f10_arg3.cols.aeID ) )
	if f10_local0 then
		local f10_local1 = f10_local0.progress
		if not f10_local1 then
			f10_local0 = f10_local1
		end
	end
	f10_local0 = {}
end

RejoinUtils.GetLastLobbyDisconnectedReasonAchievement = function ( f9_arg0 )
	local f9_local0 = RejoinUtils.GetRejoinAchievementProgression( f9_arg0, "sub_progress", RejoinUtils.Achievements.name, RejoinUtils.Achievements.csv )
	if not f9_local0 then
		f9_local0 = 0
	end
	return f9_local0
end

RejoinUtils.IsLobbyDisconnectReasonRejoinable = function ( f8_arg0 )
	local f8_local0
	if (f8_arg0 < LeaguePlayUtils.DisconnectReason.FIRST_LEAVE or f8_arg0 > LeaguePlayUtils.DisconnectReason.INACTIVITY) and f8_arg0 ~= LeaguePlayUtils.DisconnectReason.FORCE_DISCONNECT then
		f8_local0 = false
	else
		f8_local0 = true
	end
	return f8_local0
end

RejoinUtils.GetLobbyRejoinPopupType = function ( f7_arg0 )
	if f7_arg0 == Enum[0x3085A67688502CD][0xECB1AED3C240D60] then
		return RejoinUtils.REJOIN_POPUP_TYPE.RANKED
	else
		return RejoinUtils.REJOIN_POPUP_TYPE.GENERIC
	end
end

RejoinUtils.GetRejoinInfoFromAchievement = function ( f6_arg0 )
	local f6_local0 = RejoinUtils.GetRejoinAchievementProgression( f6_arg0, "lobby_id", RejoinUtils.Achievements.name, RejoinUtils.Achievements.csv ) or 0
	local f6_local1 = RejoinUtils.GetRejoinAchievementProgression( f6_arg0, "gametype", RejoinUtils.Achievements.name, RejoinUtils.Achievements.csv ) or 1
	local f6_local2 = RejoinUtils.GetLastLobbyDisconnectedReasonAchievement( f6_arg0 )
	local f6_local3 = RejoinUtils.GetRejoinAchievementProgression( f6_arg0, "expiry_t", RejoinUtils.Achievements.name, RejoinUtils.Achievements.csv ) or 0
	local f6_local4
	if f6_local3 == 0 or f6_local3 >= CoD.GetUTC() then
		f6_local4 = false
	else
		f6_local4 = true
	end
	return {
		lastLobbyID = f6_local0,
		lastLobbyGametype = f6_local1,
		lastLobbyDisconnectReason = f6_local2,
		rejoinExpiry = f6_local3,
		isRejoinExpired = f6_local4
	}
end

RejoinUtils.UpdateRejoinState = function ( f5_arg0 )
	local f5_local0 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.hasLastLobbyInfo" )
	if f5_local0:GetValue( f5_arg0 ) then
		local f5_local1 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.lobbySupportsRejoin" )
		if not f5_local1:GetValue( f5_arg0 ) then
			return 
		end
		local f5_local2 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.isAllowedToRejoinPreviousLobby" )
		local f5_local3 = f5_local2:GetValue( f5_arg0 )
		local f5_local4 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.rejoinExpiryTimestamp" )
		local f5_local5 = f5_local4:GetValue( f5_arg0 )
		local f5_local6 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.rejoinPlaylistID" )
		local f5_local7 = f5_local6:GetValue( f5_arg0 )
		local f5_local8 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.rejoinPlaylistVersion" )
		local f5_local9 = f5_local8:GetValue( f5_arg0 )
		local f5_local10 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.currentPlaylistVersion" )
		local f5_local11 = f5_local9 ~= f5_local10:GetValue( f5_arg0 )
		local f5_local12 = LUI.DataSourceInControllerModel.new( "frontend.rejoinState.performanceGametype" )
		local f5_local13 = RejoinUtils.RejoinProcessFunctions[RejoinUtils.GetLobbyRejoinPopupType( f5_local12:GetValue( f5_arg0 ) )]
		if f5_local13.lobbyActiveFunc then
			f5_local13.lobbyActiveFunc( f5_arg0, f5_local3, f5_local5, f5_local11 )
		end
	else
		local f5_local1 = RejoinUtils.GetRejoinInfoFromAchievement( f5_arg0 )
		local f5_local2 = RejoinUtils.RejoinProcessFunctions[RejoinUtils.GetLobbyRejoinPopupType( f5_local1.lastLobbyGametype )]
		if f5_local2.lobbyInactiveFunc then
			f5_local2.lobbyInactiveFunc( f5_arg0, f5_local1 )
		end
	end
end

RejoinUtils.SendRejoinSeenEvent = function ( f4_arg0 )
	OnlineRejoin[0x95E2903C8049DB]( f4_arg0 )
end

RejoinUtils.ProcessRankedPlayRejoinForActiveLobby = function ( f3_arg0, f3_arg1, f3_arg2, f3_arg3 )
	if not f3_arg1 then
		return 
	end
	local f3_local0 = LeaguePlayUtils.GetLocalPlayerStat( "reason", LeaguePlayUtils.Achievements.Progression, "penalty", true ) == LeaguePlayUtils.DisconnectReason.PENALTY_LIMIT_REACHED
	local f3_local1 = false
	if f3_arg2 ~= 0 then
		f3_local1 = f3_arg2 < CoD.GetUTC()
	end
	if f3_local0 then
		RejoinUtils.PopupFunctions.OpenTooManyDisconnectPenaltyPopup( f3_arg0 )
	elseif f3_local1 then
		RejoinUtils.PopupFunctions.OpenRejoinTimerExpiredPopup( f3_arg0, RejoinUtils.REJOIN_POPUP_TYPE.RANKED )
	elseif f3_arg3 then
		f0_local0( f3_arg0 )
	else
		RejoinUtils.PopupFunctions.OpenRejoinMatchPopup( f3_arg0, RejoinUtils.REJOIN_POPUP_TYPE.RANKED )
	end
end

RejoinUtils.ProcessRankedPlayRejoinForInactiveLobby = function ( f2_arg0, f2_arg1 )
	if f2_arg1.lastLobbyID ~= 0 then
		RejoinUtils.PopupFunctions.OpenMatchEndedNoPenaltyPopup( f2_arg0 )
	end
end

RejoinUtils.ProcessGenericRejoin = function ( f1_arg0, f1_arg1, f1_arg2, f1_arg3 )
	if not f1_arg1 then
		return 
	elseif 0 < f1_arg2 and f1_arg2 < CoD.GetUTC() then
		return 
	elseif f1_arg3 then
		f0_local0( f1_arg0 )
		return 
	else
		RejoinUtils.PopupFunctions.OpenRejoinMatchPopup( f1_arg0, RejoinUtils.REJOIN_POPUP_TYPE.GENERIC )
	end
end

